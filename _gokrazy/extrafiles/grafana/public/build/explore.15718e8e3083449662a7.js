(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9782],{"./public/app/features/dashboard/dashgrid/SeriesVisibilityConfigFactory.ts":(e,t,s)=>{"use strict";s.d(t,{N:()=>a});var n=s("./packages/grafana-data/src/index.ts"),i=s("./packages/grafana-ui/src/index.ts");const o="hideSeriesFrom",r=(0,n.isSystemOverrideWithRef)(o);function a(e,t,s,n){const{overrides:o}=s,a=e,h=o.findIndex(r);if(h<0){if(t===i.SeriesVisibilityChangeMode.ToggleSelection){const e=l([a]);return Object.assign({},s,{overrides:[...s.overrides,e]})}const e=l(p(n,a));return Object.assign({},s,{overrides:[...s.overrides,e]})}const g=Array.from(o),[m]=g.splice(h,1);if(t===i.SeriesVisibilityChangeMode.ToggleSelection){const e=d(m);if(e[0]===a&&1===e.length)return Object.assign({},s,{overrides:g});const t=l([a]);return Object.assign({},s,{overrides:[...g,t]})}const f=c(m,a);return u(f,n)?Object.assign({},s,{overrides:g}):Object.assign({},s,{overrides:[...g,f]})}function l(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.ByNamesMatcherMode.exclude,i=arguments.length>2?arguments[2]:void 0;return i=null!==(t=i)&&void 0!==t?t:{id:"custom.hideFrom",value:{viz:!0,legend:!1,tooltip:!1}},{__systemRef:o,matcher:{id:n.FieldMatcherID.byNames,options:{mode:s,names:e,prefix:s===n.ByNamesMatcherMode.exclude?"All except:":void 0,readOnly:!0}},properties:[Object.assign({},i,{value:{viz:!0,legend:!1,tooltip:!1}})]}}const c=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.ByNamesMatcherMode.exclude;const i=e.properties.find((e=>"custom.hideFrom"===e.id)),o=d(e),r=o.findIndex((e=>e===t));return r<0?o.push(t):o.splice(r,1),l(o,s,i)},d=e=>{var t;const s=null===(t=e.matcher.options)||void 0===t?void 0:t.names;return Array.isArray(s)?s:[]},u=(e,t)=>d(e).length===p(t).length,p=(e,t)=>{const s=new Set;for(const i of e)for(const o of i.fields){if(o.type!==n.FieldType.number)continue;const r=(0,n.getFieldDisplayName)(o,i,e);r!==t&&s.add(r)}return Array.from(s)}},"./public/app/features/explore/Wrapper.tsx":(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>xn});var n=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=s("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/3/opt/drone/yarncache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),o=s("./public/app/types/explore.ts"),r=s("./packages/grafana-ui/src/index.ts"),a=s("./public/app/features/explore/state/main.ts"),l=s("../../opt/drone/yarncache/memoize-one-npm-6.0.0-8b2a2cd020-f185ea69f7.zip/node_modules/memoize-one/dist/memoize-one.esm.js"),c=s("./packages/grafana-data/src/index.ts"),d=s("./packages/grafana-e2e-selectors/src/index.ts"),u=s("./public/app/core/store.ts"),p=s("./public/app/features/explore/state/explorePane.ts"),h=s("./public/app/core/utils/explore.ts"),g=s("./public/app/features/profile/state/selectors.ts"),m=s("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),f=s("../../opt/drone/yarncache/redux-npm-4.1.2-04cdbe7a08-6a839cee5b.zip/node_modules/redux/es/redux.js"),v=s("./.yarn/__virtual__/react-virtualized-auto-sizer-virtual-b5ab366cb0/3/opt/drone/yarncache/react-virtualized-auto-sizer-npm-1.0.6-50869b8392-81270e9d32.zip/node_modules/react-virtualized-auto-sizer/dist/index.esm.js"),x=s("./public/app/features/explore/state/query.ts"),y=s("./public/app/features/explore/state/time.ts"),b=s("../../opt/drone/yarncache/tinycolor2-npm-1.4.2-462ba30c26-57ed262e08.zip/node_modules/tinycolor2/tinycolor.js"),w=s.n(b);const S=function(e,t){var s=(0,n.useRef)((function(){}));(0,n.useEffect)((function(){s.current=e})),(0,n.useEffect)((function(){if(null!==t){var e=setInterval((function(){return s.current()}),t||0);return function(){return clearInterval(e)}}}),[t])};var j=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const T=e=>{let{timeInMs:t,className:s,humanize:n}=e;return(0,j.jsx)("span",{className:`elapsed-time ${s}`,children:R(t,n)})},R=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=e/1e3;if(!t)return`${s.toFixed(1)}s`;const n=(0,c.toDuration)(s,"seconds"),i=n.hours(),o=n.minutes(),r=n.seconds();return i?`${i}h ${o}m ${r}s`:o?`${o}m ${r}s`:`${r}s`},C=e=>{let{resetKey:t,humanize:s,className:i}=e;const[o,r]=(0,n.useState)(0);return S((()=>r(o+150)),150),(0,n.useEffect)((()=>r(0)),[t]),(0,j.jsx)(T,{timeInMs:o,className:i,humanize:s})};var I;function k(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class z extends n.PureComponent{constructor(e){super(e),k(this,"liveEndDiv",null),k(this,"scrollContainerRef",n.createRef()),k(this,"onScroll",(e=>{const{isPaused:t,onPause:s}=this.props,{scrollTop:n,clientHeight:i,scrollHeight:o}=e.currentTarget;o-(n+i)>=5&&!t&&s()})),k(this,"rowsToRender",(()=>{const{isPaused:e}=this.props;let{logRowsToRender:t=[]}=this.state;return e||(t=t.slice(-100)),t})),this.state={logRowsToRender:e.logRows}}static getDerivedStateFromProps(e,t){return e.isPaused?null:{logRowsToRender:e.logRows}}render(){const{theme:e,timeZone:t,onPause:s,onResume:n,isPaused:i}=this.props,o=(e=>({logsRowsLive:m.css`
    label: logs-rows-live;
    font-family: ${e.typography.fontFamilyMonospace};
    font-size: ${e.typography.bodySmall.fontSize};
    display: flex;
    flex-flow: column nowrap;
    height: 60vh;
    overflow-y: scroll;
    :first-child {
      margin-top: auto !important;
    }
  `,logsRowFade:m.css`
    label: logs-row-fresh;
    color: ${e.colors.text};
    background-color: ${w()(e.colors.info.transparent).setAlpha(.25).toString()};
    animation: fade 1s ease-out 1s 1 normal forwards;
    @keyframes fade {
      from {
        background-color: ${w()(e.colors.info.transparent).setAlpha(.25).toString()};
      }
      to {
        background-color: transparent;
      }
    }
  `,logsRowsIndicator:m.css`
    font-size: ${e.typography.h6.fontSize};
    padding-top: ${e.spacing(1)};
    display: flex;
    align-items: center;
  `,button:m.css`
    margin-right: ${e.spacing(1)};
  `,fullWidth:m.css`
    width: 100%;
  `}))(e),{logsRow:a,logsRowLocalTime:l,logsRowMessage:d}=(0,r.getLogRowStyles)(e);return(0,j.jsxs)("div",{children:[(0,j.jsx)("table",{className:o.fullWidth,children:(0,j.jsxs)("tbody",{onScroll:i?void 0:this.onScroll,className:(0,m.cx)(["logs-rows",o.logsRowsLive]),ref:this.scrollContainerRef,children:[this.rowsToRender().map((e=>(0,j.jsxs)("tr",{className:(0,m.cx)(a,o.logsRowFade),children:[(0,j.jsx)("td",{className:(0,m.cx)(l),children:(0,c.dateTimeFormat)(e.timeEpochMs,{timeZone:t})}),(0,j.jsx)("td",{className:(0,m.cx)(d),children:e.hasAnsi?(0,j.jsx)(r.LogMessageAnsi,{value:e.raw}):e.entry})]},e.uid))),(0,j.jsx)("tr",{ref:e=>{var t;(this.liveEndDiv=e,this.liveEndDiv&&!i)&&(null===(t=this.scrollContainerRef.current)||void 0===t||t.scrollTo(0,this.scrollContainerRef.current.scrollHeight))}})]})}),(0,j.jsxs)("div",{className:o.logsRowsIndicator,children:[(0,j.jsxs)(r.Button,{variant:"secondary",onClick:i?n:s,className:o.button,children:[(0,j.jsx)(r.Icon,{name:i?"play":"pause"})," ",i?"Resume":"Pause"]}),(0,j.jsxs)(r.Button,{variant:"secondary",onClick:this.props.stopLive,className:o.button,children:[I||(I=(0,j.jsx)(r.Icon,{name:"square-shape",size:"lg",type:"mono"})),"  Exit live mode"]}),i||(0,j.jsxs)("span",{children:["Last line received: ",(0,j.jsx)(C,{resetKey:this.props.logRows,humanize:!0})," ago"]})]})]})}}const O=(0,r.withTheme2)(z);var F=s("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),D=s("./packages/grafana-schema/src/index.ts"),N=s("./public/app/core/logs_model.ts"),L=s("./packages/grafana-ui/src/components/Logs/LogRowMessage.tsx");const P=e=>({metaContainer:m.css`
    flex: 1;
    color: ${e.colors.text.secondary};
    margin-bottom: ${e.spacing(2)};
    min-width: 30%;
    display: flex;
    flex-wrap: wrap;
  `,metaItem:m.css`
    margin-right: ${e.spacing(2)};
    margin-top: ${e.spacing(.5)};
    display: flex;
    align-items: baseline;

    .logs-meta-item__error {
      color: ${e.colors.error.text};
    }
  `,metaLabel:m.css`
    margin-right: calc(${e.spacing(2)} / 2);
    font-size: ${e.typography.bodySmall.fontSize};
    font-weight: ${e.typography.fontWeightMedium};
  `,metaValue:m.css`
    font-family: ${e.typography.fontFamilyMonospace};
    font-size: ${e.typography.bodySmall.fontSize};
  `}),$=(0,n.memo)((function(e){const t=(0,r.useStyles2)(P),{label:s,value:n}=e;return(0,j.jsxs)("div",{"data-testid":"meta-info-text-item",className:t.metaItem,children:[s&&(0,j.jsxs)("span",{className:t.metaLabel,children:[s,":"]}),(0,j.jsx)("span",{className:t.metaValue,children:n})]})})),B=(0,n.memo)((function(e){const t=(0,r.useStyles2)(P),{metaItems:s}=e;return(0,j.jsx)("div",{className:t.metaContainer,"data-testid":"meta-info-text",children:s.map(((e,t)=>(0,j.jsx)($,{label:e.label,value:e.value},`${t}-${e.label}`)))})}));var E;const A=n.memo((e=>{let{meta:t,dedupStrategy:s,dedupCount:n,showDetectedFields:i,clearDetectedFields:o,hasUnescapedContent:a,forceEscape:l,onEscapeNewlines:d,logRows:u}=e;const p=[...t];return s!==c.LogsDedupStrategy.none&&p.push({label:"Dedup count",value:n,kind:c.LogsMetaKind.Number}),u.some((e=>e.entry.length>L.n))&&p.push({label:"Info",value:"Logs with more than 100,000 characters could not be parsed and highlighted",kind:c.LogsMetaKind.String}),(null==i?void 0:i.length)>0&&p.push({label:"Showing only detected fields",value:M(i,c.LogsMetaKind.LabelsMap)},{label:"",value:(0,j.jsx)(r.Button,{variant:"secondary",size:"sm",onClick:o,children:"Show all detected fields"})}),a&&p.push({label:"Your logs might have incorrectly escaped content",value:(0,j.jsx)(r.Tooltip,{content:"Fix incorrectly escaped newline and tab sequences in log lines. Manually review the results to confirm that the replacements are correct.",placement:"right",children:(0,j.jsxs)(r.Button,{variant:"secondary",size:"sm",onClick:d,children:[(0,j.jsxs)("span",{children:[l?"Remove escaping":"Escape newlines"," "]}),E||(E=(0,j.jsx)(r.Icon,{name:"exclamation-triangle",className:"muted",size:"sm"}))]})})}),(0,j.jsx)(j.Fragment,{children:p&&(0,j.jsx)(B,{metaItems:p.map((e=>({label:e.label,value:"kind"in e?M(e.value,e.kind):e.value})))})})}));function M(e,t){return t===c.LogsMetaKind.LabelsMap?(0,j.jsx)("span",{className:"logs-meta-item__labels",children:(0,j.jsx)(r.LogLabels,{labels:e})}):t===c.LogsMetaKind.Error?(0,j.jsx)("span",{className:"logs-meta-item__error",children:e}):e}var q;function _(e){let{pages:t,currentPageIndex:s,oldestLogsFirst:n,timeZone:i,loading:o,changeTime:a}=e;const l=e=>`${(0,c.dateTimeFormat)(e,{format:c.systemDateFormats.interval.second,timeZone:i})}`,d=(e,t)=>{if(s===t&&o)return q||(q=(0,j.jsx)(r.Spinner,{}));return`${l(n?e.logsRange.from:e.logsRange.to)} — ${l(n?e.logsRange.to:e.logsRange.from)}`},u=(0,r.useTheme2)(),p=H(u,o);return(0,j.jsx)(r.CustomScrollbar,{autoHide:!0,children:(0,j.jsx)("div",{className:p.pagesWrapper,"data-testid":"logsNavigationPages",children:(0,j.jsx)("div",{className:p.pagesContainer,children:t.map(((e,t)=>(0,j.jsxs)("div",{"data-testid":`page${t+1}`,className:p.page,onClick:()=>!o&&a({from:e.queryRange.from,to:e.queryRange.to}),children:[(0,j.jsx)("div",{className:(0,m.cx)(p.line,{selectedBg:s===t})}),(0,j.jsx)("div",{className:(0,m.cx)(p.time,{selectedText:s===t}),children:d(e,t)})]},e.queryRange.to)))})})})}A.displayName="LogsMetaRow";const H=(e,t)=>({pagesWrapper:m.css`
      height: 100%;
      padding-left: ${e.spacing(.5)};
      display: flex;
      flex-direction: column;
      overflow-y: scroll;
      &::after {
        content: '';
        display: block;
        background: repeating-linear-gradient(
          135deg,
          ${e.colors.background.primary},
          ${e.colors.background.primary} 5px,
          ${e.colors.background.secondary} 5px,
          ${e.colors.background.secondary} 15px
        );
        width: 3px;
        height: inherit;
        margin-bottom: 8px;
      }
    `,pagesContainer:m.css`
      display: flex;
      padding: 0;
      flex-direction: column;
    `,page:m.css`
      display: flex;
      margin: ${e.spacing(2)} 0;
      cursor: ${t?"auto":"pointer"};
      white-space: normal;
      .selectedBg {
        background: ${e.colors.primary.main};
      }
      .selectedText {
        color: ${e.colors.primary.main};
      }
    `,line:m.css`
      width: 3px;
      height: 100%;
      align-items: center;
      background: ${e.colors.text.secondary};
    `,time:m.css`
      width: 60px;
      min-height: 80px;
      font-size: ${e.v1.typography.size.sm};
      padding-left: ${e.spacing(.5)};
      display: flex;
      align-items: center;
    `});var Z,W,Q;function V(e){let{absoluteRange:t,logsSortOrder:s,timeZone:i,loading:o,onChangeTime:a,scrollToTopLogs:l,visibleRange:d,queries:u,clearCache:p,addResultsToCache:h}=e;const[g,m]=(0,n.useState)([]),[f,v]=(0,n.useState)(0),x=(0,n.useRef)(),y=(0,n.useRef)(),b=(0,n.useRef)(0),w=s===c.LogsSortOrder.Ascending,S=w?f===g.length-1:0===f,T=w?0===f:f===g.length-1,R=(0,r.useTheme2)(),C=G(R,w,o);(0,n.useEffect)((()=>{const e={logsRange:d,queryRange:t};let n=[];if((0,F.isEqual)(y.current,t)&&(0,F.isEqual)(x.current,u)){m((t=>(n=t.filter((t=>!(0,F.isEqual)(e.queryRange,t.queryRange))),n=[...n,e].sort(((e,t)=>k(e,t,s))),n)));const i=n.findIndex((e=>e.queryRange.to===t.to));v(i)}else p(),m([e]),v(0),x.current=u,b.current=t.to-t.from;h()}),[d,t,s,u,p,h]),(0,n.useEffect)((()=>{p()}),[]);const I=e=>{let{from:t,to:s}=e;y.current={from:t,to:s},a({from:t,to:s})},k=(e,t,s)=>s===c.LogsSortOrder.Ascending?e.queryRange.to>t.queryRange.to?1:-1:e.queryRange.to>t.queryRange.to?-1:1,z=(0,j.jsx)(r.Button,{"data-testid":"olderLogsButton",className:C.navButton,variant:"secondary",onClick:()=>{if(T)I({from:d.from-b.current,to:d.from});else{const e=w?-1:1;I({from:g[f+e].queryRange.from,to:g[f+e].queryRange.to})}},disabled:o,children:(0,j.jsxs)("div",{className:C.navButtonContent,children:[o?Z||(Z=(0,j.jsx)(r.Spinner,{})):(0,j.jsx)(r.Icon,{name:w?"angle-up":"angle-down",size:"lg"}),"Older logs"]})}),O=(0,j.jsx)(r.Button,{"data-testid":"newerLogsButton",className:C.navButton,variant:"secondary",onClick:()=>{if(!S){const e=w?1:-1;I({from:g[f+e].queryRange.from,to:g[f+e].queryRange.to})}},disabled:o||S,children:(0,j.jsxs)("div",{className:C.navButtonContent,children:[o&&(W||(W=(0,j.jsx)(r.Spinner,{}))),S||o?null:(0,j.jsx)(r.Icon,{name:w?"angle-down":"angle-up",size:"lg"}),S?"Start of range":"Newer logs"]})});return(0,j.jsxs)("div",{className:C.navContainer,children:[w?z:O,(0,j.jsx)(_,{pages:g,currentPageIndex:f,oldestLogsFirst:w,timeZone:i,loading:o,changeTime:I}),w?O:z,(0,j.jsx)(r.Button,{"data-testid":"scrollToTop",className:C.scrollToTopButton,variant:"secondary",onClick:l,title:"Scroll to top",children:Q||(Q=(0,j.jsx)(r.Icon,{name:"arrow-up",size:"lg"}))})]})}const U=(0,n.memo)(V),G=(e,t,s)=>({navContainer:m.css`
      max-height: 95vh;
      display: flex;
      flex-direction: column;
      justify-content: ${t?"flex-start":"space-between"};
      position: sticky;
      top: ${e.spacing(2)};
      right: 0;
    `,navButton:m.css`
      width: 58px;
      height: 68px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      line-height: 1;
    `,navButtonContent:m.css`
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      white-space: normal;
    `,scrollToTopButton:m.css`
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-top: ${e.spacing(1)};
    `});var K=s("./packages/grafana-runtime/src/index.ts"),Y=s("./public/app/core/app_events.ts"),J=s("./public/app/plugins/panel/timeseries/config.ts"),X=s("./.yarn/__virtual__/react-use-virtual-00326e70ba/3/opt/drone/yarncache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/usePrevious.js"),ee=s("./public/app/features/dashboard/dashgrid/SeriesVisibilityConfigFactory.ts"),te=s("../../opt/drone/yarncache/immer-npm-9.0.12-e8cd7358fa-bcbec6d76d.zip/node_modules/immer/dist/immer.esm.js");function se(e){let{data:t,height:s,width:i,timeZone:o,absoluteRange:a,onChangeTime:l,loadingState:d,annotations:u,onHiddenSeriesChanged:p,splitOpenFn:h,graphStyle:g,tooltipDisplayMode:f=D.f3.Single}=e;const v=(0,r.useTheme2)(),[x,y]=(0,n.useState)(!1),[b,w]=(0,n.useState)(1),S=(0,X.Z)(t),T=(0,n.useRef)(0);t&&S&&!(0,c.compareArrayValues)(S,t,c.compareDataFrameStructures)&&T.current++;const R=b+T.current,[C,I]=(0,n.useState)({defaults:{color:{mode:c.FieldColorModeId.PaletteClassic},custom:{drawStyle:D.l8.Line,fillOpacity:0,pointSize:5}},overrides:[]}),k=(0,r.useStyles2)(ne),z={from:(0,c.dateTime)(a.from),to:(0,c.dateTime)(a.to),raw:{from:(0,c.dateTime)(a.from),to:(0,c.dateTime)(a.to)}},O=(0,n.useMemo)((()=>{const e=(0,c.createFieldConfigRegistry)((0,J.F)(J.r),"Explore"),s=function(e,t){return(0,te.ZP)(e,(e=>{void 0===e.defaults.custom&&(e.defaults.custom={});const{custom:s}=e.defaults;switch(void 0===s.stacking&&(s.stacking={group:"A"}),t){case"lines":s.drawStyle=D.l8.Line,s.stacking.mode=D.o0.None,s.fillOpacity=0;break;case"bars":s.drawStyle=D.l8.Bars,s.stacking.mode=D.o0.None,s.fillOpacity=100;break;case"points":s.drawStyle=D.l8.Points,s.stacking.mode=D.o0.None,s.fillOpacity=0;break;case"stacked_lines":s.drawStyle=D.l8.Line,s.stacking.mode=D.o0.Normal,s.fillOpacity=100;break;case"stacked_bars":s.drawStyle=D.l8.Bars,s.stacking.mode=D.o0.Normal,s.fillOpacity=100;break;default:throw new Error(`Invalid graph-style: ${t}`)}}))}(C,g);return(0,c.applyFieldOverrides)({fieldConfig:s,data:t,timeZone:o,replaceVariables:e=>e,theme:v,fieldConfigRegistry:e})}),[C,g,t,o,v]);(0,n.useEffect)((()=>{if(p){const e=[];O.forEach((t=>{t.fields.map((e=>{var t,s,n;return null===(t=e.config)||void 0===t||null===(s=t.custom)||void 0===s||null===(n=s.hideFrom)||void 0===n?void 0:n.viz})).every(F.identity)&&e.push((0,c.getFrameDisplayName)(t))})),p(e)}}),[O,p]);const N=x?O:O.slice(0,20),L={eventBus:Y.Z,onSplitOpen:h,onToggleSeriesVisibility(e,s){w((e=>e+1)),I((0,ee.N)(e,s,C,t))}};return(0,j.jsxs)(r.PanelContextProvider,{value:L,children:[O.length>20&&!x&&(0,j.jsxs)("div",{className:(0,m.cx)([k.timeSeriesDisclaimer]),children:[(0,j.jsx)(r.Icon,{className:k.disclaimerIcon,name:"exclamation-triangle"}),"Showing only 20 time series. ",(0,j.jsx)("span",{className:(0,m.cx)([k.showAllTimeSeries]),onClick:()=>{T.current++,y(!0)},children:`Show all ${O.length}`})]}),(0,j.jsx)(K.PanelRenderer,{data:{series:N,timeRange:z,structureRev:R,state:d,annotations:u},pluginId:"timeseries",title:"",width:i,height:s,onChangeTimeRange:l,timeZone:o,options:{tooltip:{mode:f,sort:D.As.None},legend:{displayMode:D.jK.List,placement:"bottom",calcs:[]}}})]})}const ne=e=>({timeSeriesDisclaimer:m.css`
    label: time-series-disclaimer;
    width: 300px;
    margin: ${e.spacing(1)} auto;
    padding: 10px 0;
    border-radius: ${e.spacing(2)};
    text-align: center;
    background-color: ${e.colors.background.primary};
  `,disclaimerIcon:m.css`
    label: disclaimer-icon;
    color: ${e.colors.warning.main};
    margin-right: ${e.spacing(.5)};
  `,showAllTimeSeries:m.css`
    label: show-all-time-series;
    cursor: pointer;
    color: ${e.colors.text.link};
  `});function ie(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const oe="grafana.explore.logs.showLabels",re="grafana.explore.logs.showTime",ae="grafana.explore.logs.wrapLogMessage",le="grafana.explore.logs.prettifyLogMessage",ce="grafana.explore.logs.sortOrder";class de extends n.PureComponent{constructor(){super(...arguments),ie(this,"flipOrderTimer",void 0),ie(this,"cancelFlippingTimer",void 0),ie(this,"topLogsRef",(0,n.createRef)()),ie(this,"state",{showLabels:u.Z.getBool(oe,!1),showTime:u.Z.getBool(re,!0),wrapLogMessage:u.Z.getBool(ae,!0),prettifyLogMessage:u.Z.getBool(le,!1),dedupStrategy:c.LogsDedupStrategy.none,hiddenLogLevels:[],logsSortOrder:u.Z.get(ce)||c.LogsSortOrder.Descending,isFlipping:!1,showDetectedFields:[],forceEscape:!1}),ie(this,"onChangeLogsSortOrder",(()=>{this.setState({isFlipping:!0}),this.flipOrderTimer=window.setTimeout((()=>{this.setState((e=>{const t=e.logsSortOrder===c.LogsSortOrder.Descending?c.LogsSortOrder.Ascending:c.LogsSortOrder.Descending;return u.Z.set(ce,t),{logsSortOrder:t}}))}),0),this.cancelFlippingTimer=window.setTimeout((()=>this.setState({isFlipping:!1})),1e3)})),ie(this,"onEscapeNewlines",(()=>{this.setState((e=>({forceEscape:!e.forceEscape})))})),ie(this,"onChangeDedup",(e=>{this.setState({dedupStrategy:e})})),ie(this,"onChangeLabels",(e=>{const{target:t}=e;if(t){const e=t.checked;this.setState({showLabels:e}),u.Z.set(oe,e)}})),ie(this,"onChangeTime",(e=>{const{target:t}=e;if(t){const e=t.checked;this.setState({showTime:e}),u.Z.set(re,e)}})),ie(this,"onChangewrapLogMessage",(e=>{const{target:t}=e;if(t){const e=t.checked;this.setState({wrapLogMessage:e}),u.Z.set(ae,e)}})),ie(this,"onChangePrettifyLogMessage",(e=>{const{target:t}=e;if(t){const e=t.checked;this.setState({prettifyLogMessage:e}),u.Z.set(le,e)}})),ie(this,"onToggleLogLevel",(e=>{const t=e.map((e=>c.LogLevel[e]));this.setState({hiddenLogLevels:t})})),ie(this,"onClickScan",(e=>{e.preventDefault(),this.props.onStartScanning&&this.props.onStartScanning()})),ie(this,"onClickStopScan",(e=>{e.preventDefault(),this.props.onStopScanning&&this.props.onStopScanning()})),ie(this,"showDetectedField",(e=>{-1===this.state.showDetectedFields.indexOf(e)&&this.setState((t=>({showDetectedFields:t.showDetectedFields.concat(e)})))})),ie(this,"hideDetectedField",(e=>{this.state.showDetectedFields.indexOf(e)>-1&&this.setState((t=>({showDetectedFields:t.showDetectedFields.filter((t=>e!==t))})))})),ie(this,"clearDetectedFields",(()=>{this.setState((e=>({showDetectedFields:[]})))})),ie(this,"checkUnescapedContent",(0,l.Z)((e=>!!e.some((e=>e.hasUnescapedContent))))),ie(this,"dedupRows",(0,l.Z)(((e,t)=>{const s=(0,N.UW)(e,t),n=s.reduce(((e,t)=>t.duplicates?e+t.duplicates:e),0);return{dedupedRows:s,dedupCount:n}}))),ie(this,"filterRows",(0,l.Z)(((e,t)=>(0,N.nu)(e,new Set(t))))),ie(this,"scrollToTopLogs",(()=>{var e;return null===(e=this.topLogsRef.current)||void 0===e?void 0:e.scrollIntoView()}))}componentWillUnmount(){this.flipOrderTimer&&window.clearTimeout(this.flipOrderTimer),this.cancelFlippingTimer&&window.clearTimeout(this.cancelFlippingTimer)}render(){const{width:e,logRows:t,logsMeta:s,logsSeries:n,visibleRange:i,loading:o=!1,loadingState:a,onClickFilterLabel:l,onClickFilterOutLabel:d,timeZone:u,scanning:p,scanRange:h,showContextToggle:g,absoluteRange:m,onChangeTime:f,getFieldLinks:v,theme:x,logsQueries:y,clearCache:b,addResultsToCache:w}=this.props,{showLabels:S,showTime:T,wrapLogMessage:R,prettifyLogMessage:C,dedupStrategy:I,hiddenLogLevels:k,logsSortOrder:z,isFlipping:O,showDetectedFields:N,forceEscape:L}=this.state,P=pe(x,R),$=t&&t.length>0,B=this.checkUnescapedContent(t),E=this.filterRows(t,k),{dedupedRows:M,dedupCount:q}=this.dedupRows(E,I),_=h?`Scanning ${c.rangeUtil.describeTimeRange(h)}`:"Scanning...";return(0,j.jsxs)(j.Fragment,{children:[n&&n.length?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:P.infoText,children:"This datasource does not support full-range histograms. The graph is based on the logs seen in the response."}),(0,j.jsx)(se,{graphStyle:"lines",data:n,height:150,width:e,tooltipDisplayMode:D.f3.Multi,absoluteRange:i||m,timeZone:u,loadingState:a,onChangeTime:f,onHiddenSeriesChanged:this.onToggleLogLevel})]}):void 0,(0,j.jsxs)("div",{className:P.logOptions,ref:this.topLogsRef,children:[(0,j.jsxs)(r.InlineFieldRow,{children:[(0,j.jsx)(r.InlineField,{label:"Time",className:P.horizontalInlineLabel,transparent:!0,children:(0,j.jsx)(r.InlineSwitch,{value:T,onChange:this.onChangeTime,className:P.horizontalInlineSwitch,transparent:!0,id:"show-time"})}),(0,j.jsx)(r.InlineField,{label:"Unique labels",className:P.horizontalInlineLabel,transparent:!0,children:(0,j.jsx)(r.InlineSwitch,{value:S,onChange:this.onChangeLabels,className:P.horizontalInlineSwitch,transparent:!0,id:"unique-labels"})}),(0,j.jsx)(r.InlineField,{label:"Wrap lines",className:P.horizontalInlineLabel,transparent:!0,children:(0,j.jsx)(r.InlineSwitch,{value:R,onChange:this.onChangewrapLogMessage,className:P.horizontalInlineSwitch,transparent:!0,id:"wrap-lines"})}),(0,j.jsx)(r.InlineField,{label:"Prettify JSON",className:P.horizontalInlineLabel,transparent:!0,children:(0,j.jsx)(r.InlineSwitch,{value:C,onChange:this.onChangePrettifyLogMessage,className:P.horizontalInlineSwitch,transparent:!0,id:"prettify"})}),(0,j.jsx)(r.InlineField,{label:"Dedup",className:P.horizontalInlineLabel,transparent:!0,children:(0,j.jsx)(r.RadioButtonGroup,{options:Object.values(c.LogsDedupStrategy).map((e=>({label:(0,F.capitalize)(e),value:e,description:c.LogsDedupDescription[e]}))),value:I,onChange:this.onChangeDedup,className:P.radioButtons})})]}),(0,j.jsx)("div",{children:(0,j.jsx)(r.InlineField,{label:"Display results",className:P.horizontalInlineLabel,transparent:!0,children:(0,j.jsx)(r.RadioButtonGroup,{disabled:O,options:[{label:"Newest first",value:c.LogsSortOrder.Descending,description:"Show results newest to oldest"},{label:"Oldest first",value:c.LogsSortOrder.Ascending,description:"Show results oldest to newest"}],value:z,onChange:this.onChangeLogsSortOrder,className:P.radioButtons})})})]}),(0,j.jsx)(A,{logRows:t,meta:s||[],dedupStrategy:I,dedupCount:q,hasUnescapedContent:B,forceEscape:L,showDetectedFields:N,onEscapeNewlines:this.onEscapeNewlines,clearDetectedFields:this.clearDetectedFields}),(0,j.jsxs)("div",{className:P.logsSection,children:[(0,j.jsx)("div",{className:P.logRows,"data-testid":"logRows",children:(0,j.jsx)(r.LogRows,{logRows:t,deduplicatedRows:M,dedupStrategy:I,getRowContext:this.props.getRowContext,onClickFilterLabel:l,onClickFilterOutLabel:d,showContextToggle:g,showLabels:S,showTime:T,enableLogDetails:!0,forceEscape:L,wrapLogMessage:R,prettifyLogMessage:C,timeZone:u,getFieldLinks:v,logsSortOrder:z,showDetectedFields:N,onClickShowDetectedField:this.showDetectedField,onClickHideDetectedField:this.hideDetectedField})}),(0,j.jsx)(U,{logsSortOrder:z,visibleRange:null!=i?i:m,absoluteRange:m,timeZone:u,onChangeTime:f,loading:o,queries:null!=y?y:[],scrollToTopLogs:this.scrollToTopLogs,addResultsToCache:w,clearCache:b})]}),!o&&!$&&!p&&(0,j.jsxs)("div",{className:P.noData,children:["No logs found.",(0,j.jsx)(r.Button,{size:"xs",fill:"text",onClick:this.onClickScan,children:"Scan for older logs"})]}),p&&(0,j.jsxs)("div",{className:P.noData,children:[(0,j.jsx)("span",{children:_}),(0,j.jsx)(r.Button,{size:"xs",fill:"text",onClick:this.onClickStopScan,children:"Stop scan"})]})]})}}const ue=(0,r.withTheme2)(de),pe=(e,t)=>({noData:m.css`
      > * {
        margin-left: 0.5em;
      }
    `,logOptions:m.css`
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      flex-wrap: wrap;
      background-color: ${e.colors.background.primary};
      padding: ${e.spacing(1,2)};
      border-radius: ${e.shape.borderRadius()};
      margin: ${e.spacing(2,0,1)};
      border: 1px solid ${e.colors.border.medium};
    `,headerButton:m.css`
      margin: ${e.spacing(.5,0,0,1)};
    `,horizontalInlineLabel:m.css`
      > label {
        margin-right: 0;
      }
    `,horizontalInlineSwitch:m.css`
      padding: 0 ${e.spacing(1)} 0 0;
    `,radioButtons:m.css`
      margin: 0;
    `,logsSection:m.css`
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    `,logRows:m.css`
      overflow-x: ${t?"unset":"scroll"};
      overflow-y: visible;
      width: 100%;
    `,infoText:m.css`
      font-size: ${e.typography.size.sm};
      color: ${e.colors.text.secondary};
    `});var he=s("./.yarn/__virtual__/react-transition-group-virtual-8df824fae8/3/opt/drone/yarncache/react-transition-group-npm-4.4.2-5052c30656-b67bf5b3e8.zip/node_modules/react-transition-group/esm/CSSTransition.js");const ge=(0,l.Z)((()=>({logsEnter:m.css`
      label: logsEnter;
      position: absolute;
      opacity: 0;
      height: auto;
      width: 100%;
    `,logsEnterActive:m.css`
      label: logsEnterActive;
      opacity: 1;
      transition: opacity ${500}ms ease-out ${100}ms;
    `,logsExit:m.css`
      label: logsExit;
      position: absolute;
      opacity: 1;
      height: auto;
      width: 100%;
    `,logsExitActive:m.css`
      label: logsExitActive;
      opacity: 0;
      transition: opacity ${500}ms ease-out ${100}ms;
    `})));function me(e){const{visible:t,children:s}=e,n=ge();return(0,j.jsx)(he.Z,{in:t,mountOnEnter:!0,unmountOnExit:!0,timeout:600,classNames:{enter:n.logsEnter,enterActive:n.logsEnterActive,exit:n.logsExit,exitActive:n.logsExitActive},children:s})}function fe(e){const t=function(e){const t=(0,i.useDispatch)(),s=(0,n.useCallback)((()=>{t((0,x.sQ)({exploreId:e,isPaused:!0}))}),[e,t]),o=(0,n.useCallback)((()=>{t((0,x.sQ)({exploreId:e,isPaused:!1}))}),[e,t]),a=(0,n.useCallback)((()=>{s(),t((0,y.oz)(e,r.RefreshPicker.offOption.value)),t((0,x.aA)(e))}),[e,t,s]),l=(0,n.useCallback)((()=>{t((0,y.oz)(e,r.RefreshPicker.liveOption.value))}),[e,t]);return{pause:s,resume:o,stop:a,start:l}}(e.exploreId);return e.children(t)}var ve=s("./public/app/features/explore/utils/links.ts");function xe(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class ye extends n.PureComponent{constructor(){super(...arguments),xe(this,"onChangeTime",(e=>{const{exploreId:t,updateTimeRange:s}=this.props;s({exploreId:t,absoluteRange:e})})),xe(this,"getLogRowContext",(async(e,t)=>{const{datasourceInstance:s}=this.props;return(0,c.hasLogsContextSupport)(s)?s.getLogRowContext(e,t):[]})),xe(this,"showContextToggle",(e=>{const{datasourceInstance:t}=this.props;return!!(0,c.hasLogsContextSupport)(t)&&t.showContextToggle(e)})),xe(this,"getFieldLinks",((e,t)=>{const{splitOpen:s,range:n}=this.props;return(0,ve.a)({field:e,rowIndex:t,splitOpenFn:s,range:n})}))}render(){const{loading:e,loadingState:t,logRows:s,logsMeta:n,logsSeries:i,logsQueries:o,onClickFilterLabel:a,onClickFilterOutLabel:l,onStartScanning:c,onStopScanning:d,absoluteRange:u,timeZone:p,visibleRange:h,scanning:g,range:f,width:v,isLive:x,exploreId:y,addResultsToCache:b,clearCache:w}=this.props;if(!s)return null;const S=m.css`
      & > div {
        overflow: visible;
        & > div {
          overflow: visible;
        }
      }
    `;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(me,{visible:x,children:(0,j.jsx)(r.Collapse,{label:"Logs",loading:!1,isOpen:!0,children:(0,j.jsx)(fe,{exploreId:y,children:e=>(0,j.jsx)(O,{logRows:s,timeZone:p,stopLive:e.stop,isPaused:this.props.isPaused,onPause:e.pause,onResume:e.resume})})})}),(0,j.jsx)(me,{visible:!x,children:(0,j.jsx)(r.Collapse,{label:"Logs",loading:e,isOpen:!0,className:S,children:(0,j.jsx)(ue,{logRows:s,logsMeta:n,logsSeries:i,logsQueries:o,width:v,loading:e,loadingState:t,onChangeTime:this.onChangeTime,onClickFilterLabel:a,onClickFilterOutLabel:l,onStartScanning:c,onStopScanning:d,absoluteRange:u,visibleRange:h,timeZone:p,scanning:g,scanRange:f.raw,showContextToggle:this.showContextToggle,getRowContext:this.getLogRowContext,getFieldLinks:this.getFieldLinks,addResultsToCache:()=>b(y),clearCache:()=>w(y)})})})]})}}const be={updateTimeRange:y.cD,splitOpen:a.bW,addResultsToCache:x.K8,clearCache:x.LK},we=(0,i.connect)((function(e,t){let{exploreId:s}=t;const n=e.explore[s],{logsResult:i,loading:o,scanning:r,datasourceInstance:a,isLive:l,isPaused:c,range:d,absoluteRange:u,logsVolumeDataProvider:p,logsVolumeData:h}=n,m=(0,g.Z)(e.user);return{loading:o,logRows:null==i?void 0:i.rows,logsMeta:null==i?void 0:i.meta,logsSeries:null==i?void 0:i.series,logsQueries:null==i?void 0:i.queries,visibleRange:null==i?void 0:i.visibleRange,scanning:r,timeZone:m,datasourceInstance:a,isLive:l,isPaused:c,range:d,absoluteRange:u,logsVolumeDataProvider:p,logsVolumeData:h}}),be)(ye);var Se=s("./public/app/features/plugins/datasource_srv.ts"),je=s("./public/app/core/utils/query.ts"),Te=s("./public/app/features/query/components/QueryEditorRows.tsx"),Re=s("../../opt/drone/yarncache/reselect-npm-4.1.5-bc046e41ae-54c13c1e79.zip/node_modules/reselect/es/index.js"),Ce=s("./public/app/features/explore/state/selectors.ts");const Ie=e=>{let{exploreId:t}=e;const s=(0,i.useDispatch)(),{getQueries:o,getDatasourceInstanceSettings:r,getQueryResponse:a,getHistory:l,getEventBridge:d}=(0,n.useMemo)((()=>(e=>{const t=(0,Ce.F)(e);return{getQueries:(0,Re.P1)(t,(e=>e.queries)),getQueryResponse:(0,Re.P1)(t,(e=>e.queryResponse)),getHistory:(0,Re.P1)(t,(e=>e.history)),getEventBridge:(0,Re.P1)(t,(e=>e.eventBridge)),getDatasourceInstanceSettings:(0,Re.P1)(t,(e=>{var t;return(0,Se.ak)().getInstanceSettings(null===(t=e.datasourceInstance)||void 0===t?void 0:t.uid)}))}})(t)),[t]),u=(0,i.useSelector)(o),p=(0,i.useSelector)(r),h=(0,i.useSelector)(a),g=(0,i.useSelector)(l),m=(0,i.useSelector)(d),f=(0,n.useCallback)((()=>{s((0,x.aA)(t))}),[s,t]),v=(0,n.useCallback)((e=>{s((0,x.PM)({queries:e,exploreId:t})),e.length<u.length&&f()}),[s,t,f,u]),y=(0,n.useCallback)((e=>{v([...u,Object.assign({},e,{refId:(0,je.Hs)(u)})])}),[v,u]);return(0,j.jsx)(Te.l,{dsSettings:p,queries:u,onQueriesChange:v,onAddQuery:y,onRunQueries:f,data:h,app:c.CoreApp.Explore,history:g,eventBus:m})};var ke=s("./public/app/core/config.ts"),ze=s("./public/app/core/constants.ts");const Oe={splitOpen:a.bW},Fe=(0,i.connect)((function(e,t){let{exploreId:s}=t;const n=e.explore[s],{loading:i,tableResult:o,range:r}=n;return{loading:!(o&&o.length>0)&&i,tableResult:o,range:r}}),Oe);class De extends n.PureComponent{getTableHeight(){const{tableResult:e}=this.props;return e&&0!==e.length?Math.max(Math.min(600,35*e.length)+35):200}render(){var e,t;const{loading:s,onCellFilterAdded:n,tableResult:i,width:o,splitOpen:a,range:l,ariaLabel:d,timeZone:u}=this.props,p=this.getTableHeight(),h=o-2*ke.vc.theme.panelPadding-ze.QO;let g=i;if(null!==(e=g)&&void 0!==e&&e.length){g=(0,c.applyFieldOverrides)({data:[g],timeZone:u,theme:ke.vc.theme2,replaceVariables:e=>e,fieldConfig:{defaults:{},overrides:[]}})[0];for(const e of g.fields)e.getLinks=t=>(0,ve.a)({field:e,rowIndex:t.valueRowIndex,splitOpenFn:a,range:l,dataFrame:g})}return(0,j.jsx)(r.Collapse,{label:"Table",loading:s,isOpen:!0,children:null!==(t=g)&&void 0!==t&&t.length?(0,j.jsx)(r.Table,{ariaLabel:d,data:g,width:h,height:p,onCellFilterAdded:n}):(0,j.jsx)(B,{metaItems:[{value:"0 series returned"}]})})}}const Ne=Fe(De);var Le=s("./public/app/core/history/richHistoryLocalStorageUtils.ts"),Pe=s("./public/app/core/utils/richHistory.ts"),$e=s("./public/app/types/events.ts"),Be=s("./public/app/store/store.ts"),Ee=s("./public/app/core/actions/index.ts"),Ae=s("./public/app/core/copy/appNotification.ts"),Me=s("./public/app/core/history/RichHistoryLocalStorage.ts");const qe=(0,r.stylesFactory)((e=>({container:m.css`
      font-size: ${e.typography.size.sm};
      .space-between {
        margin-bottom: ${e.spacing.lg};
      }
    `,input:m.css`
      max-width: 200px;
    `,switch:m.css`
      display: flex;
      align-items: center;
    `,label:m.css`
      margin-left: ${e.spacing.md};
    `}))),_e=[{value:2,label:"2 days"},{value:5,label:"5 days"},{value:7,label:"1 week"},{value:14,label:"2 weeks"}];function He(e){const{retentionPeriod:t,starredTabAsFirstTab:s,activeDatasourceOnly:n,onChangeRetentionPeriod:i,toggleStarredTabAsFirstTab:o,toggleactiveDatasourceOnly:a,deleteRichHistory:l}=e,c=(0,r.useTheme)(),d=qe(c),u=_e.find((e=>e.value===t));return(0,j.jsxs)("div",{className:d.container,children:[(0,j.jsx)(r.Field,{label:"History time span",description:`Select the period of time for which Grafana will save your query history. Up to ${Me.H6} entries will be stored.`,className:"space-between",children:(0,j.jsx)("div",{className:d.input,children:(0,j.jsx)(r.Select,{menuShouldPortal:!0,value:u,options:_e,onChange:i})})}),(0,j.jsx)(r.Field,{label:"Default active tab",description:" ",className:"space-between",children:(0,j.jsxs)("div",{className:d.switch,children:[(0,j.jsx)(r.Switch,{value:s,onChange:o}),(0,j.jsx)("div",{className:d.label,children:"Change the default active tab from “Query history” to “Starred”"})]})}),(0,j.jsx)(r.Field,{label:"Data source behaviour",description:" ",className:"space-between",children:(0,j.jsxs)("div",{className:d.switch,children:[(0,j.jsx)(r.Switch,{value:n,onChange:a}),(0,j.jsx)("div",{className:d.label,children:"Only show queries for data source currently active in Explore"})]})}),(0,j.jsx)("div",{className:m.css`
          font-weight: ${c.typography.weight.bold};
        `,children:"Clear query history"}),(0,j.jsx)("div",{className:m.css`
          margin-bottom: ${c.spacing.sm};
        `,children:"Delete all of your query history, permanently."}),(0,j.jsx)(r.Button,{variant:"destructive",onClick:()=>{Y.Z.publish(new $e.VJ({title:"Delete",text:"Are you sure you want to permanently delete your query history?",yesText:"Delete",icon:"trash-alt",onConfirm:()=>{l(),(0,Be.WI)((0,Ee.$l)((0,Ae.AT)("Query history deleted")))}}))},children:"Clear query history"})]})}var Ze=s("./public/app/core/utils/shortLinks.ts"),We=s("./public/app/features/explore/state/history.ts"),Qe=s("./public/app/features/explore/state/datasource.ts");const Ve={changeDatasource:Qe.zU,deleteHistoryItem:We.NV,commentHistoryItem:We.Ff,starHistoryItem:We.ev,setQueries:x.KO},Ue=(0,i.connect)((function(e,t){let{exploreId:s}=t;const n=e.explore,{datasourceInstance:i}=n[s];return{exploreId:s,datasourceInstance:i}}),Ve),Ge=(0,r.stylesFactory)(((e,t)=>{const s="240px",n="170px",i=e.colors.bg2;return{queryCard:m.css`
      display: flex;
      flex-direction: column;
      border: 1px solid ${e.colors.border1};
      margin: ${e.spacing.sm} 0;
      background-color: ${i};
      border-radius: ${e.border.radius.sm};
      .starred {
        color: ${e.palette.orange};
      }
    `,cardRow:m.css`
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: ${e.spacing.sm};
      border-bottom: none;
      :first-of-type {
        border-bottom: 1px solid ${e.colors.border1};
        padding: ${e.spacing.xs} ${e.spacing.sm};
      }
      img {
        height: ${e.typography.size.base};
        max-width: ${e.typography.size.base};
        margin-right: ${e.spacing.sm};
      }
    `,datasourceContainer:m.css`
      display: flex;
      align-items: center;
      font-size: ${e.typography.size.sm};
      font-weight: ${e.typography.weight.semibold};
    `,queryActionButtons:m.css`
      max-width: ${n};
      display: flex;
      justify-content: flex-end;
      font-size: ${e.typography.size.base};
      button {
        margin-left: ${e.spacing.sm};
      }
    `,queryContainer:m.css`
      font-weight: ${e.typography.weight.semibold};
      width: calc(100% - ${s});
    `,queryRow:m.css`
      border-top: 1px solid ${e.colors.border1};
      word-break: break-all;
      padding: 4px 2px;
      :first-child {
        border-top: none;
        padding: 0 0 4px 0;
      }
    `,updateCommentContainer:m.css`
      width: calc(100% + ${s});
      margin-top: ${e.spacing.sm};
    `,comment:m.css`
      overflow-wrap: break-word;
      font-size: ${e.typography.size.sm};
      font-weight: ${e.typography.weight.regular};
      margin-top: ${e.spacing.xs};
    `,commentButtonRow:m.css`
      > * {
        margin-right: ${e.spacing.sm};
      }
    `,textArea:m.css`
      width: 100%;
    `,runButton:m.css`
      max-width: ${n};
      display: flex;
      justify-content: flex-end;
      button {
        height: auto;
        padding: ${e.spacing.xs} ${e.spacing.md};
        line-height: 1.4;
        span {
          white-space: normal !important;
        }
      }
    `}}));const Ke=Ue((function(e){var t;const{query:s,dsImg:i,isRemoved:o,commentHistoryItem:a,starHistoryItem:l,deleteHistoryItem:c,changeDatasource:d,exploreId:u,datasourceInstance:p,setQueries:g}=e,[f,v]=(0,n.useState)(!1),[x,y]=(0,n.useState)(s.comment),[b,w]=(0,n.useState)(void 0);(0,n.useEffect)((()=>{(async()=>{const e=await(0,K.getDataSourceSrv)().get(s.datasourceName);w(e)})()}),[s.datasourceName]);const S=(0,r.useTheme)(),T=Ge(S,o),R=()=>{a(s.id,x),v(!1)},C=()=>{v(!1),y(s.comment)},I=(0,j.jsxs)("div",{className:T.updateCommentContainer,"aria-label":x?"Update comment form":"Add comment form",children:[(0,j.jsx)(r.TextArea,{value:x,placeholder:x?void 0:"An optional description of what the query does.",onChange:e=>y(e.currentTarget.value),className:T.textArea}),(0,j.jsxs)("div",{className:T.commentButtonRow,children:[(0,j.jsx)(r.Button,{onClick:R,"aria-label":"Submit button",children:"Save comment"}),(0,j.jsx)(r.Button,{variant:"secondary",onClick:C,children:"Cancel"})]})]}),k=(0,j.jsxs)("div",{className:T.queryActionButtons,children:[(0,j.jsx)(r.IconButton,{name:"comment-alt",onClick:()=>v(!f),title:(null===(t=s.comment)||void 0===t?void 0:t.length)>0?"Edit comment":"Add comment"}),(0,j.jsx)(r.IconButton,{name:"copy",onClick:()=>{const e=s.queries.map((e=>(0,Pe.OH)(e,b))).join("\n");(0,h.n9)(e),(0,Be.WI)((0,Ee.$l)((0,Ae.AT)("Query copied to clipboard")))},title:"Copy query to clipboard"}),!o&&(0,j.jsx)(r.IconButton,{name:"share-alt",onClick:async()=>{const e=(0,Pe.t2)(s);await(0,Ze.L)(e)},title:"Copy shortened link to clipboard"}),(0,j.jsx)(r.IconButton,{name:"trash-alt",title:"Delete query",onClick:()=>{s.starred?Y.Z.publish(new $e.VJ({title:"Delete",text:"Are you sure you want to permanently delete your starred query?",yesText:"Delete",icon:"trash-alt",onConfirm:()=>{c(s.id),(0,Be.WI)((0,Ee.$l)((0,Ae.AT)("Query deleted")))}})):(c(s.id),(0,Be.WI)((0,Ee.$l)((0,Ae.AT)("Query deleted"))))}}),(0,j.jsx)(r.IconButton,{name:s.starred?"favorite":"star",iconType:s.starred?"mono":"default",onClick:()=>{l(s.id,!s.starred)},title:s.starred?"Unstar query":"Star query"})]});return(0,j.jsxs)("div",{className:T.queryCard,onKeyDown:e=>{"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&R(),"Escape"===e.key&&C()},children:[(0,j.jsxs)("div",{className:T.cardRow,children:[(0,j.jsxs)("div",{className:T.datasourceContainer,children:[(0,j.jsx)("img",{src:i,"aria-label":"Data source icon"}),(0,j.jsx)("div",{"aria-label":"Data source name",children:o?"Data source does not exist anymore":s.datasourceName})]}),k]}),(0,j.jsxs)("div",{className:(0,m.cx)(T.cardRow),children:[(0,j.jsxs)("div",{className:T.queryContainer,children:[s.queries.map(((e,t)=>{const s=(0,Pe.OH)(e,b);return(0,j.jsx)("div",{"aria-label":"Query text",className:T.queryRow,children:s},`${e}-${t}`)})),!f&&s.comment&&(0,j.jsx)("div",{"aria-label":"Query comment",className:T.comment,children:s.comment}),f&&I]}),!f&&(0,j.jsx)("div",{className:T.runButton,children:(0,j.jsx)(r.Button,{variant:"secondary",onClick:async()=>{const e=s.queries;s.datasourceName!==(null==p?void 0:p.name)?(await d(u,s.datasourceName,{importQueries:!0}),g(u,e)):g(u,e)},disabled:o,children:(null==p?void 0:p.name)===s.datasourceName?"Run query":"Switch data source and run query"})})]})]})}));var Ye,Je=s("./.yarn/__virtual__/react-use-virtual-00326e70ba/3/opt/drone/yarncache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useDebounce.js");const Xe=(0,r.stylesFactory)(((e,t)=>{const s=e.isLight?e.palette.gray5:e.palette.dark4,n=t-180+"px";return{container:m.css`
      display: flex;
      .label-slider {
        font-size: ${e.typography.size.sm};
        &:last-of-type {
          margin-top: ${e.spacing.lg};
        }
        &:first-of-type {
          font-weight: ${e.typography.weight.semibold};
          margin-bottom: ${e.spacing.md};
        }
      }
    `,containerContent:m.css`
      width: calc(${"100% - 134px"});
    `,containerSlider:m.css`
      width: 129px;
      margin-right: ${e.spacing.sm};
      .slider {
        bottom: 10px;
        height: ${n};
        width: 129px;
        padding: ${e.spacing.sm} 0;
      }
    `,slider:m.css`
      position: fixed;
    `,selectors:m.css`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,filterInput:m.css`
      margin-bottom: ${e.spacing.sm};
    `,multiselect:m.css`
      width: 100%;
      margin-bottom: ${e.spacing.sm};
      .gf-form-select-box__multi-value {
        background-color: ${s};
        padding: ${e.spacing.xxs} ${e.spacing.xs} ${e.spacing.xxs} ${e.spacing.sm};
        border-radius: ${e.border.radius.sm};
      }
    `,sort:m.css`
      width: 170px;
    `,sessionName:m.css`
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      margin-top: ${e.spacing.lg};
      h4 {
        margin: 0 10px 0 0;
      }
    `,heading:m.css`
      font-size: ${e.typography.heading.h4};
      margin: ${e.spacing.md} ${e.spacing.xxs} ${e.spacing.sm} ${e.spacing.xxs};
    `,footer:m.css`
      height: 60px;
      margin: ${e.spacing.lg} auto;
      display: flex;
      justify-content: center;
      font-weight: ${e.typography.weight.light};
      font-size: ${e.typography.size.sm};
      a {
        font-weight: ${e.typography.weight.semibold};
        margin-left: ${e.spacing.xxs};
      }
    `,queries:m.css`
      font-size: ${e.typography.size.sm};
      font-weight: ${e.typography.weight.regular};
      margin-left: ${e.spacing.xs};
    `}}));function et(e){const{datasourceFilters:t,onSelectDatasourceFilters:s,queries:i,onChangeSortOrder:o,sortOrder:a,activeDatasourceOnly:l,retentionPeriod:c,exploreId:d,height:u}=e,[p,h]=(0,n.useState)([0,c]),[g,m]=(0,n.useState)([[],[]]),[f,v]=(0,n.useState)(""),[x,y]=(0,n.useState)(""),b=(0,r.useTheme)(),w=Xe(b,u);(0,Je.Z)((()=>{y(f)}),300,[f]),(0,n.useEffect)((()=>{const e=(0,F.uniqBy)(i,"datasourceName").map((e=>e.datasourceName)),s=(0,Pe.DR)(e);m([(0,Pe.ZX)(i,a,t.map((e=>e.value)),x,p),s])}),[p,i,a,t,x]);const[S,T]=g,R=(0,Pe.k4)(S,a);return(0,j.jsxs)("div",{className:w.container,children:[(0,j.jsx)("div",{className:w.containerSlider,children:(0,j.jsxs)("div",{className:w.slider,children:[Ye||(Ye=(0,j.jsx)("div",{className:"label-slider",children:"Filter history"})),(0,j.jsx)("div",{className:"label-slider",children:(0,Pe.bQ)(p[0])}),(0,j.jsx)("div",{className:"slider",children:(0,j.jsx)(r.RangeSlider,{tooltipAlwaysVisible:!1,min:0,max:c,value:p,orientation:"vertical",formatTooltipResult:Pe.bQ,reverse:!0,onAfterChange:h})}),(0,j.jsx)("div",{className:"label-slider",children:(0,Pe.bQ)(p[1])})]})}),(0,j.jsxs)("div",{className:w.containerContent,children:[(0,j.jsxs)("div",{className:w.selectors,children:[!l&&(0,j.jsx)("div",{"aria-label":"Filter datasources",className:w.multiselect,children:(0,j.jsx)(r.MultiSelect,{menuShouldPortal:!0,options:T,value:t,placeholder:"Filter queries for data sources(s)",onChange:s})}),(0,j.jsx)("div",{className:w.filterInput,children:(0,j.jsx)(r.FilterInput,{placeholder:"Search queries",value:f,onChange:e=>{v(e)}})}),(0,j.jsx)("div",{"aria-label":"Sort queries",className:w.sort,children:(0,j.jsx)(r.Select,{menuShouldPortal:!0,value:ot.filter((e=>e.value===a)),options:ot,placeholder:"Sort queries by",onChange:e=>o(e.value)})})]}),Object.keys(R).map((e=>(0,j.jsxs)("div",{children:[(0,j.jsxs)("div",{className:w.heading,children:[e," ",(0,j.jsxs)("span",{className:w.queries,children:[R[e].length," queries"]})]}),R[e].map((e=>{const t=T.findIndex((t=>t.label===e.datasourceName));return(0,j.jsx)(Ke,{query:e,exploreId:d,dsImg:T[t].imgUrl,isRemoved:T[t].isRemoved},e.id)}))]},e))),(0,j.jsx)("div",{className:w.footer,children:"The history is local to your browser and is not shared with others."})]})]})}const tt=(0,r.stylesFactory)((e=>{const t=e.isLight?e.palette.gray5:e.palette.dark4;return{container:m.css`
      display: flex;
    `,containerContent:m.css`
      width: 100%;
    `,selectors:m.css`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,multiselect:m.css`
      width: 100%;
      margin-bottom: ${e.spacing.sm};
      .gf-form-select-box__multi-value {
        background-color: ${t};
        padding: ${e.spacing.xxs} ${e.spacing.xs} ${e.spacing.xxs} ${e.spacing.sm};
        border-radius: ${e.border.radius.sm};
      }
    `,filterInput:m.css`
      margin-bottom: ${e.spacing.sm};
    `,sort:m.css`
      width: 170px;
    `,footer:m.css`
      height: 60px;
      margin-top: ${e.spacing.lg};
      display: flex;
      justify-content: center;
      font-weight: ${e.typography.weight.light};
      font-size: ${e.typography.size.sm};
      a {
        font-weight: ${e.typography.weight.semibold};
        margin-left: ${e.spacing.xxs};
      }
    `}}));function st(e){const{datasourceFilters:t,onSelectDatasourceFilters:s,queries:i,onChangeSortOrder:o,sortOrder:a,activeDatasourceOnly:l,exploreId:c}=e,[d,u]=(0,n.useState)([[],[]]),[p,h]=(0,n.useState)(""),[g,m]=(0,n.useState)(""),f=(0,r.useTheme)(),v=tt(f);(0,Je.Z)((()=>{m(p)}),300,[p]),(0,n.useEffect)((()=>{const e=(0,F.uniqBy)(i,"datasourceName").map((e=>e.datasourceName)),s=(0,Pe.DR)(e),n=i.filter((e=>!0===e.starred));u([(0,Pe.ZX)(n,a,t.map((e=>e.value)),g),s])}),[i,a,t,g]);const[x,y]=d;return(0,j.jsx)("div",{className:v.container,children:(0,j.jsxs)("div",{className:v.containerContent,children:[(0,j.jsxs)("div",{className:v.selectors,children:[!l&&(0,j.jsx)("div",{"aria-label":"Filter datasources",className:v.multiselect,children:(0,j.jsx)(r.MultiSelect,{menuShouldPortal:!0,options:y,value:t,placeholder:"Filter queries for specific data sources(s)",onChange:s})}),(0,j.jsx)("div",{className:v.filterInput,children:(0,j.jsx)(r.FilterInput,{placeholder:"Search queries",value:p,onChange:e=>{h(e)}})}),(0,j.jsx)("div",{"aria-label":"Sort queries",className:v.sort,children:(0,j.jsx)(r.Select,{menuShouldPortal:!0,options:ot,value:ot.filter((e=>e.value===a)),placeholder:"Sort queries by",onChange:e=>o(e.value)})})]}),x.map((e=>{const t=y.findIndex((t=>t.label===e.datasourceName));return(0,j.jsx)(Ke,{query:e,exploreId:c,dsImg:y[t].imgUrl,isRemoved:y[t].isRemoved},e.id)})),(0,j.jsx)("div",{className:v.footer,children:"The history is local to your browser and is not shared with others."})]})})}function nt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}let it;!function(e){e.RichHistory="Query history",e.Starred="Starred",e.Settings="Settings"}(it||(it={}));const ot=[{label:"Newest first",value:Pe.As.Descending},{label:"Oldest first",value:Pe.As.Ascending},{label:"Data source A-Z",value:Pe.As.DatasourceAZ},{label:"Data source Z-A",value:Pe.As.DatasourceZA}];class rt extends n.PureComponent{constructor(e){super(e),nt(this,"onChangeRetentionPeriod",(e=>{void 0!==e.value&&(this.setState({retentionPeriod:e.value}),u.Z.set(Le.hO.retentionPeriod,e.value))})),nt(this,"toggleStarredTabAsFirstTab",(()=>{const e=!this.state.starredTabAsFirstTab;this.setState({starredTabAsFirstTab:e}),u.Z.set(Le.hO.starredTabAsFirstTab,e)})),nt(this,"toggleActiveDatasourceOnly",(()=>{const e=!this.state.activeDatasourceOnly;this.setState({activeDatasourceOnly:e}),u.Z.set(Le.hO.activeDatasourceOnly,e)})),nt(this,"onSelectDatasourceFilters",(e=>{try{u.Z.setObject(Le.hO.datasourceFilters,e)}catch(e){console.error(e)}this.setState({datasourceFilters:e})})),nt(this,"onChangeSortOrder",(e=>this.setState({sortOrder:e}))),this.state={sortOrder:Pe.As.Descending,datasourceFilters:u.Z.getObject(Le.hO.datasourceFilters,[]),retentionPeriod:u.Z.getObject(Le.hO.retentionPeriod,7),starredTabAsFirstTab:u.Z.getBool(Le.hO.starredTabAsFirstTab,!1),activeDatasourceOnly:u.Z.getBool(Le.hO.activeDatasourceOnly,!0)}}updateFilters(){this.state.activeDatasourceOnly&&this.props.activeDatasourceInstance?this.onSelectDatasourceFilters([{label:this.props.activeDatasourceInstance,value:this.props.activeDatasourceInstance}]):this.onSelectDatasourceFilters(this.state.datasourceFilters)}componentDidMount(){this.updateFilters()}componentDidUpdate(e,t){this.props.activeDatasourceInstance===e.activeDatasourceInstance&&this.state.activeDatasourceOnly===t.activeDatasourceOnly||this.updateFilters()}render(){const{datasourceFilters:e,sortOrder:t,activeDatasourceOnly:s,retentionPeriod:n}=this.state,{richHistory:i,height:o,exploreId:a,deleteRichHistory:l,onClose:c,firstTab:d}=this.props;let u=[{label:"Query history",value:it.RichHistory,content:(0,j.jsx)(et,{queries:i,sortOrder:t,datasourceFilters:e,activeDatasourceOnly:s,retentionPeriod:n,onChangeSortOrder:this.onChangeSortOrder,onSelectDatasourceFilters:this.onSelectDatasourceFilters,exploreId:a,height:o}),icon:"history"},{label:"Starred",value:it.Starred,content:(0,j.jsx)(st,{queries:i,sortOrder:t,datasourceFilters:e,activeDatasourceOnly:s,onChangeSortOrder:this.onChangeSortOrder,onSelectDatasourceFilters:this.onSelectDatasourceFilters,exploreId:a}),icon:"star"},{label:"Settings",value:it.Settings,content:(0,j.jsx)(He,{retentionPeriod:this.state.retentionPeriod,starredTabAsFirstTab:this.state.starredTabAsFirstTab,activeDatasourceOnly:this.state.activeDatasourceOnly,onChangeRetentionPeriod:this.onChangeRetentionPeriod,toggleStarredTabAsFirstTab:this.toggleStarredTabAsFirstTab,toggleactiveDatasourceOnly:this.toggleActiveDatasourceOnly,deleteRichHistory:l}),icon:"sliders-v-alt"}];return(0,j.jsx)(r.TabbedContainer,{tabs:u,onClose:c,defaultTab:d,closeIconTooltip:"Close query history"})}}const at=(0,r.withTheme)(rt);var lt,ct=(lt=function(e,t){return lt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])},lt(e,t)},function(e,t){function s(){this.constructor=e}lt(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}),dt=function(){return dt=Object.assign||function(e){for(var t,s=1,n=arguments.length;s<n;s++)for(var i in t=arguments[s])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},dt.apply(this,arguments)},ut={top:{width:"100%",height:"10px",top:"-5px",left:"0px",cursor:"row-resize"},right:{width:"10px",height:"100%",top:"0px",right:"-5px",cursor:"col-resize"},bottom:{width:"100%",height:"10px",bottom:"-5px",left:"0px",cursor:"row-resize"},left:{width:"10px",height:"100%",top:"0px",left:"-5px",cursor:"col-resize"},topRight:{width:"20px",height:"20px",position:"absolute",right:"-10px",top:"-10px",cursor:"ne-resize"},bottomRight:{width:"20px",height:"20px",position:"absolute",right:"-10px",bottom:"-10px",cursor:"se-resize"},bottomLeft:{width:"20px",height:"20px",position:"absolute",left:"-10px",bottom:"-10px",cursor:"sw-resize"},topLeft:{width:"20px",height:"20px",position:"absolute",left:"-10px",top:"-10px",cursor:"nw-resize"}},pt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onMouseDown=function(e){t.props.onResizeStart(e,t.props.direction)},t.onTouchStart=function(e){t.props.onResizeStart(e,t.props.direction)},t}return ct(t,e),t.prototype.render=function(){return n.createElement("div",{className:this.props.className||"",style:dt(dt({position:"absolute",userSelect:"none"},ut[this.props.direction]),this.props.replaceStyles||{}),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart},this.props.children)},t}(n.PureComponent),ht=s("../../opt/drone/yarncache/fast-memoize-npm-2.5.2-f42a7c6940-79fa759719.zip/node_modules/fast-memoize/src/index.js"),gt=s.n(ht),mt=function(){var e=function(t,s){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])},e(t,s)};return function(t,s){function n(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(n.prototype=s.prototype,new n)}}(),ft=function(){return ft=Object.assign||function(e){for(var t,s=1,n=arguments.length;s<n;s++)for(var i in t=arguments[s])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ft.apply(this,arguments)},vt={width:"auto",height:"auto"},xt=gt()((function(e,t,s){return Math.max(Math.min(e,s),t)})),yt=gt()((function(e,t){return Math.round(e/t)*t})),bt=gt()((function(e,t){return new RegExp(e,"i").test(t)})),wt=function(e){return Boolean(e.touches&&e.touches.length)},St=gt()((function(e,t,s){void 0===s&&(s=0);var n=t.reduce((function(s,n,i){return Math.abs(n-e)<Math.abs(t[s]-e)?i:s}),0),i=Math.abs(t[n]-e);return 0===s||i<s?t[n]:e})),jt=gt()((function(e,t){return e.substr(e.length-t.length,t.length)===t})),Tt=gt()((function(e){return"auto"===(e=e.toString())||jt(e,"px")||jt(e,"%")||jt(e,"vh")||jt(e,"vw")||jt(e,"vmax")||jt(e,"vmin")?e:e+"px"})),Rt=function(e,t,s,n){if(e&&"string"==typeof e){if(jt(e,"px"))return Number(e.replace("px",""));if(jt(e,"%"))return t*(Number(e.replace("%",""))/100);if(jt(e,"vw"))return s*(Number(e.replace("vw",""))/100);if(jt(e,"vh"))return n*(Number(e.replace("vh",""))/100)}return e},Ct=gt()((function(e,t,s,n,i,o,r){return n=Rt(n,e.width,t,s),i=Rt(i,e.height,t,s),o=Rt(o,e.width,t,s),r=Rt(r,e.height,t,s),{maxWidth:void 0===n?void 0:Number(n),maxHeight:void 0===i?void 0:Number(i),minWidth:void 0===o?void 0:Number(o),minHeight:void 0===r?void 0:Number(r)}})),It=["as","style","className","grid","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],kt="__resizable_base__",zt=function(e){function t(t){var s=e.call(this,t)||this;return s.ratio=1,s.resizable=null,s.parentLeft=0,s.parentTop=0,s.resizableLeft=0,s.resizableRight=0,s.resizableTop=0,s.resizableBottom=0,s.targetLeft=0,s.targetTop=0,s.appendBase=function(){if(!s.resizable||!s.window)return null;var e=s.parentNode;if(!e)return null;var t=s.window.document.createElement("div");return t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.transform="scale(0, 0)",t.style.left="0",t.style.flex="0 0 100%",t.classList?t.classList.add(kt):t.className+=kt,e.appendChild(t),t},s.removeBase=function(e){var t=s.parentNode;t&&t.removeChild(e)},s.ref=function(e){e&&(s.resizable=e)},s.state={isResizing:!1,width:void 0===(s.propsSize&&s.propsSize.width)?"auto":s.propsSize&&s.propsSize.width,height:void 0===(s.propsSize&&s.propsSize.height)?"auto":s.propsSize&&s.propsSize.height,direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},s.onResizeStart=s.onResizeStart.bind(s),s.onMouseMove=s.onMouseMove.bind(s),s.onMouseUp=s.onMouseUp.bind(s),s}return mt(t,e),Object.defineProperty(t.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return this.resizable&&this.resizable.ownerDocument?this.resizable.ownerDocument.defaultView:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){var e=0,t=0;if(this.resizable&&this.window){var s=this.resizable.offsetWidth,n=this.resizable.offsetHeight,i=this.resizable.style.position;"relative"!==i&&(this.resizable.style.position="relative"),e="auto"!==this.resizable.style.width?this.resizable.offsetWidth:s,t="auto"!==this.resizable.style.height?this.resizable.offsetHeight:n,this.resizable.style.position=i}return{width:e,height:t}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sizeStyle",{get:function(){var e=this,t=this.props.size,s=function(t){if(void 0===e.state[t]||"auto"===e.state[t])return"auto";if(e.propsSize&&e.propsSize[t]&&jt(e.propsSize[t].toString(),"%")){if(jt(e.state[t].toString(),"%"))return e.state[t].toString();var s=e.getParentSize();return Number(e.state[t].toString().replace("px",""))/s[t]*100+"%"}return Tt(e.state[t])};return{width:t&&void 0!==t.width&&!this.state.isResizing?Tt(t.width):s("width"),height:t&&void 0!==t.height&&!this.state.isResizing?Tt(t.height):s("height")}},enumerable:!1,configurable:!0}),t.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var e=this.appendBase();if(!e)return{width:0,height:0};var t=!1,s=this.parentNode.style.flexWrap;"wrap"!==s&&(t=!0,this.parentNode.style.flexWrap="wrap"),e.style.position="relative",e.style.minWidth="100%",e.style.minHeight="100%";var n={width:e.offsetWidth,height:e.offsetHeight};return t&&(this.parentNode.style.flexWrap=s),this.removeBase(e),n},t.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},t.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},t.prototype.componentDidMount=function(){if(this.resizable&&this.window){var e=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:"auto"!==e.flexBasis?e.flexBasis:void 0})}},t.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},t.prototype.createSizeForCssProperty=function(e,t){var s=this.propsSize&&this.propsSize[t];return"auto"!==this.state[t]||this.state.original[t]!==e||void 0!==s&&"auto"!==s?e:"auto"},t.prototype.calculateNewMaxFromBoundary=function(e,t){var s,n,i=this.props.boundsByDirection,o=this.state.direction,r=i&&bt("left",o),a=i&&bt("top",o);if("parent"===this.props.bounds){var l=this.parentNode;l&&(s=r?this.resizableRight-this.parentLeft:l.offsetWidth+(this.parentLeft-this.resizableLeft),n=a?this.resizableBottom-this.parentTop:l.offsetHeight+(this.parentTop-this.resizableTop))}else"window"===this.props.bounds?this.window&&(s=r?this.resizableRight:this.window.innerWidth-this.resizableLeft,n=a?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(s=r?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),n=a?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return s&&Number.isFinite(s)&&(e=e&&e<s?e:s),n&&Number.isFinite(n)&&(t=t&&t<n?t:n),{maxWidth:e,maxHeight:t}},t.prototype.calculateNewSizeFromDirection=function(e,t){var s=this.props.scale||1,n=this.props.resizeRatio||1,i=this.state,o=i.direction,r=i.original,a=this.props,l=a.lockAspectRatio,c=a.lockAspectRatioExtraHeight,d=a.lockAspectRatioExtraWidth,u=r.width,p=r.height,h=c||0,g=d||0;return bt("right",o)&&(u=r.width+(e-r.x)*n/s,l&&(p=(u-g)/this.ratio+h)),bt("left",o)&&(u=r.width-(e-r.x)*n/s,l&&(p=(u-g)/this.ratio+h)),bt("bottom",o)&&(p=r.height+(t-r.y)*n/s,l&&(u=(p-h)*this.ratio+g)),bt("top",o)&&(p=r.height-(t-r.y)*n/s,l&&(u=(p-h)*this.ratio+g)),{newWidth:u,newHeight:p}},t.prototype.calculateNewSizeFromAspectRatio=function(e,t,s,n){var i=this.props,o=i.lockAspectRatio,r=i.lockAspectRatioExtraHeight,a=i.lockAspectRatioExtraWidth,l=void 0===n.width?10:n.width,c=void 0===s.width||s.width<0?e:s.width,d=void 0===n.height?10:n.height,u=void 0===s.height||s.height<0?t:s.height,p=r||0,h=a||0;if(o){var g=(d-p)*this.ratio+h,m=(u-p)*this.ratio+h,f=(l-h)/this.ratio+p,v=(c-h)/this.ratio+p,x=Math.max(l,g),y=Math.min(c,m),b=Math.max(d,f),w=Math.min(u,v);e=xt(e,x,y),t=xt(t,b,w)}else e=xt(e,l,c),t=xt(t,d,u);return{newWidth:e,newHeight:t}},t.prototype.setBoundingClientRect=function(){if("parent"===this.props.bounds){var e=this.parentNode;if(e){var t=e.getBoundingClientRect();this.parentLeft=t.left,this.parentTop=t.top}}if(this.props.bounds&&"string"!=typeof this.props.bounds){var s=this.props.bounds.getBoundingClientRect();this.targetLeft=s.left,this.targetTop=s.top}if(this.resizable){var n=this.resizable.getBoundingClientRect(),i=n.left,o=n.top,r=n.right,a=n.bottom;this.resizableLeft=i,this.resizableRight=r,this.resizableTop=o,this.resizableBottom=a}},t.prototype.onResizeStart=function(e,t){if(this.resizable&&this.window){var s,n=0,i=0;if(e.nativeEvent&&function(e){return Boolean((e.clientX||0===e.clientX)&&(e.clientY||0===e.clientY))}(e.nativeEvent)?(n=e.nativeEvent.clientX,i=e.nativeEvent.clientY):e.nativeEvent&&wt(e.nativeEvent)&&(n=e.nativeEvent.touches[0].clientX,i=e.nativeEvent.touches[0].clientY),this.props.onResizeStart)if(this.resizable)if(!1===this.props.onResizeStart(e,t,this.resizable))return;this.props.size&&(void 0!==this.props.size.height&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),void 0!==this.props.size.width&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio="number"==typeof this.props.lockAspectRatio?this.props.lockAspectRatio:this.size.width/this.size.height;var o=this.window.getComputedStyle(this.resizable);if("auto"!==o.flexBasis){var r=this.parentNode;if(r){var a=this.window.getComputedStyle(r).flexDirection;this.flexDir=a.startsWith("row")?"row":"column",s=o.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var l={original:{x:n,y:i,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:ft(ft({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(e.target).cursor||"auto"}),direction:t,flexBasis:s};this.setState(l)}},t.prototype.onMouseMove=function(e){if(this.state.isResizing&&this.resizable&&this.window){if(this.window.TouchEvent&&wt(e))try{e.preventDefault(),e.stopPropagation()}catch(e){}var t=this.props,s=t.maxWidth,n=t.maxHeight,i=t.minWidth,o=t.minHeight,r=wt(e)?e.touches[0].clientX:e.clientX,a=wt(e)?e.touches[0].clientY:e.clientY,l=this.state,c=l.direction,d=l.original,u=l.width,p=l.height,h=this.getParentSize(),g=Ct(h,this.window.innerWidth,this.window.innerHeight,s,n,i,o);s=g.maxWidth,n=g.maxHeight,i=g.minWidth,o=g.minHeight;var m=this.calculateNewSizeFromDirection(r,a),f=m.newHeight,v=m.newWidth,x=this.calculateNewMaxFromBoundary(s,n);this.props.snap&&this.props.snap.x&&(v=St(v,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(f=St(f,this.props.snap.y,this.props.snapGap));var y=this.calculateNewSizeFromAspectRatio(v,f,{width:x.maxWidth,height:x.maxHeight},{width:i,height:o});if(v=y.newWidth,f=y.newHeight,this.props.grid){var b=yt(v,this.props.grid[0]),w=yt(f,this.props.grid[1]),S=this.props.snapGap||0;v=0===S||Math.abs(b-v)<=S?b:v,f=0===S||Math.abs(w-f)<=S?w:f}var j={width:v-d.width,height:f-d.height};if(u&&"string"==typeof u)if(jt(u,"%"))v=v/h.width*100+"%";else if(jt(u,"vw")){v=v/this.window.innerWidth*100+"vw"}else if(jt(u,"vh")){v=v/this.window.innerHeight*100+"vh"}if(p&&"string"==typeof p)if(jt(p,"%"))f=f/h.height*100+"%";else if(jt(p,"vw")){f=f/this.window.innerWidth*100+"vw"}else if(jt(p,"vh")){f=f/this.window.innerHeight*100+"vh"}var T={width:this.createSizeForCssProperty(v,"width"),height:this.createSizeForCssProperty(f,"height")};"row"===this.flexDir?T.flexBasis=T.width:"column"===this.flexDir&&(T.flexBasis=T.height),this.setState(T),this.props.onResize&&this.props.onResize(e,c,this.resizable,j)}},t.prototype.onMouseUp=function(e){var t=this.state,s=t.isResizing,n=t.direction,i=t.original;if(s&&this.resizable){var o={width:this.size.width-i.width,height:this.size.height-i.height};this.props.onResizeStop&&this.props.onResizeStop(e,n,this.resizable,o),this.props.size&&this.setState(this.props.size),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:ft(ft({},this.state.backgroundStyle),{cursor:"auto"})})}},t.prototype.updateSize=function(e){this.setState({width:e.width,height:e.height})},t.prototype.renderResizer=function(){var e=this,t=this.props,s=t.enable,i=t.handleStyles,o=t.handleClasses,r=t.handleWrapperStyle,a=t.handleWrapperClass,l=t.handleComponent;if(!s)return null;var c=Object.keys(s).map((function(t){return!1!==s[t]?n.createElement(pt,{key:t,direction:t,onResizeStart:e.onResizeStart,replaceStyles:i&&i[t],className:o&&o[t]},l&&l[t]?l[t]:null):null}));return n.createElement("div",{className:a,style:r},c)},t.prototype.render=function(){var e=this,t=Object.keys(this.props).reduce((function(t,s){return-1!==It.indexOf(s)||(t[s]=e.props[s]),t}),{}),s=ft(ft(ft({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(s.flexBasis=this.state.flexBasis);var i=this.props.as||"div";return n.createElement(i,ft({ref:this.ref,style:s,className:this.props.className},t),this.state.isResizing&&n.createElement("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer())},t.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},t}(n.PureComponent);const Ot=m.keyframes`
  0% {
    transform: translateY(400px);
  }

  100% {
    transform: translateY(0px);
  }
`,Ft=(0,r.stylesFactory)((e=>({container:m.css`
      position: fixed !important;
      bottom: 0;
      background: ${e.colors.background.primary};
      border-top: 1px solid ${e.colors.border.weak};
      margin: ${e.spacing(0,-2,0,-2)};
      box-shadow: ${e.shadows.z3};
      z-index: ${e.zIndex.sidemenu};
    `,drawerActive:m.css`
      opacity: 1;
      animation: 0.5s ease-out ${Ot};
    `,rzHandle:m.css`
      background: ${e.colors.secondary.main};
      transition: 0.3s background ease-in-out;
      position: relative;
      width: 200px !important;
      height: 7px !important;
      left: calc(50% - 100px) !important;
      top: -4px !important;
      cursor: grab;
      border-radius: 4px;
      &:hover {
        background: ${e.colors.secondary.shade};
      }
    `})));function Dt(e){const{width:t,children:s,onResize:n}=e,i=(0,r.useTheme2)(),o=Ft(i),a=`${t+31.5}px`;return(0,j.jsx)(zt,{className:(0,m.cx)(o.container,o.drawerActive),defaultSize:{width:a,height:"400px"},handleClasses:{top:o.rzHandle},enable:{top:!0,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},maxHeight:"100vh",maxWidth:a,minWidth:a,onResize:n,children:s})}const Nt={loadRichHistory:We.TV,deleteRichHistory:We.ik},Lt=(0,i.connect)((function(e,t){let{exploreId:s}=t;const n=e.explore[s],{datasourceInstance:i}=n,o=u.Z.getBool(Le.hO.starredTabAsFirstTab,!1)?it.Starred:it.RichHistory,{richHistory:r}=n;return{richHistory:r,firstTab:o,activeDatasourceInstance:null==i?void 0:i.name}}),Nt);const Pt=Lt((function(e){const[t,s]=(0,n.useState)(400),{richHistory:i,width:o,firstTab:r,activeDatasourceInstance:a,exploreId:l,deleteRichHistory:c,loadRichHistory:d,onClose:u}=e;return(0,n.useEffect)((()=>{d(l)}),[d,l]),(0,j.jsx)(Dt,{width:o,onResize:(e,t,n)=>{s(Number(n.style.height.slice(0,-2)))},children:(0,j.jsx)(at,{richHistory:i,firstTab:r,activeDatasourceInstance:a,exploreId:l,deleteRichHistory:c,onClose:u,height:t})})}));var $t=s("./public/app/features/inspector/InspectJSONTab.tsx"),Bt=s("./public/app/features/inspector/QueryInspector.tsx"),Et=s("./public/app/features/inspector/InspectStatsTab.tsx"),At=s("./public/app/features/inspector/InspectDataTab.tsx"),Mt=s("./public/app/features/inspector/InspectErrorTab.tsx");const qt={runQueries:x.aA},_t=(0,i.connect)((function(e,t){let{exploreId:s}=t;const n=e.explore[s],{loading:i,queryResponse:o}=n;return{loading:i,queryResponse:o}}),qt)((function(e){var t;const{loading:s,width:n,onClose:i,queryResponse:o,timeZone:a}=e,l=(null==o?void 0:o.series)||[],c=null==o?void 0:o.error,d={label:"Stats",value:"stats",icon:"chart-line",content:(0,j.jsx)(Et.f,{data:o,timeZone:null==o||null===(t=o.request)||void 0===t?void 0:t.timezone})},u={label:"JSON",value:"json",icon:"brackets-curly",content:(0,j.jsx)($t.W,{data:o,onClose:i})},p={label:"Data",value:"data",icon:"database",content:(0,j.jsx)(At.E,{data:l,isLoading:s,options:{withTransforms:!1,withFieldConfig:!1},timeZone:a})},h=[d,{label:"Query",value:"query",icon:"info-circle",content:(0,j.jsx)(Bt.D,{data:l,onRefreshQuery:()=>e.runQueries(e.exploreId)})},u,p];if(c){const e={label:"Error",value:"error",icon:"exclamation-triangle",content:(0,j.jsx)(Mt.l,{error:c})};h.push(e)}return(0,j.jsx)(Dt,{width:n,onResize:()=>{},children:(0,j.jsx)(r.TabbedContainer,{tabs:h,onClose:i,closeIconTooltip:"Close query inspector"})})}));var Ht=s("./public/app/features/profile/state/reducers.ts");function Zt(e){const{onClick:t,isSynced:s}=e;return(0,j.jsx)(r.Tooltip,{content:()=>{const{isSynced:t}=e,s=t?"Unsync all views":"Sync all views to this time range";return(0,j.jsx)(j.Fragment,{children:s})},placement:"bottom",children:(0,j.jsx)(r.ToolbarButton,{icon:"link",variant:s?"active":"default","aria-label":s?"Synced times":"Unsynced times",onClick:t})})}var Wt=s("./public/app/core/components/TimePicker/TimePickerWithHistory.tsx"),Qt=s("./public/app/core/utils/timePicker.ts");function Vt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class Ut extends n.Component{constructor(){super(...arguments),Vt(this,"onMoveTimePicker",(e=>{const{range:t,onChangeTime:s,timeZone:n}=this.props,{from:i,to:o}=(0,Qt.e)(e,t);s({from:(0,c.dateTimeForTimeZone)(n,i),to:(0,c.dateTimeForTimeZone)(n,o)})})),Vt(this,"onMoveForward",(()=>this.onMoveTimePicker(1))),Vt(this,"onMoveBack",(()=>this.onMoveTimePicker(-1))),Vt(this,"onChangeTimePicker",(e=>{const t=c.dateMath.isMathString(e.raw.from)?e.raw.from:e.from,s=c.dateMath.isMathString(e.raw.to)?e.raw.to:e.to;this.props.onChangeTime({from:t,to:s})})),Vt(this,"onZoom",(()=>{const{range:e,onChangeTime:t,timeZone:s}=this.props,{from:n,to:i}=(0,Qt.h)(e,2);t({from:(0,c.dateTimeForTimeZone)(s,n),to:(0,c.dateTimeForTimeZone)(s,i)})}))}render(){const{range:e,timeZone:t,fiscalYearStartMonth:s,splitted:n,syncedTimes:i,onChangeTimeSync:o,hideText:r,onChangeTimeZone:a,onChangeFiscalYearStartMonth:l}=this.props,c=n?(0,j.jsx)(Zt,{onClick:o,isSynced:i}):void 0,d={value:e,timeZone:t,fiscalYearStartMonth:s,onMoveBackward:this.onMoveBack,onMoveForward:this.onMoveForward,onZoom:this.onZoom,hideText:r};return(0,j.jsx)(Wt.a,Object.assign({},d,{timeSyncButton:c,isSynced:i,onChange:this.onChangeTimePicker,onChangeTimeZone:a,onChangeFiscalYearStartMonth:l}))}}function Gt(e){const{start:t,pause:s,resume:n,isLive:i,isPaused:o,stop:a,splitted:l}=e,c=i&&!o?"active":"default",d=i?o?n:s:t;return(0,j.jsxs)(r.ButtonGroup,{children:[(0,j.jsx)(r.Tooltip,{content:i&&!o?(0,j.jsx)(j.Fragment,{children:"Pause the live stream"}):(0,j.jsx)(j.Fragment,{children:"Start live stream your logs"}),placement:"bottom",children:(0,j.jsx)(r.ToolbarButton,{iconOnly:l,variant:c,icon:!i||o?"play":"pause",onClick:d,children:i&&o?"Paused":"Live"})}),(0,j.jsx)(he.Z,{mountOnEnter:!0,unmountOnExit:!0,timeout:100,in:i,classNames:{enter:Kt.stopButtonEnter,enterActive:Kt.stopButtonEnterActive,exit:Kt.stopButtonExit,exitActive:Kt.stopButtonExitActive},children:(0,j.jsx)(r.Tooltip,{content:(0,j.jsx)(j.Fragment,{children:"Stop and exit the live stream"}),placement:"bottom",children:(0,j.jsx)(r.ToolbarButton,{variant:c,onClick:a,icon:"square-shape"})})})]})}const Kt={stopButtonEnter:m.css`
    label: stopButtonEnter;
    width: 0;
    opacity: 0;
    overflow: hidden;
  `,stopButtonEnterActive:m.css`
    label: stopButtonEnterActive;
    opacity: 1;
    width: 32px;
  `,stopButtonExit:m.css`
    label: stopButtonExit;
    width: 32px;
    opacity: 1;
    overflow: hidden;
  `,stopButtonExitActive:m.css`
    label: stopButtonExitActive;
    opacity: 0;
    width: 0;
  `};var Yt=s("./public/app/features/dashboard/services/TimeSrv.ts");function Jt(e){const{isSmall:t,loading:s,onRun:n,onChangeRefreshInterval:i,refreshInterval:o,showDropdown:a,isLive:l}=e,c=(0,Yt.$t)().getValidIntervals(r.defaultIntervals);let d=s?"Cancel":"Run query",u="",p="108px";return l?null:(t&&(u=d,d=void 0,p="35px"),(0,j.jsx)(r.RefreshPicker,{onIntervalChanged:i,value:o,isLoading:s,text:d,tooltip:u,intervals:c,isLive:l,onRefresh:()=>n(s),noIntervalPicker:!a,primary:!0,width:p}))}var Xt=s("./public/app/features/dashboard/components/DashNav/DashNavButton.tsx");function es(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const ts=(0,n.lazy)((()=>s.e(5204).then(s.bind(s,"./public/app/features/explore/AddToDashboard/index.tsx")).then((e=>{let{AddToDashboard:t}=e;return{default:t}}))));class ss extends n.PureComponent{constructor(){var e;super(...arguments),e=this,es(this,"onChangeDatasource",(async e=>{this.props.changeDatasource(this.props.exploreId,e.uid,{importQueries:!0})})),es(this,"onRunQuery",(function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{runQueries:s,cancelQueries:n,exploreId:i}=e.props;return t?n(i):s(i)})),es(this,"onChangeRefreshInterval",(e=>{const{changeRefreshInterval:t,exploreId:s}=this.props;t(s,e)})),es(this,"onChangeTimeSync",(()=>{const{syncTimes:e,exploreId:t}=this.props;e(t)}))}render(){const{datasourceMissing:e,closeSplit:t,exploreId:s,loading:i,range:a,timeZone:l,fiscalYearStartMonth:c,splitted:d,syncedTimes:u,refreshInterval:p,onChangeTime:h,split:g,hasLiveOption:m,isLive:f,isPaused:v,containerWidth:x,onChangeTimeZone:y,onChangeFiscalYearStartMonth:b,topOfExploreViewRef:w}=this.props,S=(d?x<700:x<800)||!1,T=d||x<1210;return(0,j.jsx)("div",{ref:w,children:(0,j.jsx)(r.PageToolbar,{"aria-label":"Explore toolbar",title:s===o.K.left?"Explore":void 0,pageIcon:s===o.K.left?"compass":void 0,leftItems:[s===o.K.left&&(0,j.jsx)(Xt.u,{tooltip:"Copy shortened link",icon:"share-alt",onClick:()=>(0,Ze.L)(window.location.href),"aria-label":"Copy shortened link"},"share"),!e&&(0,j.jsx)(K.DataSourcePicker,{onChange:this.onChangeDatasource,current:this.props.datasourceName,hideTextValue:S,width:S?8:void 0},`${s}-ds-picker`)].filter(Boolean),children:(0,j.jsxs)(r.ToolbarButtonRow,{children:[d?(0,j.jsx)(r.ToolbarButton,{title:"Close split pane",onClick:()=>t(s),icon:"times",children:"Close"}):(0,j.jsx)(r.ToolbarButton,{title:"Split",onClick:()=>g(),icon:"columns",disabled:f,children:"Split"}),K.config.featureToggles.explore2Dashboard&&(0,j.jsx)(n.Suspense,{fallback:null,children:(0,j.jsx)(ts,{exploreId:s})}),!f&&(0,j.jsx)(Ut,{exploreId:s,range:a,timeZone:l,fiscalYearStartMonth:c,onChangeTime:h,splitted:d,syncedTimes:u,onChangeTimeSync:this.onChangeTimeSync,hideText:T,onChangeTimeZone:y,onChangeFiscalYearStartMonth:b}),(0,j.jsx)(Jt,{refreshInterval:p,onChangeRefreshInterval:this.onChangeRefreshInterval,isSmall:d||T,isLive:f,loading:i||f&&!v,onRun:this.onRunQuery,showDropdown:!f}),p&&(0,j.jsx)(r.SetInterval,{func:this.onRunQuery,interval:p,loading:i}),m&&(0,j.jsx)(fe,{exploreId:s,children:e=>(0,j.jsx)(Gt,{splitted:d,isLive:f,isPaused:v,start:e.start,pause:e.pause,resume:e.resume,stop:e.stop})})]})})})}}const ns={changeDatasource:Qe.zU,changeRefreshInterval:y.oz,cancelQueries:x.ci,runQueries:x.aA,closeSplit:a.YV,split:a.bW,syncTimes:y.mG,onChangeTimeZone:Ht.YT,onChangeFiscalYearStartMonth:Ht.rf},is=(0,i.connect)(((e,t)=>{var s;let{exploreId:n}=t;const{syncedTimes:i}=e.explore,o=e.explore[n],{datasourceInstance:r,datasourceMissing:a,range:l,refreshInterval:c,loading:d,isLive:u,isPaused:p,containerWidth:h}=o,m=!(null==r||null===(s=r.meta)||void 0===s||!s.streaming);return{datasourceMissing:a,datasourceName:null==r?void 0:r.name,loading:d,range:l,timeZone:(0,g.Z)(e.user),fiscalYearStartMonth:(0,g.i)(e.user),splitted:(0,Ce.p)(e),refreshInterval:c,hasLiveOption:m,isLive:u,isPaused:p,syncedTimes:i,containerWidth:h}}),ns)(ss);var os,rs,as=s("./public/app/core/core.ts"),ls=s("./public/app/types/index.ts");const cs=()=>{const e=(0,r.useTheme2)(),t=as.Vt.hasPermission(ls.bW.DataSourcesCreate)&&as.Vt.hasPermission(ls.bW.DataSourcesWrite),s=(0,j.jsxs)(j.Fragment,{children:[os||(os=(0,j.jsx)(r.Icon,{name:"rocket"})),(0,j.jsx)(j.Fragment,{children:" ProTip: You can also define data sources through configuration files. "}),rs||(rs=(0,j.jsx)("a",{href:"http://docs.grafana.org/administration/provisioning/#datasources?utm_source=explore",target:"_blank",rel:"noreferrer",className:"text-link",children:"Learn more"}))]}),n=(0,j.jsx)(r.LinkButton,{size:"lg",href:"datasources/new",icon:"database",disabled:!t,children:"Add data source"}),i=m.css`
    max-width: ${e.breakpoints.values.lg}px;
    margin-top: ${e.spacing(2)};
    align-self: center;
  `;return(0,j.jsx)(r.CallToActionCard,{callToActionElement:n,className:i,footer:s,message:"Explore requires at least one data source. Once you have added a data source, you can query it here."})};function ds(e){const t=(e=>({containerMargin:m.css`
      margin-top: ${e.spacing(2)};
    `}))((0,r.useTheme2)());return(0,j.jsx)("div",{className:t.containerMargin,children:(0,j.jsxs)(r.HorizontalGroup,{children:[!e.addQueryRowButtonHidden&&(0,j.jsx)(r.Button,{variant:"secondary","aria-label":"Add row button",onClick:e.onClickAddQueryRowButton,disabled:e.addQueryRowButtonDisabled,icon:"plus",children:"Add query"}),(0,j.jsx)(r.Button,{variant:"secondary","aria-label":"Rich history button",className:(0,m.cx)({"explore-active-button":e.richHistoryButtonActive}),onClick:e.onClickRichHistoryButton,icon:"history",children:"Query history"}),(0,j.jsx)(r.Button,{variant:"secondary","aria-label":"Query inspector button",className:(0,m.cx)({"explore-active-button":e.queryInspectorButtonActive}),onClick:e.onClickQueryInspectorButton,icon:"info-circle",children:"Inspector"})]})})}var us,ps=s("./packages/grafana-ui/src/components/Table/types.ts"),hs=s("./.yarn/__virtual__/react-use-virtual-00326e70ba/3/opt/drone/yarncache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useToggle.js"),gs=s("./public/app/plugins/panel/nodeGraph/NodeGraph.tsx"),ms=s("./public/app/plugins/panel/nodeGraph/useCategorizeFrames.ts");const fs=e=>({warningText:m.css`
    label: warningText;
    font-size: ${e.typography.bodySmall.fontSize};
    color: ${e.colors.text.secondary};
  `});const vs={splitOpen:a.bW},xs=(0,i.connect)((function(e,t){let{exploreId:s}=t;return{range:e.explore[s].range}}),vs)((function(e){var t;const{dataFrames:s,range:n,splitOpen:i,withTraceView:o}=e,a=(0,ve.u)(n,i),l=(0,r.useTheme2)(),d=(0,r.useStyles2)(fs),u=(0,c.applyFieldOverrides)({fieldConfig:{defaults:{},overrides:[]},data:s,replaceVariables:e=>e,theme:l}),{nodes:p}=(0,ms.Y)(u),[h,g]=(0,hs.Z)(!1),m=o&&(null===(t=p[0])||void 0===t?void 0:t.length)>1e3?(0,j.jsxs)("span",{className:d.warningText,children:[" (",p[0].length," nodes, can be slow to load)"]}):null;return(0,j.jsx)(r.Collapse,{label:(0,j.jsxs)("span",{children:["Node graph",m," ",us||(us=(0,j.jsx)(r.Badge,{text:"Beta",color:"blue",icon:"rocket",tooltip:"This visualization is in beta"}))]}),collapsible:o,isOpen:!o||h,onToggle:o?()=>g():void 0,children:(0,j.jsx)("div",{style:{height:o?500:600},children:(0,j.jsx)(gs.E,{dataFrames:u,getLinks:a})})})}));var ys=s("./.yarn/__virtual__/react-transition-group-virtual-8df824fae8/3/opt/drone/yarncache/react-transition-group-npm-4.4.2-5052c30656-b67bf5b3e8.zip/node_modules/react-transition-group/esm/Transition.js");const bs=e=>{const t={transition:`opacity ${e.duration}ms linear`,opacity:0},s={exited:{opacity:0,display:"none"},entering:{opacity:0},entered:{opacity:1},exiting:{opacity:0}};return(0,j.jsx)(ys.ZP,{in:e.in,timeout:e.duration,unmountOnExit:e.unmountOnExit||!1,onExited:e.onExited,children:n=>(0,j.jsx)("div",{style:Object.assign({},t,s[n]),children:e.children})})},ws=e=>{var t;const{queryError:s}=e,n=(0,r.useTheme2)(),i=!!s,o=i?100:10,a=s?"Query error":"Unknown error",l=(null==s?void 0:s.message)||(null==s||null===(t=s.data)||void 0===t?void 0:t.message)||null,c=m.css`
    margin-top: ${n.spacing(2)};
  `;return(0,j.jsx)(bs,{in:i,duration:o,children:(0,j.jsx)(r.Alert,{severity:"error",title:a,className:c,children:l})})};function Ss(e){const t=(0,i.useSelector)((t=>{var s;return null===(s=t.explore[e.exploreId])||void 0===s?void 0:s.queryResponse})),s=(null==t?void 0:t.state)===c.LoadingState.Error?null==t?void 0:t.error:void 0;return(0,j.jsx)(ws,{queryError:s})}var js,Ts,Rs=s("./packages/jaeger-ui-components/src/index.ts");function Cs(e){let{splitOpenFn:t,traceToLogsOptions:s,dataFrame:n}=e;return n&&1!==n.fields.length&&n.fields.some((e=>{var t;return Boolean(null===(t=e.config.links)||void 0===t?void 0:t.length)}))?function(e){const s=n.fields.find((e=>{var t;return Boolean(null===(t=e.config.links)||void 0===t?void 0:t.length)}));try{const i=(0,ve.a)({field:s,rowIndex:e.dataFrameRowIndex,splitOpenFn:t,range:ks(e),dataFrame:n});return{href:i[0].href,onClick:i[0].onClick,content:js||(js=(0,j.jsx)(r.Icon,{name:"gf-logs",title:"Explore the logs for this in split view"}))}}catch(e){return void console.error(e)}}:function(e,t){if(null==t||!t.datasourceUid)return;const s=(0,Se.ak)().getInstanceSettings(t.datasourceUid),n="grafana-splunk-datasource"===(null==s?void 0:s.type);if(!s)return;return function(i){var o;let a,l={};switch(null==s?void 0:s.type){case"loki":if(l=function(e,t,s){const{tags:n,filterByTraceID:i,filterBySpanID:o,mapTagNamesEnabled:r,mappedTags:a}=t,l=r&&null!=a&&a.length?a:null!=n&&n.length?n:Is,c=[...e.process.tags,...e.tags].reduce(((e,t)=>{if(r){const s=l.find((e=>e.key===t.key));s&&e.push(`${s.value?s.value:s.key}="${t.value}"`)}else l.includes(t.key)&&e.push(`${t.key}="${t.value}"`);return e}),[]);if(!c.length)return;let d=`{${c.join(", ")}}`;i&&e.traceID&&(d+=` |="${e.traceID}"`);o&&e.spanID&&(d+=` |="${e.spanID}"`);return{title:s.name,url:"",internal:{datasourceUid:s.uid,datasourceName:s.name,query:{expr:d,refId:""}}}}(i,t,s),!l)return;break;case"grafana-splunk-datasource":l=function(e,t,s){const{tags:n,filterByTraceID:i,filterBySpanID:o,mapTagNamesEnabled:r,mappedTags:a}=t,l=r&&null!=a&&a.length?a:null!=n&&n.length?n:Is,c=[...e.process.tags,...e.tags].reduce(((e,t)=>{if(r){const s=l.find((e=>e.key===t.key));s&&e.push(`${s.value?s.value:s.key}="${t.value}"`)}else l.includes(t.key)&&e.push(`${t.key}="${t.value}"`);return e}),[]);let d="";c.length>0&&(d+=`${c.join(" ")}`);i&&e.traceID&&(d+=` "${e.traceID}"`);o&&e.spanID&&(d+=` "${e.spanID}"`);return{title:s.name,url:"",internal:{datasourceUid:s.uid,datasourceName:s.name,query:{query:d,refId:""}}}}(i,t,s);break;default:return}return a=(0,c.mapInternalLinkToExplore)({link:l,internalLink:null===(o=l)||void 0===o?void 0:o.internal,scopedVars:{},range:ks(i,{startMs:t.spanStartTimeShift?c.rangeUtil.intervalToMs(t.spanStartTimeShift):0,endMs:t.spanEndTimeShift?c.rangeUtil.intervalToMs(t.spanEndTimeShift):0},n),field:{},onClickFn:e,replaceVariables:(0,K.getTemplateSrv)().replace.bind((0,K.getTemplateSrv)())}),{href:a.href,onClick:a.onClick,content:Ts||(Ts=(0,j.jsx)(r.Icon,{name:"gf-logs",title:"Explore the logs for this in split view"}))}}}(t,s)}const Is=["cluster","hostname","namespace","pod"];function ks(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{startMs:0,endMs:0},s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=Math.floor(e.startTime/1e3+t.startMs),i=(0,c.dateTime)(n),o=(e.startTime+e.duration)/1e3;let r=Math.floor(o+t.endMs);s&&r-n<1e3?r=n+1e3:n===r&&r++;const a=(0,c.dateTime)(r);return{from:i,to:a,raw:{from:i,to:a}}}function zs(e,t,s){return n=>{const i=t.get(n);if(!i)return;let o;o="tags"===e?i.toggleTags():"process"===e?i.toggleProcess():"warnings"===e?i.toggleWarnings():"references"===e?i.toggleReferences():"stackTraces"===e?i.toggleStackTraces():i.toggleLogs();const r=new Map(t);r.set(n,o),s(r)}}function Os(){return{}}function Fs(e){var t,s,o,r,a;const{expandOne:l,expandAll:d,collapseOne:u,collapseAll:h,childrenToggle:m,childrenHiddenIDs:f,spanFindMatches:v,traceProp:x}=e,{detailStates:y,toggleDetail:b,detailLogItemToggle:w,detailLogsToggle:S,detailProcessToggle:T,detailReferencesToggle:R,detailReferenceItemToggle:C,detailTagsToggle:I,detailWarningsToggle:k,detailStackTracesToggle:z}=function(e){const[t,s]=(0,n.useState)(new Map);(0,n.useEffect)((()=>{s(new Map)}),[e,s]);const i=(0,n.useCallback)((function(e){const n=new Map(t);n.has(e)?n.delete(e):n.set(e,new Rs.kt),s(n)}),[t]),o=(0,n.useCallback)((function(e,n){const i=t.get(e);if(!i)return;const o=i.toggleLogItem(n),r=new Map(t);return r.set(e,o),s(r)}),[t]),r=(0,n.useCallback)((function(e,n){const i=t.get(e);if(!i)return;const o=i.toggleReferenceItem(n),r=new Map(t);return r.set(e,o),s(r)}),[t]);return{detailStates:t,toggleDetail:i,detailLogItemToggle:o,detailLogsToggle:(0,n.useCallback)((e=>zs("logs",t,s)(e)),[t]),detailWarningsToggle:(0,n.useCallback)((e=>zs("warnings",t,s)(e)),[t]),detailStackTracesToggle:(0,n.useCallback)((e=>zs("stackTraces",t,s)(e)),[t]),detailReferenceItemToggle:r,detailReferencesToggle:(0,n.useCallback)((e=>zs("references",t,s)(e)),[t]),detailProcessToggle:(0,n.useCallback)((e=>zs("process",t,s)(e)),[t]),detailTagsToggle:(0,n.useCallback)((e=>zs("tags",t,s)(e)),[t])}}(e.dataFrames[0]),{removeHoverIndentGuideId:O,addHoverIndentGuideId:F,hoverIndentGuideIds:D}=function(){const[e,t]=(0,n.useState)(new Set);return{hoverIndentGuideIds:e,addHoverIndentGuideId:(0,n.useCallback)((function(e){t((t=>{const s=new Set(t);return s.add(e),s}))}),[]),removeHoverIndentGuideId:(0,n.useCallback)((function(e){t((t=>{const s=new Set(t);return s.delete(e),s}))}),[])}}(),{viewRange:N,updateViewRangeTime:L,updateNextViewRangeTime:P}=function(){const[e,t]=(0,n.useState)({time:{current:[0,1]}}),s=(0,n.useCallback)((function(e){t((t=>{const s=Object.assign({},t.time,e);return Object.assign({},t,{time:s})}))}),[]),i=(0,n.useCallback)((function(e,s){const n={current:[e,s]};t((e=>Object.assign({},e,{time:n})))}),[]);return{viewRange:e,updateViewRangeTime:i,updateNextViewRangeTime:s}}(),[$,B]=(0,n.useState)(.25),[E,A]=(0,n.useState)(!1),M=(0,i.useSelector)((t=>{var s,n;return null!==(s=null===(n=t.explore[e.exploreId])||void 0===n?void 0:n.datasourceInstance)&&void 0!==s?s:void 0})),[q,_]=function(e){const t=(0,i.useSelector)((t=>{var s;return null===(s=t.explore[e.exploreId])||void 0===s?void 0:s.panelsState.trace})),s=null==t?void 0:t.spanId,n=(0,i.useDispatch)(),o=s=>n((0,p.km)(e.exploreId,"trace",Object.assign({},t,{spanId:s}))),r=(0,i.useSelector)((t=>{var s;return null===(s=t.explore[e.exploreId])||void 0===s?void 0:s.queries.find((t=>t.refId===e.refId))}));return[s,(t,n)=>{var i,a;const l={title:"Deep link to this span",url:"",internal:{datasourceUid:null===(i=e.datasource)||void 0===i?void 0:i.uid,datasourceName:null===(a=e.datasource)||void 0===a?void 0:a.name,query:r,panelsState:{trace:{spanId:n}}}};return(0,c.mapInternalLinkToExplore)({link:l,internalLink:l.internal,scopedVars:{},range:{},field:{},onClickFn:()=>o(s===n?void 0:n),replaceVariables:(0,K.getTemplateSrv)().replace.bind((0,K.getTemplateSrv)())})}]}({refId:null===(t=e.dataFrames[0])||void 0===t?void 0:t.refId,exploreId:e.exploreId,datasource:M}),H=(0,n.useMemo)((()=>{var t;return{childrenHiddenIDs:f,detailStates:y,hoverIndentGuideIds:D,shouldScrollToFirstUiFindMatch:!1,spanNameColumnWidth:$,traceID:null===(t=e.traceProp)||void 0===t?void 0:t.traceID}}),[f,y,D,$,null===(s=e.traceProp)||void 0===s?void 0:s.traceID]);(0,n.useEffect)((()=>{var t,s;e.queryResponse.state===c.LoadingState.Done&&(null===(t=e.topOfExploreViewRef)||void 0===t||null===(s=t.current)||void 0===s||s.scrollIntoView())}),[e.queryResponse,e.topOfExploreViewRef]);const Z=null===(o=(0,Se.ak)().getInstanceSettings(null==M?void 0:M.name))||void 0===o||null===(r=o.jsonData)||void 0===r?void 0:r.tracesToLogs,W=(0,n.useMemo)((()=>Cs({splitOpenFn:e.splitOpenFn,traceToLogsOptions:Z,dataFrame:e.dataFrames[0]})),[e.splitOpenFn,Z,e.dataFrames]),Q=(0,n.useCallback)((()=>A(!E)),[E]),V=(0,i.useSelector)((e=>(0,g.Z)(e.user)));return null!==(a=e.dataFrames)&&void 0!==a&&a.length&&x?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(Rs.T2,{canCollapse:!1,hideMap:!1,hideSummary:!1,onSlimViewClicked:Q,onTraceGraphViewClicked:Os,slimView:E,trace:x,updateNextViewRangeTime:P,updateViewRangeTime:L,viewRange:N,timeZone:V}),(0,j.jsx)(Rs.Ox,{registerAccessors:Os,scrollToFirstVisibleSpan:Os,findMatchesIDs:v,trace:x,traceTimeline:H,updateNextViewRangeTime:P,updateViewRangeTime:L,viewRange:N,focusSpan:Os,createLinkToExternalSpan:(e,t)=>_(e,t).href,setSpanNameColumnWidth:B,collapseAll:h,collapseOne:u,expandAll:d,expandOne:l,childrenToggle:m,clearShouldScrollToFirstUiFindMatch:Os,detailLogItemToggle:w,detailLogsToggle:S,detailWarningsToggle:k,detailStackTracesToggle:z,detailReferencesToggle:R,detailReferenceItemToggle:C,detailProcessToggle:T,detailTagsToggle:I,detailToggle:b,setTrace:Os,addHoverIndentGuideId:F,removeHoverIndentGuideId:O,linksGetter:Os,uiFind:e.search,createSpanLink:W,scrollElement:e.scrollElement,focusedSpanId:q,focusedSpanIdForSearch:e.focusedSpanIdForSearch,createFocusSpanLink:_,topOfExploreViewRef:e.topOfExploreViewRef})]}):null}var Ds=s("../../opt/drone/yarncache/classnames-npm-2.3.1-f2ae0a8d3c-14db8889d5.zip/node_modules/classnames/index.js"),Ns=s.n(Ds),Ls=s("./.yarn/__virtual__/@emotion-css-virtual-15ef12e38d/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js");function Ps(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class $s extends n.PureComponent{constructor(){super(...arguments),Ps(this,"clearUiFind",(()=>{this.props.onChange("")}))}render(){const{allowClear:e,inputProps:t,value:s}=this.props,n=(0,j.jsxs)(j.Fragment,{children:[t.suffix,e&&s&&s.length&&(0,j.jsx)(r.IconButton,{name:"times",onClick:this.clearUiFind})]});return(0,j.jsx)(r.Input,Object.assign({placeholder:"Find..."},t,{onChange:e=>this.props.onChange(e.currentTarget.value),suffix:n,value:s}))}}Ps($s,"defaultProps",{inputProps:{},trackFindFunction:void 0,value:void 0});var Bs=s("./packages/jaeger-ui-components/src/uberUtilityStyles.ts");const Es=e=>({TracePageSearchBar:Ls.iv`
      label: TracePageSearchBar;
      float: right;
      position: sticky;
      top: 8px;
      right: 0;
      z-index: ${e.zIndex.navbarFixed};
      background: ${e.colors.background.primary};
      margin-top: 8px;
      margin-bottom: -48px;
      padding: 8px;
      margin-right: 2px;
      border-radius: 4px;
      box-shadow: ${e.shadows.z2};
    `,TracePageSearchBarBar:Ls.iv`
      label: TracePageSearchBarBar;
      max-width: 20rem;
      transition: max-width 0.5s;
      &:focus-within {
        max-width: 100%;
      }
    `,TracePageSearchBarSuffix:Ls.iv`
      label: TracePageSearchBarSuffix;
      opacity: 0.6;
    `,TracePageSearchBarBtn:Ls.iv`
      label: TracePageSearchBarBtn;
      transition: 0.2s;
      margin-left: 8px;
    `,TracePageSearchBarBtnDisabled:Ls.iv`
      label: TracePageSearchBarBtnDisabled;
      opacity: 0.5;
    `,TracePageSearchBarLocateBtn:Ls.iv`
      label: TracePageSearchBarLocateBtn;
      padding: 1px 8px 4px;
    `}),As=(0,n.memo)((function(e){const{navigable:t,nextResult:s,prevResult:n,onSearchValueChange:i,searchValue:o,searchBarSuffix:a}=e,l=(0,r.useStyles2)(Es),c=o?(0,j.jsx)("span",{className:l.TracePageSearchBarSuffix,"data-testid":"trace-page-search-bar-suffix",children:a}):null,d=Ns()(l.TracePageSearchBarBtn,{[l.TracePageSearchBarBtnDisabled]:!o}),u={"data-test":"in-trace-search",className:Ns()(l.TracePageSearchBarBar,Bs.A4),name:"search",suffix:c};return(0,j.jsx)("div",{className:l.TracePageSearchBar,children:(0,j.jsxs)("span",{className:Bs.NY,style:{display:"flex"},children:[(0,j.jsx)($s,{onChange:i,value:o,inputProps:u,allowClear:!0}),(0,j.jsx)(j.Fragment,{children:t&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(r.Button,{className:d,variant:"secondary",disabled:!o,type:"button",icon:"arrow-down","data-testid":"trace-page-search-bar-next-result-button",onClick:s}),(0,j.jsx)(r.Button,{className:d,variant:"secondary",disabled:!o,type:"button",icon:"arrow-up","data-testid":"trace-page-search-bar-prev-result-button",onClick:n})]})})]})})}));function Ms(e){if(!e)return null;let t=1===e.fields.length?e.fields[0].values.get(0):function(e){const t=new c.DataFrameView(e),s={};for(let e=0;e<t.length;e++){const n=t.get(e);s[n.spanID]||(s[n.spanID]={serviceName:n.serviceName,tags:n.serviceTags})}return{traceID:t.get(0).traceID,processes:s,spans:t.toArray().map(((e,t)=>{var s;const n=[];return e.parentSpanID&&n.push({refType:"CHILD_OF",spanID:e.parentSpanID,traceID:e.traceID}),e.references&&n.push(...e.references.map((e=>Object.assign({refType:"FOLLOWS_FROM"},e)))),Object.assign({},e,{duration:1e3*e.duration,startTime:1e3*e.startTime,processID:e.spanID,flags:0,references:n,logs:(null===(s=e.logs)||void 0===s?void 0:s.map((e=>Object.assign({},e,{timestamp:1e3*e.timestamp}))))||[],dataFrameRowIndex:t})}))}}(e);return(0,Rs.R1)(t)}function qs(e,t){return e.filter((e=>e.hasChildren)).length===t.size}function _s(e){const t=e.dataFrames[0],{dataFrames:s,splitOpenFn:i,exploreId:o,scrollElement:a,topOfExploreViewRef:l,queryResponse:c}=e,d=(0,n.useMemo)((()=>Ms(t)),[t]),{search:u,setSearch:p,spanFindMatches:h}=function(e){const[t,s]=(0,n.useState)(""),i=(0,n.useMemo)((()=>t&&e?(0,Rs.rZ)(t,e):void 0),[t,e]);return{search:t,setSearch:s,spanFindMatches:i}}(null==d?void 0:d.spans),{expandOne:g,collapseOne:m,childrenToggle:f,collapseAll:v,childrenHiddenIDs:x,expandAll:y}=function(){const[e,t]=(0,n.useState)(new Set),s=(0,n.useCallback)((function(s){if(0===e.size)return;let n=-1,i=!0;const o=s.reduce(((e,t)=>(t.depth<=n&&(i=!0),i&&e.has(t.spanID)&&(e.delete(t.spanID),i=!1,n=t.depth),e)),new Set(e));t(o)}),[e]),i=(0,n.useCallback)((function(s){if(qs(s,e))return;let n;const i=s.reduce(((e,t)=>(n&&t.depth<=n.depth?(e.add(n.spanID),t.hasChildren&&(n=t)):t.hasChildren&&!e.has(t.spanID)&&(n=t),e)),new Set(e));n&&i.add(n.spanID),t(i)}),[e]),o=(0,n.useCallback)((function(){t(new Set)}),[]),r=(0,n.useCallback)((function(s){if(qs(s,e))return;const n=s.reduce(((e,t)=>(t.hasChildren&&e.add(t.spanID),e)),new Set);t(n)}),[e]),a=(0,n.useCallback)((function(s){const n=new Set(e);e.has(s)?n.delete(s):n.add(s),t(n)}),[e]);return{childrenHiddenIDs:e,expandOne:s,collapseOne:i,expandAll:o,collapseAll:r,childrenToggle:a}}(),[b,w]=(0,n.useState)(""),[S,T]=(0,n.useState)(""),R=e=>null!=h&&h.size&&(null==h?void 0:h.size)>0?e+" of "+(null==h?void 0:h.size):"";return d?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(As,{nextResult:()=>{y();const e=Array.from(h),t=e.indexOf(b)?e.indexOf(b):0;if(-1===t||t===e.length-1)return w(e[0]),void T(R(1));w(e[t+1]),T(R(t+2))},prevResult:()=>{y();const e=Array.from(h),t=e.indexOf(b)?e.indexOf(b):0;if(-1===t||0===t)return w(e[e.length-1]),void T(R(e.length));w(e[t-1]),T(R(t))},navigable:!0,searchValue:u,onSearchValueChange:e=>{w(""),T(""),p(e)},searchBarSuffix:S}),(0,j.jsx)(r.Collapse,{label:"Trace View",isOpen:!0,children:(0,j.jsx)(Fs,{exploreId:o,dataFrames:s,splitOpenFn:i,scrollElement:a,topOfExploreViewRef:l,traceProp:d,spanFindMatches:h,search:u,focusedSpanIdForSearch:b,expandOne:g,collapseOne:m,collapseAll:v,expandAll:y,childrenToggle:f,childrenHiddenIDs:x,queryResponse:c})})]}):null}var Hs,Zs;function Ws(e){var t;const[s,i]=(0,n.useState)(!1),o=e.error.message||(null===(t=e.error.data)||void 0===t?void 0:t.message)||"",a=!s&&o.length>100;return(0,j.jsx)(r.Alert,{title:"Failed to load log volume for this query",severity:"warning",children:a?(0,j.jsx)(r.Button,{variant:"secondary",size:"xs",onClick:()=>{i(!0)},children:"Show details"}):o})}function Qs(e){const{width:t,logsVolumeData:s,absoluteRange:n,timeZone:i,splitOpen:o,onUpdateTimeRange:a,onLoadLogsVolume:l}=e,d=(0,r.useTheme2)(),u=(0,r.useStyles2)(Vs),p=parseInt(d.spacing(2).slice(0,-2),10);let h;if(!s)return null;if(null!=s&&s.error)return(0,j.jsx)(Ws,{error:null==s?void 0:s.error});(null==s?void 0:s.state)===c.LoadingState.Loading?h=Hs||(Hs=(0,j.jsx)("span",{children:"Log volume is loading..."})):null!=s&&s.data&&(h=s.data.length>0?(0,j.jsx)(se,{graphStyle:"lines",loadingState:c.LoadingState.Done,data:s.data,height:150,width:t-p,absoluteRange:n,onChangeTime:a,timeZone:i,splitOpenFn:o,tooltipDisplayMode:r.TooltipDisplayMode.Multi}):Zs||(Zs=(0,j.jsx)("span",{children:"No volume data."})));const g=function(e,t){var s,n;const i=e&&e.data[0]&&(null===(s=e.data[0].meta)||void 0===s||null===(n=s.custom)||void 0===n?void 0:n.absoluteRange);return i?(t.from-t.to)/(i.from-i.to):void 0}(s,n);let m;return void 0!==g&&g<1&&(m=(0,j.jsx)(r.InlineField,{label:"Reload log volume",transparent:!0,children:(0,j.jsx)(r.Button,{size:"xs",icon:"sync",variant:"secondary",onClick:l,id:"reload-volume"})})),(0,j.jsxs)(r.Collapse,{label:"Log volume",isOpen:!0,loading:(null==s?void 0:s.state)===c.LoadingState.Loading,children:[(0,j.jsx)("div",{style:{height:150},className:u.contentContainer,children:h}),(0,j.jsx)("div",{className:u.zoomInfoContainer,children:m})]})}const Vs=()=>({zoomInfoContainer:m.css`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: 5px;
    `,contentContainer:m.css`
      display: flex;
      align-items: center;
      justify-content: center;
    `});const Us=ls.f0.map((e=>({value:e,label:e[0].toUpperCase()+e.slice(1).replace(/_/," ")}))),Gs=(0,m.css)({display:"flex",justifyContent:"space-between"});function Ks(e){const{graphStyle:t,onChangeGraphStyle:s}=e;return(0,j.jsxs)("div",{className:Gs,children:["Graph",(0,j.jsx)(r.RadioButtonGroup,{size:"sm",options:Us,value:t,onChange:s})]})}var Ys,Js=s("./public/app/plugins/panel/nodeGraph/utils.ts");function Xs(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var en;!function(e){e[e.RichHistory=0]="RichHistory",e[e.QueryInspector=1]="QueryInspector"}(en||(en={}));class tn extends n.PureComponent{constructor(e){super(e),Xs(this,"scrollElement",void 0),Xs(this,"absoluteTimeUnsubsciber",void 0),Xs(this,"topOfExploreViewRef",(0,n.createRef)()),Xs(this,"onChangeTime",(e=>{const{updateTimeRange:t,exploreId:s}=this.props;t({exploreId:s,rawRange:e})})),Xs(this,"onClickExample",(e=>{this.props.setQueries(this.props.exploreId,[e])})),Xs(this,"onCellFilterAdded",(e=>{const{value:t,key:s,operator:n}=e;n===ps.PT&&this.onClickFilterLabel(s,t),n===ps.tE&&this.onClickFilterOutLabel(s,t)})),Xs(this,"onClickFilterLabel",((e,t)=>{this.onModifyQueries({type:"ADD_FILTER",key:e,value:t})})),Xs(this,"onClickFilterOutLabel",((e,t)=>{this.onModifyQueries({type:"ADD_FILTER_OUT",key:e,value:t})})),Xs(this,"onClickAddQueryRowButton",(()=>{const{exploreId:e,queryKeys:t}=this.props;this.props.addQueryRow(e,t.length)})),Xs(this,"onMakeAbsoluteTime",(()=>{const{makeAbsoluteTime:e}=this.props;e()})),Xs(this,"onModifyQueries",((e,t)=>{const{datasourceInstance:s}=this.props;if(null!=s&&s.modifyQuery){const n=(e,t)=>s.modifyQuery(e,t);this.props.modifyQueries(this.props.exploreId,e,n,t)}})),Xs(this,"onResize",(e=>{this.props.changeSize(this.props.exploreId,e)})),Xs(this,"onStartScanning",(()=>{this.props.scanStart(this.props.exploreId)})),Xs(this,"onStopScanning",(()=>{this.props.scanStopAction({exploreId:this.props.exploreId})})),Xs(this,"onUpdateTimeRange",(e=>{const{exploreId:t,updateTimeRange:s}=this.props;s({exploreId:t,absoluteRange:e})})),Xs(this,"onChangeGraphStyle",(e=>{const{exploreId:t,changeGraphStyle:s}=this.props;s(t,e)})),Xs(this,"toggleShowRichHistory",(()=>{this.setState((e=>({openDrawer:e.openDrawer===en.RichHistory?void 0:en.RichHistory})))})),Xs(this,"toggleShowQueryInspector",(()=>{this.setState((e=>({openDrawer:e.openDrawer===en.QueryInspector?void 0:en.QueryInspector})))})),Xs(this,"memoizedGetNodeGraphDataFrames",(0,l.Z)(Js.Ee)),this.state={openDrawer:void 0}}componentDidMount(){this.absoluteTimeUnsubsciber=Y.Z.subscribe($e.QI,this.onMakeAbsoluteTime)}componentWillUnmount(){var e;null===(e=this.absoluteTimeUnsubsciber)||void 0===e||e.unsubscribe()}renderEmptyState(){return Ys||(Ys=(0,j.jsx)("div",{className:"explore-container",children:(0,j.jsx)(cs,{})}))}renderGraphPanel(e){const{graphResult:t,absoluteRange:s,timeZone:n,splitOpen:i,queryResponse:o,loading:a,theme:l,graphStyle:c}=this.props,d=parseInt(l.spacing(2).slice(0,-2),10),u=(0,j.jsx)(Ks,{graphStyle:c,onChangeGraphStyle:this.onChangeGraphStyle});return(0,j.jsx)(r.Collapse,{label:u,loading:a,isOpen:!0,children:(0,j.jsx)(se,{graphStyle:c,data:t,height:400,width:e-d,absoluteRange:s,onChangeTime:this.onUpdateTimeRange,timeZone:n,annotations:o.annotations,splitOpenFn:i,loadingState:o.state})})}renderLogsVolume(e){const{logsVolumeData:t,exploreId:s,loadLogsVolumeData:n,absoluteRange:i,timeZone:o,splitOpen:r}=this.props;return(0,j.jsx)(Qs,{absoluteRange:i,width:e,logsVolumeData:t,onUpdateTimeRange:this.onUpdateTimeRange,timeZone:o,splitOpen:r,onLoadLogsVolume:()=>n(s)})}renderTablePanel(e){const{exploreId:t,datasourceInstance:s,timeZone:n}=this.props;return(0,j.jsx)(Ne,{ariaLabel:d.wl.pages.Explore.General.table,width:e,exploreId:t,onCellFilterAdded:null!=s&&s.modifyQuery?this.onCellFilterAdded:void 0,timeZone:n})}renderLogsPanel(e){const{exploreId:t,syncedTimes:s,theme:n,queryResponse:i}=this.props,o=parseInt(n.spacing(2).slice(0,-2),10);return(0,j.jsx)(we,{exploreId:t,loadingState:i.state,syncedTimes:s,width:e-o,onClickFilterLabel:this.onClickFilterLabel,onClickFilterOutLabel:this.onClickFilterOutLabel,onStartScanning:this.onStartScanning,onStopScanning:this.onStopScanning})}renderNodeGraphPanel(){const{exploreId:e,showTrace:t,queryResponse:s}=this.props;return(0,j.jsx)(xs,{dataFrames:this.memoizedGetNodeGraphDataFrames(s.series),exploreId:e,withTraceView:t})}renderTraceViewPanel(){const{queryResponse:e,splitOpen:t,exploreId:s}=this.props,n=e.series.filter((e=>{var t;return"trace"===(null===(t=e.meta)||void 0===t?void 0:t.preferredVisualisationType)}));return n.length&&(0,j.jsx)(_s,{exploreId:s,dataFrames:n,splitOpenFn:t,scrollElement:this.scrollElement,topOfExploreViewRef:this.topOfExploreViewRef,queryResponse:e})}render(){const{datasourceInstance:e,datasourceMissing:t,exploreId:s,graphResult:n,queryResponse:i,isLive:o,theme:a,showMetrics:l,showTable:d,showLogs:u,showTrace:p,showNodeGraph:h,timeZone:g}=this.props,{openDrawer:f}=this.state,x=(e=>({exploreMain:m.css`
      label: exploreMain;
      // Is needed for some transition animations to work.
      position: relative;
      margin-top: 21px;
    `,button:m.css`
      label: button;
      margin: 1em 4px 0 0;
    `,queryContainer:m.css`
      label: queryContainer;
      // Need to override normal css class and don't want to count on ordering of the classes in html.
      height: auto !important;
      flex: unset !important;
      display: unset !important;
      padding: ${e.spacing(1)};
    `}))(a),y=i&&i.state!==c.LoadingState.NotStarted,b=f===en.RichHistory,w=f===en.QueryInspector;return(0,j.jsxs)(r.CustomScrollbar,{autoHeightMin:"100%",scrollRefCallback:e=>this.scrollElement=e||void 0,children:[(0,j.jsx)(is,{exploreId:s,onChangeTime:this.onChangeTime,topOfExploreViewRef:this.topOfExploreViewRef}),t?this.renderEmptyState():null,e&&(0,j.jsxs)("div",{className:"explore-container",children:[(0,j.jsxs)("div",{className:(0,m.cx)("panel-container",x.queryContainer),children:[(0,j.jsx)(Ie,{exploreId:s}),(0,j.jsx)(ds,{addQueryRowButtonDisabled:o,addQueryRowButtonHidden:!1,richHistoryButtonActive:b,queryInspectorButtonActive:w,onClickAddQueryRowButton:this.onClickAddQueryRowButton,onClickRichHistoryButton:this.toggleShowRichHistory,onClickQueryInspectorButton:this.toggleShowQueryInspector}),(0,j.jsx)(Ss,{exploreId:s})]}),(0,j.jsx)(v.Z,{onResize:this.onResize,disableHeight:!0,children:e=>{let{width:t}=e;return 0===t?null:(0,j.jsx)("main",{className:(0,m.cx)(x.exploreMain),style:{width:t},children:(0,j.jsxs)(r.ErrorBoundaryAlert,{children:[y&&(0,j.jsxs)(j.Fragment,{children:[l&&n&&(0,j.jsx)(r.ErrorBoundaryAlert,{children:this.renderGraphPanel(t)}),(0,j.jsx)(r.ErrorBoundaryAlert,{children:this.renderLogsVolume(t)}),d&&(0,j.jsx)(r.ErrorBoundaryAlert,{children:this.renderTablePanel(t)}),u&&(0,j.jsx)(r.ErrorBoundaryAlert,{children:this.renderLogsPanel(t)}),h&&(0,j.jsx)(r.ErrorBoundaryAlert,{children:this.renderNodeGraphPanel()}),p&&(0,j.jsx)(r.ErrorBoundaryAlert,{children:this.renderTraceViewPanel()})]}),b&&(0,j.jsx)(Pt,{width:t,exploreId:s,onClose:this.toggleShowRichHistory}),w&&(0,j.jsx)(_t,{exploreId:s,width:t,onClose:this.toggleShowQueryInspector,timeZone:g})]})})}})]})]})}}const sn={changeSize:p.qN,changeGraphStyle:p.Rl,modifyQueries:x.sK,scanStart:x.EA,scanStopAction:x.P4,setQueries:x.KO,updateTimeRange:y.cD,makeAbsoluteTime:y.F9,loadLogsVolumeData:x.QH,addQueryRow:x.CS,splitOpen:a.bW},nn=(0,i.connect)((function(e,t){let{exploreId:s}=t;const n=e.explore,{syncedTimes:i}=n,o=n[s],r=(0,g.Z)(e.user),{datasourceInstance:a,datasourceMissing:l,queryKeys:c,isLive:d,graphResult:u,logsVolumeData:p,logsResult:h,showLogs:m,showMetrics:f,showTable:v,showTrace:x,absoluteRange:y,queryResponse:b,showNodeGraph:w,loading:S,graphStyle:j}=o;return{datasourceInstance:a,datasourceMissing:l,queryKeys:c,isLive:d,graphResult:u,logsVolumeData:p,logsResult:null!=h?h:void 0,absoluteRange:y,queryResponse:b,syncedTimes:i,timeZone:r,showLogs:m,showMetrics:f,showTable:v,showTrace:x,showNodeGraph:w,loading:S,graphStyle:j}}),sn),on=(0,f.compose)(nn,r.withTheme2)(tn);function rn(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class an extends n.PureComponent{constructor(e){super(e),rn(this,"el",void 0),rn(this,"exploreEvents",void 0),rn(this,"refreshExplore",(e=>{const{exploreId:t,urlQuery:s}=this.props;s!==e&&s!==a.IS[t]&&this.props.refreshExplore(t,s)})),rn(this,"getRef",(e=>{this.el=e})),this.exploreEvents=new c.EventBusSrv,this.state={openDrawer:void 0}}componentDidMount(){var e,t;const{initialized:s,exploreId:n,initialDatasource:i,initialQueries:o,initialRange:r,panelsState:a}=this.props,l=null!==(e=null===(t=this.el)||void 0===t?void 0:t.offsetWidth)&&void 0!==e?e:0;s||this.props.initializeExplore(n,i,o,r,l,this.exploreEvents,a)}componentWillUnmount(){this.exploreEvents.removeAllListeners(),this.props.cleanupPaneAction({exploreId:this.props.exploreId})}componentDidUpdate(e){this.refreshExplore(e.urlQuery)}render(){const e=this.props.split?"explore explore-split":"explore";return(0,j.jsx)("div",{className:e,ref:this.getRef,"data-testid":d.wl.pages.Explore.General.container,children:this.props.initialized&&(0,j.jsx)(on,{exploreId:this.props.exploreId})})}}const ln=(0,l.Z)(h.Z8),cn=(0,l.Z)(h.vP);const dn={initializeExplore:p.CK,refreshExplore:p.Om,cleanupPaneAction:a.Jt},un=(0,i.connect)((function(e,t){var s;const n=(0,h.J5)(t.urlQuery),i=(0,g.Z)(e.user),o=(0,g.i)(e.user),{datasource:r,queries:a,range:l,panelsState:c}=n||{},d=r||u.Z.get((0,h.I$)(e.user.orgId)),p=ln(a),m=l?cn(l,i,o):(0,h.OQ)(i,h.UI,o);return{initialized:null===(s=e.explore[t.exploreId])||void 0===s?void 0:s.initialized,initialDatasource:d,initialQueries:p,initialRange:m,panelsState:c}}),dn),pn=un(an);var hn=s("./public/app/core/components/Branding/Branding.tsx"),gn=s("./public/app/core/selectors/navModel.ts");const mn={resetExploreAction:a.WK,richHistoryUpdatedAction:a.ZU},fn=(0,i.connect)((e=>({navModel:(0,gn.h)(e.navIndex,"explore"),exploreState:e.explore})),mn);class vn extends n.PureComponent{componentWillUnmount(){this.props.resetExploreAction({})}componentDidMount(){a.IS.left=void 0,a.IS.right=void 0;const e=K.locationService.getSearchObject();(e.from||e.to)&&K.locationService.partial({from:void 0,to:void 0},!0)}componentDidUpdate(e){var t,s,n,i;const{left:o,right:r}=this.props.queryParams,a=Boolean(o)&&Boolean(r)?`${null===(t=this.props.exploreState.left.datasourceInstance)||void 0===t?void 0:t.name} | ${null===(s=this.props.exploreState.right)||void 0===s||null===(n=s.datasourceInstance)||void 0===n?void 0:n.name}`:`${null===(i=this.props.exploreState.left.datasourceInstance)||void 0===i?void 0:i.name}`,l=`${this.props.navModel.main.text} - ${a} - ${hn.c.AppTitle}`;document.title=l}render(){const{left:e,right:t}=this.props.queryParams,s=Boolean(e)&&Boolean(t);return(0,j.jsx)("div",{className:"page-scrollbar-wrapper",children:(0,j.jsxs)("div",{className:"explore-wrapper",children:[(0,j.jsx)(r.ErrorBoundaryAlert,{style:"page",children:(0,j.jsx)(pn,{split:s,exploreId:o.K.left,urlQuery:e})}),s&&(0,j.jsx)(r.ErrorBoundaryAlert,{style:"page",children:(0,j.jsx)(pn,{split:s,exploreId:o.K.right,urlQuery:t})})]})})}}const xn=fn(vn)},"./public/app/features/explore/state/selectors.ts":(e,t,s)=>{"use strict";s.d(t,{F:()=>o,p:()=>i});var n=s("./public/app/types/index.ts");const i=e=>Boolean(e.explore[n.Kd.left]&&e.explore[n.Kd.right]),o=e=>t=>t.explore[e]},"./.yarn/__virtual__/react-use-virtual-00326e70ba/3/opt/drone/yarncache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/usePrevious.js":(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");function i(e){var t=(0,n.useRef)();return(0,n.useEffect)((function(){t.current=e})),t.current}},"../../opt/drone/yarncache/fast-memoize-npm-2.5.2-f42a7c6940-79fa759719.zip/node_modules/fast-memoize/src/index.js":e=>{function t(e,t,s,n){var i,o=null==(i=n)||"number"==typeof i||"boolean"==typeof i?n:s(n),r=t.get(o);return void 0===r&&(r=e.call(this,n),t.set(o,r)),r}function s(e,t,s){var n=Array.prototype.slice.call(arguments,3),i=s(n),o=t.get(i);return void 0===o&&(o=e.apply(this,n),t.set(i,o)),o}function n(e,t,s,n,i){return s.bind(t,e,n,i)}function i(e,i){return n(e,this,1===e.length?t:s,i.cache.create(),i.serializer)}function o(){return JSON.stringify(arguments)}function r(){this.cache=Object.create(null)}r.prototype.has=function(e){return e in this.cache},r.prototype.get=function(e){return this.cache[e]},r.prototype.set=function(e,t){this.cache[e]=t};var a={create:function(){return new r}};e.exports=function(e,t){var s=t&&t.cache?t.cache:a,n=t&&t.serializer?t.serializer:o;return(t&&t.strategy?t.strategy:i)(e,{cache:s,serializer:n})},e.exports.strategies={variadic:function(e,t){return n(e,this,s,t.cache.create(),t.serializer)},monadic:function(e,s){return n(e,this,t,s.cache.create(),s.serializer)}}},"../../opt/drone/yarncache/immer-npm-9.0.12-e8cd7358fa-bcbec6d76d.zip/node_modules/immer/dist/immer.esm.js":(e,t,s)=>{"use strict";function n(e){for(var t=arguments.length,s=Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(s.length?" "+s.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function i(e){return!!e&&!!e[W]}function o(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var s=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return s===Object||"function"==typeof s&&Function.toString.call(s)===Q}(e)||Array.isArray(e)||!!e[Z]||!!e.constructor[Z]||p(e)||h(e))}function r(e,t,s){void 0===s&&(s=!1),0===a(e)?(s?Object.keys:V)(e).forEach((function(n){s&&"symbol"==typeof n||t(n,e[n],e)})):e.forEach((function(s,n){return t(n,s,e)}))}function a(e){var t=e[W];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:p(e)?2:h(e)?3:0}function l(e,t){return 2===a(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){return 2===a(e)?e.get(t):e[t]}function d(e,t,s){var n=a(e);2===n?e.set(t,s):3===n?(e.delete(t),e.add(s)):e[t]=s}function u(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function p(e){return M&&e instanceof Map}function h(e){return q&&e instanceof Set}function g(e){return e.o||e.t}function m(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=U(e);delete t[W];for(var s=V(t),n=0;n<s.length;n++){var i=s[n],o=t[i];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function f(e,t){return void 0===t&&(t=!1),x(e)||i(e)||!o(e)||(a(e)>1&&(e.set=e.add=e.clear=e.delete=v),Object.freeze(e),t&&r(e,(function(e,t){return f(t,!0)}),!0)),e}function v(){n(2)}function x(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function y(e){var t=G[e];return t||n(18,e),t}function b(){return E}function w(e,t){t&&(y("Patches"),e.u=[],e.s=[],e.v=t)}function S(e){j(e),e.p.forEach(R),e.p=null}function j(e){e===E&&(E=e.l)}function T(e){return E={p:[],l:E,h:e,m:!0,_:0}}function R(e){var t=e[W];0===t.i||1===t.i?t.j():t.O=!0}function C(e,t){t._=t.p.length;var s=t.p[0],i=void 0!==e&&e!==s;return t.h.g||y("ES5").S(t,e,i),i?(s[W].P&&(S(t),n(4)),o(e)&&(e=I(t,e),t.l||z(t,e)),t.u&&y("Patches").M(s[W].t,e,t.u,t.s)):e=I(t,s,[]),S(t),t.u&&t.v(t.u,t.s),e!==H?e:void 0}function I(e,t,s){if(x(t))return t;var n=t[W];if(!n)return r(t,(function(i,o){return k(e,n,t,i,o,s)}),!0),t;if(n.A!==e)return t;if(!n.P)return z(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=4===n.i||5===n.i?n.o=m(n.k):n.o;r(3===n.i?new Set(i):i,(function(t,o){return k(e,n,i,t,o,s)})),z(e,i,!1),s&&e.u&&y("Patches").R(n,s,e.u,e.s)}return n.o}function k(e,t,s,n,r,a){if(i(r)){var c=I(e,r,a&&t&&3!==t.i&&!l(t.D,n)?a.concat(n):void 0);if(d(s,n,c),!i(c))return;e.m=!1}if(o(r)&&!x(r)){if(!e.h.F&&e._<1)return;I(e,r),t&&t.A.l||z(e,r)}}function z(e,t,s){void 0===s&&(s=!1),e.h.F&&e.m&&f(t,s)}function O(e,t){var s=e[W];return(s?g(s):e)[t]}function F(e,t){if(t in e)for(var s=Object.getPrototypeOf(e);s;){var n=Object.getOwnPropertyDescriptor(s,t);if(n)return n;s=Object.getPrototypeOf(s)}}function D(e){e.P||(e.P=!0,e.l&&D(e.l))}function N(e){e.o||(e.o=m(e.t))}function L(e,t,s){var n=p(t)?y("MapSet").N(t,s):h(t)?y("MapSet").T(t,s):e.g?function(e,t){var s=Array.isArray(e),n={i:s?1:0,A:t?t.A:b(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},i=n,o=K;s&&(i=[n],o=Y);var r=Proxy.revocable(i,o),a=r.revoke,l=r.proxy;return n.k=l,n.j=a,l}(t,s):y("ES5").J(t,s);return(s?s.A:b()).p.push(n),n}function P(e){return i(e)||n(22,e),function e(t){if(!o(t))return t;var s,n=t[W],i=a(t);if(n){if(!n.P&&(n.i<4||!y("ES5").K(n)))return n.t;n.I=!0,s=$(t,i),n.I=!1}else s=$(t,i);return r(s,(function(t,i){n&&c(n.t,t)===i||d(s,t,e(i))})),3===i?new Set(s):s}(e)}function $(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return m(e)}s.d(t,{ZP:()=>te});var B,E,A="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),M="undefined"!=typeof Map,q="undefined"!=typeof Set,_="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,H=A?Symbol.for("immer-nothing"):((B={})["immer-nothing"]=!0,B),Z=A?Symbol.for("immer-draftable"):"__$immer_draftable",W=A?Symbol.for("immer-state"):"__$immer_state",Q=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),V="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,U=Object.getOwnPropertyDescriptors||function(e){var t={};return V(e).forEach((function(s){t[s]=Object.getOwnPropertyDescriptor(e,s)})),t},G={},K={get:function(e,t){if(t===W)return e;var s=g(e);if(!l(s,t))return function(e,t,s){var n,i=F(t,s);return i?"value"in i?i.value:null===(n=i.get)||void 0===n?void 0:n.call(e.k):void 0}(e,s,t);var n=s[t];return e.I||!o(n)?n:n===O(e.t,t)?(N(e),e.o[t]=L(e.A.h,n,e)):n},has:function(e,t){return t in g(e)},ownKeys:function(e){return Reflect.ownKeys(g(e))},set:function(e,t,s){var n=F(g(e),t);if(null==n?void 0:n.set)return n.set.call(e.k,s),!0;if(!e.P){var i=O(g(e),t),o=null==i?void 0:i[W];if(o&&o.t===s)return e.o[t]=s,e.D[t]=!1,!0;if(u(s,i)&&(void 0!==s||l(e.t,t)))return!0;N(e),D(e)}return e.o[t]===s&&"number"!=typeof s&&(void 0!==s||t in e.o)||(e.o[t]=s,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==O(e.t,t)||t in e.t?(e.D[t]=!1,N(e),D(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var s=g(e),n=Reflect.getOwnPropertyDescriptor(s,t);return n?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:s[t]}:n},defineProperty:function(){n(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){n(12)}},Y={};r(K,(function(e,t){Y[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),Y.deleteProperty=function(e,t){return Y.set.call(this,e,t,void 0)},Y.set=function(e,t,s){return K.set.call(this,e[0],t,s,e[0])};var J=function(){function e(e){var t=this;this.g=_,this.F=!0,this.produce=function(e,s,i){if("function"==typeof e&&"function"!=typeof s){var r=s;s=e;var a=t;return function(e){var t=this;void 0===e&&(e=r);for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return a.produce(e,(function(e){var n;return(n=s).call.apply(n,[t,e].concat(i))}))}}var l;if("function"!=typeof s&&n(6),void 0!==i&&"function"!=typeof i&&n(7),o(e)){var c=T(t),d=L(t,e,void 0),u=!0;try{l=s(d),u=!1}finally{u?S(c):j(c)}return"undefined"!=typeof Promise&&l instanceof Promise?l.then((function(e){return w(c,i),C(e,c)}),(function(e){throw S(c),e})):(w(c,i),C(l,c))}if(!e||"object"!=typeof e){if(void 0===(l=s(e))&&(l=e),l===H&&(l=void 0),t.F&&f(l,!0),i){var p=[],h=[];y("Patches").M(e,l,p,h),i(p,h)}return l}n(21,e)},this.produceWithPatches=function(e,s){if("function"==typeof e)return function(s){for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return t.produceWithPatches(s,(function(t){return e.apply(void 0,[t].concat(i))}))};var n,i,o=t.produce(e,s,(function(e,t){n=e,i=t}));return"undefined"!=typeof Promise&&o instanceof Promise?o.then((function(e){return[e,n,i]})):[o,n,i]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){o(e)||n(8),i(e)&&(e=P(e));var t=T(this),s=L(this,e,void 0);return s[W].C=!0,j(t),s},t.finishDraft=function(e,t){var s=(e&&e[W]).A;return w(s,t),C(void 0,s)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!_&&n(20),this.g=e},t.applyPatches=function(e,t){var s;for(s=t.length-1;s>=0;s--){var n=t[s];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}s>-1&&(t=t.slice(s+1));var o=y("Patches").$;return i(e)?o(e,t):this.produce(e,(function(e){return o(e,t)}))},e}(),X=new J,ee=X.produce;X.produceWithPatches.bind(X),X.setAutoFreeze.bind(X),X.setUseProxies.bind(X),X.applyPatches.bind(X),X.createDraft.bind(X),X.finishDraft.bind(X);const te=ee}}]);
//# sourceMappingURL=explore.15718e8e3083449662a7.js.map