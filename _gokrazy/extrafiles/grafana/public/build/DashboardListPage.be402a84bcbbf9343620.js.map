{"version":3,"file":"DashboardListPage.be402a84bcbbf9343620.js","mappings":"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","sources":["webpack://grafana/./public/app/features/search/loaders.ts","webpack://grafana/./public/app/features/search/components/DashboardActions.tsx","webpack://grafana/./public/app/features/search/components/ManageDashboardsNew.tsx","webpack://grafana/./public/app/features/search/components/DashboardListPage.tsx"],"sourcesContent":["import { backendSrv } from 'app/core/services/backend_srv';\n\nimport { buildNavModel } from '../folders/state/navModel';\n\nexport const loadFolderPage = (uid: string) => {\n  return backendSrv.getFolderByUid(uid, { withAccessControl: true }).then((folder) => {\n    const navModel = buildNavModel(folder);\n    navModel.children![0].active = true;\n\n    return { folder, folderNav: navModel };\n  });\n};\n","import React, { FC } from 'react';\n\nimport { config } from '@grafana/runtime';\nimport { Menu, Dropdown, Button, Icon } from '@grafana/ui';\nimport { t } from 'app/core/internationalization';\n\nexport interface Props {\n  folderUid?: string;\n  canCreateFolders?: boolean;\n  canCreateDashboards?: boolean;\n}\n\nexport const DashboardActions: FC<Props> = ({ folderUid, canCreateFolders = false, canCreateDashboards = false }) => {\n  const actionUrl = (type: string) => {\n    let url = `dashboard/${type}`;\n    const isTypeNewFolder = type === 'new_folder';\n\n    if (isTypeNewFolder) {\n      url = `dashboards/folder/new/`;\n    }\n\n    if (folderUid) {\n      url += `?folderUid=${folderUid}`;\n    }\n\n    return url;\n  };\n\n  const MenuActions = () => {\n    return (\n      <Menu>\n        {canCreateDashboards && (\n          <Menu.Item url={actionUrl('new')} label={t('search.dashboard-actions.new-dashboard', 'New Dashboard')} />\n        )}\n        {canCreateFolders && (config.featureToggles.nestedFolders || !folderUid) && (\n          <Menu.Item url={actionUrl('new_folder')} label={t('search.dashboard-actions.new-folder', 'New Folder')} />\n        )}\n        {canCreateDashboards && (\n          <Menu.Item url={actionUrl('import')} label={t('search.dashboard-actions.import', 'Import')} />\n        )}\n      </Menu>\n    );\n  };\n\n  return (\n    <div>\n      <Dropdown overlay={MenuActions} placement=\"bottom-start\">\n        <Button variant=\"primary\">\n          {t('search.dashboard-actions.new', 'New')}\n          <Icon name=\"angle-down\" />\n        </Button>\n      </Dropdown>\n    </div>\n  );\n};\n","import { css, cx } from '@emotion/css';\nimport React, { useEffect } from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { Input, useStyles2, Spinner } from '@grafana/ui';\nimport { contextSrv } from 'app/core/services/context_srv';\nimport { FolderDTO, AccessControlAction } from 'app/types';\n\nimport { useKeyNavigationListener } from '../hooks/useSearchKeyboardSelection';\nimport { SearchView } from '../page/components/SearchView';\nimport { getSearchStateManager } from '../state/SearchStateManager';\n\nimport { DashboardActions } from './DashboardActions';\n\nexport interface Props {\n  folder?: FolderDTO;\n}\n\nexport const ManageDashboardsNew = React.memo(({ folder }: Props) => {\n  const styles = useStyles2(getStyles);\n  // since we don't use \"query\" from use search... it is not actually loaded from the URL!\n  const stateManager = getSearchStateManager();\n  const state = stateManager.useState();\n  const { onKeyDown, keyboardEvents } = useKeyNavigationListener();\n\n  // TODO: we need to refactor DashboardActions to use folder.uid instead\n\n  const folderUid = folder?.uid;\n  const canSave = folder?.canSave;\n  const { isEditor } = contextSrv;\n  const hasEditPermissionInFolders = folder ? canSave : contextSrv.hasEditPermissionInFolders;\n  const canCreateFolders = contextSrv.hasAccess(AccessControlAction.FoldersCreate, isEditor);\n  const canCreateDashboardsFallback = hasEditPermissionInFolders || !!canSave;\n  const canCreateDashboards = folderUid\n    ? contextSrv.hasAccessInMetadata(AccessControlAction.DashboardsCreate, folder, canCreateDashboardsFallback)\n    : contextSrv.hasAccess(AccessControlAction.DashboardsCreate, canCreateDashboardsFallback);\n  const viewActions = (folder === undefined && canCreateFolders) || canCreateDashboards;\n\n  useEffect(() => stateManager.initStateFromUrl(folder?.uid), [folder?.uid, stateManager]);\n\n  return (\n    <>\n      <div className={cx(styles.actionBar, 'page-action-bar')}>\n        <div className={cx(styles.inputWrapper, 'gf-form gf-form--grow m-r-2')}>\n          <Input\n            value={state.query ?? ''}\n            onChange={(e) => stateManager.onQueryChange(e.currentTarget.value)}\n            onKeyDown={onKeyDown}\n            // eslint-disable-next-line jsx-a11y/no-autofocus\n            autoFocus\n            spellCheck={false}\n            placeholder={state.includePanels ? 'Search for dashboards and panels' : 'Search for dashboards'}\n            className={styles.searchInput}\n            suffix={false ? <Spinner /> : null}\n          />\n        </div>\n        {viewActions && (\n          <DashboardActions\n            folderUid={folderUid}\n            canCreateFolders={canCreateFolders}\n            canCreateDashboards={canCreateDashboards}\n          />\n        )}\n      </div>\n\n      <SearchView\n        showManage={Boolean(isEditor || hasEditPermissionInFolders || canSave)}\n        folderDTO={folder}\n        hidePseudoFolders={true}\n        keyboardEvents={keyboardEvents}\n      />\n    </>\n  );\n});\n\nManageDashboardsNew.displayName = 'ManageDashboardsNew';\n\nexport default ManageDashboardsNew;\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  actionBar: css`\n    ${theme.breakpoints.down('sm')} {\n      flex-wrap: wrap;\n    }\n  `,\n  inputWrapper: css`\n    ${theme.breakpoints.down('sm')} {\n      margin-right: 0 !important;\n    }\n  `,\n  searchInput: css`\n    margin-bottom: 6px;\n    min-height: ${theme.spacing(4)};\n  `,\n  unsupported: css`\n    padding: 10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 100%;\n    font-size: 18px;\n  `,\n  noResults: css`\n    padding: ${theme.v1.spacing.md};\n    background: ${theme.v1.colors.bg2};\n    font-style: italic;\n    margin-top: ${theme.v1.spacing.md};\n  `,\n});\n","import { css } from '@emotion/css';\nimport React, { memo } from 'react';\nimport { useAsync } from 'react-use';\n\nimport { locationUtil, NavModelItem } from '@grafana/data';\nimport { locationService } from '@grafana/runtime';\nimport { Page } from 'app/core/components/Page/Page';\nimport { FolderDTO } from 'app/types';\n\nimport { GrafanaRouteComponentProps } from '../../../core/navigation/types';\nimport { loadFolderPage } from '../loaders';\n\nimport ManageDashboardsNew from './ManageDashboardsNew';\n\nexport interface DashboardListPageRouteParams {\n  uid?: string;\n  slug?: string;\n}\n\ninterface Props extends GrafanaRouteComponentProps<DashboardListPageRouteParams> {}\n\nexport const DashboardListPage = memo(({ match, location }: Props) => {\n  const { loading, value } = useAsync<() => Promise<{ folder?: FolderDTO; pageNav?: NavModelItem }>>(() => {\n    const uid = match.params.uid;\n    const url = location.pathname;\n    if (!uid || !url.startsWith('/dashboards')) {\n      return Promise.resolve({});\n    }\n\n    return loadFolderPage(uid!).then(({ folder, folderNav }) => {\n      const path = locationUtil.stripBaseFromUrl(folder.url);\n\n      if (path !== location.pathname) {\n        locationService.replace(path);\n      }\n\n      return { folder, pageNav: folderNav };\n    });\n  }, [match.params.uid]);\n\n  return (\n    <Page navId=\"dashboards/browse\" pageNav={value?.pageNav}>\n      <Page.Contents\n        isLoading={loading}\n        className={css`\n          display: flex;\n          flex-direction: column;\n          height: 100%;\n        `}\n      >\n        <ManageDashboardsNew folder={value?.folder} />\n      </Page.Contents>\n    </Page>\n  );\n});\n\nDashboardListPage.displayName = 'DashboardListPage';\n\nexport default DashboardListPage;\n"],"names":["loadFolderPage","uid","folder","navModel","DashboardActions","folderUid","canCreateFolders","canCreateDashboards","actionUrl","type","url","MenuActions","Menu","config","Dropdown","Button","Icon","ManageDashboardsNew","styles","getStyles","stateManager","state","onKeyDown","keyboardEvents","canSave","isEditor","hasEditPermissionInFolders","canCreateDashboardsFallback","viewActions","Input","e","SearchView","theme","DashboardListPage","match","location","loading","value","useAsync","folderNav","path","Page"],"sourceRoot":""}