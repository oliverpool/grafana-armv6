"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2001],{"./public/app/plugins/datasource/mixed/module.ts":(e,r,s)=>{s.r(r),s.d(r,{Datasource:()=>g,MixedDatasource:()=>g});var a=s("./packages/grafana-data/src/index.ts"),t=s("./packages/grafana-runtime/src/index.ts"),o=s("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),n=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/of.js"),d=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/from.js"),c=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/forkJoin.js"),i=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js"),p=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/map.js"),u=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/toArray.js"),l=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),m=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/mergeAll.js"),b=s("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/reduce.js");class g extends a.DataSourceApi{constructor(e){super(e)}query(e){const r=e.targets.filter((e=>{var r;return"-- Mixed --"!==(null===(r=e.datasource)||void 0===r?void 0:r.uid)}));if(!r.length)return(0,n.of)({data:[]});const s=(0,o.groupBy)(r,"datasource.uid"),a=[];for(const r in s){const o=s[r];a.push({datasource:(0,t.getDataSourceSrv)().get(o[0].datasource,e.scopedVars),targets:o})}return a.length?this.batchQueries(a,e):(0,n.of)({data:[]})}batchQueries(e,r){const s=e.filter(this.isQueryable).map(((e,s)=>(0,d.D)(e.datasource).pipe((0,i.z)((c=>{const i=(0,o.cloneDeep)(r);return i.requestId=`mixed-${s}-${i.requestId||""}`,i.targets=e.targets,(0,d.D)(c.query(i)).pipe((0,p.U)((e=>Object.assign({},e,{data:e.data||[],state:a.LoadingState.Loading,key:`mixed-${s}-${e.key||""}`}))),(0,u.q)(),(0,l.K)((e=>((e=(0,t.toDataQueryError)(e)).message=`${c.name}: ${e.message}`,(0,n.of)([{data:[],state:a.LoadingState.Error,error:e,key:`mixed-${s}-${i.requestId||""}`}])))))})))));return(0,c.D)(s).pipe((0,b.u)(((e,r)=>r.reduce(((e,r)=>(e.push.apply(e,r),e)),e)),[]),(0,p.U)(this.finalizeResponses),(0,m.J)())}testDatasource(){return Promise.resolve({})}isQueryable(e){return e&&Array.isArray(e.targets)&&e.targets.length>0}finalizeResponses(e){const{length:r}=e;if(0===r)return e;const s=e.find((e=>e.state===a.LoadingState.Error));return s?e.push(s):e[r-1].state=a.LoadingState.Done,e}}}}]);
//# sourceMappingURL=mixedPlugin.15718e8e3083449662a7.js.map