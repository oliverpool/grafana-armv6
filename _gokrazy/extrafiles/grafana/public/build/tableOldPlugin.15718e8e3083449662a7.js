"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6784],{"./public/app/angular/AngularLocationWrapper.ts":(t,e,a)=>{a.d(e,{O:()=>r});var s=a("./packages/grafana-runtime/src/index.ts"),n=a("./packages/grafana-data/src/index.ts");const i={http:80,https:443,ftp:21};class r{constructor(){this.absUrl=this.wrapInDeprecationWarning(this.absUrl),this.hash=this.wrapInDeprecationWarning(this.hash),this.host=this.wrapInDeprecationWarning(this.host),this.path=this.wrapInDeprecationWarning(this.path),this.port=this.wrapInDeprecationWarning(this.port,"window.location"),this.protocol=this.wrapInDeprecationWarning(this.protocol,"window.location"),this.replace=this.wrapInDeprecationWarning(this.replace),this.search=this.wrapInDeprecationWarning(this.search),this.state=this.wrapInDeprecationWarning(this.state),this.url=this.wrapInDeprecationWarning(this.url)}wrapInDeprecationWarning(t,e){let a=this;return function(){return(0,n.deprecationWarning)("$location",t.name,e||"locationService"),t.apply(a,arguments)}}absUrl(){return`${window.location.origin}${this.url()}`}hash(t){if((0,s.navigationLogger)("AngularLocationWrapper",!1,"Angular compat layer: hash"),t)throw new Error("AngularLocationWrapper method not implemented.");return s.locationService.getLocation().hash.slice(1)}host(){return new URL(window.location.href).hostname}path(t){(0,s.navigationLogger)("AngularLocationWrapper",!1,"Angular compat layer: path");const e=s.locationService.getLocation();if(null!=t){let a=String(t);a=a.startsWith("/")?a:`/${a}`;const n=new URL(`${window.location.origin}${a}`);return s.locationService.push({pathname:n.pathname,search:n.search.length>0?n.search:e.search,hash:n.hash.length>0?n.hash:e.hash}),this}return null===t?(s.locationService.push("/"),this):e.pathname}port(){const t=new URL(window.location.href);return parseInt(t.port,10)||i[t.protocol]||null}protocol(){return new URL(window.location.href).protocol.slice(0,-1)}replace(){throw new Error("AngularLocationWrapper method not implemented.")}search(t,e){if((0,s.navigationLogger)("AngularLocationWrapper",!1,"Angular compat layer: search"),!t)return s.locationService.getSearchObject();if(t&&arguments.length>1)return s.locationService.partial({[t]:e}),this;if(t){let e;e="object"==typeof t?Object.assign({},t):(0,s.locationSearchToObject)(t);for(const t of Object.keys(e))null!==e[t]&&void 0!==e[t]||delete e[t];const a=n.urlUtil.renderUrl(s.locationService.getLocation().pathname,e);s.locationService.push(a)}return this}state(t){throw(0,s.navigationLogger)("AngularLocationWrapper",!1,"Angular compat layer: state"),new Error("AngularLocationWrapper method not implemented.")}url(t){if((0,s.navigationLogger)("AngularLocationWrapper",!1,"Angular compat layer: url"),void 0!==t)return t.startsWith("#")?s.locationService.push(Object.assign({},s.locationService.getLocation(),{hash:t})):t.startsWith("?")?s.locationService.push(Object.assign({},s.locationService.getLocation(),{search:t})):0===t.trim().length?s.locationService.push("/"):s.locationService.push(t),s.locationService;const e=s.locationService.getLocation();return`${e.pathname}${e.search}${e.hash}`}}},"./public/app/angular/panel/metrics_panel_ctrl.ts":(t,e,a)=>{a.d(e,{k:()=>o});var s=a("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),n=a("./public/app/angular/panel/panel_ctrl.ts"),i=a("./public/app/features/dashboard/utils/panel.ts"),r=a("./packages/grafana-data/src/index.ts");function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class o extends n.q{constructor(t,e){super(t,e),l(this,"contextSrv",void 0),l(this,"datasourceSrv",void 0),l(this,"timeSrv",void 0),l(this,"templateSrv",void 0),l(this,"interval",void 0),l(this,"intervalMs",void 0),l(this,"resolution",void 0),l(this,"timeInfo",void 0),l(this,"skipDataOnInit",!1),l(this,"dataList",[]),l(this,"querySubscription",void 0),l(this,"useDataFrames",!1),l(this,"panelData",void 0),l(this,"panelDataObserver",{next:t=>{if(this.panelData=t,t.state===r.LoadingState.Error&&(this.loading=!1,this.processDataError(t.error)),t.state===r.LoadingState.Loading)return this.loading=!0,void this.angularDirtyCheck();if(t.request){const{timeInfo:e}=t.request;e&&(this.timeInfo=e)}if(t.timeRange&&(this.range=t.timeRange),this.useDataFrames)this.handleDataFrames(t.series);else{const e=t.series.map((t=>(0,r.toLegacyResponseData)(t)));this.handleQueryResult({data:e})}this.angularDirtyCheck()}}),this.contextSrv=e.get("contextSrv"),this.datasourceSrv=e.get("datasourceSrv"),this.timeSrv=e.get("timeSrv"),this.templateSrv=e.get("templateSrv"),this.panel.datasource=this.panel.datasource||null,this.events.on(r.PanelEvents.refresh,this.onMetricsPanelRefresh.bind(this)),this.events.on(r.PanelEvents.panelTeardown,this.onPanelTearDown.bind(this)),this.events.on(r.PanelEvents.componentDidMount,this.onMetricsPanelMounted.bind(this))}onMetricsPanelMounted(){const t=this.panel.getQueryRunner();this.querySubscription=t.getData({withTransforms:!0,withFieldConfig:!0}).subscribe(this.panelDataObserver)}onPanelTearDown(){this.querySubscription&&(this.querySubscription.unsubscribe(),this.querySubscription=null)}onMetricsPanelRefresh(){if(!this.otherPanelInFullscreenMode()){if(this.panel.snapshotData){this.updateTimeRange();let t=this.panel.snapshotData;return(0,s.isArray)(t)||(t=t.data),this.panelData={state:r.LoadingState.Done,series:t,timeRange:this.range},this.$timeout((()=>{this.events.emit(r.PanelEvents.dataSnapshotLoad,t)}))}return delete this.error,this.loading=!0,this.datasourceSrv.get(this.panel.datasource,this.panel.scopedVars).then(this.issueQueries.bind(this)).catch((t=>{this.processDataError(t)}))}}processDataError(t){t.cancelled?console.log("Panel request cancelled",t):(this.error=t.message||"Request Error",t.data&&(t.data.message?this.error=t.data.message:t.data.error&&(this.error=t.data.error)),this.angularDirtyCheck())}angularDirtyCheck(){this.$scope.$root.$$phase||this.$scope.$digest()}updateTimeRange(t){this.datasource=t||this.datasource,this.range=this.timeSrv.timeRange();const e=(0,i.W1)(this.panel,this.range);this.timeInfo=e.timeInfo,this.range=e.timeRange}issueQueries(t){this.updateTimeRange(t),this.datasource=t;const e=this.panel;return e.getQueryRunner().run({datasource:e.datasource,queries:e.targets,panelId:e.id,dashboardId:this.dashboard.id,timezone:this.dashboard.getTimezone(),timeInfo:this.timeInfo,timeRange:this.range,maxDataPoints:e.maxDataPoints||this.width,minInterval:e.interval,scopedVars:e.scopedVars,cacheTimeout:e.cacheTimeout,transformations:e.transformations})}handleDataFrames(t){this.loading=!1,this.dashboard&&this.dashboard.snapshot&&(this.panel.snapshotData=t.map((t=>(0,r.toDataFrameDTO)(t))));try{this.events.emit(r.PanelEvents.dataFramesReceived,t)}catch(t){this.processDataError(t)}}handleQueryResult(t){this.loading=!1,this.dashboard.snapshot&&(this.panel.snapshotData=t.data),t&&t.data||(console.log("Data source query result invalid, missing data field:",t),t={data:[]});try{this.events.emit(r.PanelEvents.dataReceived,t.data)}catch(t){this.processDataError(t)}}}},"./public/app/angular/panel/panel_ctrl.ts":(t,e,a)=>{a.d(e,{q:()=>h});var s=a("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),n=a("./public/app/core/config.ts"),i=a("./public/app/core/core.ts"),r=a("./packages/grafana-data/src/index.ts"),l=a("./public/app/angular/AngularLocationWrapper.ts");function o(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class h{constructor(t,e){var a,s;o(this,"panel",void 0),o(this,"error",void 0),o(this,"pluginName",""),o(this,"pluginId",""),o(this,"editorTabs",void 0),o(this,"$scope",void 0),o(this,"$injector",void 0),o(this,"$timeout",void 0),o(this,"editModeInitiated",!1),o(this,"containerHeight",void 0),o(this,"events",void 0),o(this,"loading",!1),o(this,"timing",void 0),o(this,"$location",void 0),o(this,"onPluginTypeChange",(t=>{})),this.panel=null!==(a=this.panel)&&void 0!==a?a:t.$parent.panel,this.dashboard=null!==(s=this.dashboard)&&void 0!==s?s:t.$parent.dashboard,this.$injector=e,this.$scope=t,this.$timeout=e.get("$timeout"),this.editorTabs=[],this.$location=new l.O,this.events=new r.EventBusSrv,this.timing={};const i=n.ZP.panels[this.panel.type];i&&(this.pluginId=i.id,this.pluginName=i.name),t.$on(r.PanelEvents.componentDidMount.name,(()=>this.panelDidMount()))}panelDidMount(){this.events.emit(r.PanelEvents.componentDidMount),this.events.emit(r.PanelEvents.initialized),this.dashboard.panelInitialized(this.panel)}renderingCompleted(){i.rv.renderingCompleted()}refresh(){this.panel.refresh()}publishAppEvent(t,e){this.$scope.$root.appEvent(t,e)}initEditMode(){this.editModeInitiated||(this.editModeInitiated=!0,this.events.emit(r.PanelEvents.editModeInitialized))}addEditorTab(t,e,a,n){const i={title:t,directiveFn:e,icon:n};(0,s.isString)(e)&&(i.directiveFn=()=>({templateUrl:e})),a?this.editorTabs.splice(a,0,i):this.editorTabs.push(i)}getExtendedMenu(){const t=[];return this.events.emit(r.PanelEvents.initPanelActions,t),t}async getAdditionalMenuItems(){return[]}otherPanelInFullscreenMode(){return this.dashboard.otherPanelInFullscreen(this.panel)}render(t){this.events.emit(r.PanelEvents.render,t)}}},"./public/app/angular/panel/query_ctrl.ts":(t,e,a)=>{a.d(e,{G:()=>i});var s=a("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js");function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class i{constructor(t,e){var a,i,r,l,o;n(this,"target",void 0),n(this,"datasource",void 0),n(this,"panelCtrl",void 0),n(this,"panel",void 0),n(this,"hasRawMode",void 0),n(this,"error",void 0),n(this,"isLastQuery",void 0),this.$scope=t,this.$injector=e,this.$scope=t,this.$injector=e,this.panelCtrl=null!==(a=this.panelCtrl)&&void 0!==a?a:t.ctrl.panelCtrl,this.target=null!==(i=this.target)&&void 0!==i?i:t.ctrl.target,this.datasource=null!==(r=this.datasource)&&void 0!==r?r:t.ctrl.datasource,this.panel=null!==(l=null===(o=this.panelCtrl)||void 0===o?void 0:o.panel)&&void 0!==l?l:t.ctrl.panelCtrl.panel,this.isLastQuery=(0,s.indexOf)(this.panel.targets,this.target)===this.panel.targets.length-1}refresh(){this.panelCtrl.refresh()}}},"./public/app/plugins/panel/table-old/module.ts":(t,e,a)=>{a.r(e),a.d(e,{TablePanelCtrl:()=>$,plugin:()=>k});var s=a("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),n=a("../../opt/drone/yarncache/jquery-npm-3.6.0-ca7872bdbb-8fd5fef4aa.zip/node_modules/jquery/dist/jquery-exposed.js"),i=a.n(n),r=a("./public/app/plugins/sdk.ts"),l=a("./public/app/core/config.ts"),o=a("./public/app/core/utils/flatten.ts"),h=a("./public/app/core/time_series2.ts"),c=a("./public/app/core/table_model.ts");const u={},p=t=>Array.isArray(t)?t.reduce(((t,e)=>e.datapoints?t.concat(e):t),[]):t.datapoints?[t]:[],d=t=>Array.isArray(t)?t.reduce(((t,e)=>e.columns?t.concat(e):t),[]):t.columns?[t]:[];function m(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}u.timeseries_to_rows={description:"Time series to rows",getColumns:()=>[],transform:(t,e,a)=>{a.columns=[{text:"Time",type:"date"},{text:"Metric"},{text:"Value"}];const s=p(t);for(let t=0;t<s.length;t++){const e=s[t];for(let t=0;t<e.datapoints.length;t++){const s=e.datapoints[t];a.rows.push([s[1],e.target,s[0]])}}}},u.timeseries_to_columns={description:"Time series to columns",getColumns:()=>[],transform:(t,e,a)=>{a.columns.push({text:"Time",type:"date"});const s={},n=p(t);for(let t=0;t<n.length;t++){const e=n[t];a.columns.push({text:e.target});for(let a=0;a<e.datapoints.length;a++){const n=e.datapoints[a],i=n[1].toString();s[i]||(s[i]={time:n[1]}),s[i][t]=n[0]}}for(const t in s){const e=s[t],i=[e.time];for(let t=0;t<n.length;t++){const a=e[t];i.push(a)}a.rows.push(i)}}},u.timeseries_aggregations={description:"Time series aggregations",getColumns:()=>[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Current",value:"current"},{text:"Count",value:"count"}],transform:(t,e,a)=>{let s,n;for(a.columns.push({text:"Metric"}),s=0;s<e.columns.length;s++)a.columns.push({text:e.columns[s].text});const i=p(t);for(s=0;s<i.length;s++){const t=new h.Z({datapoints:i[s].datapoints,alias:i[s].target});t.getFlotPairs("connected");const r=[t.alias];for(n=0;n<e.columns.length;n++)r.push(t.stats[e.columns[n].value]);a.rows.push(r)}}},u.annotations={description:"Annotations",getColumns:()=>[],transform:(t,e,a)=>{if(a.columns.push({text:"Time",type:"date"}),a.columns.push({text:"Title"}),a.columns.push({text:"Text"}),a.columns.push({text:"Tags"}),t&&t.annotations&&0!==t.annotations.length)for(let e=0;e<t.annotations.length;e++){const s=t.annotations[e];a.rows.push([s.time,s.title,s.text,s.tags])}}},u.table={description:"Table",getColumns:t=>{if(!t||0===t.length)return[];if(1===t.length)return[...t[0].columns];const e=d(t),a={};return e.reduce(((t,e)=>(e.columns.forEach((e=>{const{text:s}=e;void 0===a[s]&&(a[s]=t.length,t.push(e))})),t)),[])},transform:(t,e,a)=>{if(!t||0===t.length)return;const n=d(t),i=(0,s.findIndex)(n,(t=>"columns"in t&&"rows"in t));if(i<0)throw{message:`Result of query #${String.fromCharCode(65+i)} is not in table format, try using another transform.`};(0,c.M)(a,...n)}},u.json={description:"JSON Data",getColumns:t=>{if(!t||0===t.length)return[];const e={};for(let a=0;a<t.length;a++){const s=t[a];if("docs"!==s.type)continue;const n=Math.min(s.datapoints.length,100);for(let t=0;t<n;t++){const a=s.datapoints[t],n=(0,o.default)(a,{});for(const t in n)e[t]=!0}}return(0,s.map)(e,((t,e)=>({text:e,value:e})))},transform:(t,e,a)=>{let n,i,r;for(const s of e.columns){const e={text:s.text};t.length>0&&t[0].filterable&&(e.filterable=!0),a.columns.push(e)}for(0===a.columns.length&&a.columns.push({text:"JSON"}),n=0;n<t.length;n++){const l=t[n];for(i=0;i<l.datapoints.length;i++){const t=l.datapoints[i],n=[];if((0,s.isObject)(t)&&e.columns.length>0){const a=(0,o.default)(t);for(r=0;r<e.columns.length;r++)n.push(a[e.columns[r].value])}else n.push(JSON.stringify(t));a.rows.push(n)}}}};class g{constructor(t,e){m(this,"panel",void 0),m(this,"panelCtrl",void 0),m(this,"transformers",void 0),m(this,"fontSizes",void 0),m(this,"addColumnSegment",void 0),m(this,"getColumnNames",void 0),m(this,"canSetColumns",!1),m(this,"columnsHelpMessage",""),this.uiSegmentSrv=e,this.uiSegmentSrv=e,t.editor=this,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.transformers=u,this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.addColumnSegment=e.newPlusButton(),this.updateTransformHints()}updateTransformHints(){switch(this.canSetColumns=!1,this.columnsHelpMessage="",this.panel.transform){case"timeseries_aggregations":case"json":this.canSetColumns=!0;break;case"table":this.columnsHelpMessage="Columns and their order are determined by the data query"}}getColumnOptions(){if(!this.panelCtrl.dataRaw)return Promise.resolve([]);const t=this.transformers[this.panel.transform].getColumns(this.panelCtrl.dataRaw),e=(0,s.map)(t,(t=>this.uiSegmentSrv.newSegment({value:t.text})));return Promise.resolve(e)}addColumn(){const t=u[this.panel.transform].getColumns(this.panelCtrl.dataRaw),e=(0,s.find)(t,{text:this.addColumnSegment.value});e&&(this.panel.columns.push(e),this.render());const a=this.uiSegmentSrv.newPlusButton();this.addColumnSegment.html=a.html,this.addColumnSegment.value=a.value}transformChanged(){this.panel.columns=[],"annotations"===this.panel.transform?this.panelCtrl.refresh():("timeseries_aggregations"===this.panel.transform&&this.panel.columns.push({text:"Avg",value:"avg"}),this.updateTransformHints(),this.render())}render(){this.panelCtrl.render()}removeColumn(t){this.panel.columns=(0,s.without)(this.panel.columns,t),this.panelCtrl.render()}}function v(t){return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/table-old/editor.html",controller:g}}g.$inject=["$scope","uiSegmentSrv"];var f=a("./packages/grafana-data/src/index.ts");function b(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class y{constructor(t){b(this,"panel",void 0),b(this,"panelCtrl",void 0),b(this,"colorModes",void 0),b(this,"columnStyles",void 0),b(this,"columnTypes",void 0),b(this,"fontSizes",void 0),b(this,"dateFormats",void 0),b(this,"addColumnSegment",void 0),b(this,"unitFormats",void 0),b(this,"getColumnNames",void 0),b(this,"activeStyleIndex",void 0),b(this,"mappingTypes",void 0),b(this,"alignTypes",void 0),t.editor=this,this.activeStyleIndex=0,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.unitFormats=(0,f.getValueFormats)(),this.colorModes=[{text:"Disabled",value:null},{text:"Cell",value:"cell"},{text:"Value",value:"value"},{text:"Row",value:"row"}],this.columnTypes=[{text:"Number",value:"number"},{text:"String",value:"string"},{text:"Date",value:"date"},{text:"Hidden",value:"hidden"}],this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.dateFormats=[{text:"YYYY-MM-DD HH:mm:ss",value:"YYYY-MM-DD HH:mm:ss"},{text:"YYYY-MM-DD HH:mm:ss.SSS",value:"YYYY-MM-DD HH:mm:ss.SSS"},{text:"MM/DD/YY h:mm:ss a",value:"MM/DD/YY h:mm:ss a"},{text:"MMMM D, YYYY LT",value:"MMMM D, YYYY LT"},{text:"YYYY-MM-DD",value:"YYYY-MM-DD"}],this.mappingTypes=[{text:"Value to text",value:1},{text:"Range to text",value:2}],this.alignTypes=y.alignTypesEnum,this.getColumnNames=()=>this.panelCtrl.table?(0,s.map)(this.panelCtrl.table.columns,(t=>t.text)):[],this.onColorChange=this.onColorChange.bind(this)}render(){this.panelCtrl.render()}setUnitFormat(t){return e=>{t.unit=e,this.panelCtrl.render()}}addColumnStyle(){const t=this.panel.styles,e=t.length;let a=e;if(e>0){"/.*/"===t[e-1].pattern&&(a=e-1)}t.splice(a,0,{unit:"short",type:"number",alias:"",decimals:2,colors:["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],colorMode:null,pattern:"",dateFormat:"YYYY-MM-DD HH:mm:ss",thresholds:[],mappingType:1,align:"auto"}),this.activeStyleIndex=a}removeColumnStyle(t){this.panel.styles=(0,s.without)(this.panel.styles,t)}invertColorOrder(t){const e=this.panel.styles[t].colors,a=e[0];e[0]=e[2],e[2]=a,this.panelCtrl.render()}onColorChange(t,e){return a=>{t.colors[e]=a,this.render()}}addValueMap(t){t.valueMaps||(t.valueMaps=[]),t.valueMaps.push({value:"",text:""}),this.panelCtrl.render()}removeValueMap(t,e){t.valueMaps.splice(e,1),this.panelCtrl.render()}addRangeMap(t){t.rangeMaps||(t.rangeMaps=[]),t.rangeMaps.push({from:"",to:"",text:""}),this.panelCtrl.render()}removeRangeMap(t,e){t.rangeMaps.splice(e,1),this.panelCtrl.render()}}function S(){return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/table-old/column_options.html",controller:y}}y.$inject=["$scope"],b(y,"alignTypesEnum",[{text:"auto",value:""},{text:"left",value:"left"},{text:"center",value:"center"},{text:"right",value:"right"}]);var C=a("./packages/grafana-runtime/src/index.ts");function w(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class x{constructor(t,e,a,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,C.getTemplateSrv)(),i=arguments.length>5?arguments[5]:void 0;w(this,"formatters",[]),w(this,"colorState",void 0),this.panel=t,this.table=e,this.timeZone=a,this.sanitize=s,this.templateSrv=n,this.theme=i,this.panel=t,this.table=e,this.timeZone=a,this.sanitize=s,this.templateSrv=n,this.theme=i,this.initColumns()}setTable(t){this.table=t,this.initColumns()}initColumns(){this.formatters=[],this.colorState={};for(let t=0;t<this.table.columns.length;t++){const e=this.table.columns[t];e.title=e.text;for(let t=0;t<this.panel.styles.length;t++){const a=this.panel.styles[t],s=(0,f.stringStartsAsRegEx)(a.pattern)?a.pattern:(0,f.escapeStringForRegex)((0,f.unEscapeStringFromRegex)(a.pattern)),n=(0,f.stringToJsRegex)(s);if(e.text.match(n)){e.style=a,a.alias&&(e.title=f.textUtil.escapeHtml(e.text.replace(n,a.alias)));break}}this.formatters[t]=this.createColumnFormatter(e)}}getColorForValue(t,e){if(!e.thresholds||!e.colors)return null;for(let a=e.thresholds.length;a>0;a--)if(t>=e.thresholds[a-1])return(0,f.getColorForTheme)(e.colors[a],this.theme);return(0,f.getColorForTheme)((0,s.first)(e.colors),this.theme)}defaultCellFormatter(t,e){return null==t||void 0===t?"":((0,s.isArray)(t)&&(t=t.join(", ")),e&&e.sanitize?this.sanitize(t):(0,s.escape)(t))}createColumnFormatter(t){if(!t.style)return this.defaultCellFormatter;if("hidden"===t.style.type)return t=>{};if("date"===t.style.type)return e=>null==e?"-":((0,s.isArray)(e)&&(e=e[0]),(0,s.isString)(e)&&!isNaN(e)&&e.length>12&&(e=parseInt(e,10)),t.style.dateFormat?(0,f.dateTimeFormat)(e,{format:t.style.dateFormat,timeZone:this.timeZone}):(0,f.dateTimeFormatISO)(e,{timeZone:this.timeZone}));if("string"===t.style.type)return e=>{(0,s.isArray)(e)&&(e=e.join(", "));const a=t.style.mappingType||0;if(1===a&&t.style.valueMaps)for(let a=0;a<t.style.valueMaps.length;a++){const n=t.style.valueMaps[a];if(null!==e){if(!(0,s.isString)(e)&&Number(n.value)===Number(e)||n.value===e)return this.setColorState(e,t.style),this.defaultCellFormatter(n.text,t.style)}else if("null"===n.value)return n.text}if(2===a&&t.style.rangeMaps)for(let a=0;a<t.style.rangeMaps.length;a++){const s=t.style.rangeMaps[a];if(null!==e){if(Number(s.from)<=Number(e)&&Number(s.to)>=Number(e))return this.setColorState(e,t.style),this.defaultCellFormatter(s.text,t.style)}else if("null"===s.from&&"null"===s.to)return s.text}return null==e?"-":(this.setColorState(e,t.style),this.defaultCellFormatter(e,t.style))};if("number"===t.style.type){const e=(0,f.getValueFormat)(t.unit||t.style.unit);return a=>null==a?"-":isNaN(a)||(0,s.isArray)(a)?this.defaultCellFormatter(a,t.style):(this.setColorState(a,t.style),(0,f.formattedValueToString)(e(a,t.style.decimals,null)))}return e=>this.defaultCellFormatter(e,t.style)}setColorState(t,e){if(!e.colorMode)return;if(null==t||(0,s.isArray)(t))return;const a=Number(t);isNaN(a)||(this.colorState[e.colorMode]=this.getColorForValue(a,e))}renderRowVariables(t){const e={};let a;const s=this.table.rows[t];for(let t=0;t<s.length;t++)a=`__cell_${t}`,e[a]={value:s[t],text:s[t]?s[t].toString():""};return e}formatColumnValue(t,e){const a=this.formatters[t];return a?a(e):e}renderCell(t,e,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];a=this.formatColumnValue(t,a);const i=this.table.columns[t],r=[];let l="";const o=[];let h="";this.colorState.cell?(r.push("background-color:"+this.colorState.cell),o.push("table-panel-color-cell"),this.colorState.cell=null):this.colorState.value&&(r.push("color:"+this.colorState.value),this.colorState.value=null);let c="";if(n&&(c='<div class="table-panel-width-hack">'+this.table.columns[t].title+"</div>"),void 0===a?(r.push("display:none"),i.hidden=!0):i.hidden=!1,!0===i.hidden)return"";if(i.style&&i.style.preserveFormat&&o.push("table-panel-cell-pre"),i.style&&i.style.align){const t=(0,s.find)(y.alignTypesEnum,["text",i.style.align]);t&&t.value&&r.push(`text-align:${t.value}`)}if(r.length&&(l=' style="'+r.join(";")+'"'),i.style&&i.style.link){const t=this.renderRowVariables(e);t.__cell={value:a,text:a?a.toString():""};const s=this.templateSrv.replace(i.style.linkUrl,t,encodeURIComponent),n=f.textUtil.sanitizeUrl(s),r=f.textUtil.escapeHtml(this.templateSrv.replace(i.style.linkTooltip,t)),h=i.style.linkTargetBlank?"_blank":"";o.push("table-panel-cell-link"),c+=`<a href="${n}" target="${h}" data-link-tooltip data-original-title="${r}" data-placement="right"${l}>`,c+=`${a}`,c+="</a>"}else c+=a;return i.filterable&&(o.push("table-panel-cell-filterable"),c+=`<a class="table-panel-filter-link" data-link-tooltip data-original-title="Filter out value" data-placement="bottom"\n           data-row="${e}" data-column="${t}" data-operator="!=">`,c+='<i class="fa fa-search-minus"></i>',c+="</a>",c+=`<a class="table-panel-filter-link" data-link-tooltip data-original-title="Filter for value" data-placement="bottom"\n           data-row="${e}" data-column="${t}" data-operator="=">`,c+='<i class="fa fa-search-plus"></i>',c+="</a>"),o.length&&(h=' class="'+o.join(" ")+'"'),c="<td"+h+l+">"+c+"</td>",c}render(t){const e=this.panel.pageSize||100,a=t*e,s=Math.min(a+e,this.table.rows.length);let n="";for(let t=a;t<s;t++){const e=this.table.rows[t];let s="",i="";const r=[];let l="";for(let n=0;n<this.table.columns.length;n++)s+=this.renderCell(n,t,e[n],t===a);this.colorState.row&&(i=' style="background-color:'+this.colorState.row+'"',r.push("table-panel-color-row"),this.colorState.row=null),r.length&&(l=' class="'+r.join(" ")+'"'),n+="<tr "+l+i+">"+s+"</tr>"}return n}render_values(){const t=[],e=this.table.columns.filter((t=>!t.hidden));for(let e=0;e<this.table.rows.length;e++){const a=this.table.rows[e],s=[];for(let t=0;t<this.table.columns.length;t++)this.table.columns[t].hidden||s.push(this.formatColumnValue(t,a[t]));t.push(s)}return{columns:e,rows:t}}}var M=a("./public/app/store/store.ts"),D=a("./public/app/features/variables/adhoc/actions.ts");function T(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class $ extends r.MetricsPanelCtrl{constructor(t,e,a,n){super(t,e),T(this,"pageIndex",void 0),T(this,"dataRaw",void 0),T(this,"table",void 0),T(this,"renderer",void 0),T(this,"panelHasRowColorMode",void 0),T(this,"panelHasLinks",void 0),T(this,"panelDefaults",{targets:[{}],transform:"timeseries_to_columns",pageSize:null,showHeader:!0,styles:[{type:"date",pattern:"Time",alias:"Time",dateFormat:"YYYY-MM-DD HH:mm:ss",align:"auto"},{unit:"short",type:"number",alias:"",decimals:2,colors:["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],colorMode:null,pattern:"/.*/",thresholds:[],align:"right"}],columns:[],fontSize:"100%",sort:{col:0,desc:!0}}),this.annotationsSrv=a,this.$sanitize=n,this.annotationsSrv=a,this.$sanitize=n,this.pageIndex=0,void 0===this.panel.styles&&(this.panel.styles=this.panel.columns,this.panel.columns=this.panel.fields,delete this.panel.columns,delete this.panel.fields),(0,s.defaults)(this.panel,this.panelDefaults),this.panelHasRowColorMode=Boolean(this.panel.styles.find((t=>"row"===t.colorMode))),this.panelHasLinks=Boolean(this.panel.styles.find((t=>t.link))),this.events.on(f.PanelEvents.dataReceived,this.onDataReceived.bind(this)),this.events.on(f.PanelEvents.dataSnapshotLoad,this.onDataReceived.bind(this)),this.events.on(f.PanelEvents.editModeInitialized,this.onInitEditMode.bind(this))}onInitEditMode(){this.addEditorTab("Options",v,2),this.addEditorTab("Column Styles",S,3)}migrateToPanel(t){this.onPluginTypeChange(l.ZP.panels[t])}issueQueries(t){return this.pageIndex=0,"annotations"===this.panel.transform?this.annotationsSrv.getAnnotations({dashboard:this.dashboard,panel:this.panel,range:this.range}).then((t=>(this.loading=!1,this.dataRaw=t,this.pageIndex=0,this.render(),{data:this.dataRaw}))):super.issueQueries(t)}onDataReceived(t){this.dataRaw=t,this.pageIndex=0,this.dataRaw&&this.dataRaw.length&&((0,f.isTableData)(this.dataRaw[0])?this.panel.transform="table":"docs"===this.dataRaw[0].type?this.panel.transform="json":"table"!==this.panel.transform&&"json"!==this.panel.transform||(this.panel.transform="timeseries_to_rows")),this.render()}render(){return this.table=function(t,e){const a=new c.Z;if(!t||0===t.length)return a;const s=u[e.transform];if(!s)throw{message:"Transformer "+e.transform+" not found"};return s.transform(t,e,a),a}(this.dataRaw,this.panel),this.table.sort(this.panel.sort),this.renderer=new x(this.panel,this.table,this.dashboard.getTimezone(),this.$sanitize,this.templateSrv,l.ZP.theme),super.render(this.table)}toggleColumnSort(t,e){this.table.columns[this.panel.sort.col]&&(this.table.columns[this.panel.sort.col].sort=!1),this.panel.sort.col===e?this.panel.sort.desc?this.panel.sort.desc=!1:this.panel.sort.col=null:(this.panel.sort.col=e,this.panel.sort.desc=!0),this.render()}link(t,e,a,s){let n;const r=s.panel;let l=0;function o(){let t=s.height;return l>1&&(t-=26),t-31+"px"}function h(){const t=e.parents(".panel-content"),a=e.find(".table-panel-scroll"),h=e.find("tbody"),c=e.find(".table-panel-footer");e.css({"font-size":r.fontSize}),t.addClass("table-panel-content"),function(t){s.renderer.setTable(n),t.empty(),t.html(s.renderer.render(s.pageIndex))}(h),function(t){t.empty();const e=r.pageSize||100;if(l=Math.ceil(n.rows.length/e),1===l)return;const a=Math.max(s.pageIndex-3,0),o=Math.min(l,a+9),h=i()("<ul></ul>");for(let t=a;t<o;t++){const e=t===s.pageIndex?"active":"",a=i()('<li><a class="table-panel-page-link pointer '+e+'">'+(t+1)+"</a></li>");h.append(a)}t.append(h)}(c),a.css({"max-height":o()})}e.tooltip({selector:"[data-link-tooltip]"}),e.on("click",".table-panel-page-link",(function(t){const e=i()(t.currentTarget);s.pageIndex=parseInt(e.text(),10)-1,h()})),e.on("click",".table-panel-filter-link",(function(t){const e=i()(t.currentTarget).data(),a={datasource:r.datasource,key:n.columns[e.column].text,value:n.rows[e.row][e.column],operator:e.operator};(0,M.WI)((0,D.m2)(a))}));const c=t.$on("$destroy",(()=>{e.off("click",".table-panel-page-link"),e.off("click",".table-panel-filter-link"),c()}));s.events.on(f.PanelEvents.render,(t=>{n=t||n,n&&h(),s.renderingCompleted()}))}}$.$inject=["$scope","$injector","annotationsSrv","$sanitize"],T($,"templateUrl","module.html");const k=new f.PanelPlugin(null);k.angularPanelCtrl=$,k.setNoPadding()},"./public/app/plugins/sdk.ts":(t,e,a)=>{a.r(e),a.d(e,{MetricsPanelCtrl:()=>h,PanelCtrl:()=>o,QueryCtrl:()=>c,loadPluginCss:()=>n.loadPluginCss});var s=a("./packages/grafana-data/src/index.ts"),n=a("./packages/grafana-runtime/src/index.ts"),i=a("./public/app/angular/panel/panel_ctrl.ts"),r=a("./public/app/angular/panel/metrics_panel_ctrl.ts"),l=a("./public/app/angular/panel/query_ctrl.ts");const o=(0,s.makeClassES5Compatible)(i.q),h=(0,s.makeClassES5Compatible)(r.k),c=(0,s.makeClassES5Compatible)(l.G)}}]);
//# sourceMappingURL=tableOldPlugin.15718e8e3083449662a7.js.map