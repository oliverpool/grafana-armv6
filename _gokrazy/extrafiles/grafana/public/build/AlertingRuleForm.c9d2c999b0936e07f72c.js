"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5372],{85670:(h,u,e)=>{e.r(u),e.d(u,{default:()=>z});var t=e(68404),o=e(22350),c=e(78758),E=e(81168),g=e(52423),d=e(2323),r=e(29516),i=e(90723);function f({title:a,children:l}){return t.createElement(d.b,{className:(0,r.wW)(P).warning,severity:"warning",title:a},t.createElement("p",null,l),t.createElement(i.Qj,{href:"alerting/list"},"To rule list"))}const P=a=>({warning:g.css`
    margin: ${a.spacing(4)};
  `});var C=e(82897),M=e(57388),I=e(90090),A=e(11376),T=e(72004),U=e(21767),m=e(79662),W=e(93411);function y({sourceRuleId:a}){const l=(0,E.useDispatch)(),{loading:R,value:s,error:n}=(0,o.Z)(()=>l((0,T.on)(a)).unwrap(),[a]);if(R)return t.createElement(I.u,{text:"Loading the rule"});if(s){const v=(0,C.cloneDeep)(s);F(v.rule,x(v));const D=(0,U.DQ)(v);return(0,m.Pc)(s.rule)&&Boolean(s.rule.grafana_alert.provenance)&&(D.group=""),t.createElement(A.p,{prefill:D})}return n?t.createElement(d.b,{title:"Error",severity:"error"},n.message):t.createElement(d.b,{title:"Cannot duplicate. The rule does not exist",buttonContent:"Go back to alert list",onRemove:()=>M.E1.replace((0,W.u)("/alerting/list"))})}function x(a){const l=(0,m.PW)(a.rule),R=a.group.rules.map(m.PW),s=l.replace(/\(copy( [0-9]+)?\)$/,"").trim();let n=`${s} (copy)`;for(let v=2;R.includes(n);v++)n=`${s} (copy ${v})`;return n}function F(a,l){(0,m.Pc)(a)&&(a.grafana_alert.title=l),(0,m.cG)(a)&&(a.alert=l),(0,m.yF)(a)&&(a.record=l)}var N=e(40014),V=e(44391),$=e(79370),G=e(46818),p=e(60048);function j({identifier:a}){(0,N.x)(O=>O.unifiedAlerting.ruleForm.existingRule=G.oq);const{loading:l,result:R,error:s,dispatched:n}=(0,$._)(O=>O.ruleForm.existingRule),v=(0,E.useDispatch)(),{isEditable:D,loading:B}=(0,V.M)(p.s0(a),R?.rule),L=l||B;return(0,t.useEffect)(()=>{n||v((0,T.on)(a))},[n,v,a]),L||D===void 0?t.createElement(I.u,{text:"Loading rule..."}):s?t.createElement(d.b,{severity:"error",title:"Failed to load rule"},s.message):R?D===!1?t.createElement(f,{title:"Cannot edit rule"},"Sorry! You do not have permission to edit this rule."):t.createElement(A.p,{existing:R}):t.createElement(f,{title:"Rule not found"},"Sorry! This rule does not exist.")}var Y=e(45524),H=e(31808),J=e(39910);const K={icon:"bell",id:"alert-rule-view",breadcrumbs:[{title:"Alert rules",url:"alerting/list"}]},Q=a=>{if(a==="edit")return{...K,id:"alert-rule-edit",text:"Edit rule"};if(a==="add")return{...K,id:"alert-rule-add",text:"Add rule"}},Z=({match:a})=>{const l=(0,E.useDispatch)(),[R]=(0,H.j)(),{id:s}=a.params,n=p.OA(s,!0),v=R.get("copyFrom")??void 0,D=p.OA(v),{loading:B=!0}=(0,o.Z)(async()=>{n&&await l((0,T.nw)({rulesSourceName:n.ruleSourceName}))},[l]),{canCreateGrafanaRules:L,canCreateCloudRules:O,canEditRules:S}=(0,J.B)(),X=(0,t.useCallback)(()=>{if(!B)return!n&&!L&&!O?t.createElement(f,{title:"Cannot create rules"},"Sorry! You are not allowed to create rules."):n&&!S(n.ruleSourceName)?t.createElement(f,{title:"Cannot edit rules"},"Sorry! You are not allowed to edit rules."):n?t.createElement(j,{key:s,identifier:n}):D?t.createElement(y,{sourceRuleId:D}):t.createElement(A.p,null)},[O,L,S,D,s,n,B]);return t.createElement(Y.J,{isLoading:B,pageId:"alert-list",pageNav:Q(n?"edit":"add")},X())},z=(0,c.Pf)(Z,{style:"page"})},45524:(h,u,e)=>{e.d(u,{J:()=>c});var t=e(68404),o=e(79396);const c=({children:E,pageId:g,pageNav:d,isLoading:r})=>t.createElement(o.T,{pageNav:d,navId:g},t.createElement(o.T.Contents,{isLoading:r},E))},55485:(h,u,e)=>{e.d(u,{W:()=>d});var t=e(68404),o=e(81168),c=e(72004),E=e(46818),g=e(79370);function d(r){const i=(0,o.useDispatch)(),f=(0,g._)(P=>P.folders);if((0,t.useEffect)(()=>{r&&i((0,c.sw)(r))},[i,r]),r){const P=f[r]||E.oq;return{folder:P.result,loading:P.loading}}return{loading:!1}}},44391:(h,u,e)=>{e.d(u,{M:()=>d});var t=e(82002),o=e(97953),c=e(79662),E=e(55485),g=e(79370);function d(r,i){const f=(0,g._)(m=>m.dataSources),P=i&&(0,c.Pc)(i)?i.grafana_alert.namespace_uid:void 0,C=(0,o.Bz)(r),{folder:M,loading:I}=(0,E.W)(P);if(!i)return{isEditable:!1,isRemovable:!1,loading:!1};if((0,c.Pc)(i)){if(!P)throw new Error(`Rule ${i.grafana_alert.title} does not have a folder uid, cannot determine if it is editable.`);if(!M)return{isEditable:!1,isRemovable:!1,loading:I};const m=M.canSave,W=t.Vt.hasAccessInMetadata(C.update,M,m),y=t.Vt.hasAccessInMetadata(C.delete,M,m);return{isEditable:W,isRemovable:y,loading:I}}const A=Boolean(f[r]?.result?.rulerConfig),T=t.Vt.hasAccess(C.update,t.Vt.isEditor),U=t.Vt.hasAccess(C.delete,t.Vt.isEditor);return{isEditable:T&&A,isRemovable:U&&A,loading:f[r]?.loading}}},31808:(h,u,e)=>{e.d(u,{j:()=>E});var t=e(68404),o=e(70356),c=e(57388);function E(){const{search:g}=(0,o.TH)(),d=(0,t.useMemo)(()=>new URLSearchParams(g),[g]),r=(0,t.useCallback)((i,f)=>{c.E1.partial(i,f)},[]);return[d,r]}},39910:(h,u,e)=>{e.d(u,{B:()=>c});var t=e(68404),o=e(97953);function c(){return(0,t.useMemo)(()=>(0,o.Rv)(),[])}}}]);

//# sourceMappingURL=AlertingRuleForm.c9d2c999b0936e07f72c.js.map