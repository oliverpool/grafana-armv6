"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1324],{61627:(V,S,t)=>{t.d(S,{Kd:()=>T,Zo:()=>O});var a=t(82897),B=t.n(a),R=t(68404),P=t(45849),h=t(79662),p=t(79370);function O(e){const n=(0,p._)(c=>c.promRules),s=(0,p._)(c=>c.rulerRules),o=(0,R.useRef)({}),i=(0,R.useMemo)(()=>{if(e){const c=(0,P.o_)(e);if(!c)throw new Error(`Unknown rules source: ${e}`);return[c]}return(0,P.h_)()},[e]);return(0,R.useMemo)(()=>i.map(c=>{const l=(0,P.jq)(c)?c.name:c,u=n[l]?.result,I=s[l]?.result,A=o.current[l];if(A&&A.promRules===u&&A.rulerRules===I)return A.result;const L={};Object.entries(I||{}).forEach(([C,b])=>{const N={rulesSource:c,name:C,groups:[]};L[C]=N,K(N,b)}),u?.forEach(({name:C,groups:b})=>{const N=L[C]=L[C]||{rulesSource:c,name:C,groups:[]};U(N,b)});const G=Object.values(L);return o.current[l]={promRules:u,rulerRules:I,result:G},G}).flat(),[n,s,i])}function T(e){return e.map(n=>{const s={...n,groups:[]};return s.groups.push({name:"default",rules:D(n.groups.flatMap(o=>o.rules))}),s})}function D(e){return e.sort((n,s)=>n.name.localeCompare(s.name))}function K(e,n=[]){e.groups=n.map(s=>{const o={name:s.name,interval:s.interval,source_tenants:s.source_tenants,rules:[]};return o.rules=s.rules.map(i=>x(i,e,o)),o})}function U(e,n){const s=new Map;e.groups.forEach(o=>s.set(o.name,o)),n.forEach(o=>{let i=s.get(o.name);i||(i={name:o.name,rules:[]},e.groups.push(i),s.set(o.name,i));const c=new Map;i.rules.forEach(l=>{const u=c.get(l.name);u?u.push(l):c.set(l.name,[l])}),(o.rules??[]).forEach(l=>{const u=y(l,c,e.rulesSource);u?u.promRule=l:i.rules.push(j(l,e,i))})})}function j(e,n,s){return{name:e.name,query:e.query,labels:e.labels||{},annotations:(0,h.x_)(e)?e.annotations||{}:{},promRule:e,namespace:n,group:s}}function x(e,n,s){return(0,h.cG)(e)?{name:e.alert,query:e.expr,labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:n,group:s}:(0,h.yF)(e)?{name:e.record,query:e.expr,labels:e.labels||{},annotations:{},rulerRule:e,namespace:n,group:s}:{name:e.grafana_alert.title,query:"",labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:n,group:s}}function y(e,n,s){const o=n.get(e.name);if(!o)return;if((0,P.HY)(s))return o[0];const i=o.find(l=>!l.promRule&&Z(l,e,!0));if(i)return i;const c=o.find(l=>!l.promRule&&Z(l,e,!1));if(c)return c}function Z(e,n,s=!0){return e.name===n.name?(0,a.isEqual)([s?W(e.query):"",e.labels,e.annotations],[s?W(n.query):"",n.labels||{},(0,h.x_)(n)?n.annotations||{}:{}]):!1}function W(e){return e.length>1&&e[0]==="("&&e[e.length-1]===")"&&(e=e.slice(1,-1)),e=e.replace(/\s|\n/g,""),e.split("").sort().join("")}},31808:(V,S,t)=>{t.d(S,{j:()=>P});var a=t(68404),B=t(70356),R=t(57388);function P(){const{search:h}=(0,B.TH)(),p=(0,a.useMemo)(()=>new URLSearchParams(h),[h]),O=(0,a.useCallback)((T,D)=>{R.E1.partial(T,D)},[]);return[p,O]}},30097:(V,S,t)=>{t.r(S),t.d(S,{default:()=>q});var a=t(68404),B=t(22350),R=t(79396),P=t(86245),h=t(81168),p=t(52423),O=t(82897),T=t(70197),D=t(26418),K=t(29516),U=t(79230),j=t(46739),x=t(81697),y=t(66208),Z=t(36012),W=t(89891),e=t(84952),n=t(99822),s=t(61627),o=t(25724),i=t(31808),c=t(72004),l=t(20194),u=t(45849),I=t(10505),A=(r=>(r.Ascending="alpha-asc",r.Descending="alpha-desc",r))(A||{});const L=[{label:"Alphabetically [A-Z]",value:"alpha-asc"},{label:"Alphabetically [Z-A]",value:"alpha-desc"}],G=({folder:r})=>{const g=(0,K.wW)(w),f=(0,h.useDispatch)(),F=d=>{const H=(0,l.Zh)(m),J=(0,l.tC)(d),le=(0,O.uniqWith)([...H,J],O.isEqual),oe=(0,l.oI)(le);z(oe)};(0,a.useEffect)(()=>{f((0,c.y6)({rulesSourceName:u.GC})),f((0,c.UR)({rulesSourceName:u.GC}))},[f]);const E=(0,s.Zo)(u.GC),{nameFilter:M,labelFilter:m,sortOrder:v,setNameFilter:$,setLabelFilter:z,setSortOrder:_}=b(),Q=E.find(d=>d.name===r.title)?.groups.flatMap(d=>d.rules)??[],X=N(Q,M,m,v??"alpha-asc"),ee=Q.length===0||X.length===0,{page:te,numberOfPages:ae,onPageChange:ne,pageItems:se}=(0,o.h)(X,1,e.gN);return a.createElement("div",{className:g.container},a.createElement(D.Stack,{direction:"column",gap:3},a.createElement(U.H,{value:M,onChange:$,placeholder:"Search alert rules by name","data-testid":"name-filter"}),a.createElement(D.Stack,{direction:"row"},a.createElement(j.Ph,{value:v,onChange:({value:d})=>d&&_(d),options:L,width:25,"aria-label":"Sort",placeholder:"Sort (Default A-Z)",prefix:a.createElement(x.J,{name:v==="alpha-asc"?"sort-amount-up":"sort-amount-down"})}),a.createElement(U.H,{value:m,onChange:z,placeholder:"Search alerts by labels",className:g.filterLabelsInput,"data-testid":"label-filter"})),a.createElement(D.Stack,{gap:1},se.map(d=>a.createElement(y.Z,{key:d.name,href:(0,I.V2)("grafana",d,""),className:g.card,"data-testid":"alert-card-row"},a.createElement(y.Z.Heading,null,d.name),a.createElement(y.Z.Tags,null,a.createElement(Z.P,{onClick:F,tags:Object.entries(d.labels).map(([H,J])=>`${H}=${J}`)})),a.createElement(y.Z.Meta,null,a.createElement("div",null,a.createElement(x.J,{name:"folder"})," ",r.title))))),ee&&a.createElement("div",{className:g.noResults},"No alert rules found"),a.createElement("div",{className:g.pagination},a.createElement(W.t,{currentPage:te,numberOfPages:ae,onNavigate:ne,hideWhenSinglePage:!0}))))};var C=(r=>(r.nameFilter="nameFilter",r.labelFilter="labelFilter",r.sortOrder="sort",r))(C||{});function b(){const[r,g]=(0,i.j)(),[f,F]=(0,a.useState)(r.get("nameFilter")??""),[E,M]=(0,a.useState)(r.get("labelFilter")??""),m=r.get("sort"),[v,$]=(0,a.useState)(m==="alpha-asc"?"alpha-asc":m==="alpha-desc"?"alpha-desc":void 0);return(0,T.Z)(()=>g({nameFilter:(0,n.sB)(f),labelFilter:(0,n.sB)(E),sort:(0,n.sB)(v)},!0),400,[f,E,v]),{nameFilter:f,labelFilter:E,sortOrder:v,setNameFilter:F,setLabelFilter:M,setSortOrder:$}}function N(r,g,f,F){const E=(0,l.Zh)(f);let M=r.filter(m=>m.name.toLowerCase().includes(g.toLowerCase())&&(0,l.eD)(m.labels,E));return(0,O.orderBy)(M,m=>m.name.toLowerCase(),[F==="alpha-asc"?"asc":"desc"])}const w=r=>({container:p.css`
    padding: ${r.spacing(1)};
  `,card:p.css`
    grid-template-columns: auto 1fr 2fr;
    margin: 0;
  `,pagination:p.css`
    align-self: center;
  `,filterLabelsInput:p.css`
    flex: 1;
    width: auto;
    min-width: 240px;
  `,noResults:p.css`
    padding: ${r.spacing(2)};
    background-color: ${r.colors.background.secondary};
    font-style: italic;
  `});var Y=t(61986),k=t(60492);const q=({match:r})=>{const g=(0,h.useDispatch)(),f=(0,h.useSelector)(v=>v.navIndex),F=(0,h.useSelector)(v=>v.folder),E=r.params.uid,M=(0,P.ht)(f,`folder-alerting-${E}`,(0,k._)(1)),{loading:m}=(0,B.Z)(async()=>g((0,Y.Pb)(E)),[Y.Pb,E]);return a.createElement(R.T,{navId:"dashboards/browse",pageNav:M.main},a.createElement(R.T.Contents,{isLoading:m},a.createElement(G,{folder:F})))}}}]);

//# sourceMappingURL=FolderAlerting.252dfe31fdf645b5f3b7.js.map