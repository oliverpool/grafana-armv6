"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1324],{"./public/app/features/alerting/unified/hooks/useCombinedRuleNamespaces.ts":(e,a,r)=>{r.d(a,{Kd:()=>o,Zo:()=>u});var n=r("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),t=r("./public/app/features/alerting/unified/utils/datasource.ts"),s=r("./public/app/features/alerting/unified/utils/rules.ts"),l=r("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts");function u(e){const a=(0,l._)((e=>e.promRules)),r=(0,l._)((e=>e.rulerRules)),u=(0,n.useRef)({}),o=(0,n.useMemo)((()=>{if(e){const a=(0,t.o_)(e);if(!a)throw new Error(`Unknown rules source: ${e}`);return[a]}return(0,t.h_)()}),[e]);return(0,n.useMemo)((()=>o.map((e=>{var n,l;const o=(0,t.jq)(e)?e.name:e,c=null===(n=a[o])||void 0===n?void 0:n.result,d=null===(l=r[o])||void 0===l?void 0:l.result,p=u.current[o];if(p&&p.promRules===c&&p.rulerRules===d)return p.result;const m={};Object.entries(d||{}).forEach((a=>{let[r,n]=a;const t={rulesSource:e,name:r,groups:[]};m[r]=t,function(e,a){e.groups=a.map((a=>{const r={name:a.name,interval:a.interval,source_tenants:a.source_tenants,rules:[]};return r.rules=a.rules.map((a=>function(e,a,r){return(0,s.cG)(e)?{name:e.alert,query:e.expr,labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:a,group:r}:(0,s.yF)(e)?{name:e.record,query:e.expr,labels:e.labels||{},annotations:{},rulerRule:e,namespace:a,group:r}:{name:e.grafana_alert.title,query:"",labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:a,group:r}}(a,e,r))),r}))}(t,n)})),null==c||c.forEach((a=>{let{name:r,groups:n}=a;!function(e,a){a.forEach((a=>{var r;let n=e.groups.find((e=>e.name===a.name));n||(n={name:a.name,rules:[]},e.groups.push(n)),(null!==(r=a.rules)&&void 0!==r?r:[]).forEach((a=>{const r=function(e,a,r){var n;if((0,t.HY)(r))return a.rules.find((a=>a.name===e.name));return null!==(n=a.rules.find((a=>!a.promRule&&i(a,e,!0))))&&void 0!==n?n:a.rules.find((a=>!a.promRule&&i(a,e,!1)))}(a,n,e.rulesSource);r?r.promRule=a:n.rules.push(function(e,a,r){return{name:e.name,query:e.query,labels:e.labels||{},annotations:(0,s.x_)(e)&&e.annotations||{},promRule:e,namespace:a,group:r}}(a,e,n))}))}))}(m[r]=m[r]||{rulesSource:e,name:r,groups:[]},n)}));const f=Object.values(m);return u.current[o]={promRules:c,rulerRules:d,result:f},f})).flat()),[a,r,o])}function o(e){return e.map((e=>{const a=Object.assign({},e,{groups:[]});var r;return a.groups.push({name:"default",rules:(r=e.groups.flatMap((e=>e.rules)),r.sort(((e,a)=>e.name.localeCompare(a.name))))}),a}))}function i(e,a){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.name===a.name&&JSON.stringify([r?c(e.query):"",e.labels,e.annotations])===JSON.stringify([r?c(a.query):"",a.labels||{},(0,s.x_)(a)&&a.annotations||{}])}function c(e){return e.length>1&&"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,-1)),(e=e.replace(/\s|\n/g,"")).split("").sort().join("")}},"./public/app/features/alerting/unified/hooks/useURLSearchParams.ts":(e,a,r)=>{r.d(a,{j:()=>l});var n=r("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),t=r("./.yarn/__virtual__/react-router-virtual-31642fe47a/3/opt/drone/yarncache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js"),s=r("./packages/grafana-runtime/src/index.ts");function l(){const{search:e}=(0,t.TH)();return[(0,n.useMemo)((()=>new URLSearchParams(e)),[e]),(0,n.useCallback)(((e,a)=>{s.locationService.partial(e,a)}),[])]}},"./public/app/features/folders/FolderAlerting.tsx":(e,a,r)=>{r.r(a),r.d(a,{default:()=>A});var n=r("./public/app/core/components/Page/Page.tsx"),t=r("./public/app/core/selectors/navModel.ts"),s=r("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),l=r("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/3/opt/drone/yarncache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),u=r("./.yarn/__virtual__/react-use-virtual-00326e70ba/3/opt/drone/yarncache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useAsync.js"),o=r("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),i=r("./.yarn/__virtual__/@grafana-experimental-virtual-920bad95a1/3/opt/drone/yarncache/@grafana-experimental-npm-0.0.2-canary.22-45d2c4f135-b9a64c0abc.zip/node_modules/@grafana/experimental/index.js"),c=r("./packages/grafana-ui/src/index.ts"),d=r("./public/app/core/constants.ts"),p=r("./public/app/core/utils/query.ts"),m=r("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),f=r("./.yarn/__virtual__/react-use-virtual-00326e70ba/3/opt/drone/yarncache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useDebounce.js"),g=r("./public/app/features/alerting/unified/hooks/useCombinedRuleNamespaces.ts");var b,h,v=r("./public/app/features/alerting/unified/hooks/useURLSearchParams.ts"),x=r("./public/app/features/alerting/unified/state/actions.ts"),_=r("./public/app/features/alerting/unified/utils/alertmanager.ts"),j=r("./public/app/features/alerting/unified/utils/datasource.ts"),y=r("./public/app/features/alerting/unified/utils/misc.ts"),S=r("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");!function(e){e.Ascending="alpha-asc",e.Descending="alpha-desc"}(h||(h={}));const C=[{label:"Alphabetically [A-Z]",value:h.Ascending},{label:"Alphabetically [Z-A]",value:h.Descending}],R=e=>{var a,r;let{folder:n}=e;const t=(0,c.useStyles2)(k),u=(0,l.useDispatch)(),o=e=>{const a=(0,_.Zh)(O),r=(0,_.tC)(e),n=(0,m.uniqWith)([...a,r],m.isEqual),t=(0,_.oI)(n);w(t)};(0,s.useEffect)((()=>{u((0,x.y6)({rulesSourceName:j.GC})),u((0,x.UR)({rulesSourceName:j.GC}))}),[u]);const R=(0,g.Zo)(j.GC),{nameFilter:N,labelFilter:O,sortOrder:A,setNameFilter:P,setLabelFilter:w,setSortOrder:q}=function(){var e,a;const[r,n]=(0,v.j)(),[t,l]=(0,s.useState)(null!==(e=r.get(F.nameFilter))&&void 0!==e?e:""),[u,o]=(0,s.useState)(null!==(a=r.get(F.labelFilter))&&void 0!==a?a:""),i=r.get(F.sortOrder),[c,d]=(0,s.useState)(i===h.Ascending?h.Ascending:i===h.Descending?h.Descending:void 0);return(0,f.Z)((()=>n({[F.nameFilter]:(0,p.sB)(t),[F.labelFilter]:(0,p.sB)(u),[F.sortOrder]:(0,p.sB)(c)},!0)),400,[t,u,c]),{nameFilter:t,labelFilter:u,sortOrder:c,setNameFilter:l,setLabelFilter:o,setSortOrder:d}}(),z=R.find((e=>e.name===n.title)),L=null!==(a=null==z||null===(r=z.groups[0])||void 0===r?void 0:r.rules)&&void 0!==a?a:[],Z=function(e,a,r,n){const t=(0,_.Zh)(r);let s=e.filter((e=>e.name.toLowerCase().includes(a.toLowerCase())&&(0,_.eD)(e.labels,t)));return(0,m.orderBy)(s,(e=>e.name),[n===h.Ascending?"asc":"desc"])}(L,N,O,null!=A?A:h.Ascending),I=0===L.length||0===Z.length,{page:D,numberOfPages:M,onPageChange:E,pageItems:$}=function(e,a,r){const[n,t]=(0,s.useState)(a),l=Math.ceil(e.length/r),u=r*(n-1),o=e.slice(u,u+r);return(0,s.useEffect)((()=>t(1)),[l]),{page:n,onPageChange:e=>{t(e)},numberOfPages:l,pageItems:o}}(Z,1,d.gN);return(0,S.jsx)("div",{className:t.container,children:(0,S.jsxs)(i.Stack,{direction:"column",gap:3,children:[(0,S.jsx)(c.FilterInput,{value:N,onChange:P,placeholder:"Search alert rules by name","data-testid":"name-filter"}),(0,S.jsxs)(i.Stack,{direction:"row",children:[(0,S.jsx)(c.Select,{value:A,onChange:e=>{let{value:a}=e;return a&&q(a)},options:C,width:25,"aria-label":"Sort",placeholder:"Sort (Default A-Z)",prefix:(0,S.jsx)(c.Icon,{name:A===h.Ascending?"sort-amount-up":"sort-amount-down"})}),(0,S.jsx)(c.FilterInput,{value:O,onChange:w,placeholder:"Search alerts by labels",className:t.filterLabelsInput,"data-testid":"label-filter"})]}),(0,S.jsx)(i.Stack,{gap:1,children:$.map((e=>(0,S.jsxs)(c.Card,{href:(0,y.V2)("grafana",e,""),className:t.card,"data-testid":"alert-card-row",children:[(0,S.jsx)(c.Card.Heading,{children:e.name}),(0,S.jsx)(c.Card.Tags,{children:(0,S.jsx)(c.TagList,{onClick:o,tags:Object.entries(e.labels).map((e=>{let[a,r]=e;return`${a}=${r}`}))})}),(0,S.jsx)(c.Card.Meta,{children:(0,S.jsxs)("div",{children:[b||(b=(0,S.jsx)(c.Icon,{name:"folder"}))," ",n.title]})})]},e.name)))}),I&&(0,S.jsx)("div",{className:t.noResults,children:"No alert rules found"}),(0,S.jsx)("div",{className:t.pagination,children:(0,S.jsx)(c.Pagination,{currentPage:D,numberOfPages:M,onNavigate:E,hideWhenSinglePage:!0})})]})})};var F;!function(e){e.nameFilter="nameFilter",e.labelFilter="labelFilter",e.sortOrder="sort"}(F||(F={}));const k=e=>({container:o.css`
    padding: ${e.spacing(1)};
  `,card:o.css`
    grid-template-columns: auto 1fr 2fr;
    margin: 0;
  `,pagination:o.css`
    align-self: center;
  `,filterLabelsInput:o.css`
    flex: 1;
    width: auto;
    min-width: 240px;
  `,noResults:o.css`
    padding: ${e.spacing(2)};
    background-color: ${e.colors.background.secondary};
    font-style: italic;
  `});var N=r("./public/app/features/folders/state/actions.ts"),O=r("./public/app/features/folders/state/navModel.ts");const A=e=>{let{match:a}=e;const r=(0,l.useDispatch)(),s=(0,l.useSelector)((e=>e.navIndex)),o=(0,l.useSelector)((e=>e.folder)),i=a.params.uid,c=(0,t.h)(s,`folder-alerting-${i}`,(0,O._)(1)),{loading:d}=(0,u.Z)((async()=>r((0,N.Pb)(i))),[N.Pb,i]);return(0,S.jsx)(n.Z,{navModel:c,children:(0,S.jsx)(n.Z.Contents,{isLoading:d,children:(0,S.jsx)(R,{folder:o})})})}}}]);
//# sourceMappingURL=FolderAlerting.15718e8e3083449662a7.js.map