"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2721],{29209:(y,u,t)=>{t.r(u),t.d(u,{default:()=>N});var e=t(68404),D=t(671),c=t(47214),U=t(2323),M=t(78107),R=t(4403),o=t(74955),E=t(25474),C=t(90723),h=t(90701),p=t(89891),m=t(79396),_=t(77582),f=t(95156),i=t(81168),d=t(68903);const T=30,I=async l=>await(0,c.i)().get(`/api/orgs/${l}`),a=async(l,s)=>_.Vt.hasPermission(i.AccessControlAction.OrgUsersRead)?(0,c.i)().get(`/api/orgs/${l}/users/search`,(0,f.y)({perpage:T,page:s})):{orgUsers:[]},g=(l,s)=>(0,c.i)().patch(`/api/orgs/${s}/users/${l.userId}`,l),P=(l,s)=>(0,c.i)().delete(`/api/orgs/${s}/users/${l.userId}`),N=({match:l})=>{const s=parseInt(l.params.id,10),L=_.Vt.hasPermission(i.AccessControlAction.OrgsWrite),W=_.Vt.hasPermission(i.AccessControlAction.OrgUsersRead),[B,b]=(0,e.useState)([]),[O,x]=(0,e.useState)(1),[S,V]=(0,e.useState)(1),[A,K]=(0,D.Z)(()=>I(s),[]),[,v]=(0,D.Z)(async n=>{const r=await a(s,n),Y=r?.perPage!==0?Math.ceil(r.totalCount/r.perPage):0;return V(Y),b(r.orgUsers),r.orgUsers},[]);(0,e.useEffect)(()=>{K(),v(O)},[K,v,O]);const $=async n=>await(0,c.i)().put(`/api/orgs/${s}`,{...A.value,name:n}),z=()=>e.createElement(U.b,{severity:"info",title:"Access denied"},"You do not have permission to see users in this organization. To update this organization, contact your server administrator."),F=n=>{x(n)},Z=async n=>{await P(n,s),v(O)},j=async(n,r)=>{await g({...r,role:n},s),v(O)},X={text:A?.value?.name??"",icon:"shield",breadcrumbs:[{title:"Orgs",url:"admin/orgs"}],subTitle:"Manage settings and user roles for an organization."};return e.createElement(m.T,{navId:"global-orgs",pageNav:X,subTitle:"Manage settings for this specific org."},e.createElement(m.T.Contents,null,e.createElement(e.Fragment,null,e.createElement(M.D,null,"Edit organization"),A.value&&e.createElement(R.l,{defaultValues:{orgName:A.value.name},onSubmit:n=>$(n.orgName)},({register:n,errors:r})=>e.createElement(e.Fragment,null,e.createElement(o.g,{label:"Name",invalid:!!r.orgName,error:"Name is required",disabled:!L},e.createElement(E.I,{...n("orgName",{required:!0}),id:"org-name-input"})),e.createElement(C.zx,{type:"submit",disabled:!L},"Update"))),e.createElement("div",{style:{marginTop:"20px"}},e.createElement(M.D,null,"Organization users"),!W&&z(),W&&!!B.length&&e.createElement(h.wc,{spacing:"md"},e.createElement(d.P,{users:B,orgId:s,onRoleChange:j,onRemoveUser:Z}),e.createElement(h.Lh,{justify:"flex-end"},e.createElement(p.t,{onNavigate:F,currentPage:O,numberOfPages:S,hideWhenSinglePage:!0})))))))}},68903:(y,u,t)=>{t.d(u,{P:()=>h});var e=t(68404),D=t(90723),c=t(81202),U=t(66226),M=t(11630),R=t(21731),o=t(77582),E=t(81168),C=t(65135);const h=({users:p,orgId:m,onRoleChange:_,onRemoveUser:f})=>{const[i,d]=(0,e.useState)(null),[T,I]=(0,e.useState)([]);return(0,e.useEffect)(()=>{async function a(){try{if(o.Vt.hasPermission(E.AccessControlAction.ActionRolesList)){let g=await(0,M.ul)(m);I(g)}}catch{console.error("Error loading options")}}o.Vt.licensedAccessControlEnabled()&&a()},[m]),e.createElement(e.Fragment,null,e.createElement("table",{className:"filter-table form-inline"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Login"),e.createElement("th",null,"Email"),e.createElement("th",null,"Name"),e.createElement("th",null,"Seen"),e.createElement("th",null,"Role"),e.createElement("th",{style:{width:"34px"}}),e.createElement("th",null),e.createElement("th",null))),e.createElement("tbody",null,p.map((a,g)=>e.createElement("tr",{key:`${a.userId}-${g}`},e.createElement("td",{className:"width-2 text-center"},e.createElement("img",{className:"filter-table__avatar",src:a.avatarUrl,alt:"User avatar"})),e.createElement("td",{className:"max-width-6"},e.createElement("span",{className:"ellipsis",title:a.login},a.login)),e.createElement("td",{className:"max-width-5"},e.createElement("span",{className:"ellipsis",title:a.email},a.email)),e.createElement("td",{className:"max-width-5"},e.createElement("span",{className:"ellipsis",title:a.name},a.name)),e.createElement("td",{className:"width-1"},a.lastSeenAtAge),e.createElement("td",{className:"width-8"},o.Vt.licensedAccessControlEnabled()?e.createElement(U.R,{userId:a.userId,orgId:m,roleOptions:T,basicRole:a.role,onBasicRoleChange:P=>_(P,a),basicRoleDisabled:!o.Vt.hasPermissionInMetadata(E.AccessControlAction.OrgUsersWrite,a)}):e.createElement(C.A,{"aria-label":"Role",value:a.role,disabled:!o.Vt.hasPermissionInMetadata(E.AccessControlAction.OrgUsersWrite,a),onChange:P=>_(P,a)})),e.createElement("td",{className:"width-1 text-center"},a.isDisabled&&e.createElement("span",{className:"label label-tag label-tag--gray"},"Disabled")),e.createElement("td",{className:"width-1"},Array.isArray(a.authLabels)&&a.authLabels.length>0&&e.createElement(R.e,{label:a.authLabels[0],removeIcon:!1,count:0})),o.Vt.hasPermissionInMetadata(E.AccessControlAction.OrgUsersRemove,a)&&e.createElement("td",{className:"text-right"},e.createElement(D.zx,{size:"sm",variant:"destructive",onClick:()=>{d(a)},icon:"times","aria-label":"Delete user"})))))),Boolean(i)&&e.createElement(c.s,{body:`Are you sure you want to delete user ${i?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{d(null)},isOpen:!0,onConfirm:()=>{i&&(f(i),d(null))}}))}}}]);

//# sourceMappingURL=AdminEditOrgPage.f1fcc64fb8c4b57687fd.js.map