"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7497,8039,8580],{68082:(Y,v,n)=>{n.r(v),n.d(v,{UserListAdminPage:()=>J,UserListAdminPageContent:()=>F,addExtraFilters:()=>_,default:()=>I});var e=n(52423),t=n(68404),N=n(36635),P=n(29516),p=n(79230),f=n(318),d=n(90723),i=n(48756),m=n(81697),D=n(89891),M=n(79396),L=n(21731),h=n(77582),y=n(2555),A=n(81168),E=n(37592);const O=[],_=a=>{O.push(a)},r={fetchUsers:E.uh,changeQuery:E.R5,changePage:E.oO,changeFilter:E.M6},C=a=>({users:a.userListAdmin.users,query:a.userListAdmin.query,showPaging:a.userListAdmin.showPaging,totalPages:a.userListAdmin.totalPages,page:a.userListAdmin.page,filters:a.userListAdmin.filters,isLoading:a.userListAdmin.isLoading}),F=(0,N.connect)(C,r)(({fetchUsers:a,query:T,changeQuery:g,users:c,showPaging:S,totalPages:w,page:k,changePage:$,changeFilter:j,filters:G,isLoading:le})=>{const Q=(0,P.wW)(K);(0,t.useEffect)(()=>{a()},[a]);const H=(0,t.useMemo)(()=>c.some(u=>u.licensedRole),[c]);return t.createElement(M.T.Contents,null,t.createElement("div",{className:"page-action-bar"},t.createElement("div",{className:"gf-form gf-form--grow"},t.createElement(p.H,{placeholder:"Search user by login, email, or name.",autoFocus:!0,value:T,onChange:g}),t.createElement(f.S,{options:[{label:"All users",value:!1},{label:"Active last 30 days",value:!0}],onChange:u=>j({name:"activeLast30Days",value:u}),value:G.find(u=>u.name==="activeLast30Days")?.value,className:Q.filter}),O.map((u,q)=>t.createElement(u,{key:q,filters:G,onChange:j,className:Q.filter}))),h.Vt.hasPermission(A.AccessControlAction.UsersCreate)&&t.createElement(d.Qj,{href:"admin/users/create",variant:"primary"},"New user")),le?t.createElement(y.Z,null):t.createElement(t.Fragment,null,t.createElement("div",{className:(0,e.cx)(Q.table,"admin-list-table")},t.createElement("table",{className:"filter-table form-inline filter-table--hover"},t.createElement("thead",null,t.createElement("tr",null,t.createElement("th",null),t.createElement("th",null,"Login"),t.createElement("th",null,"Email"),t.createElement("th",null,"Name"),t.createElement("th",null,"Belongs to"),H&&t.createElement("th",null,"Licensed role"," ",t.createElement(i.u,{placement:"top",content:t.createElement(t.Fragment,null,"Licensed role is based on a user's Org role (i.e. Viewer, Editor, Admin) and their dashboard/folder permissions."," ",t.createElement("a",{className:Q.link,target:"_blank",rel:"noreferrer noopener",href:"https://grafana.com/docs/grafana/next/enterprise/license/license-restrictions/#active-users-limit"},"Learn more"))},t.createElement(m.J,{name:"question-circle"}))),t.createElement("th",null,"Last active\xA0",t.createElement(i.u,{placement:"top",content:"Time since user was seen using Grafana"},t.createElement(m.J,{name:"question-circle"}))),t.createElement("th",{style:{width:"1%"}}))),t.createElement("tbody",null,c.map(u=>t.createElement(z,{user:u,showLicensedRole:H,key:u.id}))))),S&&t.createElement(D.t,{numberOfPages:w,currentPage:k,onNavigate:$})))});function J(){return t.createElement(M.T,{navId:"global-users"},t.createElement(F,null))}const B=a=>`Edit user's ${a} details`,z=(0,t.memo)(({user:a,showLicensedRole:T})=>{const g=(0,P.wW)(K),c=`admin/users/edit/${a.id}`;return t.createElement("tr",{key:a.id},t.createElement("td",{className:"width-4 text-center link-td"},t.createElement("a",{href:c,"aria-label":`Edit user's ${a.name} details`},t.createElement("img",{className:"filter-table__avatar",src:a.avatarUrl,alt:`Avatar for user ${a.name}`}))),t.createElement("td",{className:"link-td max-width-10"},t.createElement("a",{className:"ellipsis",href:c,title:a.login,"aria-label":B(a.name)},a.login)),t.createElement("td",{className:"link-td max-width-10"},t.createElement("a",{className:"ellipsis",href:c,title:a.email,"aria-label":B(a.name)},a.email)),t.createElement("td",{className:"link-td max-width-10"},t.createElement("a",{className:"ellipsis",href:c,title:a.name,"aria-label":B(a.name)},a.name)),t.createElement("td",{className:g.row,title:a.orgs?.length?`The user is a member of the following organizations: ${a.orgs.map(S=>S.name).join(",")}`:void 0},t.createElement(b,{units:a.orgs,icon:"building"}),a.isAdmin&&t.createElement("a",{href:c,"aria-label":B(a.name)},t.createElement(i.u,{placement:"top",content:"Grafana Admin"},t.createElement(m.J,{name:"shield"})))),T&&t.createElement("td",{className:(0,e.cx)("link-td",g.iconRow)},t.createElement("a",{className:"ellipsis",href:c,title:a.name,"aria-label":B(a.name)},a.licensedRole==="None"?t.createElement("span",{className:g.disabled},"Not assigned"," ",t.createElement(i.u,{placement:"top",content:"A licensed role will be assigned when this user signs in"},t.createElement(m.J,{name:"question-circle"}))):a.licensedRole)),t.createElement("td",{className:"link-td"},a.lastSeenAtAge&&t.createElement("a",{href:c,"aria-label":`Last seen at ${a.lastSeenAtAge}. Follow to edit user's ${a.name} details.`},a.lastSeenAtAge==="10 years"?t.createElement("span",{className:g.disabled},"Never"):a.lastSeenAtAge)),t.createElement("td",{className:"text-right"},Array.isArray(a.authLabels)&&a.authLabels.length>0&&t.createElement(L.e,{label:a.authLabels[0],removeIcon:!1,count:0})),t.createElement("td",{className:"text-right"},a.isDisabled&&t.createElement("span",{className:"label label-tag label-tag--gray"},"Disabled")))});z.displayName="UserListItem";const b=({units:a,icon:T})=>{const g=(0,P.wW)(K);return a?.length?a.length>1?t.createElement(i.u,{placement:"top",content:t.createElement("div",{className:g.unitTooltip},a?.map(c=>t.createElement("a",{href:c.url,className:g.link,title:c.name,key:c.name,"aria-label":`Edit ${c.name}`},c.name)))},t.createElement("div",{className:g.unitItem},t.createElement(m.J,{name:T})," ",t.createElement("span",null,a.length))):t.createElement("a",{href:a[0].url,className:g.unitItem,title:a[0].name,key:a[0].name,"aria-label":`Edit ${a[0].name}`},t.createElement(m.J,{name:T})," ",a[0].name):null},K=a=>({table:e.css`
      margin-top: ${a.spacing(3)};
    `,filter:e.css`
      margin: 0 ${a.spacing(1)};
    `,iconRow:e.css`
      svg {
        margin-left: ${a.spacing(.5)};
      }
    `,row:e.css`
      display: flex;
      align-items: center;
      height: 100% !important;

      a {
        padding: ${a.spacing(.5)} 0 !important;
      }
    `,unitTooltip:e.css`
      display: flex;
      flex-direction: column;
    `,unitItem:e.css`
      cursor: pointer;
      padding: ${a.spacing(.5)} 0;
      margin-right: ${a.spacing(1)};
    `,disabled:e.css`
      color: ${a.colors.text.disabled};
    `,link:e.css`
      color: inherit;
      cursor: pointer;
      text-decoration: underline;
    `}),I=J},21038:(Y,v,n)=>{n.r(v),n.d(v,{default:()=>M});var e=n(52423),t=n(68404),N=n(29516),P=n(26625),p=n(17353),f=n(82002),d=n(79396),i=n(81168),m=n(71221),D=n(68082);function M(){const h=f.Vt.hasAccess(i.AccessControlAction.UsersRead,f.Vt.isGrafanaAdmin),y=f.Vt.hasPermission(i.AccessControlAction.OrgUsersRead),A=(0,N.wW)(L),[E,O]=(0,t.useState)(()=>h?"admin":y?"org":null),_=y&&h;return t.createElement(d.T,{navId:"global-users"},_&&t.createElement(P.J,{className:A.tabsMargin},t.createElement(p.O,{label:"All users",active:E==="admin",onChangeTab:()=>O("admin")}),t.createElement(p.O,{label:"Organization users",active:E==="org",onChangeTab:()=>O("org")})),E==="admin"?t.createElement(D.UserListAdminPageContent,null):t.createElement(m.UsersListPageContent,null))}const L=h=>({tabsMargin:(0,e.css)({marginBottom:h.spacing(3)})})},71221:(Y,v,n)=>{n.r(v),n.d(v,{UsersListPageContent:()=>ce,UsersListPageUnconnected:()=>re,default:()=>Ee});var e=n(68404),t=n(36635),N=n(41959),P=n(90701),p=n(89891),f=n(79396),d=n(77582),i=n(38120),m=n(90723),D=n(90336);const M={revokeInvite:D.GY},L=(0,t.connect)(null,M);class h extends e.PureComponent{render(){const{invitee:l,revokeInvite:o}=this.props;return e.createElement("tr",null,e.createElement("td",null,l.email),e.createElement("td",null,l.name),e.createElement("td",{className:"text-right"},e.createElement(i.m,{icon:"copy",variant:"secondary",size:"sm",getText:()=>l.url},"Copy Invite"),"\xA0"),e.createElement("td",null,e.createElement(m.zx,{variant:"destructive",size:"sm",icon:"times",onClick:()=>o(l.code),"aria-label":"Revoke Invite"})))}}const y=L(h);class A extends e.PureComponent{render(){const{invitees:l}=this.props;return e.createElement("table",{className:"filter-table form-inline"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Email"),e.createElement("th",null,"Name"),e.createElement("th",null),e.createElement("th",{style:{width:"34px"}}))),e.createElement("tbody",{"data-testid":"InviteesTable-body"},l.map((o,R)=>e.createElement(y,{key:`${o.id}-${R}`,invitee:o}))))}}var E=n(90158),O=n(75804);const{selectAll:_,selectById:r,selectTotal:C}=O.wl,W=(s,l)=>l,se=(0,E.P1)([_,W],(s,l)=>{const o=new RegExp(l,"i");return s.filter(U=>o.test(U.name)||o.test(U.email))});var F=n(79230),J=n(318),B=n(81168),z=n(82897),b=n(47214),K=n(95156),I=n(46002);function a(){return async(s,l)=>{try{const{perPage:o,page:R,searchQuery:U}=l().users,x=await(0,b.i)().get("/api/org/users/search",(0,K.y)({perpage:o,page:R,query:U}));s((0,I.eT)(x))}catch{(0,I.k7)()}}}const T=(0,z.debounce)(s=>s(a()),300);function g(s){return async l=>{await(0,b.i)().patch(`/api/org/users/${s.userId}`,{role:s.role}),l(a())}}function c(s){return async l=>{await(0,b.i)().delete(`/api/org/users/${s}`),l(a())}}function S(s){return async l=>{l((0,I.tZ)()),l((0,I.PJ)(s)),l(a())}}function w(s){return async l=>{l((0,I.tZ)()),l((0,I.w4)(s)),T(l)}}const k=s=>{const l=new RegExp(s.searchQuery,"i");return s.users.filter(o=>l.test(o.login)||l.test(o.email)||l.test(o.name))},$=s=>s.searchQuery;function j(s){return{searchQuery:$(s.users),pendingInvitesCount:C(s.invites),externalUserMngLinkName:s.users.externalUserMngLinkName,externalUserMngLinkUrl:s.users.externalUserMngLinkUrl,canInvite:s.users.canInvite}}const G={changeSearchQuery:w},H=(0,t.connect)(j,G)(({canInvite:s,externalUserMngLinkName:l,externalUserMngLinkUrl:o,searchQuery:R,pendingInvitesCount:U,changeSearchQuery:x,onShowInvites:Z,showInvites:X})=>{const ee=[{label:"Users",value:"users"},{label:`Pending Invites (${U})`,value:"invites"}],te=d.Vt.hasAccess(B.AccessControlAction.OrgUsersAdd,s);return e.createElement("div",{className:"page-action-bar","data-testid":"users-action-bar"},e.createElement("div",{className:"gf-form gf-form--grow"},e.createElement(F.H,{value:R,onChange:x,placeholder:"Search user by login, email or name"})),U>0&&e.createElement("div",{style:{marginLeft:"1rem"}},e.createElement(J.S,{value:X?"invites":"users",options:ee,onChange:Z})),te&&e.createElement(m.Qj,{href:"org/users/invite"},"Invite"),o&&e.createElement(m.Qj,{href:o,target:"_blank",rel:"noopener"},l))});var u=n(68903);function q(s){const l=$(s.users);return{users:k(s.users),searchQuery:$(s.users),page:s.users.page,totalPages:s.users.totalPages,perPage:s.users.perPage,invitees:se(s.invites,l),externalUserMngInfo:s.users.externalUserMngInfo,isLoading:s.users.isLoading}}const ie={loadUsers:a,fetchInvitees:D.nW,changePage:S,updateUser:g,removeUser:c},me=(0,t.connect)(q,ie),re=({users:s,page:l,totalPages:o,invitees:R,externalUserMngInfo:U,isLoading:x,loadUsers:Z,fetchInvitees:X,changePage:ee,updateUser:te,removeUser:de})=>{const[ae,ge]=(0,e.useState)(!1),oe=U?(0,N.a)(U):"";(0,e.useEffect)(()=>{Z(),X()},[X,Z]);const ue=(V,ne)=>{te({...ne,role:V})},he=()=>{ge(!ae)},ve=()=>ae?e.createElement(A,{invitees:R}):e.createElement(P.wc,{spacing:"md"},e.createElement(u.P,{users:s,orgId:d.Vt.user.orgId,onRoleChange:(V,ne)=>ue(V,ne),onRemoveUser:V=>de(V.userId)}),e.createElement(P.Lh,{justify:"flex-end"},e.createElement(p.t,{onNavigate:ee,currentPage:l,numberOfPages:o,hideWhenSinglePage:!0})));return e.createElement(f.T.Contents,{isLoading:!x},e.createElement(H,{onShowInvites:he,showInvites:ae}),oe&&e.createElement("div",{className:"grafana-info-box",dangerouslySetInnerHTML:{__html:oe}}),x&&ve())},ce=me(re);function Ee(){return e.createElement(f.T,{navId:"users"},e.createElement(ce,null))}},68903:(Y,v,n)=>{n.d(v,{P:()=>D});var e=n(68404),t=n(90723),N=n(81202),P=n(66226),p=n(11630),f=n(21731),d=n(77582),i=n(81168),m=n(65135);const D=({users:M,orgId:L,onRoleChange:h,onRemoveUser:y})=>{const[A,E]=(0,e.useState)(null),[O,_]=(0,e.useState)([]);return(0,e.useEffect)(()=>{async function r(){try{if(d.Vt.hasPermission(i.AccessControlAction.ActionRolesList)){let C=await(0,p.ul)(L);_(C)}}catch{console.error("Error loading options")}}d.Vt.licensedAccessControlEnabled()&&r()},[L]),e.createElement(e.Fragment,null,e.createElement("table",{className:"filter-table form-inline"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Login"),e.createElement("th",null,"Email"),e.createElement("th",null,"Name"),e.createElement("th",null,"Seen"),e.createElement("th",null,"Role"),e.createElement("th",{style:{width:"34px"}}),e.createElement("th",null),e.createElement("th",null))),e.createElement("tbody",null,M.map((r,C)=>e.createElement("tr",{key:`${r.userId}-${C}`},e.createElement("td",{className:"width-2 text-center"},e.createElement("img",{className:"filter-table__avatar",src:r.avatarUrl,alt:"User avatar"})),e.createElement("td",{className:"max-width-6"},e.createElement("span",{className:"ellipsis",title:r.login},r.login)),e.createElement("td",{className:"max-width-5"},e.createElement("span",{className:"ellipsis",title:r.email},r.email)),e.createElement("td",{className:"max-width-5"},e.createElement("span",{className:"ellipsis",title:r.name},r.name)),e.createElement("td",{className:"width-1"},r.lastSeenAtAge),e.createElement("td",{className:"width-8"},d.Vt.licensedAccessControlEnabled()?e.createElement(P.R,{userId:r.userId,orgId:L,roleOptions:O,basicRole:r.role,onBasicRoleChange:W=>h(W,r),basicRoleDisabled:!d.Vt.hasPermissionInMetadata(i.AccessControlAction.OrgUsersWrite,r)}):e.createElement(m.A,{"aria-label":"Role",value:r.role,disabled:!d.Vt.hasPermissionInMetadata(i.AccessControlAction.OrgUsersWrite,r),onChange:W=>h(W,r)})),e.createElement("td",{className:"width-1 text-center"},r.isDisabled&&e.createElement("span",{className:"label label-tag label-tag--gray"},"Disabled")),e.createElement("td",{className:"width-1"},Array.isArray(r.authLabels)&&r.authLabels.length>0&&e.createElement(f.e,{label:r.authLabels[0],removeIcon:!1,count:0})),d.Vt.hasPermissionInMetadata(i.AccessControlAction.OrgUsersRemove,r)&&e.createElement("td",{className:"text-right"},e.createElement(t.zx,{size:"sm",variant:"destructive",onClick:()=>{E(r)},icon:"times","aria-label":"Delete user"})))))),Boolean(A)&&e.createElement(N.s,{body:`Are you sure you want to delete user ${A?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{E(null)},isOpen:!0,onConfirm:()=>{A&&(y(A),E(null))}}))}}}]);

//# sourceMappingURL=UserListPage.041cbb6534a4f99b2960.js.map