{"version":3,"file":"cloudMonitoringPlugin.371cc2e0cbef8fb9b937.js","mappings":"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","sources":["webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/components/CloudMonitoringCheatSheet.tsx","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/components/ConfigEditor/ConfigEditor.tsx","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/components/VariableQueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/components/AnnotationQueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/annotationSupport.ts","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/CloudMonitoringMetricFindQuery.ts","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/variables.ts","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/datasource.ts","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/tracking.ts","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/module.ts"],"sourcesContent":["import { css } from '@emotion/css';\nimport React, { PureComponent } from 'react';\n\nimport { QueryEditorHelpProps } from '@grafana/data';\n\nimport { CloudMonitoringQuery } from '../types';\n\nexport default class CloudMonitoringCheatSheet extends PureComponent<\n  QueryEditorHelpProps<CloudMonitoringQuery>,\n  { userExamples: string[] }\n> {\n  render() {\n    return (\n      <div>\n        <h2>Cloud Monitoring alias patterns</h2>\n        <div>\n          <p>\n            Format the legend keys any way you want by using alias patterns. Format the legend keys any way you want by\n            using alias patterns.\n          </p>\n          Example:\n          <code>{`${'{{metric.name}} - {{metric.label.instance_name}}'}`}</code>\n          <br />\n          Result: &nbsp;&nbsp;<code>cpu/usage_time - server1-europe-west-1</code>\n          <br />\n          <br />\n          <span>Patterns:</span>\n          <br />\n          <ul\n            className={css`\n              list-style: none;\n            `}\n          >\n            <li>\n              <code>{`${'{{metric.type}}'}`}</code> = metric type e.g. compute.googleapis.com/instance/cpu/usage_time\n            </li>\n            <li>\n              <code>{`${'{{metric.name}}'}`}</code> = name part of metric e.g. instance/cpu/usage_time\n            </li>\n            <li>\n              <code>{`${'{{metric.service}}'}`}</code> = service part of metric e.g. compute\n            </li>\n            <li>\n              <code>{`${'{{metric.label.label_name}}'}`}</code> = Metric label metadata e.g. metric.label.instance_name\n            </li>\n            <li>\n              <code>{`${'{{resource.label.label_name}}'}`}</code> = Resource label metadata e.g. resource.label.zone\n            </li>\n            <li>\n              <code>{`${'{{metadata.system_labels.name}}'}`}</code> = Meta data system labels e.g.\n              metadata.system_labels.name. For this to work, the needs to be included in the group by\n            </li>\n            <li>\n              <code>{`${'{{metadata.user_labels.name}}'}`}</code> = Meta data user labels e.g.\n              metadata.user_labels.name. For this to work, the needs to be included in the group by\n            </li>\n            <li>\n              <code>{`${'{{bucket}}'}`}</code> = bucket boundary for distribution metrics when using a heatmap in\n              Grafana\n            </li>\n            <li>\n              <code>{`${'{{project}}'}`}</code> = The project name that was specified in the query editor\n            </li>\n            <li>\n              <code>{`${'{{service}}'}`}</code> = The service id that was specified in the SLO query editor\n            </li>\n            <li>\n              <code>{`${'{{slo}}'}`}</code> = The SLO id that was specified in the SLO query editor\n            </li>\n            <li>\n              <code>{`${'{{selector}}'}`}</code> = The Selector function that was specified in the SLO query editor\n            </li>\n          </ul>\n        </div>\n      </div>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\n\nimport { DataSourcePluginOptionsEditorProps } from '@grafana/data';\nimport { ConnectionConfig } from '@grafana/google-sdk';\n\nimport { CloudMonitoringOptions, CloudMonitoringSecureJsonData } from '../../types';\n\nexport type Props = DataSourcePluginOptionsEditorProps<CloudMonitoringOptions, CloudMonitoringSecureJsonData>;\n\nexport class ConfigEditor extends PureComponent<Props> {\n  render() {\n    return (\n      <>\n        <ConnectionConfig {...this.props}></ConnectionConfig>\n      </>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\n\nimport { QueryEditorProps } from '@grafana/data';\nimport { getTemplateSrv } from '@grafana/runtime';\n\nimport CloudMonitoringDatasource from '../datasource';\nimport { extractServicesFromMetricDescriptors, getLabelKeys, getMetricTypes } from '../functions';\nimport {\n  CloudMonitoringOptions,\n  CloudMonitoringQuery,\n  CloudMonitoringVariableQuery,\n  MetricDescriptor,\n  MetricFindQueryTypes,\n  VariableQueryData,\n} from '../types';\n\nimport { VariableQueryField } from './';\n\nexport type Props = QueryEditorProps<\n  CloudMonitoringDatasource,\n  CloudMonitoringQuery,\n  CloudMonitoringOptions,\n  CloudMonitoringVariableQuery\n>;\n\nexport class CloudMonitoringVariableQueryEditor extends PureComponent<Props, VariableQueryData> {\n  queryTypes: Array<{ value: string; label: string }> = [\n    { value: MetricFindQueryTypes.Projects, label: 'Projects' },\n    { value: MetricFindQueryTypes.Services, label: 'Services' },\n    { value: MetricFindQueryTypes.MetricTypes, label: 'Metric Types' },\n    { value: MetricFindQueryTypes.LabelKeys, label: 'Label Keys' },\n    { value: MetricFindQueryTypes.LabelValues, label: 'Label Values' },\n    { value: MetricFindQueryTypes.ResourceTypes, label: 'Resource Types' },\n    { value: MetricFindQueryTypes.Aggregations, label: 'Aggregations' },\n    { value: MetricFindQueryTypes.Aligners, label: 'Aligners' },\n    { value: MetricFindQueryTypes.AlignmentPeriods, label: 'Alignment Periods' },\n    { value: MetricFindQueryTypes.Selectors, label: 'Selectors' },\n    { value: MetricFindQueryTypes.SLOServices, label: 'SLO Services' },\n    { value: MetricFindQueryTypes.SLO, label: 'Service Level Objectives (SLO)' },\n  ];\n\n  defaults: VariableQueryData = {\n    selectedQueryType: this.queryTypes[0].value,\n    metricDescriptors: [],\n    selectedService: '',\n    selectedMetricType: '',\n    labels: [],\n    labelKey: '',\n    metricTypes: [],\n    services: [],\n    sloServices: [],\n    selectedSLOService: '',\n    projects: [],\n    projectName: '',\n    loading: true,\n  };\n\n  constructor(props: Props) {\n    super(props);\n    this.state = Object.assign(this.defaults, this.props.query);\n  }\n\n  async componentDidMount() {\n    await this.props.datasource.ensureGCEDefaultProject();\n    const projectName = this.props.datasource.getDefaultProject();\n    const projects = (await this.props.datasource.getProjects()) as MetricDescriptor[];\n    const metricDescriptors = await this.props.datasource.getMetricTypes(\n      this.props.query.projectName || this.props.datasource.getDefaultProject()\n    );\n    const services = extractServicesFromMetricDescriptors(metricDescriptors).map((m: any) => ({\n      value: m.service,\n      label: m.serviceShortName,\n    }));\n\n    let selectedService = '';\n    if (services.some((s) => s.value === getTemplateSrv().replace(this.state.selectedService))) {\n      selectedService = this.state.selectedService;\n    } else if (services && services.length > 0) {\n      selectedService = services[0].value;\n    }\n\n    const { metricTypes, selectedMetricType } = getMetricTypes(\n      metricDescriptors,\n      this.state.selectedMetricType,\n      getTemplateSrv().replace(this.state.selectedMetricType),\n      getTemplateSrv().replace(selectedService)\n    );\n\n    const sloServices = await this.props.datasource.getSLOServices(projectName);\n\n    const state: any = {\n      services,\n      selectedService,\n      metricTypes,\n      selectedMetricType,\n      metricDescriptors,\n      projects,\n      ...(await this.getLabels(selectedMetricType, projectName)),\n      sloServices,\n      loading: false,\n      projectName,\n    };\n    this.setState(state, () => this.onPropsChange());\n  }\n\n  onPropsChange = () => {\n    const { metricDescriptors, labels, metricTypes, services, ...queryModel } = this.state;\n    this.props.onChange({ ...queryModel, refId: 'CloudMonitoringVariableQueryEditor-VariableQuery' });\n  };\n\n  async onQueryTypeChange(queryType: string) {\n    const state: any = {\n      selectedQueryType: queryType,\n      ...(await this.getLabels(this.state.selectedMetricType, this.state.projectName, queryType)),\n    };\n\n    this.setState(state);\n  }\n\n  async onProjectChange(projectName: string) {\n    const metricDescriptors = await this.props.datasource.getMetricTypes(projectName);\n    const labels = await this.getLabels(this.state.selectedMetricType, projectName);\n    const { metricTypes, selectedMetricType } = getMetricTypes(\n      metricDescriptors,\n      this.state.selectedMetricType,\n      getTemplateSrv().replace(this.state.selectedMetricType),\n      getTemplateSrv().replace(this.state.selectedService)\n    );\n\n    const sloServices = await this.props.datasource.getSLOServices(projectName);\n\n    this.setState(\n      {\n        ...labels,\n        metricTypes,\n        selectedMetricType,\n        metricDescriptors,\n        projectName,\n        sloServices,\n      },\n      () => this.onPropsChange()\n    );\n  }\n\n  async onServiceChange(service: string) {\n    const { metricTypes, selectedMetricType } = getMetricTypes(\n      this.state.metricDescriptors,\n      this.state.selectedMetricType,\n      getTemplateSrv().replace(this.state.selectedMetricType),\n      getTemplateSrv().replace(service)\n    );\n    const state: any = {\n      selectedService: service,\n      metricTypes,\n      selectedMetricType,\n      ...(await this.getLabels(selectedMetricType, this.state.projectName)),\n    };\n    this.setState(state, () => this.onPropsChange());\n  }\n\n  async onMetricTypeChange(metricType: string) {\n    const state: any = {\n      selectedMetricType: metricType,\n      ...(await this.getLabels(metricType, this.state.projectName)),\n    };\n    this.setState(state, () => this.onPropsChange());\n  }\n\n  onLabelKeyChange(labelKey: string) {\n    this.setState({ labelKey }, () => this.onPropsChange());\n  }\n\n  componentDidUpdate(prevProps: Readonly<Props>, prevState: Readonly<VariableQueryData>) {\n    const selecQueryTypeChanged = prevState.selectedQueryType !== this.state.selectedQueryType;\n    const selectSLOServiceChanged = this.state.selectedSLOService !== prevState.selectedSLOService;\n    if (selecQueryTypeChanged || selectSLOServiceChanged) {\n      this.onPropsChange();\n    }\n  }\n\n  async getLabels(selectedMetricType: string, projectName: string, selectedQueryType = this.state.selectedQueryType) {\n    let result = { labels: this.state.labels, labelKey: this.state.labelKey };\n    if (selectedMetricType && selectedQueryType === MetricFindQueryTypes.LabelValues) {\n      const labels = await getLabelKeys(this.props.datasource, selectedMetricType, projectName);\n      const labelKey = labels.some((l) => l === getTemplateSrv().replace(this.state.labelKey))\n        ? this.state.labelKey\n        : labels[0];\n      result = { labels, labelKey };\n    }\n    return result;\n  }\n\n  renderQueryTypeSwitch(queryType: string) {\n    const variableOptionGroup = {\n      label: 'Template Variables',\n      expanded: false,\n      options: getTemplateSrv()\n        .getVariables()\n        .map((v: any) => ({\n          value: `$${v.name}`,\n          label: `$${v.name}`,\n        })),\n    };\n\n    switch (queryType) {\n      case MetricFindQueryTypes.MetricTypes:\n        return (\n          <>\n            <VariableQueryField\n              allowCustomValue={true}\n              value={this.state.projectName}\n              options={[variableOptionGroup, ...this.state.projects]}\n              onChange={(value) => this.onProjectChange(value)}\n              label=\"Project\"\n            />\n            <VariableQueryField\n              value={this.state.selectedService}\n              options={[variableOptionGroup, ...this.state.services]}\n              onChange={(value) => this.onServiceChange(value)}\n              label=\"Service\"\n            />\n          </>\n        );\n      case MetricFindQueryTypes.LabelKeys:\n      case MetricFindQueryTypes.LabelValues:\n      case MetricFindQueryTypes.ResourceTypes:\n        return (\n          <>\n            <VariableQueryField\n              allowCustomValue={true}\n              value={this.state.projectName}\n              options={[variableOptionGroup, ...this.state.projects]}\n              onChange={(value) => this.onProjectChange(value)}\n              label=\"Project\"\n            />\n            <VariableQueryField\n              value={this.state.selectedService}\n              options={[variableOptionGroup, ...this.state.services]}\n              onChange={(value) => this.onServiceChange(value)}\n              label=\"Service\"\n            />\n            <VariableQueryField\n              value={this.state.selectedMetricType}\n              options={[\n                variableOptionGroup,\n                ...this.state.metricTypes.map(({ value, name }) => ({ value, label: name })),\n              ]}\n              onChange={(value) => this.onMetricTypeChange(value)}\n              label=\"Metric Type\"\n            />\n            {queryType === MetricFindQueryTypes.LabelValues && (\n              <VariableQueryField\n                value={this.state.labelKey}\n                options={[variableOptionGroup, ...this.state.labels.map((l) => ({ value: l, label: l }))]}\n                onChange={(value) => this.onLabelKeyChange(value)}\n                label=\"Label Key\"\n              />\n            )}\n          </>\n        );\n      case MetricFindQueryTypes.Aligners:\n      case MetricFindQueryTypes.Aggregations:\n        return (\n          <>\n            <VariableQueryField\n              value={this.state.selectedService}\n              options={[variableOptionGroup, ...this.state.services]}\n              onChange={(value) => this.onServiceChange(value)}\n              label=\"Service\"\n            />\n            <VariableQueryField\n              value={this.state.selectedMetricType}\n              options={[\n                variableOptionGroup,\n                ...this.state.metricTypes.map(({ value, name }) => ({ value, label: name })),\n              ]}\n              onChange={(value) => this.onMetricTypeChange(value)}\n              label=\"Metric Type\"\n            />\n          </>\n        );\n      case MetricFindQueryTypes.SLOServices:\n        return (\n          <>\n            <VariableQueryField\n              allowCustomValue={true}\n              value={this.state.projectName}\n              options={[variableOptionGroup, ...this.state.projects]}\n              onChange={(value) => this.onProjectChange(value)}\n              label=\"Project\"\n            />\n          </>\n        );\n\n      case MetricFindQueryTypes.SLO:\n        return (\n          <>\n            <VariableQueryField\n              allowCustomValue={true}\n              value={this.state.projectName}\n              options={[variableOptionGroup, ...this.state.projects]}\n              onChange={(value) => this.onProjectChange(value)}\n              label=\"Project\"\n            />\n            <VariableQueryField\n              value={this.state.selectedSLOService}\n              options={[variableOptionGroup, ...this.state.sloServices]}\n              onChange={(value) => {\n                this.setState({\n                  ...this.state,\n                  selectedSLOService: value,\n                });\n              }}\n              label=\"SLO Service\"\n            />\n          </>\n        );\n      default:\n        return '';\n    }\n  }\n\n  render() {\n    if (this.state.loading) {\n      return (\n        <div className=\"gf-form max-width-21\">\n          <span className=\"gf-form-label width-10 query-keyword\">Query Type</span>\n          <div className=\"gf-form-select-wrapper max-width-12\">\n            <select className=\"gf-form-input\">\n              <option>Loading...</option>\n            </select>\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <>\n        <VariableQueryField\n          value={this.state.selectedQueryType}\n          options={this.queryTypes}\n          onChange={(value) => this.onQueryTypeChange(value)}\n          label=\"Query Type\"\n        />\n        {this.renderQueryTypeSwitch(this.state.selectedQueryType)}\n      </>\n    );\n  }\n}\n","import React, { useEffect, useState } from 'react';\nimport { useDebounce } from 'react-use';\n\nimport { QueryEditorProps, toOption } from '@grafana/data';\nimport { EditorField, EditorRows } from '@grafana/experimental';\nimport { Input } from '@grafana/ui';\n\nimport CloudMonitoringDatasource from '../datasource';\nimport { AnnotationQuery, CloudMonitoringOptions, CloudMonitoringQuery, QueryType } from '../types';\n\nimport { MetricQueryEditor, defaultTimeSeriesList } from './MetricQueryEditor';\n\nimport { AnnotationsHelp } from './';\n\nexport type Props = QueryEditorProps<CloudMonitoringDatasource, CloudMonitoringQuery, CloudMonitoringOptions>;\n\nexport const defaultQuery: (datasource: CloudMonitoringDatasource) => AnnotationQuery = (datasource) => ({\n  ...defaultTimeSeriesList(datasource),\n  title: '',\n  text: '',\n});\n\nexport const AnnotationQueryEditor = (props: Props) => {\n  const { datasource, query, onRunQuery, data, onChange } = props;\n  const meta = data?.series.length ? data?.series[0].meta : {};\n  const customMetaData = meta?.custom ?? {};\n  const timeSeriesList = { ...defaultQuery(datasource), ...query.timeSeriesList };\n  const [title, setTitle] = useState(timeSeriesList.title || '');\n  const [text, setText] = useState(timeSeriesList.text || '');\n  const variableOptionGroup = {\n    label: 'Template Variables',\n    options: datasource.getVariables().map(toOption),\n  };\n\n  const handleTitleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setTitle(e.target.value);\n  };\n  const handleTextChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setText(e.target.value);\n  };\n\n  useDebounce(\n    () => {\n      onChange({ ...query, timeSeriesList: { ...timeSeriesList, title } });\n    },\n    1000,\n    [title, onChange]\n  );\n  useDebounce(\n    () => {\n      onChange({ ...query, timeSeriesList: { ...timeSeriesList, text } });\n    },\n    1000,\n    [text, onChange]\n  );\n\n  // Use a known query type\n  useEffect(() => {\n    if (!Object.values(QueryType).includes(query.queryType)) {\n      onChange({ ...query, queryType: QueryType.TIME_SERIES_LIST });\n    }\n  });\n\n  return (\n    <EditorRows>\n      <>\n        <MetricQueryEditor\n          refId={query.refId}\n          variableOptionGroup={variableOptionGroup}\n          customMetaData={customMetaData}\n          onChange={onChange}\n          onRunQuery={onRunQuery}\n          datasource={datasource}\n          query={query}\n        />\n        <EditorField label=\"Title\" htmlFor=\"annotation-query-title\">\n          <Input id=\"annotation-query-title\" value={title} onChange={handleTitleChange} />\n        </EditorField>\n        <EditorField label=\"Text\" htmlFor=\"annotation-query-text\">\n          <Input id=\"annotation-query-text\" value={text} onChange={handleTextChange} />\n        </EditorField>\n      </>\n      <AnnotationsHelp />\n    </EditorRows>\n  );\n};\n","import { AnnotationSupport, AnnotationQuery } from '@grafana/data';\n\nimport { AnnotationQueryEditor } from './components/AnnotationQueryEditor';\nimport CloudMonitoringDatasource from './datasource';\nimport { AlignmentTypes, CloudMonitoringQuery, LegacyCloudMonitoringAnnotationQuery, QueryType } from './types';\n\n// The legacy query format sets the title and text values to empty strings by default.\n// If the title or text is not undefined at the top-level of the annotation target,\n// then it is a legacy query.\nconst isLegacyCloudMonitoringAnnotation = (\n  query: unknown\n): query is AnnotationQuery<LegacyCloudMonitoringAnnotationQuery> =>\n  (query as AnnotationQuery<LegacyCloudMonitoringAnnotationQuery>).target?.title !== undefined ||\n  (query as AnnotationQuery<LegacyCloudMonitoringAnnotationQuery>).target?.text !== undefined;\n\nexport const CloudMonitoringAnnotationSupport: (\n  ds: CloudMonitoringDatasource\n) => AnnotationSupport<CloudMonitoringQuery> = (ds: CloudMonitoringDatasource) => {\n  return {\n    prepareAnnotation: (\n      query: AnnotationQuery<LegacyCloudMonitoringAnnotationQuery> | AnnotationQuery<CloudMonitoringQuery>\n    ): AnnotationQuery<CloudMonitoringQuery> => {\n      if (!isLegacyCloudMonitoringAnnotation(query)) {\n        return query;\n      }\n\n      const { enable, name, iconColor } = query;\n      const { target } = query;\n      const result: AnnotationQuery<CloudMonitoringQuery> = {\n        datasource: query.datasource,\n        enable,\n        name,\n        iconColor,\n        target: {\n          intervalMs: ds.intervalMs,\n          refId: target?.refId || 'annotationQuery',\n          queryType: QueryType.ANNOTATION,\n          timeSeriesList: {\n            projectName: target?.projectName || ds.getDefaultProject(),\n            filters: target?.filters || [],\n            crossSeriesReducer: 'REDUCE_NONE',\n            perSeriesAligner: AlignmentTypes.ALIGN_NONE,\n            title: target?.title || '',\n            text: target?.text || '',\n          },\n        },\n      };\n      return result;\n    },\n    prepareQuery: (anno: AnnotationQuery<CloudMonitoringQuery>) => {\n      if (!anno.target) {\n        return undefined;\n      }\n\n      return {\n        ...anno.target,\n        queryType: QueryType.ANNOTATION,\n        type: 'annotationQuery',\n      };\n    },\n    QueryEditor: AnnotationQueryEditor,\n  };\n};\n","import { isString } from 'lodash';\n\nimport { SelectableValue } from '@grafana/data';\n\nimport { ALIGNMENT_PERIODS, SELECTORS } from './constants';\nimport CloudMonitoringDatasource from './datasource';\nimport {\n  extractServicesFromMetricDescriptors,\n  getAggregationOptionsByMetric,\n  getAlignmentOptionsByMetric,\n  getLabelKeys,\n  getMetricTypesByService,\n} from './functions';\nimport { CloudMonitoringVariableQuery, MetricDescriptor, MetricFindQueryTypes, MetricKind, ValueTypes } from './types';\n\nexport default class CloudMonitoringMetricFindQuery {\n  constructor(private datasource: CloudMonitoringDatasource) {}\n\n  async execute(query: CloudMonitoringVariableQuery) {\n    try {\n      if (!query.projectName) {\n        query.projectName = this.datasource.getDefaultProject();\n      }\n\n      switch (query.selectedQueryType) {\n        case MetricFindQueryTypes.Projects:\n          return this.handleProjectsQuery();\n        case MetricFindQueryTypes.Services:\n          return this.handleServiceQuery(query);\n        case MetricFindQueryTypes.MetricTypes:\n          return this.handleMetricTypesQuery(query);\n        case MetricFindQueryTypes.LabelKeys:\n          return this.handleLabelKeysQuery(query);\n        case MetricFindQueryTypes.LabelValues:\n          return this.handleLabelValuesQuery(query);\n        case MetricFindQueryTypes.ResourceTypes:\n          return this.handleResourceTypeQuery(query);\n        case MetricFindQueryTypes.Aligners:\n          return this.handleAlignersQuery(query);\n        case MetricFindQueryTypes.AlignmentPeriods:\n          return this.handleAlignmentPeriodQuery();\n        case MetricFindQueryTypes.Aggregations:\n          return this.handleAggregationQuery(query);\n        case MetricFindQueryTypes.SLOServices:\n          return this.handleSLOServicesQuery(query);\n        case MetricFindQueryTypes.SLO:\n          return this.handleSLOQuery(query);\n        case MetricFindQueryTypes.Selectors:\n          return this.handleSelectorQuery();\n        default:\n          return [];\n      }\n    } catch (error) {\n      console.error(`Could not run CloudMonitoringMetricFindQuery ${query}`, error);\n      return [];\n    }\n  }\n\n  async handleProjectsQuery() {\n    const projects = await this.datasource.getProjects();\n    return (projects as SelectableValue<string>).map((s: { label: string; value: string }) => ({\n      text: s.label,\n      value: s.value,\n      expandable: true,\n    }));\n  }\n\n  async handleServiceQuery({ projectName }: CloudMonitoringVariableQuery) {\n    const metricDescriptors = await this.datasource.getMetricTypes(projectName);\n    const services: MetricDescriptor[] = extractServicesFromMetricDescriptors(metricDescriptors);\n    return services.map((s) => ({\n      text: s.serviceShortName,\n      value: s.service,\n      expandable: true,\n    }));\n  }\n\n  async handleMetricTypesQuery({ selectedService, projectName }: CloudMonitoringVariableQuery) {\n    if (!selectedService) {\n      return [];\n    }\n    const metricDescriptors = await this.datasource.getMetricTypes(projectName);\n    return getMetricTypesByService(metricDescriptors, this.datasource.templateSrv.replace(selectedService)).map(\n      (s) => ({\n        text: s.displayName,\n        value: s.type,\n        expandable: true,\n      })\n    );\n  }\n\n  async handleLabelKeysQuery({ selectedMetricType, projectName }: CloudMonitoringVariableQuery) {\n    if (!selectedMetricType) {\n      return [];\n    }\n    const labelKeys = await getLabelKeys(this.datasource, selectedMetricType, projectName);\n    return labelKeys.map(this.toFindQueryResult);\n  }\n\n  async handleLabelValuesQuery({ selectedMetricType, labelKey, projectName }: CloudMonitoringVariableQuery) {\n    if (!selectedMetricType) {\n      return [];\n    }\n    const refId = 'handleLabelValuesQuery';\n    // REDUCE_MEAN is needed so the groupBy is not ignored\n    const labels = await this.datasource.getLabels(selectedMetricType, refId, projectName, {\n      groupBys: [labelKey],\n      crossSeriesReducer: 'REDUCE_MEAN',\n    });\n    const interpolatedKey = this.datasource.templateSrv.replace(labelKey);\n    const values = labels.hasOwnProperty(interpolatedKey) ? labels[interpolatedKey] : [];\n    return values.map(this.toFindQueryResult);\n  }\n\n  async handleResourceTypeQuery({ selectedMetricType, projectName }: CloudMonitoringVariableQuery) {\n    if (!selectedMetricType) {\n      return [];\n    }\n    const refId = 'handleResourceTypeQueryQueryType';\n    const labels = await this.datasource.getLabels(selectedMetricType, refId, projectName);\n    return labels['resource.type']?.map(this.toFindQueryResult) ?? [];\n  }\n\n  async handleAlignersQuery({ selectedMetricType, projectName }: CloudMonitoringVariableQuery) {\n    if (!selectedMetricType) {\n      return [];\n    }\n    const metricDescriptors = await this.datasource.getMetricTypes(projectName);\n    const descriptor = metricDescriptors.find(\n      (m) => m.type === this.datasource.templateSrv.replace(selectedMetricType)\n    );\n\n    if (!descriptor) {\n      return [];\n    }\n\n    return getAlignmentOptionsByMetric(descriptor.valueType, descriptor.metricKind).map(this.toFindQueryResult);\n  }\n\n  async handleAggregationQuery({ selectedMetricType, projectName }: CloudMonitoringVariableQuery) {\n    if (!selectedMetricType) {\n      return [];\n    }\n\n    const metricDescriptors = await this.datasource.getMetricTypes(projectName);\n    const descriptor = metricDescriptors.find(\n      (m) => m.type === this.datasource.templateSrv.replace(selectedMetricType)\n    );\n\n    if (!descriptor) {\n      return [];\n    }\n\n    return getAggregationOptionsByMetric(descriptor.valueType as ValueTypes, descriptor.metricKind as MetricKind).map(\n      this.toFindQueryResult\n    );\n  }\n\n  async handleSLOServicesQuery({ projectName }: CloudMonitoringVariableQuery) {\n    const services = await this.datasource.getSLOServices(projectName);\n    return services.map(this.toFindQueryResult);\n  }\n\n  async handleSLOQuery({ selectedSLOService, projectName }: CloudMonitoringVariableQuery) {\n    const slos = await this.datasource.getServiceLevelObjectives(projectName, selectedSLOService);\n    return slos.map(this.toFindQueryResult);\n  }\n\n  async handleSelectorQuery() {\n    return SELECTORS.map(this.toFindQueryResult);\n  }\n\n  handleAlignmentPeriodQuery() {\n    return ALIGNMENT_PERIODS.map(this.toFindQueryResult);\n  }\n\n  toFindQueryResult(x: any) {\n    return isString(x) ? { text: x, expandable: true } : { ...x, expandable: true };\n  }\n}\n","import { from, Observable } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\n\nimport { CustomVariableSupport, DataQueryRequest, DataQueryResponse } from '@grafana/data';\n\nimport CloudMonitoringMetricFindQuery from './CloudMonitoringMetricFindQuery';\nimport { CloudMonitoringVariableQueryEditor } from './components/VariableQueryEditor';\nimport CloudMonitoringDatasource from './datasource';\nimport { CloudMonitoringVariableQuery } from './types';\n\nexport class CloudMonitoringVariableSupport extends CustomVariableSupport<\n  CloudMonitoringDatasource,\n  CloudMonitoringVariableQuery\n> {\n  private readonly metricFindQuery: CloudMonitoringMetricFindQuery;\n\n  constructor(private readonly datasource: CloudMonitoringDatasource) {\n    super();\n    this.metricFindQuery = new CloudMonitoringMetricFindQuery(datasource);\n    this.query = this.query.bind(this);\n  }\n\n  editor = CloudMonitoringVariableQueryEditor;\n\n  query(request: DataQueryRequest<CloudMonitoringVariableQuery>): Observable<DataQueryResponse> {\n    const executeObservable = from(this.metricFindQuery.execute(request.targets[0]));\n    return from(this.datasource.ensureGCEDefaultProject()).pipe(\n      mergeMap(() => executeObservable),\n      map((data) => ({ data }))\n    );\n  }\n}\n","import { chunk, flatten, isString, isArray, has, get, omit } from 'lodash';\nimport { from, lastValueFrom, Observable, of } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\n\nimport {\n  DataQueryRequest,\n  DataQueryResponse,\n  DataSourceInstanceSettings,\n  ScopedVars,\n  SelectableValue,\n  TimeRange,\n} from '@grafana/data';\nimport { DataSourceWithBackend, getBackendSrv, toDataQueryResponse, BackendSrv } from '@grafana/runtime';\nimport { getTimeSrv, TimeSrv } from 'app/features/dashboard/services/TimeSrv';\nimport { getTemplateSrv, TemplateSrv } from 'app/features/templating/template_srv';\n\nimport { CloudMonitoringAnnotationSupport } from './annotationSupport';\nimport { SLO_BURN_RATE_SELECTOR_NAME } from './constants';\nimport { getMetricType, setMetricType } from './functions';\nimport {\n  CloudMonitoringOptions,\n  CloudMonitoringQuery,\n  Filter,\n  MetricDescriptor,\n  QueryType,\n  PostResponse,\n  Aggregation,\n  MetricQuery,\n} from './types';\nimport { CloudMonitoringVariableSupport } from './variables';\n\nexport default class CloudMonitoringDatasource extends DataSourceWithBackend<\n  CloudMonitoringQuery,\n  CloudMonitoringOptions\n> {\n  authenticationType: string;\n  intervalMs: number;\n  backendSrv: BackendSrv;\n\n  constructor(\n    private instanceSettings: DataSourceInstanceSettings<CloudMonitoringOptions>,\n    public templateSrv: TemplateSrv = getTemplateSrv(),\n    readonly timeSrv: TimeSrv = getTimeSrv()\n  ) {\n    super(instanceSettings);\n    this.authenticationType = instanceSettings.jsonData.authenticationType || 'jwt';\n    this.variables = new CloudMonitoringVariableSupport(this);\n    this.intervalMs = 0;\n    this.annotations = CloudMonitoringAnnotationSupport(this);\n    this.backendSrv = getBackendSrv();\n  }\n\n  getVariables() {\n    return this.templateSrv.getVariables().map((v) => `$${v.name}`);\n  }\n\n  query(request: DataQueryRequest<CloudMonitoringQuery>): Observable<DataQueryResponse> {\n    request.targets = request.targets.map((t) => ({\n      ...this.migrateQuery(t),\n      intervalMs: request.intervalMs,\n    }));\n    return super.query(request);\n  }\n\n  applyTemplateVariables(target: CloudMonitoringQuery, scopedVars: ScopedVars): Record<string, any> {\n    const { timeSeriesList, timeSeriesQuery, sloQuery } = target;\n\n    return {\n      ...target,\n      datasource: this.getRef(),\n      intervalMs: this.intervalMs,\n      timeSeriesList: timeSeriesList && {\n        ...this.interpolateProps(timeSeriesList, scopedVars),\n        projectName: this.templateSrv.replace(\n          timeSeriesList.projectName ? timeSeriesList.projectName : this.getDefaultProject(),\n          scopedVars\n        ),\n        filters: this.interpolateFilters(timeSeriesList.filters || [], scopedVars),\n        groupBys: this.interpolateGroupBys(timeSeriesList.groupBys || [], scopedVars),\n        view: timeSeriesList.view || 'FULL',\n      },\n      timeSeriesQuery: timeSeriesQuery && {\n        ...this.interpolateProps(timeSeriesQuery, scopedVars),\n        projectName: this.templateSrv.replace(\n          timeSeriesQuery.projectName ? timeSeriesQuery.projectName : this.getDefaultProject(),\n          scopedVars\n        ),\n      },\n      sloQuery: sloQuery && this.interpolateProps(sloQuery, scopedVars),\n    };\n  }\n\n  async getLabels(\n    metricType: string,\n    refId: string,\n    projectName: string,\n    aggregation?: Aggregation,\n    timeRange?: TimeRange\n  ) {\n    const options = {\n      targets: [\n        {\n          refId,\n          datasource: this.getRef(),\n          queryType: QueryType.TIME_SERIES_LIST,\n          timeSeriesList: setMetricType(\n            {\n              projectName: this.templateSrv.replace(projectName),\n              groupBys: this.interpolateGroupBys(aggregation?.groupBys || [], {}),\n              crossSeriesReducer: aggregation?.crossSeriesReducer ?? 'REDUCE_NONE',\n              view: 'HEADERS',\n            },\n            metricType\n          ),\n        },\n      ],\n      range: timeRange ?? this.timeSrv.timeRange(),\n    };\n\n    const queries = options.targets;\n\n    if (!queries.length) {\n      return lastValueFrom(of({ results: [] }));\n    }\n\n    return lastValueFrom(\n      from(this.ensureGCEDefaultProject()).pipe(\n        mergeMap(() => {\n          return this.backendSrv.fetch<PostResponse>({\n            url: '/api/ds/query',\n            method: 'POST',\n            headers: this.getRequestHeaders(),\n            data: {\n              from: options.range.from.valueOf().toString(),\n              to: options.range.to.valueOf().toString(),\n              queries,\n            },\n          });\n        }),\n        map(({ data }) => {\n          const dataQueryResponse = toDataQueryResponse({\n            data: data,\n          });\n          const labels = dataQueryResponse?.data\n            .map((f) => f.meta?.custom?.labels)\n            .filter((p) => !!p)\n            .reduce((acc, labels) => {\n              for (let key in labels) {\n                if (!acc[key]) {\n                  acc[key] = new Set<string>();\n                }\n                if (labels[key]) {\n                  acc[key].add(labels[key]);\n                }\n              }\n              return acc;\n            }, {});\n          return Object.fromEntries(\n            Object.entries(labels).map((l: any) => {\n              l[1] = Array.from(l[1]);\n              return l;\n            })\n          );\n        })\n      )\n    );\n  }\n\n  async getGCEDefaultProject() {\n    return this.getResource(`gceDefaultProject`);\n  }\n\n  getDefaultProject(): string {\n    const { defaultProject, authenticationType, gceDefaultProject } = this.instanceSettings.jsonData;\n    if (authenticationType === 'gce') {\n      return gceDefaultProject || '';\n    }\n\n    return defaultProject || '';\n  }\n\n  async ensureGCEDefaultProject() {\n    const { authenticationType, gceDefaultProject } = this.instanceSettings.jsonData;\n    if (authenticationType === 'gce' && !gceDefaultProject) {\n      this.instanceSettings.jsonData.gceDefaultProject = await this.getGCEDefaultProject();\n    }\n  }\n\n  async getMetricTypes(projectName: string): Promise<MetricDescriptor[]> {\n    if (!projectName) {\n      return [];\n    }\n\n    return this.getResource(\n      `metricDescriptors/v3/projects/${this.templateSrv.replace(projectName)}/metricDescriptors`\n    ) as Promise<MetricDescriptor[]>;\n  }\n\n  async getSLOServices(projectName: string): Promise<Array<SelectableValue<string>>> {\n    return this.getResource(`services/v3/projects/${this.templateSrv.replace(projectName)}/services?pageSize=1000`);\n  }\n\n  async getServiceLevelObjectives(projectName: string, serviceId: string): Promise<Array<SelectableValue<string>>> {\n    if (!serviceId) {\n      return Promise.resolve([]);\n    }\n    let { projectName: p, serviceId: s } = this.interpolateProps({ projectName, serviceId });\n    return this.getResource(`slo-services/v3/projects/${p}/services/${s}/serviceLevelObjectives`);\n  }\n\n  getProjects(): Promise<Array<SelectableValue<string>>> {\n    return this.getResource(`projects`);\n  }\n\n  migrateMetricTypeFilter(metricType: string, filters?: string[]) {\n    const metricTypeFilterArray = ['metric.type', '=', metricType];\n    if (filters?.length) {\n      return filters.concat('AND', metricTypeFilterArray);\n    }\n    return metricTypeFilterArray;\n  }\n\n  // This is a manual port of the migration code in cloudmonitoring.go\n  // DO NOT UPDATE THIS CODE WITHOUT UPDATING THE BACKEND CODE\n  migrateQuery(query: CloudMonitoringQuery): CloudMonitoringQuery {\n    if (\n      !query.hasOwnProperty('metricQuery') &&\n      !query.hasOwnProperty('sloQuery') &&\n      !query.hasOwnProperty('timeSeriesQuery') &&\n      !query.hasOwnProperty('timeSeriesList')\n    ) {\n      const { hide, refId, datasource, key, queryType, maxLines, metric, intervalMs, type, ...rest } = query as any;\n      return {\n        refId,\n        intervalMs,\n        hide,\n        queryType: type === 'annotationQuery' ? QueryType.ANNOTATION : QueryType.TIME_SERIES_LIST,\n        timeSeriesList: {\n          ...rest,\n          view: rest.view || 'FULL',\n        },\n      };\n    }\n\n    if (has(query, 'metricQuery') && ['metrics', QueryType.ANNOTATION].includes(query.queryType)) {\n      const metricQuery: MetricQuery = get(query, 'metricQuery')!;\n      if (metricQuery.editorMode === 'mql') {\n        query.timeSeriesQuery = {\n          projectName: metricQuery.projectName,\n          query: metricQuery.query,\n          graphPeriod: metricQuery.graphPeriod,\n        };\n        query.queryType = QueryType.TIME_SERIES_QUERY;\n      } else {\n        query.timeSeriesList = {\n          projectName: metricQuery.projectName,\n          crossSeriesReducer: metricQuery.crossSeriesReducer,\n          alignmentPeriod: metricQuery.alignmentPeriod,\n          perSeriesAligner: metricQuery.perSeriesAligner,\n          groupBys: metricQuery.groupBys,\n          filters: metricQuery.filters,\n          view: metricQuery.view,\n          preprocessor: metricQuery.preprocessor,\n        };\n        query.queryType = QueryType.TIME_SERIES_LIST;\n        if (metricQuery.metricType) {\n          query.timeSeriesList.filters = this.migrateMetricTypeFilter(\n            metricQuery.metricType,\n            query.timeSeriesList.filters\n          );\n        }\n      }\n      query.aliasBy = metricQuery.aliasBy;\n      query = omit(query, 'metricQuery');\n    }\n\n    if (query.queryType === QueryType.SLO && has(query, 'sloQuery.aliasBy')) {\n      query.aliasBy = get(query, 'sloQuery.aliasBy');\n      query = omit(query, 'sloQuery.aliasBy');\n    }\n\n    return query;\n  }\n\n  interpolateProps<T extends Record<string, any>>(object: T, scopedVars: ScopedVars = {}): T {\n    return Object.entries(object).reduce((acc, [key, value]) => {\n      return {\n        ...acc,\n        [key]: value && isString(value) ? this.templateSrv.replace(value, scopedVars) : value,\n      };\n    }, {} as T);\n  }\n\n  filterQuery(query: CloudMonitoringQuery): boolean {\n    if (query.hide) {\n      return false;\n    }\n\n    if (query.queryType === QueryType.SLO) {\n      if (!query.sloQuery) {\n        return false;\n      }\n      const { selectorName, serviceId, sloId, projectName, lookbackPeriod } = query.sloQuery;\n      return (\n        !!selectorName &&\n        !!serviceId &&\n        !!sloId &&\n        !!projectName &&\n        (selectorName !== SLO_BURN_RATE_SELECTOR_NAME || !!lookbackPeriod)\n      );\n    }\n\n    if (query.queryType === QueryType.TIME_SERIES_QUERY) {\n      return !!query.timeSeriesQuery && !!query.timeSeriesQuery.projectName && !!query.timeSeriesQuery.query;\n    }\n\n    if ([QueryType.TIME_SERIES_LIST, QueryType.ANNOTATION].includes(query.queryType)) {\n      return !!query.timeSeriesList && !!query.timeSeriesList.projectName && !!getMetricType(query.timeSeriesList);\n    }\n\n    return false;\n  }\n\n  interpolateVariablesInQueries(queries: CloudMonitoringQuery[], scopedVars: ScopedVars): CloudMonitoringQuery[] {\n    return queries.map(\n      (query) => this.applyTemplateVariables(this.migrateQuery(query), scopedVars) as CloudMonitoringQuery\n    );\n  }\n\n  interpolateFilters(filters: string[], scopedVars: ScopedVars) {\n    const completeFilter: Filter[] = chunk(filters, 4)\n      .map(([key, operator, value, condition]) => ({\n        key,\n        operator,\n        value,\n        ...(condition && { condition }),\n      }))\n      .filter((item) => item.value);\n\n    const filterArray = flatten(\n      completeFilter.map(({ key, operator, value, condition }: Filter) => [\n        this.templateSrv.replace(key, scopedVars || {}),\n        operator,\n        this.templateSrv.replace(value, scopedVars || {}, (value: string | string[]) => {\n          return isArray(value) && value.length ? `(${value.join('|')})` : value;\n        }),\n        ...(condition ? [condition] : []),\n      ])\n    );\n\n    return filterArray || [];\n  }\n\n  interpolateGroupBys(groupBys: string[], scopedVars: {}): string[] {\n    let interpolatedGroupBys: string[] = [];\n    (groupBys || []).forEach((gb) => {\n      const interpolated = this.templateSrv.replace(gb, scopedVars || {}, 'csv').split(',');\n      if (Array.isArray(interpolated)) {\n        interpolatedGroupBys = interpolatedGroupBys.concat(interpolated);\n      } else {\n        interpolatedGroupBys.push(interpolated);\n      }\n    });\n    return interpolatedGroupBys;\n  }\n}\n","import { reportInteraction } from '@grafana/runtime';\n\n/**\n * Loaded the first time a dashboard containing Cloudmonitoring queries is loaded (not on every render)\n * Note: The queries used here are the ones pre-migration and pre-filterQuery\n */\nexport const trackCloudMonitoringDashboardLoaded = (props: CloudMonitoringDashboardLoadedProps) => {\n  reportInteraction('grafana_ds_cloudmonitoring_dashboard_loaded', props);\n};\n\nexport type CloudMonitoringDashboardLoadedProps = {\n  grafana_version?: string;\n  dashboard_id: string;\n  org_id?: number;\n  /** number of non hidden queries of type TimeSeriesQuery (MQL) if any  */\n  mql_queries: number;\n  /** number of non hidden queries of type TimeSeriesFilter (Builder) if any  */\n  time_series_filter_queries: number;\n  /** number of non hidden queries of type SLO if any  */\n  slo_queries: number;\n  /** number of non hidden queries of type annotation if any  */\n  annotation_queries: number;\n};\n","import { get } from 'lodash';\n\nimport { DataSourcePlugin, DashboardLoadedEvent } from '@grafana/data';\nimport { getAppEvents } from '@grafana/runtime';\n\nimport CloudMonitoringCheatSheet from './components/CloudMonitoringCheatSheet';\nimport { ConfigEditor } from './components/ConfigEditor/ConfigEditor';\nimport { QueryEditor } from './components/QueryEditor';\nimport { CloudMonitoringVariableQueryEditor } from './components/VariableQueryEditor';\nimport CloudMonitoringDatasource from './datasource';\nimport pluginJson from './plugin.json';\nimport { trackCloudMonitoringDashboardLoaded } from './tracking';\nimport { CloudMonitoringQuery, QueryType } from './types';\n\nexport const plugin = new DataSourcePlugin<CloudMonitoringDatasource, CloudMonitoringQuery>(CloudMonitoringDatasource)\n  .setQueryEditorHelp(CloudMonitoringCheatSheet)\n  .setQueryEditor(QueryEditor)\n  .setConfigEditor(ConfigEditor)\n  .setVariableQueryEditor(CloudMonitoringVariableQueryEditor);\n\n// Track dashboard loads to RudderStack\ngetAppEvents().subscribe<DashboardLoadedEvent<CloudMonitoringQuery>>(\n  DashboardLoadedEvent,\n  ({ payload: { dashboardId, orgId, grafanaVersion, queries } }) => {\n    const cloudmonitorQueries = queries[pluginJson.id];\n    let stats = {\n      [QueryType.TIME_SERIES_QUERY]: 0,\n      [QueryType.TIME_SERIES_LIST]: 0,\n      [QueryType.SLO]: 0,\n      [QueryType.ANNOTATION]: 0,\n    };\n    cloudmonitorQueries.forEach((query) => {\n      if (\n        query.queryType === QueryType.TIME_SERIES_QUERY ||\n        query.queryType === QueryType.TIME_SERIES_LIST ||\n        query.queryType === QueryType.SLO ||\n        query.queryType === QueryType.ANNOTATION\n      ) {\n        stats[query.queryType]++;\n      } else if (query.queryType === 'metrics') {\n        if (query.hasOwnProperty('type') && get(query, 'type') === 'annotationQuery') {\n          stats.annotation++;\n        }\n        if (get(query, 'metricQuery.editorMode') === 'mql') {\n          stats.timeSeriesQuery++;\n        } else {\n          stats.timeSeriesList++;\n        }\n      }\n    });\n\n    if (cloudmonitorQueries && cloudmonitorQueries.length > 0) {\n      trackCloudMonitoringDashboardLoaded({\n        grafana_version: grafanaVersion,\n        dashboard_id: dashboardId,\n        org_id: orgId,\n        mql_queries: stats[QueryType.TIME_SERIES_QUERY],\n        time_series_filter_queries: stats[QueryType.TIME_SERIES_LIST],\n        slo_queries: stats[QueryType.SLO],\n        annotation_queries: stats[QueryType.ANNOTATION],\n      });\n    }\n  }\n);\n"],"names":["CloudMonitoringCheatSheet","ConfigEditor","CloudMonitoringVariableQueryEditor","props","metricDescriptors","labels","metricTypes","services","queryModel","projectName","projects","m","selectedService","s","selectedMetricType","sloServices","state","queryType","service","metricType","labelKey","prevProps","prevState","selecQueryTypeChanged","selectSLOServiceChanged","selectedQueryType","result","l","variableOptionGroup","v","value","name","defaultQuery","datasource","AnnotationQueryEditor","query","onRunQuery","data","onChange","customMetaData","timeSeriesList","title","setTitle","text","setText","handleTitleChange","e","handleTextChange","useDebounce","MetricQueryEditor","Input","isLegacyCloudMonitoringAnnotation","CloudMonitoringAnnotationSupport","ds","enable","iconColor","target","anno","CloudMonitoringMetricFindQuery","error","refId","interpolatedKey","descriptor","selectedSLOService","x","CloudMonitoringVariableSupport","request","executeObservable","from","mergeMap","map","CloudMonitoringDatasource","DataSourceWithBackend","instanceSettings","templateSrv","timeSrv","scopedVars","timeSeriesQuery","sloQuery","aggregation","timeRange","options","queries","lastValueFrom","f","p","acc","key","of","defaultProject","authenticationType","gceDefaultProject","serviceId","filters","metricTypeFilterArray","hide","maxLines","metric","intervalMs","type","rest","metricQuery","object","selectorName","sloId","lookbackPeriod","completeFilter","operator","condition","item","groupBys","interpolatedGroupBys","gb","interpolated","trackCloudMonitoringDashboardLoaded","QueryEditor","dashboardId","orgId","grafanaVersion","cloudmonitorQueries","stats"],"sourceRoot":""}