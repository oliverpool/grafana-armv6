"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3082],{"./public/app/features/api-keys/ApiKeysPage.tsx":(e,n,s)=>{s.r(n),s.d(n,{ApiKeysPageUnconnected:()=>X,default:()=>ee});var t=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),a=s("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/3/opt/drone/yarncache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),i=s("./public/app/types/index.ts"),o=s("./public/app/core/selectors/navModel.ts");const r=e=>e.includeExpired?e.keysIncludingExpired.length:e.keys.length,l=e=>{const n=RegExp(e.searchQuery,"i");return(e.includeExpired?e.keysIncludingExpired:e.keys).filter((e=>n.test(e.name)||n.test(e.role)))},c=e=>e.includeExpired,d=e=>0===e.keys.length&&e.keysIncludingExpired.length>0;var p=s("./public/app/core/services/backend_srv.ts"),u=s("./public/app/features/api-keys/state/reducers.ts");function h(){return async e=>{e((0,u.dF)());const[n,s]=await Promise.all([(0,p.i)().get("/api/auth/keys?includeExpired=false"),(0,p.i)().get("/api/auth/keys?includeExpired=true")]);e((0,u.iK)({keys:n,keysIncludingExpired:s}))}}var y,x,m,g=s("./public/app/core/components/Page/Page.tsx"),b=s("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),f=s("./packages/grafana-ui/src/index.ts"),j=s("./public/app/core/actions/index.ts"),v=s("./public/app/store/store.ts"),A=s("./public/app/core/copy/appNotification.ts"),k=s("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function C(e){let{onDismiss:n,apiKey:s,rootPath:a}=e;const i=(0,f.useStyles2)(K),o=(0,t.useCallback)((()=>s),[s]);return(0,k.jsxs)(f.Modal,{title:"API Key Created",onDismiss:n,onClickBackdrop:n,isOpen:!0,children:[(0,k.jsx)(f.Field,{label:"Key",children:(0,k.jsx)(f.Input,{id:"Key",value:s,readOnly:!0,addonAfter:(0,k.jsxs)(f.ClipboardButton,{variant:"primary",getText:o,onClipboardCopy:()=>{(0,v.WI)((0,j.$l)((0,A.AT)("Content copied to clipboard")))},children:[y||(y=(0,k.jsx)(f.Icon,{name:"copy"}))," Copy"]})})}),x||(x=(0,k.jsx)(f.Alert,{severity:"info",title:"You will only be able to view this key here once!",children:"It is not stored in this form, so be sure to copy it now."})),m||(m=(0,k.jsx)("p",{className:"text-muted",children:"You can authenticate a request using the Authorization HTTP header, example:"})),(0,k.jsxs)("pre",{className:i.small,children:['curl -H "Authorization: Bearer ',s,'" ',a,"/api/dashboards/home"]})]})}function K(e){return{label:b.css`
      padding: ${e.spacing(1)};
      background-color: ${e.colors.background.secondary};
      border-radius: ${e.shape.borderRadius()};
    `,small:b.css`
      font-size: ${e.typography.bodySmall.fontSize};
      font-weight: ${e.typography.bodySmall.fontWeight};
    `}}var I,w,E=s("./public/app/core/config.ts"),P=s("./public/app/core/app_events.ts"),S=s("./public/app/core/components/EmptyListCTA/EmptyListCTA.tsx"),N=s("./packages/grafana-data/src/index.ts"),D=s("./public/app/features/profile/state/selectors.ts"),T=s("./public/app/core/components/Animations/SlideDown.tsx"),_=s("./public/app/core/components/CloseButton/CloseButton.tsx");const{Input:B}=f.LegacyForms,F=Object.keys(i.B5).map((e=>({label:e,value:e})));function Z(e){if(!e)return!0;try{return N.rangeUtil.intervalToSeconds(e),!0}catch{}return!1}const R={[f.EventsWithValidation.onBlur]:[{rule:Z,errorMessage:"Not a valid duration"}]},Q=e=>{let{show:n,onClose:s,onKeyAdded:a,disabled:o}=e;const[r,l]=(0,t.useState)(""),[c,d]=(0,t.useState)(i.B5.Viewer),[p,u]=(0,t.useState)("");(0,t.useEffect)((()=>{l(""),d(i.B5.Viewer),u("")}),[n]);return(0,k.jsx)(T.s,{in:n,children:(0,k.jsxs)("div",{className:"gf-form-inline cta-form",children:[(0,k.jsx)(_.P,{onClick:s}),(0,k.jsxs)("form",{className:"gf-form-group",onSubmit:e=>{e.preventDefault(),Z(p)&&(a({name:r,role:c,secondsToLive:p}),s())},children:[I||(I=(0,k.jsx)("h5",{children:"Add API Key"})),(0,k.jsxs)("div",{className:"gf-form-inline",children:[(0,k.jsxs)("div",{className:"gf-form max-width-21",children:[w||(w=(0,k.jsx)("span",{className:"gf-form-label",children:"Key name"})),(0,k.jsx)(B,{type:"text",className:"gf-form-input",value:r,placeholder:"Name",onChange:e=>{l(e.currentTarget.value)}})]}),(0,k.jsx)("div",{className:"gf-form",children:(0,k.jsx)(f.InlineField,{label:"Role",children:(0,k.jsx)(f.Select,{inputId:"role-select",value:c,onChange:e=>{d(e.value)},options:F,menuShouldPortal:!0})})}),(0,k.jsx)("div",{className:"gf-form max-width-21",children:(0,k.jsx)(f.InlineField,{tooltip:"The API key life duration. For example, 1d if your key is going to last for one day. Supported units are: s,m,h,d,w,M,y",label:"Time to live",children:(0,k.jsx)(B,{id:"time-to-live-input",type:"text",placeholder:"1d",validationEvents:R,value:p,onChange:e=>{u(e.currentTarget.value)}})})}),(0,k.jsx)("div",{className:"gf-form",children:(0,k.jsx)(f.Button,{disabled:o,children:"Add"})})]})]})]})})},z=e=>{let{searchQuery:n,disabled:s,onAddClick:t,onSearchChange:a}=e;return(0,k.jsxs)("div",{className:"page-action-bar",children:[(0,k.jsx)("div",{className:"gf-form gf-form--grow",children:(0,k.jsx)(f.FilterInput,{placeholder:"Search keys",value:n,onChange:a})}),(0,k.jsx)(f.Button,{className:"pull-right",onClick:t,disabled:s,children:"Add API key"})]})};var M,$,L;const V=e=>{let{apiKeys:n,timeZone:s,onDelete:t,canRead:a,canDelete:i}=e;const o=(0,f.useTheme2)(),r=W(o);return(0,k.jsxs)("table",{className:"filter-table",children:[(0,k.jsx)("thead",{children:(0,k.jsxs)("tr",{children:[M||(M=(0,k.jsx)("th",{children:"Name"})),$||($=(0,k.jsx)("th",{children:"Role"})),L||(L=(0,k.jsx)("th",{children:"Expires"})),(0,k.jsx)("th",{style:{width:"34px"}})]})}),a&&n.length>0?(0,k.jsx)("tbody",{children:n.map((e=>{const n=Boolean(e.expiration&&Date.now()>new Date(e.expiration).getTime());return(0,k.jsxs)("tr",{className:r.tableRow(n),children:[(0,k.jsx)("td",{children:e.name}),(0,k.jsx)("td",{children:e.role}),(0,k.jsxs)("td",{children:[O(e.expiration,s),n&&(0,k.jsx)("span",{className:r.tooltipContainer,children:(0,k.jsx)(f.Tooltip,{content:"This API key has expired.",children:(0,k.jsx)(f.Icon,{name:"exclamation-triangle"})})})]}),(0,k.jsx)("td",{children:(0,k.jsx)(f.DeleteButton,{"aria-label":"Delete API key",size:"sm",onConfirm:()=>t(e),disabled:!i})})]},e.id)}))}):null]})};function O(e,n){return e?(0,N.dateTimeFormat)(e,{timeZone:n}):"No expiration date"}const W=e=>({tableRow:n=>b.css`
    color: ${n?e.colors.text.secondary:e.colors.text.primary};
  `,tooltipContainer:b.css`
    margin-left: ${e.spacing(1)};
  `}),U=e=>{let{children:n}=e;const[s,a]=(0,t.useState)(!1),i=(0,t.useCallback)((()=>{a(!s)}),[s]);return n({isAdding:s,toggleIsAdding:i})};var q=s("./public/app/types/events.ts"),Y=s("./public/app/core/core.ts");function H(e,n,s){return n in e?Object.defineProperty(e,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[n]=s,e}const G={loadApiKeys:h,deleteApiKey:function(e){return async n=>{(0,p.i)().delete(`/api/auth/keys/${e}`).then((()=>n(h())))}},setSearchQuery:u.ql,toggleIncludeExpired:function(){return e=>{e((0,u.j4)())}},addApiKey:function(e,n){return async s=>{const t=await(0,p.i)().post("/api/auth/keys",e);s((0,u.ql)("")),s(h()),n(t.key)}}},J=(0,a.connect)((function(e){const n=Y.Vt.hasAccess(i.bW.ActionAPIKeysRead,!0),s=Y.Vt.hasAccess(i.bW.ActionAPIKeysCreate,!0),t=Y.Vt.hasAccess(i.bW.ActionAPIKeysDelete,!0);return{navModel:(0,o.h)(e.navIndex,"apikeys"),apiKeys:l(e.apiKeys),searchQuery:e.apiKeys.searchQuery,apiKeysCount:r(e.apiKeys),hasFetched:e.apiKeys.hasFetched,timeZone:(0,D.Z)(e.user),includeExpired:c(e.apiKeys),includeExpiredDisabled:d(e.apiKeys),canRead:n,canCreate:s,canDelete:t}}),G);class X extends t.PureComponent{constructor(e){super(e),H(this,"onDeleteApiKey",(e=>{this.props.deleteApiKey(e.id)})),H(this,"onSearchQueryChange",(e=>{this.props.setSearchQuery(e)})),H(this,"onIncludeExpiredChange",(e=>{this.props.toggleIncludeExpired()})),H(this,"onAddApiKey",(e=>{const n=e=>{const n=window.location.origin+E.ZP.appSubUrl;P.Z.publish(new q.Dn({props:{apiKey:e,rootPath:n},component:C}))},s=e.secondsToLive;try{const t=s?N.rangeUtil.intervalToSeconds(s):null,a=Object.assign({},e,{secondsToLive:t});this.props.addApiKey(a,n),this.setState((e=>Object.assign({},e,{isAdding:!1})))}catch(e){console.error(e)}}))}componentDidMount(){this.fetchApiKeys()}async fetchApiKeys(){await this.props.loadApiKeys()}render(){const{hasFetched:e,navModel:n,apiKeysCount:s,apiKeys:t,searchQuery:a,timeZone:i,includeExpired:o,includeExpiredDisabled:r,canRead:l,canCreate:c,canDelete:d}=this.props;return e?(0,k.jsx)(g.Z,{navModel:n,children:(0,k.jsx)(g.Z.Contents,{isLoading:!1,children:(0,k.jsx)(U,{children:e=>{let{isAdding:n,toggleIsAdding:p}=e;const u=!n&&0===s,h=s>0;return(0,k.jsxs)(k.Fragment,{children:[u?(0,k.jsx)(S.Z,{title:"You haven't added any API keys yet.",buttonIcon:"key-skeleton-alt",onClick:p,buttonTitle:"New API key",proTip:"Remember, you can provide view-only API access to other applications.",buttonDisabled:!c}):null,h?(0,k.jsx)(z,{searchQuery:a,disabled:n||!c,onAddClick:p,onSearchChange:this.onSearchQueryChange}):null,(0,k.jsx)(Q,{show:n,onClose:p,onKeyAdded:this.onAddApiKey,disabled:!c}),h?(0,k.jsxs)(f.VerticalGroup,{children:[(0,k.jsx)(f.InlineField,{disabled:r,label:"Include expired keys",children:(0,k.jsx)(f.InlineSwitch,{id:"showExpired",value:o,onChange:this.onIncludeExpiredChange})}),(0,k.jsx)(V,{apiKeys:t,timeZone:i,onDelete:this.onDeleteApiKey,canRead:l,canDelete:d})]}):null]})}})})}):(0,k.jsx)(g.Z,{navModel:n,children:(0,k.jsx)(g.Z.Contents,{isLoading:!0})})}}const ee=J(X)}}]);
//# sourceMappingURL=ApiKeysPage.15718e8e3083449662a7.js.map