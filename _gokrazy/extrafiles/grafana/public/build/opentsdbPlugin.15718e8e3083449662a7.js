"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3168],{"./public/app/angular/AngularLocationWrapper.ts":(t,e,a)=>{a.d(e,{O:()=>n});var s=a("./packages/grafana-runtime/src/index.ts"),r=a("./packages/grafana-data/src/index.ts");const i={http:80,https:443,ftp:21};class n{constructor(){this.absUrl=this.wrapInDeprecationWarning(this.absUrl),this.hash=this.wrapInDeprecationWarning(this.hash),this.host=this.wrapInDeprecationWarning(this.host),this.path=this.wrapInDeprecationWarning(this.path),this.port=this.wrapInDeprecationWarning(this.port,"window.location"),this.protocol=this.wrapInDeprecationWarning(this.protocol,"window.location"),this.replace=this.wrapInDeprecationWarning(this.replace),this.search=this.wrapInDeprecationWarning(this.search),this.state=this.wrapInDeprecationWarning(this.state),this.url=this.wrapInDeprecationWarning(this.url)}wrapInDeprecationWarning(t,e){let a=this;return function(){return(0,r.deprecationWarning)("$location",t.name,e||"locationService"),t.apply(a,arguments)}}absUrl(){return`${window.location.origin}${this.url()}`}hash(t){if((0,s.navigationLogger)("AngularLocationWrapper",!1,"Angular compat layer: hash"),t)throw new Error("AngularLocationWrapper method not implemented.");return s.locationService.getLocation().hash.slice(1)}host(){return new URL(window.location.href).hostname}path(t){(0,s.navigationLogger)("AngularLocationWrapper",!1,"Angular compat layer: path");const e=s.locationService.getLocation();if(null!=t){let a=String(t);a=a.startsWith("/")?a:`/${a}`;const r=new URL(`${window.location.origin}${a}`);return s.locationService.push({pathname:r.pathname,search:r.search.length>0?r.search:e.search,hash:r.hash.length>0?r.hash:e.hash}),this}return null===t?(s.locationService.push("/"),this):e.pathname}port(){const t=new URL(window.location.href);return parseInt(t.port,10)||i[t.protocol]||null}protocol(){return new URL(window.location.href).protocol.slice(0,-1)}replace(){throw new Error("AngularLocationWrapper method not implemented.")}search(t,e){if((0,s.navigationLogger)("AngularLocationWrapper",!1,"Angular compat layer: search"),!t)return s.locationService.getSearchObject();if(t&&arguments.length>1)return s.locationService.partial({[t]:e}),this;if(t){let e;e="object"==typeof t?Object.assign({},t):(0,s.locationSearchToObject)(t);for(const t of Object.keys(e))null!==e[t]&&void 0!==e[t]||delete e[t];const a=r.urlUtil.renderUrl(s.locationService.getLocation().pathname,e);s.locationService.push(a)}return this}state(t){throw(0,s.navigationLogger)("AngularLocationWrapper",!1,"Angular compat layer: state"),new Error("AngularLocationWrapper method not implemented.")}url(t){if((0,s.navigationLogger)("AngularLocationWrapper",!1,"Angular compat layer: url"),void 0!==t)return t.startsWith("#")?s.locationService.push(Object.assign({},s.locationService.getLocation(),{hash:t})):t.startsWith("?")?s.locationService.push(Object.assign({},s.locationService.getLocation(),{search:t})):0===t.trim().length?s.locationService.push("/"):s.locationService.push(t),s.locationService;const e=s.locationService.getLocation();return`${e.pathname}${e.search}${e.hash}`}}},"./public/app/angular/panel/metrics_panel_ctrl.ts":(t,e,a)=>{a.d(e,{k:()=>l});var s=a("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),r=a("./public/app/angular/panel/panel_ctrl.ts"),i=a("./public/app/features/dashboard/utils/panel.ts"),n=a("./packages/grafana-data/src/index.ts");function o(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class l extends r.q{constructor(t,e){super(t,e),o(this,"contextSrv",void 0),o(this,"datasourceSrv",void 0),o(this,"timeSrv",void 0),o(this,"templateSrv",void 0),o(this,"interval",void 0),o(this,"intervalMs",void 0),o(this,"resolution",void 0),o(this,"timeInfo",void 0),o(this,"skipDataOnInit",!1),o(this,"dataList",[]),o(this,"querySubscription",void 0),o(this,"useDataFrames",!1),o(this,"panelData",void 0),o(this,"panelDataObserver",{next:t=>{if(this.panelData=t,t.state===n.LoadingState.Error&&(this.loading=!1,this.processDataError(t.error)),t.state===n.LoadingState.Loading)return this.loading=!0,void this.angularDirtyCheck();if(t.request){const{timeInfo:e}=t.request;e&&(this.timeInfo=e)}if(t.timeRange&&(this.range=t.timeRange),this.useDataFrames)this.handleDataFrames(t.series);else{const e=t.series.map((t=>(0,n.toLegacyResponseData)(t)));this.handleQueryResult({data:e})}this.angularDirtyCheck()}}),this.contextSrv=e.get("contextSrv"),this.datasourceSrv=e.get("datasourceSrv"),this.timeSrv=e.get("timeSrv"),this.templateSrv=e.get("templateSrv"),this.panel.datasource=this.panel.datasource||null,this.events.on(n.PanelEvents.refresh,this.onMetricsPanelRefresh.bind(this)),this.events.on(n.PanelEvents.panelTeardown,this.onPanelTearDown.bind(this)),this.events.on(n.PanelEvents.componentDidMount,this.onMetricsPanelMounted.bind(this))}onMetricsPanelMounted(){const t=this.panel.getQueryRunner();this.querySubscription=t.getData({withTransforms:!0,withFieldConfig:!0}).subscribe(this.panelDataObserver)}onPanelTearDown(){this.querySubscription&&(this.querySubscription.unsubscribe(),this.querySubscription=null)}onMetricsPanelRefresh(){if(!this.otherPanelInFullscreenMode()){if(this.panel.snapshotData){this.updateTimeRange();let t=this.panel.snapshotData;return(0,s.isArray)(t)||(t=t.data),this.panelData={state:n.LoadingState.Done,series:t,timeRange:this.range},this.$timeout((()=>{this.events.emit(n.PanelEvents.dataSnapshotLoad,t)}))}return delete this.error,this.loading=!0,this.datasourceSrv.get(this.panel.datasource,this.panel.scopedVars).then(this.issueQueries.bind(this)).catch((t=>{this.processDataError(t)}))}}processDataError(t){t.cancelled?console.log("Panel request cancelled",t):(this.error=t.message||"Request Error",t.data&&(t.data.message?this.error=t.data.message:t.data.error&&(this.error=t.data.error)),this.angularDirtyCheck())}angularDirtyCheck(){this.$scope.$root.$$phase||this.$scope.$digest()}updateTimeRange(t){this.datasource=t||this.datasource,this.range=this.timeSrv.timeRange();const e=(0,i.W1)(this.panel,this.range);this.timeInfo=e.timeInfo,this.range=e.timeRange}issueQueries(t){this.updateTimeRange(t),this.datasource=t;const e=this.panel;return e.getQueryRunner().run({datasource:e.datasource,queries:e.targets,panelId:e.id,dashboardId:this.dashboard.id,timezone:this.dashboard.getTimezone(),timeInfo:this.timeInfo,timeRange:this.range,maxDataPoints:e.maxDataPoints||this.width,minInterval:e.interval,scopedVars:e.scopedVars,cacheTimeout:e.cacheTimeout,transformations:e.transformations})}handleDataFrames(t){this.loading=!1,this.dashboard&&this.dashboard.snapshot&&(this.panel.snapshotData=t.map((t=>(0,n.toDataFrameDTO)(t))));try{this.events.emit(n.PanelEvents.dataFramesReceived,t)}catch(t){this.processDataError(t)}}handleQueryResult(t){this.loading=!1,this.dashboard.snapshot&&(this.panel.snapshotData=t.data),t&&t.data||(console.log("Data source query result invalid, missing data field:",t),t={data:[]});try{this.events.emit(n.PanelEvents.dataReceived,t.data)}catch(t){this.processDataError(t)}}}},"./public/app/angular/panel/panel_ctrl.ts":(t,e,a)=>{a.d(e,{q:()=>h});var s=a("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),r=a("./public/app/core/config.ts"),i=a("./public/app/core/core.ts"),n=a("./packages/grafana-data/src/index.ts"),o=a("./public/app/angular/AngularLocationWrapper.ts");function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class h{constructor(t,e){var a,s;l(this,"panel",void 0),l(this,"error",void 0),l(this,"pluginName",""),l(this,"pluginId",""),l(this,"editorTabs",void 0),l(this,"$scope",void 0),l(this,"$injector",void 0),l(this,"$timeout",void 0),l(this,"editModeInitiated",!1),l(this,"containerHeight",void 0),l(this,"events",void 0),l(this,"loading",!1),l(this,"timing",void 0),l(this,"$location",void 0),l(this,"onPluginTypeChange",(t=>{})),this.panel=null!==(a=this.panel)&&void 0!==a?a:t.$parent.panel,this.dashboard=null!==(s=this.dashboard)&&void 0!==s?s:t.$parent.dashboard,this.$injector=e,this.$scope=t,this.$timeout=e.get("$timeout"),this.editorTabs=[],this.$location=new o.O,this.events=new n.EventBusSrv,this.timing={};const i=r.ZP.panels[this.panel.type];i&&(this.pluginId=i.id,this.pluginName=i.name),t.$on(n.PanelEvents.componentDidMount.name,(()=>this.panelDidMount()))}panelDidMount(){this.events.emit(n.PanelEvents.componentDidMount),this.events.emit(n.PanelEvents.initialized),this.dashboard.panelInitialized(this.panel)}renderingCompleted(){i.rv.renderingCompleted()}refresh(){this.panel.refresh()}publishAppEvent(t,e){this.$scope.$root.appEvent(t,e)}initEditMode(){this.editModeInitiated||(this.editModeInitiated=!0,this.events.emit(n.PanelEvents.editModeInitialized))}addEditorTab(t,e,a,r){const i={title:t,directiveFn:e,icon:r};(0,s.isString)(e)&&(i.directiveFn=()=>({templateUrl:e})),a?this.editorTabs.splice(a,0,i):this.editorTabs.push(i)}getExtendedMenu(){const t=[];return this.events.emit(n.PanelEvents.initPanelActions,t),t}async getAdditionalMenuItems(){return[]}otherPanelInFullscreenMode(){return this.dashboard.otherPanelInFullscreen(this.panel)}render(t){this.events.emit(n.PanelEvents.render,t)}}},"./public/app/angular/panel/query_ctrl.ts":(t,e,a)=>{a.d(e,{G:()=>i});var s=a("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js");function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class i{constructor(t,e){var a,i,n,o,l;r(this,"target",void 0),r(this,"datasource",void 0),r(this,"panelCtrl",void 0),r(this,"panel",void 0),r(this,"hasRawMode",void 0),r(this,"error",void 0),r(this,"isLastQuery",void 0),this.$scope=t,this.$injector=e,this.$scope=t,this.$injector=e,this.panelCtrl=null!==(a=this.panelCtrl)&&void 0!==a?a:t.ctrl.panelCtrl,this.target=null!==(i=this.target)&&void 0!==i?i:t.ctrl.target,this.datasource=null!==(n=this.datasource)&&void 0!==n?n:t.ctrl.datasource,this.panel=null!==(o=null===(l=this.panelCtrl)||void 0===l?void 0:l.panel)&&void 0!==o?o:t.ctrl.panelCtrl.panel,this.isLastQuery=(0,s.indexOf)(this.panel.targets,this.target)===this.panel.targets.length-1}refresh(){this.panelCtrl.refresh()}}},"./public/app/plugins/datasource/opentsdb/module.ts":(t,e,a)=>{a.r(e),a.d(e,{plugin:()=>C});var s=a("../../opt/drone/yarncache/angular-npm-1.8.2-307000482b-35ea81a23b.zip/node_modules/angular/index.js"),r=a.n(s),i=a("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),n=a("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/observable/of.js"),o=a("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/lastValueFrom.js"),l=a("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),h=a("../../opt/drone/yarncache/rxjs-npm-7.5.5-d0546b1ccb-e034f60805.zip/node_modules/rxjs/dist/esm5/internal/operators/map.js"),c=a("./packages/grafana-runtime/src/index.ts"),p=a("./packages/grafana-data/src/index.ts"),u=a("./public/app/features/templating/template_srv.ts");function d(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class g extends p.DataSourceApi{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,u.J)();super(t),d(this,"type",void 0),d(this,"url",void 0),d(this,"name",void 0),d(this,"withCredentials",void 0),d(this,"basicAuth",void 0),d(this,"tsdbVersion",void 0),d(this,"tsdbResolution",void 0),d(this,"lookupLimit",void 0),d(this,"tagKeys",void 0),d(this,"aggregatorsPromise",void 0),d(this,"filterTypesPromise",void 0),this.templateSrv=e,this.templateSrv=e,this.type="opentsdb",this.url=t.url,this.name=t.name,this.withCredentials=t.withCredentials,this.basicAuth=t.basicAuth,t.jsonData=t.jsonData||{},this.tsdbVersion=t.jsonData.tsdbVersion||1,this.tsdbResolution=t.jsonData.tsdbResolution||1,this.lookupLimit=t.jsonData.lookupLimit||1e3,this.tagKeys={},this.aggregatorsPromise=null,this.filterTypesPromise=null}query(t){const e=this.convertToTSDBTime(t.range.raw.from,!1,t.timezone),a=this.convertToTSDBTime(t.range.raw.to,!0,t.timezone),s=[];(0,i.each)(t.targets,(e=>{e.metric&&s.push(this.convertTargetToQuery(e,t,this.tsdbVersion))}));const r=(0,i.compact)(s);if((0,i.isEmpty)(r))return(0,n.of)({data:[]});const o={};return(0,i.each)(r,(t=>{t.filters&&t.filters.length>0?(0,i.each)(t.filters,(t=>{o[t.tagk]=!0})):(0,i.each)(t.tags,((t,e)=>{o[e]=!0}))})),t.targets=(0,i.filter)(t.targets,(t=>!0!==t.hide)),this.performTimeSeriesQuery(r,e,a).pipe((0,l.K)((t=>{var e,a;throw(null==t||null===(e=t.data)||void 0===e||null===(a=e.error)||void 0===a?void 0:a.message)||"Error performing time series query."})),(0,h.U)((e=>{const a=this.mapMetricsToTargets(e.data,t,this.tsdbVersion);return{data:(0,i.map)(e.data,((e,s)=>(-1===(s=a[s])&&(s=0),this._saveTagKeys(e),this.transformMetricData(e,o,t.targets[s],t,this.tsdbResolution))))}})))}annotationQuery(t){const e=this.convertToTSDBTime(t.rangeRaw.from,!1,t.timezone),a=this.convertToTSDBTime(t.rangeRaw.to,!0,t.timezone),s=[],r=[];s.push({aggregator:"sum",metric:t.annotation.target});const n=(0,i.compact)(s);return(0,o.n)(this.performTimeSeriesQuery(n,e,a).pipe((0,h.U)((e=>{if(e.data[0]){let a=e.data[0].annotations;t.annotation.isGlobal&&(a=e.data[0].globalAnnotations),a&&(0,i.each)(a,(e=>{const a={text:e.description,time:1e3*Math.floor(e.startTime),annotation:t.annotation};r.push(a)}))}return r}))))}targetContainsTemplate(t){if(t.filters&&t.filters.length>0)for(let e=0;e<t.filters.length;e++)if(this.templateSrv.containsTemplate(t.filters[e].filter))return!0;if(t.tags&&Object.keys(t.tags).length>0)for(const e in t.tags)if(this.templateSrv.containsTemplate(t.tags[e]))return!0;return!1}performTimeSeriesQuery(t,e,a){let s=!1;2===this.tsdbResolution&&(s=!0);const r={start:e,queries:t,msResolution:s,globalAnnotations:!0};3===this.tsdbVersion&&(r.showQuery=!0),a&&(r.end=a);const i={method:"POST",url:this.url+"/api/query",data:r};return this._addCredentialOptions(i),(0,c.getBackendSrv)().fetch(i)}suggestTagKeys(t){return Promise.resolve(this.tagKeys[t]||[])}_saveTagKeys(t){const e=Object.keys(t.tags);(0,i.each)(t.aggregateTags,(t=>{e.push(t)})),this.tagKeys[t.metric]=e}_performSuggestQuery(t,e){return this._get("/api/suggest",{type:e,q:t,max:this.lookupLimit}).pipe((0,h.U)((t=>t.data)))}_performMetricKeyValueLookup(t,e){if(!t||!e)return(0,n.of)([]);const a=e.split(",").map((t=>t.trim())),s=a[0];let r=s+"=*";a.length>1&&(r+=","+a.splice(1).join(","));const o=t+"{"+r+"}";return this._get("/api/search/lookup",{m:o,limit:this.lookupLimit}).pipe((0,h.U)((t=>{t=t.data.results;const e=[];return(0,i.each)(t,(t=>{-1===e.indexOf(t.tags[s])&&e.push(t.tags[s])})),e})))}_performMetricKeyLookup(t){return t?this._get("/api/search/lookup",{m:t,limit:1e3}).pipe((0,h.U)((t=>{t=t.data.results;const e=[];return(0,i.each)(t,(t=>{(0,i.each)(t.tags,((t,a)=>{-1===e.indexOf(a)&&e.push(a)}))})),e}))):(0,n.of)([])}_get(t,e){const a={method:"GET",url:this.url+t,params:e};return this._addCredentialOptions(a),(0,c.getBackendSrv)().fetch(a)}_addCredentialOptions(t){(this.basicAuth||this.withCredentials)&&(t.withCredentials=!0),this.basicAuth&&(t.headers={Authorization:this.basicAuth})}metricFindQuery(t){if(!t)return Promise.resolve([]);let e;try{e=this.templateSrv.replace(t,{},"distributed")}catch(t){return Promise.reject(t)}const a=t=>(0,i.map)(t,(t=>({text:t}))),s=e.match(/metrics\((.*)\)/);if(s)return(0,o.n)(this._performSuggestQuery(s[1],"metrics").pipe((0,h.U)(a)));const r=e.match(/tag_names\((.*)\)/);if(r)return(0,o.n)(this._performMetricKeyLookup(r[1]).pipe((0,h.U)(a)));const n=e.match(/tag_values\((.*?),\s?(.*)\)/);if(n)return(0,o.n)(this._performMetricKeyValueLookup(n[1],n[2]).pipe((0,h.U)(a)));const l=e.match(/suggest_tagk\((.*)\)/);if(l)return(0,o.n)(this._performSuggestQuery(l[1],"tagk").pipe((0,h.U)(a)));const c=e.match(/suggest_tagv\((.*)\)/);return c?(0,o.n)(this._performSuggestQuery(c[1],"tagv").pipe((0,h.U)(a))):Promise.resolve([])}testDatasource(){return(0,o.n)(this._performSuggestQuery("cpu","metrics").pipe((0,h.U)((()=>({status:"success",message:"Data source is working"})))))}getAggregators(){return this.aggregatorsPromise||(this.aggregatorsPromise=(0,o.n)(this._get("/api/aggregators").pipe((0,h.U)((t=>t.data&&(0,i.isArray)(t.data)?t.data.sort():[]))))),this.aggregatorsPromise}getFilterTypes(){return this.filterTypesPromise||(this.filterTypesPromise=(0,o.n)(this._get("/api/config/filters").pipe((0,h.U)((t=>t.data?Object.keys(t.data).sort():[]))))),this.filterTypesPromise}transformMetricData(t,e,a,s,r){const n=this.createMetricLabel(t,a,e,s),o=[];return(0,i.each)(t.dps,((t,e)=>{2===r?o.push([t,1*e]):o.push([t,1e3*e])})),{target:n,datapoints:o}}createMetricLabel(t,e,a,s){if(e.alias){const a=(0,i.clone)(s.scopedVars||{});return(0,i.each)(t.tags,((t,e)=>{a["tag_"+e]={value:t}})),this.templateSrv.replace(e.alias,a)}let r=t.metric;const n=[];return(0,i.isEmpty)(t.tags)||(0,i.each)((0,i.toPairs)(t.tags),(t=>{(0,i.has)(a,t[0])&&n.push(t[0]+"="+t[1])})),(0,i.isEmpty)(n)||(r+="{"+n.join(", ")+"}"),r}convertTargetToQuery(t,e,a){if(!t.metric||t.hide)return null;const s={metric:this.templateSrv.replace(t.metric,e.scopedVars,"pipe"),aggregator:"avg"};if(t.aggregator&&(s.aggregator=this.templateSrv.replace(t.aggregator)),t.shouldComputeRate&&(s.rate=!0,s.rateOptions={counter:!!t.isCounter},t.counterMax&&t.counterMax.length&&(s.rateOptions.counterMax=parseInt(t.counterMax,10)),t.counterResetValue&&t.counterResetValue.length&&(s.rateOptions.resetValue=parseInt(t.counterResetValue,10)),a>=2&&(s.rateOptions.dropResets=!(s.rateOptions.counterMax||s.rateOptions.ResetValue&&0!==s.rateOptions.ResetValue))),!t.disableDownsampling){let a=this.templateSrv.replace(t.downsampleInterval||e.interval);a.match(/\.[0-9]+s/)&&(a=1e3*parseFloat(a)+"ms"),s.downsample=a+"-"+t.downsampleAggregator,t.downsampleFillPolicy&&"none"!==t.downsampleFillPolicy&&(s.downsample+="-"+t.downsampleFillPolicy)}if(t.filters&&t.filters.length>0){if(s.filters=r().copy(t.filters),s.filters)for(const t in s.filters)s.filters[t].filter=this.templateSrv.replace(s.filters[t].filter,e.scopedVars,"pipe")}else if(s.tags=r().copy(t.tags),s.tags)for(const t in s.tags)s.tags[t]=this.templateSrv.replace(s.tags[t],e.scopedVars,"pipe");return t.explicitTags&&(s.explicitTags=!0),s}mapMetricsToTargets(t,e,a){let s,r;return(0,i.map)(t,(t=>3===a?t.query.index:(0,i.findIndex)(e.targets,(a=>a.filters&&a.filters.length>0?a.metric===t.metric:a.metric===t.metric&&(0,i.every)(a.tags,((a,n)=>(s=this.templateSrv.replace(a,e.scopedVars,"pipe"),r=s.split("|"),(0,i.includes)(r,t.tags[n])||"*"===s)))))))}interpolateVariablesInQueries(t,e){return t.length?t.map((t=>Object.assign({},t,{metric:this.templateSrv.replace(t.metric,e)}))):t}convertToTSDBTime(t,e,a){return"now"===t?null:(t=p.dateMath.parse(t,e,a)).valueOf()}}var m=a("./public/app/plugins/sdk.ts");function v(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class f extends m.QueryCtrl{constructor(t,e){super(t,e),v(this,"aggregators",void 0),v(this,"fillPolicies",void 0),v(this,"filterTypes",void 0),v(this,"tsdbVersion",void 0),v(this,"aggregator",void 0),v(this,"downsampleInterval",void 0),v(this,"downsampleAggregator",void 0),v(this,"downsampleFillPolicy",void 0),v(this,"errors",void 0),v(this,"suggestMetrics",void 0),v(this,"suggestTagKeys",void 0),v(this,"suggestTagValues",void 0),v(this,"addTagMode",!1),v(this,"addFilterMode",!1),this.errors=this.validateTarget(),this.aggregators=["avg","sum","min","max","dev","zimsum","mimmin","mimmax"],this.fillPolicies=["none","nan","null","zero"],this.filterTypes=["wildcard","iliteral_or","not_iliteral_or","not_literal_or","iwildcard","literal_or","regexp"],this.tsdbVersion=this.datasource.tsdbVersion,this.target.aggregator||(this.target.aggregator="sum"),this.target.downsampleAggregator||(this.target.downsampleAggregator="avg"),this.target.downsampleFillPolicy||(this.target.downsampleFillPolicy="none"),this.datasource.getAggregators().then((t=>{0!==t.length&&(this.aggregators=t)})),this.datasource.getFilterTypes().then((t=>{0!==t.length&&(this.filterTypes=t)})),this.suggestMetrics=(t,e)=>{this.datasource.metricFindQuery("metrics("+t+")").then(this.getTextValues).then(e)},this.suggestTagKeys=(t,e)=>{this.datasource.suggestTagKeys(this.target.metric).then(e)},this.suggestTagValues=(t,e)=>{this.datasource.metricFindQuery("suggest_tagv("+t+")").then(this.getTextValues).then(e)}}targetBlur(){this.errors=this.validateTarget(),this.refresh()}getTextValues(t){return(0,i.map)(t,(t=>p.textUtil.escapeHtml(t.text)))}addTag(){this.target.filters&&this.target.filters.length>0&&(this.errors.tags="Please remove filters to use tags, tags and filters are mutually exclusive."),this.addTagMode?(this.target.tags||(this.target.tags={}),this.errors=this.validateTarget(),this.errors.tags||(this.target.tags[this.target.currentTagKey]=this.target.currentTagValue,this.target.currentTagKey="",this.target.currentTagValue="",this.targetBlur()),this.addTagMode=!1):this.addTagMode=!0}removeTag(t){delete this.target.tags[t],this.targetBlur()}editTag(t,e){this.removeTag(t),this.target.currentTagKey=t,this.target.currentTagValue=e,this.addTag()}closeAddTagMode(){this.addTagMode=!1}addFilter(){if(this.target.tags&&(0,i.size)(this.target.tags)>0&&(this.errors.filters="Please remove tags to use filters, tags and filters are mutually exclusive."),this.addFilterMode){if(this.target.filters||(this.target.filters=[]),this.target.currentFilterType||(this.target.currentFilterType="iliteral_or"),this.target.currentFilterGroupBy||(this.target.currentFilterGroupBy=!1),this.errors=this.validateTarget(),!this.errors.filters){const t={type:this.target.currentFilterType,tagk:this.target.currentFilterKey,filter:this.target.currentFilterValue,groupBy:this.target.currentFilterGroupBy};this.target.filters.push(t),this.target.currentFilterType="literal_or",this.target.currentFilterKey="",this.target.currentFilterValue="",this.target.currentFilterGroupBy=!1,this.targetBlur()}this.addFilterMode=!1}else this.addFilterMode=!0}removeFilter(t){this.target.filters.splice(t,1),this.targetBlur()}editFilter(t,e){this.removeFilter(e),this.target.currentFilterKey=t.tagk,this.target.currentFilterValue=t.filter,this.target.currentFilterType=t.type,this.target.currentFilterGroupBy=t.groupBy,this.addFilter()}closeAddFilterMode(){this.addFilterMode=!1}validateTarget(){const t={};if(this.target.shouldDownsample)try{this.target.downsampleInterval?p.rangeUtil.describeInterval(this.target.downsampleInterval):t.downsampleInterval="You must supply a downsample interval (e.g. '1m' or '1h')."}catch(e){t.downsampleInterval=e.message}return this.target.tags&&(0,i.has)(this.target.tags,this.target.currentTagKey)&&(t.tags="Duplicate tag key '"+this.target.currentTagKey+"'."),t}}f.$inject=["$scope","$injector"],v(f,"templateUrl","partials/query.editor.html");a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var b,y=a("./packages/grafana-ui/src/index.ts"),T=a("./public/app/plugins/datasource/influxdb/components/useUniqueId.ts"),w=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const{Select:S,Input:D}=y.LegacyForms,j=[{label:"<=2.1",value:1},{label:"==2.2",value:2},{label:"==2.3",value:3}],x=[{label:"second",value:1},{label:"millisecond",value:2}],P=t=>{var e,a,s;const{onChange:r,value:i}=t,n=(0,T.L)();return(0,w.jsxs)(w.Fragment,{children:[b||(b=(0,w.jsx)("h5",{children:"OpenTSDB settings"})),(0,w.jsxs)("div",{className:"gf-form",children:[(0,w.jsx)(y.InlineFormLabel,{width:7,htmlFor:`select-version-${n}`,children:"Version"}),(0,w.jsx)(S,{inputId:`select-version-${n}`,menuShouldPortal:!0,options:j,value:null!==(e=j.find((t=>t.value===i.jsonData.tsdbVersion)))&&void 0!==e?e:j[0],onChange:F("tsdbVersion",i,r)})]}),(0,w.jsxs)("div",{className:"gf-form",children:[(0,w.jsx)(y.InlineFormLabel,{width:7,htmlFor:`select-resolution-${n}`,children:"Resolution"}),(0,w.jsx)(S,{inputId:`select-resolution-${n}`,menuShouldPortal:!0,options:x,value:null!==(a=x.find((t=>t.value===i.jsonData.tsdbResolution)))&&void 0!==a?a:x[0],onChange:F("tsdbResolution",i,r)})]}),(0,w.jsxs)("div",{className:"gf-form",children:[(0,w.jsx)(y.InlineFormLabel,{width:7,htmlFor:`lookup-input-${n}`,children:"Lookup limit"}),(0,w.jsx)(D,{id:`lookup-input-${n}`,type:"number",value:null!==(s=i.jsonData.lookupLimit)&&void 0!==s?s:1e3,onChange:_("lookupLimit",i,r)})]})]})},F=(t,e,a)=>s=>{a(Object.assign({},e,{jsonData:Object.assign({},e.jsonData,{[t]:s.value})}))},_=(t,e,a)=>s=>{a(Object.assign({},e,{jsonData:Object.assign({},e.jsonData,{[t]:s.currentTarget.value})}))};class k{}var M,L,I;I="partials/annotations.editor.html",(L="templateUrl")in(M=k)?Object.defineProperty(M,L,{value:I,enumerable:!0,configurable:!0,writable:!0}):M[L]=I;const C=new p.DataSourcePlugin(g).setQueryCtrl(f).setConfigEditor((t=>{const{options:e,onOptionsChange:a}=t;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(y.DataSourceHttpSettings,{defaultUrl:"http://localhost:4242",dataSourceConfig:e,onChange:a}),(0,w.jsx)(P,{value:e,onChange:a})]})})).setAnnotationQueryCtrl(k)},"./public/app/plugins/sdk.ts":(t,e,a)=>{a.r(e),a.d(e,{MetricsPanelCtrl:()=>h,PanelCtrl:()=>l,QueryCtrl:()=>c,loadPluginCss:()=>r.loadPluginCss});var s=a("./packages/grafana-data/src/index.ts"),r=a("./packages/grafana-runtime/src/index.ts"),i=a("./public/app/angular/panel/panel_ctrl.ts"),n=a("./public/app/angular/panel/metrics_panel_ctrl.ts"),o=a("./public/app/angular/panel/query_ctrl.ts");const l=(0,s.makeClassES5Compatible)(i.q),h=(0,s.makeClassES5Compatible)(n.k),c=(0,s.makeClassES5Compatible)(o.G)}}]);
//# sourceMappingURL=opentsdbPlugin.15718e8e3083449662a7.js.map