"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6987],{10:(Qe,Be,f)=>{f.d(Be,{q:()=>ke});var m=f(52423),Q=f(68404),Ce=f(29516);const ge=10,ke=({colorPalette:Z,min:ae,max:me,display:I,hoverValue:h,useStopsPercentage:he})=>{const[fe,_]=(0,Q.useState)([]),[ie,se]=(0,Q.useState)({isShown:!1,value:0}),[ce,Se]=(0,Q.useState)(null),Ae=(0,Ce.l4)(),de=Le(Ae,fe);(0,Q.useEffect)(()=>{_(ve({colorArray:Z,stops:ge,useStopsPercentage:he}))},[Z,he]);const Ve=ue=>{const Oe=ue.nativeEvent.offsetX,Ie=ue.currentTarget.offsetWidth,Ee=Math.floor(Oe*100/Ie+1),Re=Math.floor((me-ae)*Ee/100+ae);se({isShown:!0,value:Re}),Se(Ee)},He=()=>{se({isShown:!1,value:0})};return(0,Q.useEffect)(()=>{Se(h==null?null:O((h-ae)/(me-ae)))},[h,ae,me]),Q.createElement("div",{className:de.scaleWrapper,onMouseMove:Ve,onMouseLeave:He},Q.createElement("div",{className:de.scaleGradient},I&&(ie.isShown||h!==void 0)&&Q.createElement("div",{className:de.followerContainer},Q.createElement("div",{className:de.follower,style:{left:`${ce}%`}}))),I&&Q.createElement("div",{className:de.followerContainer},Q.createElement("div",{className:de.legendValues},Q.createElement("span",null,I(ae)),Q.createElement("span",null,I(me))),ce!=null&&(ie.isShown||h!==void 0)&&Q.createElement("span",{className:de.hoverValue,style:{left:`${ce}%`}},I(h??ie.value))))},ve=({colorArray:Z,stops:ae,useStopsPercentage:me=!0})=>{const I=Z.length;if(me&&I<=20){const _=1/I*100;let ie=0;const se=[];for(const ce of Z)ie>0?se.push(`${ce} ${ie}%`):se.push(ce),ie+=_,se.push(`${ce} ${ie}%`);return se}const h=Z[I-1],he=Math.ceil(I/ae),fe=new Set;for(let _=0;_<I;_+=he)fe.add(Z[_]);return fe.add(h),[...fe]};function O(Z){return Z>1?100:Z<0?0:Z*100}const Le=(Z,ae)=>({scaleWrapper:m.css`
    width: 100%;
    font-size: 11px;
    opacity: 1;
  `,scaleGradient:m.css`
    background: linear-gradient(90deg, ${ae.join()});
    height: 10px;
    pointer-events: none;
  `,legendValues:m.css`
    display: flex;
    justify-content: space-between;
    pointer-events: none;
  `,hoverValue:m.css`
    position: absolute;
    margin-top: -14px;
    padding: 3px 15px;
    background: ${Z.colors.background.primary};
    transform: translateX(-50%);
  `,followerContainer:m.css`
    position: relative;
    pointer-events: none;
    white-space: nowrap;
  `,follower:m.css`
    position: absolute;
    height: 14px;
    width: 14px;
    border-radius: 50%;
    transform: translateX(-50%) translateY(-50%);
    border: 2px solid ${Z.colors.text.primary};
    margin-top: 5px;
  `})},28975:(Qe,Be,f)=>{f.r(Be),f.d(Be,{plugin:()=>yt});var m=f(68404),Q=f(48513),Ce=f(68061),ge=f(14582),ke=f(78798),ve=f(93003),O=f(40538),Le=f(23084),Z=f(71464),ae=f(10),me=f(90024),I=f(77564),h=f(35585),he=f(52423),fe=f(36998),_=f(88432),ie=f(68711),se=f(29516),ce=f(71235),Se=f(85623),Ae=f(43921),de=f(97635),Ve=f(68148),He=f(50796),ue=f(20112),Oe=f(89890),Ie=f(90701),Ee=f(90723),Re=f(9398),ze=f(19942);const Ze=e=>e.hover.seriesIdx===2?m.createElement(ze.H,{data:e.data.exemplars,rowIndex:e.hover.dataIdx,header:"Exemplar"}):m.createElement(Xe,{...e}),Xe=({data:e,hover:l,showHistogram:a})=>{const o=l.dataIdx,t=e.heatmap?.fields[0],n=e.heatmap?.fields[1],i=e.heatmap?.fields[2],r=s=>{if(t?.display)return(0,ue.zc)(t.display(s));if(t?.type===ge.fS.time){const p="YYYY-MM-DD HH:mm:ss";return(0,Re.h4)().getCurrent()?.formatDate(s,p)}return`${s}`},E=t?.values.toArray(),x=n?.values.toArray(),w=i?.values.toArray(),N=(0,I.d8)(e.heatmap),b=n?.display?s=>(0,ue.zc)(n.display(s)):s=>`${s}`,K=o%e.yBucketCount;let z,U,D;if(N.yOrdinalDisplay){const s=e.yLayout===h.D.le?K-1:K,p=e.yLayout===h.D.le?K:K+1;z=s<0?N.yMinDisplay:`${N.yOrdinalDisplay[s]}`,U=`${N.yOrdinalDisplay[p]}`,(!N.yOrdinalLabel||Number.isNaN(+N.yOrdinalLabel[0]))&&(D=e.yLayout===h.D.le?U:z)}else{const s=x?.[K];if(e.yLayout===h.D.le)if(U=`${s}`,e.yLog){let R=(e.yLog===2?Math.log2:Math.log10)(s)-1/e.yLogSplit;z=`${e.yLog**R}`}else z=`${s-e.yBucketSize}`;else if(z=`${s}`,e.yLog){let R=(e.yLog===2?Math.log2:Math.log10)(s)+1/e.yLogSplit;U=`${e.yLog**R}`}else U=`${s+e.yBucketSize}`}let M,k;e.xLayout===h.D.le?(k=E?.[o],M=k-e.xBucketSize):(M=E?.[o],k=M+e.xBucketSize);const B=w?.[o],X=e.heatmap?.fields.filter(s=>!Boolean(s.config.custom?.hideFrom?.tooltip)),V=[],H=new Set;for(const s of X??[])if(s.getLinks){const p=s.values.get(o),R=s.display?s.display(p):{text:`${p}`,numeric:+p};s.getLinks({calculatedValue:R,valueRowIndex:o}).forEach(G=>{const F=`${G.title}/${G.href}`;H.has(F)||(V.push(G),H.add(F))})}let S=(0,m.useRef)(null),P=150,ne=50,T=Math.round(P*devicePixelRatio),C=Math.round(ne*devicePixelRatio);(0,m.useEffect)(()=>{if(a){let s=S.current?.getContext("2d");if(s&&E&&x&&w){let p=o;for(;E[p--]===E[o];);p++;let R=p+e.yBucketCount,G=0,F=p;for(;F<R;){let A=w[F];G=Math.max(G,A),F++}let $=new Path2D,Y=new Path2D;F=p;let le=0;for(;F<R;){let A=w[F];if(A>0){let ee=A/G,d=le/(e.yBucketCount+1);(F===o?$:Y).rect(Math.round(T*d),Math.round(C*(1-ee)),Math.round(T/e.yBucketCount),Math.round(C*ee))}F++,le++}s.clearRect(0,0,T,C),s.fillStyle="#ffffff80",s.fill(Y),s.fillStyle="#ff000080",s.fill($)}}},[o]);const[J]=(0,m.useState)(()=>e.heatmap?.meta?.type===_.P.HeatmapCells&&!(0,I.qJ)(e.heatmap));if(J)return m.createElement("div",null,m.createElement(ze.H,{data:e.heatmap,rowIndex:o}));const te=()=>{if(D)return m.createElement("div",null,"Name: ",D);switch(e.yLayout){case h.D.unknown:return m.createElement("div",null,b(z))}return m.createElement("div",null,"Bucket: ",b(z)," - ",b(U))};return m.createElement(m.Fragment,null,m.createElement("div",null,m.createElement("div",null,r(M)),m.createElement("div",null,r(k))),a&&m.createElement("canvas",{width:T,height:C,ref:S,style:{width:T+"px",height:C+"px"}}),m.createElement("div",null,te(),m.createElement("div",null,(0,Oe.C)(i,e.heatmap),": ",e.display(B))),V.length>0&&m.createElement(Ie.wc,null,V.map((s,p)=>m.createElement(Ee.Qj,{key:p,icon:"external-link-alt",target:s.target,href:s.href,onClick:s.onClick,fill:"text",style:{width:"100%"}},s.title))))};var qe=f(98234),_e=f(36512),be=f(75974),Te=f(55294),pe=f(15128),et=f(29431),tt=f(17920),Ge=f(60892);function at(e){const{dataRef:l,theme:a,eventBus:o,onhover:t,onclick:n,onzoom:i,isToolTipOpen:r,timeZone:E,getTimeRange:x,palette:w,cellGap:N,hideLE:b,hideGE:K,yAxisConfig:z,ySizeDivisor:U,sync:D}=e,M="x",k="time",B=devicePixelRatio;let X=l.current?.heatmap?.meta?.type;const V=a.visualization.getColorByName(e.exemplarColor);let H,S,P=new tt.U(E),ne;P.addHook("init",d=>{d.root.querySelectorAll(".u-cursor-pt").forEach(u=>{Object.assign(u.style,{borderRadius:"0",border:"1px solid white",background:"transparent"})}),n&&d.over.addEventListener("mouseup",u=>{d.cursor.drag._x||d.cursor.drag._y||n(u)},!0)}),i&&P.addHook("setSelect",d=>{i({xMin:d.posToVal(d.select.left,M),xMax:d.posToVal(d.select.left+d.select.width,M)}),d.setSelect({left:0,top:0,width:0,height:0},!1)}),P.addHook("setData",d=>{let{min:u,max:c}=d.scales.x,v=x().from.valueOf(),y=x().to.valueOf();(u!==v||c!==y)&&queueMicrotask(()=>{d.setScale(M,{min:v,max:y})})}),P.addHook("syncRect",(d,u)=>{ne=u});const T={point:{[k]:null},data:l.current?.heatmap},C=new Te.es(T);let J;t&&P.addHook("setLegend",d=>{if(d.cursor.idxs!=null)for(let u=0;u<d.cursor.idxs.length;u++){const c=d.cursor.idxs[u];if(c!=null){const{left:v,top:y}=d.cursor;T.rowIndex=c,T.point[k]=d.posToVal(v,M),o.publish(C),r.current||(J&&(clearTimeout(J),J=0),t({seriesIdx:u,dataIdx:c,pageX:ne.left+v,pageY:ne.top+y}));return}}r.current||J||(J=setTimeout(()=>{t(null),T.rowIndex=void 0,T.point[k]=null,o.publish(C)},100))}),P.addHook("drawClear",d=>{H=H||new Ge.lW(0,0,d.bbox.width,d.bbox.height),H.clear(),d.series.forEach((u,c)=>{c>0&&(u._paths=null)})}),P.setMode(2),P.addScale({scaleKey:M,isTime:!0,orientation:O.wN.Horizontal,direction:O.bQ.Right,range:()=>[x().from.valueOf(),x().to.valueOf()]}),P.addAxis({scaleKey:M,placement:O.LB.Bottom,isTime:!0,theme:a,timeZone:E});const te=l.current?.heatmap?.fields[1];if(!te)return P;const p=te.config?.custom?.scaleDistribution??{type:O.wf.Linear},R=Boolean(z.reverse),G=X===_.P.HeatmapCells&&!(0,I.qJ)(l.current?.heatmap),F=p.type!==O.wf.Linear||G,$=(0,I.d8)(l.current?.heatmap).yOrdinalDisplay!=null,Y="y_"+(Math.random()+1).toString(36).substring(7);P.addScale({scaleKey:Y,isTime:!1,orientation:O.wN.Vertical,direction:R?O.bQ.Down:O.bQ.Up,distribution:F?O.wf.Log:O.wf.Linear,log:p.log??2,range:G?(d,u,c)=>{let v,y;if([v,y]=F?be.Z.rangeLog(u,c,p.log??2,!0):[u,c],F&&!$){let W=d.scales[Y].log,j=W===2?Math.log2:Math.log10,{min:g,max:q}=z;if(g!=null&&g>0){let oe=j(g);v=W**(0,pe.mB)(oe,1)}if(q!=null&&q>0){let oe=j(q);y=W**(0,pe.UO)(oe,1)}}return[v,y]}:(d,u,c)=>{let v=u,y=c,{min:W,max:j}=z;if(F){let g=d.scales[Y].log,q=!1,oe=!1,xe=g===2?Math.log2:Math.log10;if(U!==1){let ye=xe(u),Je=xe(c);Number.isInteger(ye)||(v=g**(0,pe.mB)(ye,1),q=!0),Number.isInteger(Je)||(y=g**(0,pe.UO)(Je,1),oe=!0)}if(l.current?.yLayout===h.D.le?q||(v/=g):l.current?.yLayout===h.D.ge?oe||(y*=g):(v/=g/2,y*=g/2),!$){if(W!=null&&W>0){let ye=xe(W);v=g**(0,pe.mB)(ye,1)}if(j!=null&&j>0){let ye=xe(j);y=g**(0,pe.UO)(ye,1)}}}else{let g=l.current?.yBucketSize;g===0&&(g=1),g&&(l.current?.yLayout===h.D.le?v-=g:l.current?.yLayout===h.D.ge?y+=g:(v-=g/2,y+=g/2)),$||(v=W??v,y=j??y)}return[v,y]}});const le=te.display??(0,ue.Cf)("short");P.addAxis({scaleKey:Y,show:z.axisPlacement!==O.LB.Hidden,placement:z.axisPlacement||O.LB.Left,size:z.axisWidth||null,label:z.axisLabel,theme:a,formatValue:(d,u)=>(0,ue.zc)(le(d,u)),splits:$?d=>{const u=(0,I.d8)(l.current?.heatmap);if(!u.yOrdinalDisplay)return[0,1];let c=u.yOrdinalDisplay.map((v,y)=>y);switch(l.current?.yLayout){case h.D.le:c.unshift(-1);break;case h.D.ge:c.push(c.length);break}if(d.height<60)c=[c[0],c[c.length-1]];else for(;c.length>3&&(d.height-15)/c.length<10;)c=c.filter((v,y)=>y%2===0);return c}:void 0,values:$?(d,u)=>{const c=(0,I.d8)(l.current?.heatmap);return c.yOrdinalDisplay?u.map(v=>v<0?c.yMinDisplay??"":c.yOrdinalDisplay[v]??""):u}:void 0});const A=G?ot:lt;P.addSeries({facets:[{scale:M,auto:!0,sorted:1},{scale:Y,auto:!0}],pathBuilder:A({each:(d,u,c,v,y,W,j)=>{H.add({x:v-d.bbox.left,y:y-d.bbox.top,w:W,h:j,sidx:u,didx:c})},gap:N,hideLE:b,hideGE:K,xAlign:l.current?.xLayout===h.D.le?-1:l.current?.xLayout===h.D.ge?1:0,yAlign:(l.current?.yLayout===h.D.le?-1:l.current?.yLayout===h.D.ge?1:0)*(R?-1:1),ySizeDivisor:U,disp:{fill:{values:(d,u)=>{let c=G?3:2;return it(d.data[u][c],w,l.current?.minValue,l.current?.maxValue)},index:w}}}),theme:a,scaleKey:""}),P.addSeries({facets:[{scale:M,auto:!0,sorted:1},{scale:Y,auto:!0}],pathBuilder:nt({each:(d,u,c,v,y,W,j)=>{H.add({x:v-d.bbox.left,y:y-d.bbox.top,w:W,h:j,sidx:u,didx:c})}},V),theme:a,scaleKey:""});const ee={drag:{x:!0,y:!1,setScale:!1},dataIdx:(d,u)=>{if(u===1){S=null;let c=d.cursor.left*B,v=d.cursor.top*B;H.get(c,v,1,1,y=>{(0,Ge.Pn)(c,v,y.x,y.y,y.x+y.w,y.y+y.h)&&(S=y)})}return S&&u===S.sidx?S.didx:null},points:{fill:"rgba(255,255,255, 0.3)",bbox:(d,u)=>{let c=S&&u===S.sidx;return{left:c?S.x/B:-10,top:c?S.y/B:-10,width:c?S.w/B:0,height:c?S.h/B:0}}}};return D&&D()!==et.m.Off&&(ee.sync={key:"__global_",scales:[M,Y],filters:{pub:(d,u,c,v,y,W,j)=>(c<0?(T.point[k]=null,o.publish(new Te.xH)):(T.point[k]=u.posToVal(c,M),o.publish(C)),!0)}},P.setSync()),P.setCursor(ee),P}const $e=4;function lt(e){const{disp:l,each:a,gap:o=1,hideLE:t=-1/0,hideGE:n=1/0,xAlign:i=1,yAlign:r=1,ySizeDivisor:E=1}=e,x=devicePixelRatio,w=o>=$e?Math.round:b=>b,N=Math.round(o*x);return(b,K)=>(be.Z.orient(b,K,(z,U,D,M,k,B,X,V,H,S,P,ne,T,C,J)=>{let te=b.data[K];const s=te[0],p=te[1],R=te[2],G=s.length;let F=l.fill.values(b,K),$=l.fill.index??[...new Set(F)],Y=$.map(g=>new Path2D),le=G-p.lastIndexOf(p[0]),A=G/le,ee=p[1]-p[0]||k.max-k.min,d=s[le]-s[0],u,c;M.distr===3?u=Math.abs(B(s[0]*M.log,M,S,V)-B(s[0],M,S,V)):u=Math.abs(B(d,M,S,V)-B(0,M,S,V)),k.distr===3?c=Math.abs(X(p[0]*k.log,k,P,H)-X(p[0],k,P,H))/E:c=Math.abs(X(ee,k,P,H)-X(0,k,P,H))/E,u=Math.max(1,w(u-N)),c=Math.max(1,w(c-N));let v=i===-1?-u:i===0?-u/2:0,y=r===1?-c:r===0?-c/2:0,W=p.slice(0,le).map(g=>w(X(g,k,P,H)+y)),j=Array.from({length:A},(g,q)=>w(B(s[q*le],M,S,V)+v));for(let g=0;g<G;g++)if(R[g]>t&&R[g]<n){let q=j[~~(g/le)],oe=W[g%le],xe=Y[F[g]];C(xe,q,oe,u,c),a(b,1,g,q,oe,u,c)}return b.ctx.save(),b.ctx.rect(b.bbox.left,b.bbox.top,b.bbox.width,b.bbox.height),b.ctx.clip(),Y.forEach((g,q)=>{b.ctx.fillStyle=$[q],b.ctx.fill(g)}),b.ctx.restore(),null}),null)}function nt(e,l){return(a,o)=>(be.Z.orient(a,o,(t,n,i,r,E,x,w,N,b,K,z,U,D,M,k)=>{let B=new Path2D,X=[B],V=[l??"rgba(255,0,255,0.7)"];for(let H=0;H<n.length;H++){let S=i[H];S-=.5;let P=Math.round(Math.random())*2-1;S+=P*.5*Math.random();let ne=x(n[H],r,K,N),T=w(S,E,z,b),C=8,J=8;M(B,ne-C/2,T-J/2,C,J),e.each(a,o,H,ne-C/2,T-J/2,C,J)}a.ctx.save(),a.ctx.rect(a.bbox.left,a.bbox.top,a.bbox.width,a.bbox.height),a.ctx.clip(),X.forEach((H,S)=>{a.ctx.fillStyle=V[S],a.ctx.fill(H)}),a.ctx.restore()}),null)}function ot(e){const{disp:l,each:a,gap:o=1,hideLE:t=-1/0,hideGE:n=1/0}=e,i=devicePixelRatio,r=o>=$e?Math.round:x=>x,E=Math.round(o*i);return(x,w)=>(be.Z.orient(x,w,(N,b,K,z,U,D,M,k,B,X,V,H,S,P,ne)=>{let T=x.data[w];const C=T[0],J=T[1],te=T[2],s=T[3],p=C.length;let R=l.fill.values(x,w),G=l.fill.index??[...new Set(R)],F=G.map(A=>new Path2D),$=new Map,Y=new Map;for(let A=0;A<C.length;A++){let ee=C[A],d=J[A],u=te[A];$.has(ee)||$.set(ee,r(D(ee,z,X,k))),Y.has(d)||Y.set(d,r(M(d,U,V,B))),Y.has(u)||Y.set(u,r(M(u,U,V,B)))}let le=$.get(C.find(A=>A!==C[0]))-$.get(C[0]);for(let A=0;A<p;A++){if(s[A]<=t||s[A]>=n)continue;let ee=C[A],d=J[A],u=te[A],c=$.get(ee),v=Y.get(d),y=Y.get(u),W=le,j=v-y;W=Math.max(1,W-E),j=Math.max(1,j-E);let g=c,q=v,oe=F[R[A]];P(oe,g,q,W,j),a(x,1,A,g,q,W,j)}x.ctx.save(),x.ctx.rect(x.bbox.left,x.bbox.top,x.bbox.width,x.bbox.height),x.ctx.clip(),F.forEach((A,ee)=>{x.ctx.fillStyle=G[ee],x.ctx.fill(A)}),x.ctx.restore()}),null)}const Ye=(e,l,a,o=-1/0,t=1/0)=>{if(l==null){l=1/0;for(let n=0;n<e.length;n++)e[n]>o&&e[n]<t&&(l=Math.min(l,e[n]))}if(a==null){a=-1/0;for(let n=0;n<e.length;n++)e[n]>o&&e[n]<t&&(a=Math.max(a,e[n]))}return[l,a]},it=(e,l,a,o)=>{let t=Math.max(o-a,1),n=l.length,i=Array(e.length);for(let r=0;r<e.length;r++)i[r]=e[r]<a?0:e[r]>o?n-1:Math.min(n-1,Math.floor(n*(e[r]-a)/t));return i};function Fe(e,l,a,o){let t=e.series;if(!t?.length)return{};const n=e.annotations?.find(r=>r.name==="exemplar");if(o&&n?.fields.forEach((r,E)=>{n.fields[E].getLinks=o(n,r)}),l.calculate)return Ne((0,I.xf)(t,l.calculation??{}),n,l,a);let i;for(const r of t)switch(r.meta?.type){case _.P.HeatmapCells:return(0,I.qJ)(r)?Ne(r,n,l,a):st(r,n,l,a);case _.P.HeatmapRows:i=r}return i||(t.length>1?i=[(0,qe._9)({frames:t})][0]:i=t[0]),Ne((0,I.Cj)({unit:l.yAxis?.unit,decimals:l.yAxis?.decimals,...l.rowsFrame,frame:i}),n,l,a)}const st=(e,l,a,o)=>{if(e.meta?.type!==_.P.HeatmapCells||(0,I.qJ)(e))return{warning:"Expected sparse heatmap format",heatmap:e};De(e.fields[1],a.yAxis,o);const t=De(e.fields[3],a.cellValues,o);let[n,i]=Ye(e.fields[3].values.toArray(),a.color.min,a.color.max,a.filterValues?.le,a.filterValues?.ge);return{heatmap:e,minValue:n,maxValue:i,exemplars:l,display:r=>(0,ue.zc)(t(r))}},Ne=(e,l,a,o)=>{if(e.meta?.type!==_.P.HeatmapCells)return{warning:"Expected heatmap scanlines format",heatmap:e};if(e.fields.length<2||e.length<2)return{heatmap:e};const t=(0,I.d8)(e);let n,i,r;for(const V of e.fields)switch(V.name){case"y":i=V.name;case"yMin":case"yMax":{i||(i=V.name),t.yOrdinalDisplay==null&&De(V,a.yAxis,o);break}case"x":case"xMin":case"xMax":n=V.name;break;default:V.type===ge.fS.number&&!r&&(r=V)}if(!i)return{warning:"Missing Y field",heatmap:e};if(!i)return{warning:"Missing X field",heatmap:e};if(!r)return{warning:"Missing value field",heatmap:e};const E=De(r,a.cellValues,o),x=e.fields[0].values.toArray(),w=e.fields[1].values.toArray(),N=x.length;let b=N-w.lastIndexOf(w[0]),K=N/b,z=w[1]-w[0],U=x[b]-x[0],[D,M]=Ye(r.values.toArray(),a.color.min,a.color.max,a.filterValues?.le,a.filterValues?.ge),k=a.calculation?.xBuckets,B=a.calculation?.yBuckets;return{heatmap:e,exemplars:l?.length?l:void 0,xBucketSize:U,yBucketSize:z,xBucketCount:K,yBucketCount:b,yLog:B?.scale?.log??0,xLog:k?.scale?.log??0,xLogSplit:k?.scale?.log?+(k?.value??"1"):1,yLogSplit:B?.scale?.log?+(B?.value??"1"):1,minValue:D,maxValue:M,xLayout:n==="xMax"?h.D.le:n==="xMin"?h.D.ge:h.D.unknown,yLayout:i==="yMax"?h.D.le:i==="yMin"?h.D.ge:h.D.unknown,display:V=>(0,ue.zc)(E(V))}};function De(e,l,a){if(l?.unit?.length||l?.decimals!=null){const{unit:o,decimals:t}=l;e.display=void 0,e.config={...e.config},o?.length&&(e.config.unit=o),t!=null&&(e.config.decimals=t)}return e.display||(e.display=(0,_e.U)({field:e,theme:a})),e.display}var We=f(47700),rt=f(65356),ct=f(35008),Ue=f.n(ct);const gt=Object.freeze([1,0]);var re=(e=>(e.Opacity="opacity",e.Scheme="scheme",e))(re||{}),we=(e=>(e.Linear="linear",e.Exponential="exponential",e))(we||{});const L={calculate:!1,color:{mode:"scheme",scheme:"Oranges",fill:"dark-orange",scale:"exponential",reverse:!1,exponent:.5,steps:64},rowsFrame:{layout:h.D.auto},yAxis:{axisPlacement:O.LB.Left},cellValues:{},showValue:O.Jp.Auto,tooltip:{show:!0,yHistogram:!1},legend:{show:!0},exemplars:{color:"rgba(255,0,255,0.7)"},filterValues:{le:1e-9},cellGap:1},vt={},Me=[{name:"BrBG",invert:"always"},{name:"PiYG",invert:"always"},{name:"PRGn",invert:"always"},{name:"PuOr",invert:"always"},{name:"RdBu",invert:"always"},{name:"RdGy",invert:"always"},{name:"RdYlBu",invert:"always"},{name:"RdYlGn",invert:"always"},{name:"Spectral",invert:"always"},{name:"Blues",invert:"dark"},{name:"Greens",invert:"dark"},{name:"Greys",invert:"dark"},{name:"Oranges",invert:"dark"},{name:"Purples",invert:"dark"},{name:"Reds",invert:"dark"},{name:"Turbo",invert:"light"},{name:"Cividis",invert:"light"},{name:"Viridis",invert:"light"},{name:"Magma",invert:"light"},{name:"Inferno",invert:"light"},{name:"Plasma",invert:"light"},{name:"Warm",invert:"light"},{name:"Cool",invert:"light"},{name:"Cubehelix",invert:"light",name2:"CubehelixDefault"},{name:"BuGn",invert:"dark"},{name:"BuPu",invert:"dark"},{name:"GnBu",invert:"dark"},{name:"OrRd",invert:"dark"},{name:"PuBuGn",invert:"dark"},{name:"PuBu",invert:"dark"},{name:"PuRd",invert:"dark"},{name:"RdPu",invert:"dark"},{name:"YlGnBu",invert:"dark"},{name:"YlGn",invert:"dark"},{name:"YlOrBr",invert:"dark"},{name:"YlOrRd",invert:"dark"},{name:"Rainbow",invert:"always"},{name:"Sinebow",invert:"always"}],dt=Me.find(e=>e.name==="Spectral");function je(e,l){const a={...L.color,...e},o=[],t=(a.steps??128)-1;if(e.mode===re.Opacity){const n=Ue()(l.visualization.getColorByName(e.fill)).toPercentageRgb(),i=a.scale===we.Exponential?We.scalePow().exponent(a.exponent).domain([0,1]).range([0,1]):We.scaleLinear().domain([0,1]).range([0,1]);for(let r=0;r<=t;r++)n.a=i(r/t),o.push(Ue()(n).toString("hex8"))}else{const n=Me.find(E=>E.name===a.scheme)??dt;let i="interpolate"+(n.name2??n.name);const r=rt[i];for(let E=0;E<=t;E++){let x=r(E/t),w=x.indexOf("rgb")===0?"#"+[...x.matchAll(/\d+/g)].map(N=>(+N[0]).toString(16).padStart(2,"0")).join(""):x;o.push(w)}(n.invert==="always"||n.invert==="dark"&&l.isDark||n.invert==="light"&&l.isLight)&&o.reverse(),e.reverse&&o.reverse()}return o}const ut=({data:e,id:l,timeRange:a,timeZone:o,width:t,height:n,options:i,fieldConfig:r,eventBus:E,onChangeTimeRange:x,replaceVariables:w})=>{const N=(0,se.l4)(),b=(0,se.wW)(mt),{sync:K}=(0,ce.R9)();let z=(0,m.useRef)(a);z.current=a;const U=(0,m.useCallback)((s,p)=>(0,fe.oB)(s,p,p.state?.scopedVars??{},w),[w]),D=(0,m.useMemo)(()=>{try{return Fe(e,i,N,U)}catch(s){return{warning:`${s}`}}},[e,i,N,U]),M=(0,m.useMemo)(()=>{let s=[],p=[];const R=(0,I.d8)(D.heatmap);return D.exemplars?.length&&R.yMatchWithLabel&&(s=D.exemplars?.fields[0].values.toArray(),R.yOrdinalDisplay!=null?p=(D.exemplars?.fields.find($=>$.name===R.yMatchWithLabel).values.toArray()).map($=>R.yOrdinalLabel?.indexOf($)):p=D.exemplars?.fields[1].values.toArray()),[null,D.heatmap?.fields.map(G=>G.values.toArray()),[s,p]]},[D.heatmap,D.exemplars]),k=(0,m.useMemo)(()=>je(i.color,N),[i.color,N]),[B,X]=(0,m.useState)(void 0),[V,H]=(0,m.useState)(!1),S=(0,m.useRef)(!1),P=()=>{S.current=!1,H(!1),T(null)},ne=()=>{S.current=!S.current,H(S.current)},T=(0,m.useCallback)(s=>{X(s??void 0)},[i,e.structureRev]),C=(0,m.useRef)(D);C.current=D;const J=(0,m.useMemo)(()=>{const s=C.current?.heatmap?.fields[1].config?.custom?.scaleDistribution;return at({dataRef:C,theme:N,eventBus:E,onhover:T,onclick:i.tooltip.show?ne:null,onzoom:p=>{p.xMax-p.xMin>1&&x({from:p.xMin,to:p.xMax})},isToolTipOpen:S,timeZone:o,getTimeRange:()=>z.current,sync:K,palette:k,cellGap:i.cellGap,hideLE:i.filterValues?.le,hideGE:i.filterValues?.ge,exemplarColor:i.exemplars?.color??"rgba(255,0,255,0.7)",yAxisConfig:i.yAxis,ySizeDivisor:s?.type===O.wf.Log?+(i.calculation?.yBuckets?.value||1):1})},[i,o,e.structureRev]),te=()=>{if(!D.heatmap||!i.legend.show)return null;let R=C.current?.heatmap?.meta?.type===_.P.HeatmapCells&&!(0,I.qJ)(C.current?.heatmap)?3:2;const G=D.heatmap.fields[R];let F;return B&&D.heatmap.fields&&B.seriesIdx===1&&(F=G.values.get(B.dataIdx)),m.createElement(Se.AY.Legend,{placement:"bottom",maxHeight:"20%"},m.createElement("div",{className:b.colorScaleWrapper},m.createElement(ae.q,{hoverValue:F,colorPalette:k,min:C.current.minValue,max:C.current.maxValue,display:D.display})))};return D.warning||!D.heatmap?m.createElement(ie.Z,{panelId:l,fieldConfig:r,data:e,needsNumberField:!0,message:D.warning}):m.createElement(m.Fragment,null,m.createElement(Se.AY,{width:t,height:n,legend:te()},(s,p)=>m.createElement(Ae.N,{config:J,data:M,width:s,height:p,timeRange:a})),m.createElement(de.h_,null,B&&i.tooltip.show&&m.createElement(Ve.S,{position:{x:B.pageX,y:B.pageY},offset:{x:10,y:10},allowPointerEvents:S.current},V&&m.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"flex-end",paddingBottom:"6px"}},m.createElement(He.P,{onClick:P,style:{position:"relative",top:"auto",right:"auto",marginRight:0}})),m.createElement(Ze,{timeRange:a,data:D,hover:B,showHistogram:i.tooltip.yHistogram}))))},mt=e=>({colorScaleWrapper:he.css`
    margin-left: 25px;
    padding: 10px 0;
    max-width: 300px;
  `}),ft=e=>Object.keys(e.options).length===0?Ke(e,"heatmap",{angular:e},e.fieldConfig):e.options,Ke=(e,l,a,o)=>{if(l==="heatmap"&&a.angular){const{fieldConfig:t,options:n}=ht({...a.angular,fieldConfig:o});return e.fieldConfig=t,n}if(l==="heatmap-new"){const{bucketFrame:t,...n}=e.options;return t?{...n,rowsFrame:t}:e.options}return{}};function ht(e){const l={defaults:{},overrides:[]},a=e.dataFormat!=="tsbuckets",o={...L.calculation},t={logBase:1,...e.yAxis};a&&(e.xBucketSize?o.xBuckets={mode:h.k.Size,value:`${e.xBucketSize}`}:e.xBucketNumber&&(o.xBuckets={mode:h.k.Count,value:`${e.xBucketNumber}`}),e.yBucketSize?o.yBuckets={mode:h.k.Size,value:`${e.yBucketSize}`}:e.xBucketNumber&&(o.yBuckets={mode:h.k.Count,value:`${e.yBucketNumber}`}),t.logBase>1&&(o.yBuckets={mode:h.k.Count,value:+t.splitFactor>0?`${t.splitFactor}`:void 0,scale:{type:O.wf.Log,log:t.logBase}}));const n=Pe(e.cards?.cardPadding,2),i={calculate:a,calculation:o,color:{...L.color,steps:128},cellGap:n||1,cellRadius:Pe(e.cards?.cardRound),yAxis:{axisPlacement:t.show===!1?O.LB.Hidden:O.LB.Left,reverse:Boolean(e.reverseYBuckets),axisWidth:Pe(t.width),min:t.min,max:t.max,unit:t.format,decimals:t.decimals},cellValues:{decimals:Pe(e.tooltipDecimals)},rowsFrame:{layout:pt(e.yBucketBound)},legend:{show:Boolean(e.legend?.show)},showValue:O.Jp.Never,tooltip:{show:Boolean(e.tooltip?.show),yHistogram:Boolean(e.tooltip?.showHistogram)},exemplars:{...L.exemplars}};e.hideZeroBuckets&&(i.filterValues={...L.filterValues});const r=e.color??{};switch(r?.mode){case"spectrum":{i.color.mode=re.Scheme;const E=r.colorScheme;let x=Me.find(w=>w.name===E);x||(x=Me.find(w=>E.indexOf(w.name)>=0)),i.color.scheme=x?x.name:L.color.scheme;break}case"opacity":{i.color.mode=re.Opacity,i.color.scale=r.scale;break}}return i.color.fill=r.cardColor,i.color.min=r.min,i.color.max=r.max,typeof r.min=="number"&&typeof r.max=="number"&&r.min>r.max&&(i.color.min=r.max,i.color.max=r.min,i.color.reverse=!0),{fieldConfig:l,options:i}}function pt(e){switch(e){case"upper":return h.D.ge;case"lower":return h.D.le;case"middle":return h.D.unknown}return h.D.auto}function Pe(e,l){if(e==null||e==="")return l;const a=+e;return isNaN(a)?l:a}class xt{getSuggestionsForData(l){const{dataSummary:a}=l;if(!l.data?.series||!a.hasData||a.timeFieldCount<1||a.numberFieldCount<2||a.numberFieldCount>10)return;const o=Fe(l.data,L,ve.v.theme2);!o||o.warning||l.getListAppender({name:"",pluginId:"heatmap",options:{},fieldConfig:{defaults:{custom:{}},overrides:[]}})}}const yt=new Q.c(ut).useFieldConfig({disableStandardOptions:Object.values(Ce.qb).filter(e=>e!==Ce.qb.Links),useCustomConfig:e=>{e.addCustomEditor({id:"scaleDistribution",path:"scaleDistribution",name:"Y axis scale",category:["Heatmap"],editor:Le.Y,override:Le.Y,defaultValue:{type:O.wf.Linear},shouldApply:l=>l.type===ge.fS.number,process:ke.kG,hideFromDefaults:!0}),(0,Z.B)(e)}}).setPanelChangeHandler(Ke).setMigrationHandler(ft).setPanelOptions((e,l)=>{const a=l.options??L;let o=!1;try{const n=Fe({series:l.data},a,ve.v.theme2);o=(0,I.d8)(n.heatmap).yOrdinalDisplay!=null}catch{}let t=["Heatmap"];e.addRadio({path:"calculate",name:"Calculate from data",defaultValue:L.calculate,category:t,settings:{options:[{label:"Yes",value:!0},{label:"No",value:!1}]}}),a.calculate&&(0,me.J)("calculation.",e,a.calculation,t),t=["Y Axis"],e.addRadio({path:"yAxis.axisPlacement",name:"Placement",defaultValue:L.yAxis.axisPlacement??O.LB.Left,category:t,settings:{options:[{label:"Left",value:O.LB.Left},{label:"Right",value:O.LB.Right},{label:"Hidden",value:O.LB.Hidden}]}}).addUnitPicker({category:t,path:"yAxis.unit",name:"Unit",defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:t,path:"yAxis.decimals",name:"Decimals",settings:{placeholder:"Auto"}}),o||e.addNumberInput({path:"yAxis.min",name:"Min value",settings:{placeholder:"Auto"},category:t}).addTextInput({path:"yAxis.max",name:"Max value",settings:{placeholder:"Auto"},category:t}),e.addNumberInput({path:"yAxis.axisWidth",name:"Axis width",defaultValue:L.yAxis.axisWidth,settings:{placeholder:"Auto",min:5},category:t}).addTextInput({path:"yAxis.axisLabel",name:"Axis label",defaultValue:L.yAxis.axisLabel,settings:{placeholder:"Auto"},category:t}),a.calculate||e.addRadio({path:"rowsFrame.layout",name:"Tick alignment",defaultValue:L.rowsFrame?.layout??h.D.auto,category:t,settings:{options:[{label:"Auto",value:h.D.auto},{label:"Top (LE)",value:h.D.le},{label:"Middle",value:h.D.unknown},{label:"Bottom (GE)",value:h.D.ge}]}}),e.addBooleanSwitch({path:"yAxis.reverse",name:"Reverse",defaultValue:L.yAxis.reverse===!0,category:t}),t=["Colors"],e.addRadio({path:"color.mode",name:"Mode",defaultValue:L.color.mode,category:t,settings:{options:[{label:"Scheme",value:re.Scheme},{label:"Opacity",value:re.Opacity}]}}),e.addColorPicker({path:"color.fill",name:"Color",defaultValue:L.color.fill,category:t,showIf:n=>n.color.mode===re.Opacity}),e.addRadio({path:"color.scale",name:"Scale",defaultValue:L.color.scale,category:t,settings:{options:[{label:"Exponential",value:we.Exponential},{label:"Linear",value:we.Linear}]},showIf:n=>n.color.mode===re.Opacity}),e.addSliderInput({path:"color.exponent",name:"Exponent",defaultValue:L.color.exponent,category:t,settings:{min:.1,max:2,step:.1},showIf:n=>n.color.mode===re.Opacity&&n.color.scale===we.Exponential}),e.addSelect({path:"color.scheme",name:"Scheme",description:"",defaultValue:L.color.scheme,category:t,settings:{options:Me.map(n=>({value:n.name,label:n.name}))},showIf:n=>n.color.mode!==re.Opacity}),e.addSliderInput({path:"color.steps",name:"Steps",defaultValue:L.color.steps,category:t,settings:{min:2,max:128,step:1}}).addBooleanSwitch({path:"color.reverse",name:"Reverse",defaultValue:L.color.reverse,category:t}).addCustomEditor({id:"__scale__",path:"__scale__",name:"",category:t,editor:()=>{const n=je(a.color,ve.v.theme2);return m.createElement("div",null,m.createElement(ae.q,{colorPalette:n,min:1,max:100}))}}),e.addNumberInput({path:"color.min",name:"Start color scale from value",defaultValue:L.color.min,settings:{placeholder:"Auto (min)"},category:t}).addNumberInput({path:"color.max",name:"End color scale at value",defaultValue:L.color.max,settings:{placeholder:"Auto (max)"},category:t}),t=["Cell display"],a.calculate||e.addTextInput({path:"rowsFrame.value",name:"Value name",defaultValue:L.rowsFrame?.value,settings:{placeholder:"Value"},category:t}),e.addUnitPicker({category:t,path:"cellValues.unit",name:"Unit",defaultValue:void 0,settings:{isClearable:!0}}).addNumberInput({category:t,path:"cellValues.decimals",name:"Decimals",settings:{placeholder:"Auto"}}),e.addSliderInput({name:"Cell gap",path:"cellGap",defaultValue:L.cellGap,category:t,settings:{min:0,max:25}}).addNumberInput({path:"filterValues.le",name:"Hide cells with values <=",defaultValue:L.filterValues?.le,settings:{placeholder:"None"},category:t}).addNumberInput({path:"filterValues.ge",name:"Hide cells with values >=",defaultValue:L.filterValues?.ge,settings:{placeholder:"None"},category:t}),t=["Tooltip"],e.addBooleanSwitch({path:"tooltip.show",name:"Show tooltip",defaultValue:L.tooltip.show,category:t}),e.addBooleanSwitch({path:"tooltip.yHistogram",name:"Show histogram (Y axis)",defaultValue:L.tooltip.yHistogram,category:t,showIf:n=>n.tooltip.show}),t=["Legend"],e.addBooleanSwitch({path:"legend.show",name:"Show legend",defaultValue:L.legend.show,category:t}),t=["Exemplars"],e.addColorPicker({path:"exemplars.color",name:"Color",defaultValue:L.exemplars.color,category:t})}).setSuggestionsSupplier(new xt)}}]);

//# sourceMappingURL=heatmapPanel.5cfc2e8c02f8255c3740.js.map