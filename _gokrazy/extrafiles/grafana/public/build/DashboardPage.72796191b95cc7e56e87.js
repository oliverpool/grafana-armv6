"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5296,6092],{44927:(he,U,o)=>{o.d(U,{E:()=>e,z:()=>m});const m=()=>({type:"query",query:{params:["A","5m","now"]},reducer:{type:"avg",params:[]},evaluator:{type:"gt",params:[null]},operator:{type:"and"}}),e=async(R,w,V,v)=>{if(w.length===0)return"Could not find any metric queries";if(R&&R.length)return"Transformations are not supported in alert queries";let D=0,P=0;for(const b of w){const z=b.datasource||v,M=await V.get(z);M.meta.alerting?M.targetContainsTemplate&&M.targetContainsTemplate(b)&&P++:D++}return D===w.length?"The datasource does not support alerting queries":P===w.length?"Template variables are not supported in alert queries":""}},53860:(he,U,o)=>{o.r(U),o.d(U,{DashboardPage:()=>nt,UnthemedDashboardPage:()=>tt,default:()=>As,mapStateToProps:()=>tn});var m=o(52423),e=o(68404),R=o(36635),w=o(24844),V=o(83383),v=o(68183),D=o(57388),P=o(93003),b=o(29516),z=o(659),M=o(79396),Q=o(34177),G=o(60499),X=o(96694),F=o(86245),W=o(30992),k=o(60265),T=o(81168),I=o(45984),fe=o(85803),rt=o(92624),Ue=o(66157),q=o(31460),re=o(77839),H=o(82897),se=o(70356),st=o(88561),an=o(97063),oe=o(82002),ve=o(22350),rn=o(70197),te=o(6694),Ee=o(25474),K=o(81697),C=o(90723),sn=o(86648),on=o(74391),ln=o(2313);const ot=({panel:t,folderUid:n,isUnsavedPrompt:a,onDismiss:r,onConfirm:s,onDiscard:i})=>{const[l,c]=(0,e.useState)(""),d=(0,ve.Z)(async()=>{const y=await(0,sn.E8)(t.libraryPanel.uid);return y.length>0?y.map(L=>L.title):[]},[t.libraryPanel.uid]),[p,u]=(0,e.useState)([]);(0,rn.Z)(()=>d.value?u(d.value.filter(y=>y.toLowerCase().includes(l.toLowerCase()))):u([]),300,[d.value,l]);const{saveLibraryPanel:g}=(0,ln.E)(),f=(0,b.wW)(on.J),h=(0,e.useCallback)(()=>{i()},[i]),E=a?"Unsaved library panel changes":"Save library panel";return e.createElement(te.u,{title:E,icon:"save",onDismiss:r,isOpen:!0},e.createElement("div",null,e.createElement("p",{className:f.textInfo},"This update will affect ",e.createElement("strong",null,t.libraryPanel.meta.connectedDashboards," ",t.libraryPanel.meta.connectedDashboards===1?"dashboard":"dashboards","."),"The following dashboards using the panel will be affected:"),e.createElement(Ee.I,{className:f.dashboardSearch,prefix:e.createElement(K.J,{name:"search"}),placeholder:"Search affected dashboards",value:l,onChange:y=>c(y.currentTarget.value)}),d.loading?e.createElement("p",null,"Loading connected dashboards..."):e.createElement("table",{className:f.myTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Dashboard name"))),e.createElement("tbody",null,p.map((y,L)=>e.createElement("tr",{key:`dashrow-${L}`},e.createElement("td",null,y))))),e.createElement(te.u.ButtonRow,null,e.createElement(C.zx,{variant:"secondary",onClick:r,fill:"outline"},"Cancel"),a&&e.createElement(C.zx,{variant:"destructive",onClick:h},"Discard"),e.createElement(C.zx,{onClick:()=>{g(t,n).then(()=>{s()})}},"Update all"))))};var cn=o(82302),ze=o(58379),be=o(32294),it=o(46732),j=o(36281);function dn(t,n){return async a=>{const r=n.initEditPanel(t);a((0,j.Hl)({panel:r,sourcePanel:t}))}}function lt(){return async(t,n)=>{const{getPanel:a}=n().panelEditor;a().configRev=0,t((0,j.yi)(!0))}}function un(t,n){return a=>{if(t.libraryPanel?.uid===void 0||!n)return;const r=t.getSaveModel();for(const s of n.panels){if(pn(t,s))continue;s.restoreModel({...r,...(0,H.pick)(s,"gridPos","id")});const i=s.plugin?.meta.id!==t.plugin?.meta.id;s.plugin=t.plugin,s.configRev++,i&&(s.generateNewKey(),a((0,it.bc)({key:s.key,plugin:s.plugin}))),setTimeout(()=>{s.getQueryRunner().useLastResultFrom(t.getQueryRunner())},20)}t.repeat&&setTimeout(()=>n.processRepeats(),20)}}function pn(t,n){return!!(n.libraryPanel?.uid!==t.libraryPanel.uid||n.id&&n.id===t.id||n.repeatPanelId)}function mn(){return async(t,n)=>{const a=n().dashboard.getModel(),{getPanel:r,getSourcePanel:s,shouldDiscardChanges:i}=n().panelEditor,l=r();if(a&&a.exitPanelEditor(),gn(l)&&!i){const c=l.getSaveModel(),d=s(),p=d.type!==l.type;t(un(l,a)),d.restoreModel(c),d.configRev++,p&&(d.plugin=l.plugin,d.generateNewKey(),await t((0,it.bc)({key:d.key,plugin:l.plugin}))),setTimeout(()=>{d.getQueryRunner().useLastResultFrom(l.getQueryRunner()),d.render(),l.hasSavedPanelEditChange&&!l.hasChanged&&(d.configRev=0)},20)}t((0,be.qj)(l.key)),t((0,j.my)())}}function gn(t){return t.hasChanged||t.hasSavedPanelEditChange||t.isAngularPlugin()}function Fe(t){return(n,a)=>{const r={...a().panelEditor.ui,...t};n((0,j.K9)(r));try{ze.Z.setObject(j.jy,r)}catch(s){console.error(s)}}}var hn=o(84135);const fn=({dashboard:t,onSaveSuccess:n,onDiscard:a,onDismiss:r})=>e.createElement(te.u,{isOpen:!0,title:"Unsaved changes",onDismiss:r,icon:"exclamation-triangle",className:m.css`
        width: 500px;
      `},e.createElement("h5",null,"Do you want to save your changes?"),e.createElement(te.u.ButtonRow,null,e.createElement(C.zx,{variant:"secondary",onClick:r,fill:"outline"},"Cancel"),e.createElement(C.zx,{variant:"destructive",onClick:a},"Discard"),e.createElement(hn.i,{dashboard:t,onSaveSuccess:n}))),ct=e.memo(({dashboard:t})=>{const[n,a]=(0,e.useState)({original:null}),r=(0,T.useDispatch)(),{original:s,originalPath:i}=n,{showModal:l,hideModal:c}=(0,e.useContext)(st.kr);(0,e.useEffect)(()=>{const p=setTimeout(()=>{const g=D.E1.getLocation().pathname,f=t.getSaveModelClone();a({originalPath:g,original:f})},1e3),u=an.h.subscribe(I.Jd,()=>{const g=t.getSaveModelClone();a({originalPath:i,original:g})});return()=>{clearTimeout(p),u.unsubscribe()}},[t,i]),(0,e.useEffect)(()=>{const p=u=>{dt(t,s)||pt(t,s)&&(u.preventDefault(),u.returnValue="")};return window.addEventListener("beforeunload",p),()=>window.removeEventListener("beforeunload",p)},[t,s]);const d=p=>{const u=t.panelInEdit,g=new URLSearchParams(p.search);return u&&u.libraryPanel&&u.hasChanged&&!g.has("editPanel")?(l(ot,{isUnsavedPrompt:!0,panel:t.panelInEdit,folderUid:t.meta.folderUid??"",onConfirm:()=>{c(),ye(p)},onDiscard:()=>{r(lt()),ye(p),c()},onDismiss:c}),!1):i===p.pathname||!s?(u&&!g.has("editPanel")&&r(mn()),!0):dt(t,s)||!pt(t,s)?!0:(l(fn,{dashboard:t,onSaveSuccess:()=>{c(),ye(p)},onDiscard:()=>{a({...n,original:null}),c(),ye(p)},onDismiss:c}),!1)};return e.createElement(se.NL,{when:!0,message:d})});ct.displayName="DashboardPrompt";function ye(t){t&&setTimeout(()=>D.E1.push(t),10)}function dt(t,n){if(!n||!oe.Vt.isSignedIn||!t)return!0;const{canSave:a,fromScript:r,fromFile:s}=t.meta;return!oe.Vt.isEditor&&!a?!0:!a||r||s}function ut(t){const n=new cn.f(t);n.expandRows();const a=n.getSaveModelClone();return a.time=0,a.refresh="",a.schemaVersion=0,a.timezone=0,a.panels=[],(0,H.each)(a.getVariables(),r=>{r.current=null,r.options=null,r.filters=null}),a}function pt(t,n){if(t.hasUnsavedChanges())return!0;const a=ut(t.getSaveModelClone()),r=ut(n),s=(0,H.find)(a.nav,{type:"timepicker"}),i=(0,H.find)(r.nav,{type:"timepicker"});s&&i&&(s.now=i.now);const l=JSON.stringify(a,null),c=JSON.stringify(r,null);return l!==c}var vn=o(36182),N=o(39653),Pe=o(73952),Ce=o(89050),mt=o(40400),Se=o(26418),gt=o(55461),En=o(69369),Be=o(26625),ie=o(17353),bn=o(40008),_=o(2323),le=o(74955),ht=o(46739),We=o(38120),yn=o(57172),A=o(90701),ne=o(44727),Pn=o(3574),Cn=o.n(Pn),Sn=o(38849),Te=o(20112),Tn=o(38535),ce=o(19349),xe=o(87464),ft=o(78197),de=(t=>(t[t.Support=0]="Support",t[t.Data=1]="Data",t))(de||{}),De=(t=>(t[t.PanelSnapshot=0]="PanelSnapshot",t[t.GithubComment=1]="GithubComment",t))(De||{});class xn extends Tn.b{constructor(n){super({panel:n,panelTitle:n.replaceVariables(n.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:"GitHub comment",description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:"Panel support snapshot",description:"Dashboard JSON used to help troubleshoot visualization issues",value:0}]}),this.onCurrentTabChange=a=>{this.setState({currentTab:a})},this.onShowMessageChange=a=>{this.setState({showMessage:a.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:a}=this.state,r=Math.pow(1024,2)*1.5;return a.length>r?(this.setState({error:{title:"Copy to clipboard failed",message:"Snapshot is too large, consider download and attaching a file instead"}}),""):a},this.onDownloadDashboard=()=>{const{snapshotText:a,panelTitle:r}=this.state,s=new Blob([a],{type:"text/plain"}),i=`debug-${r}-${(0,Sn.dq)(new Date)}.json.txt`;Cn()(s,i)},this.onSetSnapshotText=a=>{this.setState({snapshotText:a})},this.onToggleRandomize=a=>{const{randomize:r}=this.state;this.setState({randomize:{...r,[a]:!r[a]}})},this.onPreviewDashboard=()=>{const{snapshot:a}=this.state;a&&((0,xe.$M)({meta:{},dashboard:a}),o.g.open(P.v.appUrl+"dashboard/new","_blank"))}}async buildDebugDashboard(){const{panel:n,randomize:a,snapshotUpdate:r,iframeLoading:s,currentTab:i}=this.state,l=await(0,ft.$R)(n,a,(0,ce.$t)().timeRange()),c=JSON.stringify(l,null,2),d=(0,ft.S$)(n,c),p=(0,Te.zc)((0,Te.Cf)("bytes")(c?.length??0));s&&i===0&&(0,xe.$M)({meta:{},dashboard:l}),this.setState({snapshot:l,snapshotText:c,markdownText:d,snapshotSize:p,snapshotUpdate:r+1})}subscribeToIframeLoadingMessage(){const n=a=>{a.data==="GrafanaAppInit"&&((0,xe.$M)({meta:{},dashboard:this.state.snapshot}),this.setState({iframeLoading:!0}))};return window.addEventListener("message",n,!1),function(){window.removeEventListener("message",n)}}}function Dn({panel:t,plugin:n,onClose:a}){const r=(0,b.wW)(On),s=(0,e.useMemo)(()=>new xn(t),[t]),{currentTab:i,loading:l,error:c,iframeLoading:d,options:p,showMessage:u,snapshotSize:g,markdownText:f,snapshotText:h,randomize:E,panelTitle:y,snapshotUpdate:L}=s.useState();if((0,e.useEffect)(()=>{s.buildDebugDashboard()},[s,n,E]),(0,e.useEffect)(()=>s.subscribeToIframeLoadingMessage(),[s]),!n)return null;const S=[{label:"Snapshot",value:de.Support},{label:"Data",value:de.Data}];return e.createElement(gt.d,{title:"Get help with this panel",width:"90%",onClose:a,expandable:!0,scrollableContent:!0,subtitle:e.createElement(Se.Stack,{direction:"column",gap:1},e.createElement(Se.Stack,{direction:"row",gap:1},e.createElement(En.a,{featureState:mt.CQ.beta}),e.createElement("a",{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",target:"blank",className:"external-link",rel:"noopener noreferrer"},"Troubleshooting docs ",e.createElement(K.J,{name:"external-link-alt"}))),e.createElement("span",{className:"muted"},"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings.")),tabs:e.createElement(Be.J,null,S.map((O,at)=>e.createElement(ie.O,{key:`${O.value}-${at}`,label:O.label,active:O.value===i,onChangeTab:()=>s.onCurrentTabChange(O.value)})))},l&&e.createElement(bn.$,null),c&&e.createElement(_.b,{title:c.title},c.message),i===de.Data&&e.createElement("div",{className:r.code},e.createElement("div",{className:r.opts},e.createElement(le.g,{label:"Template",className:r.field},e.createElement(ht.Ph,{options:p,value:u,onChange:s.onShowMessageChange})),u===De.GithubComment?e.createElement(We.m,{icon:"copy",getText:s.onGetMarkdownForClipboard},"Copy to clipboard"):e.createElement(C.zx,{icon:"download-alt",onClick:s.onDownloadDashboard},"Download (",g,")")),e.createElement(Ce.Z,{disableWidth:!0},({height:O})=>e.createElement(yn.p,{width:"100%",height:O,language:u===De.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:u===De.GithubComment?f:h,readOnly:!1,onBlur:s.onSetSnapshotText}))),i===de.Support&&e.createElement(e.Fragment,null,e.createElement(le.g,{label:"Randomize data",description:"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal."},e.createElement(A.Lh,null,e.createElement(ne.x,{label:"Labels",id:"randomize-labels",showLabel:!0,value:Boolean(E.labels),onChange:()=>s.onToggleRandomize("labels")}),e.createElement(ne.x,{label:"Field names",id:"randomize-field-names",showLabel:!0,value:Boolean(E.names),onChange:()=>s.onToggleRandomize("names")}),e.createElement(ne.x,{label:"String values",id:"randomize-string-values",showLabel:!0,value:Boolean(E.values),onChange:()=>s.onToggleRandomize("values")}))),e.createElement(le.g,{label:"Support snapshot",description:`Panel: ${y}`},e.createElement(Se.Stack,null,e.createElement(C.zx,{icon:"download-alt",onClick:s.onDownloadDashboard},"Dashboard (",g,")"),e.createElement(We.m,{icon:"github",getText:s.onGetMarkdownForClipboard,title:"Copy a complete GitHub comment to the clipboard"},"Copy to clipboard"),e.createElement(C.zx,{onClick:s.onPreviewDashboard,variant:"secondary",title:"Open support snapshot dashboard in a new tab"},"Preview"))),e.createElement(Ce.Z,{disableWidth:!0},({height:O})=>e.createElement(e.Fragment,null,e.createElement("iframe",{title:"Support snapshot preview",src:`${P.v.appUrl}dashboard/new?orgId=${oe.Vt.user.orgId}&kiosk&${L}`,width:"100%",height:O-100,frameBorder:"0",style:{display:d?"block":"none",marginTop:16}}),!d&&e.createElement("div",null,"\xA0")))))}const On=t=>({code:m.css`
    flex-grow: 1;
    height: 100%;
    overflow: scroll;
  `,field:m.css`
    width: 100%;
  `,opts:m.css`
    display: flex;
    display: flex;
    width: 100%;
    flex-grow: 0;
    align-items: center;
    justify-content: flex-end;

    button {
      margin-left: 8px;
    }
  `});var wn=o(49922);const Ve=(t,n,a)=>{const r=(0,e.useRef)(),[s,i]=(0,e.useState)();return(0,e.useEffect)(()=>{let l=-1,c=0;return r.current=t.getQueryRunner().getData(n).subscribe({next:d=>{if(a){if(l===d.structureRev){const p=Date.now();if(p-c<1e4)return;c=p}l=d.structureRev??-1}i(d)}}),()=>{r.current&&r.current.unsubscribe()}},[t,n.withFieldConfig,n.withTransforms]),{data:s,error:s&&s.error,isLoading:s?s.state===wn.Gu.Loading:!0,hasSeries:s?!!s.series:!1}};var Nn=o(69934),Z=o(35287),Rn=o(21957),In=o(46835),Mn=o(18893);const An=({data:t,metadataDatasource:n})=>!n||!n.components?.MetadataInspector?e.createElement(Z.cC,{i18nKey:"dashboard.inspect-meta.no-inspector"},"No Metadata Inspector"):e.createElement(n.components.MetadataInspector,{datasource:n,data:t.series});var $n=o(82090),Ln=o(72062);const Un=({panel:t,plugin:n,dashboard:a,tabs:r,data:s,isDataLoading:i,dataOptions:l,metadataDatasource:c,defaultTab:d,onDataOptionsChange:p,onClose:u})=>{const[g,f]=(0,e.useState)(d??N.q.Data);if(!n)return null;const h=s?.error;let E=g;r.find(S=>S.value===g)||(E=N.q.JSON);const y=(0,Nn.J)().replace(t.title,t.scopedVars,"text")||"Panel",L=(0,Z.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:y});return e.createElement(gt.d,{title:L,subtitle:s&&zn(s),width:"50%",onClose:u,expandable:!0,scrollableContent:!0,tabs:e.createElement(Be.J,null,r.map((S,O)=>e.createElement(ie.O,{key:`${S.value}-${O}`,label:S.label,active:S.value===E,onChangeTab:()=>f(S.value||N.q.Data)})))},E===N.q.Data&&e.createElement(Rn.E,{panel:t,data:s&&s.series,isLoading:i,options:l,onOptionsChange:p,timeZone:a.timezone,app:mt.zj.Dashboard}),s&&E===N.q.Meta&&e.createElement(An,{data:s,metadataDatasource:c}),E===N.q.JSON&&e.createElement(Mn.W,{panel:t,dashboard:a,data:s,onClose:u}),E===N.q.Error&&e.createElement(In.l,{error:h}),s&&E===N.q.Stats&&e.createElement($n.f,{data:s,timeZone:a.getTimezone()}),s&&E===N.q.Query&&e.createElement(Ln.D,{panel:t,data:s.series,onRefreshQuery:()=>t.refresh()}))};function zn(t){const{request:n}=t;if(!n)return"";const a=n.targets.length,r=n.endTime?n.endTime-n.startTime:0,s=(0,Te.zc)((0,Te.Cf)("ms")(r));return e.createElement(Z.cC,{i18nKey:"dashboard.inspect.subtitle"},{queryCount:a}," queries with total query time of ",{formatted:s})}var Fn=o(50700),vt=o(77213),ke=o(13505);const Bn=t=>(0,Fn.Z)(async()=>{const a=t?.request?.targets||[];if(t&&t.series&&a.length){for(const r of t.series)if(r.meta&&r.meta.custom){const s=await(0,vt.F)().get(a[0].datasource);if(s&&s.components?.MetadataInspector)return s}}},[t]).value,Wn=(t,n,a,r,s)=>(0,e.useMemo)(()=>{const i=[];(0,ke.sY)(a)&&(i.push({label:(0,Z.t)("dashboard.inspect.data-tab","Data"),value:N.q.Data}),i.push({label:(0,Z.t)("dashboard.inspect.stats-tab","Stats"),value:N.q.Stats})),s&&i.push({label:(0,Z.t)("dashboard.inspect.meta-tab","Meta Data"),value:N.q.Meta}),i.push({label:(0,Z.t)("dashboard.inspect.json-tab","JSON"),value:N.q.JSON}),r&&r.message&&i.push({label:(0,Z.t)("dashboard.inspect.error-tab","Error"),value:N.q.Error});const l=window.grafanaPanelInspectActionSupplier;return l&&l.getActions(t)?.length&&i.push({label:(0,Z.t)("dashboard.inspect.actions-tab","Actions"),value:N.q.Actions}),n.meta.canEdit&&(0,ke.sY)(a)&&i.push({label:(0,Z.t)("dashboard.inspect.query-tab","Query"),value:N.q.Query}),i},[t,a,s,n,r]),Vn=({panel:t,dashboard:n,plugin:a})=>{const[r,s]=(0,e.useState)({withTransforms:!1,withFieldConfig:!0}),i=(0,se.TH)(),{data:l,isLoading:c,error:d}=Ve(t,r,!0),p=Bn(l),u=Wn(t,n,a,d,p),g=new URLSearchParams(i.search).get("inspectTab"),f=()=>{D.E1.partial({inspect:null,inspectTab:null})};return a?g===N.q.Help?e.createElement(Dn,{panel:t,plugin:a,onClose:f}):e.createElement(Un,{dashboard:n,panel:t,plugin:a,defaultTab:g,tabs:u,data:l,isDataLoading:c,dataOptions:r,onDataOptionsChange:s,metadataDatasource:p,onClose:f}):null},kn=(t,n)=>{const a=(0,Pe.i)(t,n.panel);return a?{plugin:a.plugin}:{plugin:null}},Hn=(0,R.connect)(kn)(Vn);var Et=o(95484),Oe=o(318),we=o(26408),Kn=o(93880),Zn=o(10129),Qn=o(82385),Gn=o(95379),bt=o(80177),jn=o(77582),ue=o(48756),Jn=o(22323),He=o(10672);const Yn=t=>{const n=(0,e.useMemo)(()=>Jn.z.get(t.variable.type).picker,[t.variable]);return t.variable?e.createElement("div",{className:"gf-form"},e.createElement(Xn,{variable:t.variable}),t.variable.hide!==He.bU.hideVariable&&n&&e.createElement(n,{variable:t.variable,readOnly:t.readOnly??!1})):e.createElement("div",null,"Couldn't load variable")};function Xn({variable:t}){const n=(0,e.useMemo)(()=>t.label||t.name,[t]);if(t.hide!==He.bU.dontHide)return null;const a=`var-${t.id}`;return t.description?e.createElement(ue.u,{content:t.description,placement:"bottom"},e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":v.wl.pages.Dashboard.SubMenu.submenuItemLabels(n),htmlFor:a},n)):e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":v.wl.pages.Dashboard.SubMenu.submenuItemLabels(n),htmlFor:a},n)}const yt=({variables:t,readOnly:n})=>{const[a,r]=(0,e.useState)([]);return(0,e.useEffect)(()=>{r(t.filter(s=>s.hide!==He.bU.hideVariable))},[t]),a.length===0?null:e.createElement(e.Fragment,null,a.map(s=>e.createElement("div",{key:s.id,className:"submenu-item gf-form-inline","data-testid":v.wl.pages.Dashboard.SubMenu.submenuItem},e.createElement(Yn,{variable:s,readOnly:n}))))};var qn=o(54294),_n=o(81283),pe=o(6297),Ke=o(87095),ea=o(61802),ta=o(37877),na=o(7196),Pt=o(79230),me=o(49938),Ct=o(37210);function aa(t,n){ze.Z.set(`panel-edit-section-${t}`,n?"true":"false")}function ra(t,n){return ze.Z.getBool(`panel-edit-section-${t}`,n)}const St=(t,n)=>({angularPanelComponent:(0,Pe.i)(t,n.panel)?.angularComponent}),Tt={changePanelPlugin:be.Kc},Ls=(0,R.connect)(St,Tt);class sa extends e.PureComponent{constructor(n){super(n)}componentDidMount(){this.loadAngularOptions()}componentDidUpdate(n){(this.props.plugin!==n.plugin||this.props.angularPanelComponent!==n.angularPanelComponent)&&this.cleanUpAngularOptions(),this.loadAngularOptions()}componentWillUnmount(){this.cleanUpAngularOptions()}cleanUpAngularOptions(){this.angularOptions&&(this.angularOptions.destroy(),this.angularOptions=null)}loadAngularOptions(){const{panel:n,angularPanelComponent:a,changePanelPlugin:r}=this.props;if(!this.element||!a||this.angularOptions)return;const s=a.getScope();if(!s.$$childHead){setTimeout(()=>{this.forceUpdate()});return}const i=s.$$childHead.ctrl;i.initEditMode(),i.onPluginTypeChange=p=>{r({panel:n,pluginId:p.id})};let l="";for(let p=0;p<i.editorTabs.length;p++){const u=i.editorTabs[p];u.isOpen=ra(u.title,p===0),l+=`
      <div class="panel-options-group" ng-cloak>
        <div class="panel-options-group__header" ng-click="toggleOptionGroup(${p})" aria-label="${u.title} section">
          <div class="panel-options-group__icon">
            <icon name="ctrl.editorTabs[${p}].isOpen ? 'angle-down' : 'angle-right'"></icon>
          </div>
          <div class="panel-options-group__title">${u.title}</div>
        </div>
        <div class="panel-options-group__body" ng-if="ctrl.editorTabs[${p}].isOpen">
          <panel-editor-tab editor-tab="ctrl.editorTabs[${p}]" ctrl="ctrl"></panel-editor-tab>
        </div>
      </div>
      `}const c=(0,Ct.w)(),d={ctrl:i,toggleOptionGroup:p=>{const u=i.editorTabs[p];u.isOpen=!u.isOpen,aa(u.title,Boolean(u.isOpen))}};this.angularOptions=c.load(this.element,d,l),this.angularOptions.digest()}render(){return e.createElement("div",{ref:n=>this.element=n})}}const oa=(0,R.connect)(St,Tt)(sa);var Ze=o(91183),Ne=o(68061),xt=o(46090),Dt=o(4955),Re=o(64703),ia=o(47846),la=o.n(ia),ca=o(38835),da=o(24123),Ie=o(20017);const ua=({property:t,context:n,registry:a,onChange:r,onRemove:s,isSystemOverride:i,searchQuery:l})=>{const c=(0,b.wW)(pa),d=a?.getIfExists(t.id);if(!d)return null;const p=Array.isArray(t.value)||t.id===Ne.qb.Thresholds||t.id===Ne.qb.Links||t.id===Ne.qb.Mappings,u=d.category?.filter(h=>h!==d.name);let g;const f=(h=!0,E=!1)=>(y=!1)=>e.createElement(A.Lh,{justify:"space-between"},e.createElement(ca._,{category:u,description:h?d.description:void 0},e.createElement(la(),{textToHighlight:d.name,searchWords:[l],highlightClassName:"search-fragment-highlight"}),!y&&E&&d.getItemsCount&&e.createElement(da.A,{value:d.getItemsCount(t.value)})),!i&&e.createElement("div",null,e.createElement(Ie.h,{name:"times",onClick:s})));return p?g=e.createElement(Ze.u,{id:d.name,renderTitle:f(!1,!0),className:m.css`
          padding-left: 0;
          padding-right: 0;
        `,isNested:!0,isOpenDefault:t.value!==void 0},e.createElement(d.override,{value:t.value,onChange:h=>{r(h)},item:d,context:n})):g=e.createElement("div",null,e.createElement(le.g,{label:f()(),description:d.description},e.createElement(d.override,{value:t.value,onChange:h=>{r(h)},item:d,context:n}))),e.createElement("div",{className:(0,m.cx)(p&&c.collapsibleOverrideEditor,!p&&"dynamicConfigValueEditor--nonCollapsible")},g)},pa=t=>({collapsibleOverrideEditor:m.css`
      label: collapsibleOverrideEditor;
      & + .dynamicConfigValueEditor--nonCollapsible {
        margin-top: ${t.spacing(1)};
      }
    `});var ee=o(91752),B=o(66352);const Ot=({isExpanded:t,registry:n,matcherUi:a,overrideName:r,override:s,onOverrideRemove:i})=>{const l=(0,b.wW)(ma),d=s.properties.map(u=>n.getIfExists(u.id)).filter(u=>!!u).map(u=>u?.name).join(", "),p=a.optionsToLabel(s.matcher.options);return e.createElement("div",null,e.createElement(A.Lh,{justify:"space-between"},e.createElement("div",null,r),e.createElement(Ie.h,{name:"trash-alt",onClick:i,title:"Remove override"})),!t&&e.createElement("div",{className:l.overrideDetails},e.createElement("div",{className:l.options,title:p},p," ",e.createElement(K.J,{name:"angle-right"})," ",d)))};Ot.displayName="OverrideTitle";const ma=t=>({matcherUi:m.css`
      padding: ${t.spacing(1)};
    `,propertyPickerWrapper:m.css`
      margin-top: ${t.spacing(2)};
    `,overrideDetails:m.css`
      font-size: ${t.typography.bodySmall.fontSize};
      color: ${t.colors.text.secondary};
      font-weight: ${t.typography.fontWeightRegular};
    `,options:m.css`
      overflow: hidden;
      padding-right: ${t.spacing(4)};
    `,unknownLabel:m.css`
      margin-bottom: 0;
    `});function ga(t,n){const a=[],r=t.panel.fieldConfig,s=t.plugin.fieldConfigRegistry,i=t.data?.series??[];if(s.isEmpty())return[];const l=(u,g)=>{let f=(0,H.cloneDeep)(r.overrides);f[u]=g,t.onFieldConfigsChange({...r,overrides:f})},c=u=>{let g=(0,H.cloneDeep)(r.overrides);g.splice(u,1),t.onFieldConfigsChange({...r,overrides:g})},d=u=>{t.onFieldConfigsChange({...r,overrides:[...r.overrides,{matcher:{id:u.value},properties:[]}]})},p={data:i,getSuggestions:u=>(0,Re.PW)(i,u),isOverride:!0};for(let u=0;u<r.overrides.length;u++){const g=r.overrides[u],f=`Override ${u+1}`,h=xt.i.get(g.matcher.id),E=ha(s),y=(0,Ne.v3)(g),L=g.properties.length===0?1:0,S=new ee.j({title:f,id:f,forceOpen:L,renderTitle:function(Y){return e.createElement(Ot,{override:g,isExpanded:Y,registry:s,overrideName:f,matcherUi:h,onOverrideRemove:()=>c(u)})}}),O=$=>{g.matcher.options=$,l(u,g)},at=($,Y)=>{const ge=s.get(Y.value),Le={id:ge.id,value:ge.defaultValue};g.properties?$.properties.push(Le):$.properties=[Le],l(u,$)};S.addItem(new B.a({title:h.name,render:function(){return e.createElement(h.component,{id:`${h.matcher.id}-${u}`,matcher:h.matcher,data:t.data?.series??[],options:g.matcher.options,onChange:O})}}));for(let $=0;$<g.properties.length;$++){const Y=g.properties[$],ge=s.getIfExists(Y.id);if(!ge)continue;const Le=nn=>{g.properties[$].value=nn,l(u,g)},$s=()=>{g.properties.splice($,1),l(u,g)};S.addItem(new B.a({title:ge.name,skipField:!0,render:function(){return e.createElement(ua,{key:`${Y.id}/${$}`,isSystemOverride:y,onChange:Le,onRemove:$s,property:Y,registry:s,context:p,searchQuery:n})}}))}!y&&g.matcher.options&&S.addItem(new B.a({title:"----------",skipField:!0,render:function(){return e.createElement(Dt.b,{key:"Add override property",label:"Add override property",variant:"secondary",isFullWidth:!0,icon:"plus",menuPlacement:"auto",options:E,onChange:Y=>at(g,Y)})}})),a.push(S)}return a.push(new ee.j({title:"add button",id:"add button",customRender:function(){return e.createElement(fa,{key:"Add override"},e.createElement(Dt.b,{icon:"plus",label:"Add field override",variant:"secondary",menuPlacement:"auto",isFullWidth:!0,size:"md",options:xt.i.list().filter(g=>!g.excludeFromPicker).map(g=>({label:g.name,value:g.id,description:g.description})),onChange:g=>d(g)}))}})),a}function ha(t){return t.list().filter(n=>!n.hideFromOverrides).map(n=>{let a=n.name;return n.category&&(a=[...n.category,n.name].join(" > ")),{label:a,value:n.id,description:n.description}})}function fa({children:t}){const n=(0,b.wW)(va);return e.createElement("div",{className:n},t)}function va(t){return(0,m.css)({borderTop:`1px solid ${t.colors.border.weak}`,padding:`${t.spacing(2)}`,display:"flex"})}const Ea=({panel:t,formatDate:n})=>{const a=(0,b.wW)(ba),r=t.libraryPanel?.meta;return r?e.createElement("div",{className:a.info},e.createElement("div",{className:a.libraryPanelInfo},`Used on ${r.connectedDashboards} `,r.connectedDashboards===1?"dashboard":"dashboards"),e.createElement("div",{className:a.libraryPanelInfo},"Last edited on ",n?.(r.updated,"L")??r.updated," by",r.updatedBy.avatarUrl&&e.createElement("img",{width:"22",height:"22",className:a.userAvatar,src:r.updatedBy.avatarUrl,alt:`Avatar for ${r.updatedBy.name}`}),r.updatedBy.name)):null},ba=t=>({info:m.css`
      line-height: 1;
    `,libraryPanelInfo:m.css`
      color: ${t.colors.text.secondary};
      font-size: ${t.typography.bodySmall.fontSize};
    `,userAvatar:m.css`
      border-radius: 50%;
      box-sizing: content-box;
      width: 22px;
      height: 22px;
      padding-left: ${t.spacing(1)};
      padding-right: ${t.spacing(1)};
    `});function ya(t){const{panel:n,onPanelConfigChange:a,dashboard:r}=t,s=new ee.j({title:"Library panel options",id:"Library panel options",isOpenDefault:!0});return(0,pe.V)(n)&&s.addItem(new B.a({title:"Name",value:n.libraryPanel.name,popularRank:1,render:function(){return e.createElement(Ee.I,{id:"LibraryPanelFrameName",defaultValue:n.libraryPanel.name,onBlur:l=>a("libraryPanel",{...n.libraryPanel,name:l.currentTarget.value})})}})).addItem(new B.a({title:"Information",render:function(){return e.createElement(Ea,{panel:n,formatDate:r.formatDate})}})),s}var Pa=o(79090),Ca=o(27376),Sa=o(21599);function Ta(t){const{panel:n,onPanelConfigChange:a}=t;return new ee.j({title:"Panel options",id:"Panel options",isOpenDefault:!0}).addItem(new B.a({title:"Title",value:n.title,popularRank:1,render:function(){return e.createElement(Ee.I,{id:"PanelFrameTitle",defaultValue:n.title,onBlur:i=>a("title",i.currentTarget.value)})}})).addItem(new B.a({title:"Description",description:n.description,value:n.description,render:function(){return e.createElement(Pa.K,{id:"description-text-area",defaultValue:n.description,onBlur:i=>a("description",i.currentTarget.value)})}})).addItem(new B.a({title:"Transparent background",render:function(){return e.createElement(ne.r,{value:n.transparent,id:"transparent-background",onChange:i=>a("transparent",i.currentTarget.checked)})}})).addCategory(new ee.j({title:"Panel links",id:"Panel links",isOpenDefault:!1,itemsCount:n.links?.length}).addItem(new B.a({title:"Panel links",render:function(){return e.createElement(Ca.d,{links:n.links,onChange:i=>a("links",i),getSuggestions:Re.PR,data:[]})}}))).addCategory(new ee.j({title:"Repeat options",id:"Repeat options",isOpenDefault:!1}).addItem(new B.a({title:"Repeat by variable",description:"Repeat this panel for each value in the selected variable. This is not visible while in edit mode. You need to go back to dashboard and then update the variable or reload the dashboard.",render:function(){return e.createElement(Sa.X,{id:"repeat-by-variable-select",repeat:n.repeat,onChange:i=>{a("repeat",i)}})}})).addItem(new B.a({title:"Repeat direction",showIf:()=>!!n.repeat,render:function(){const i=[{label:"Horizontal",value:"h"},{label:"Vertical",value:"v"}];return e.createElement(Oe.S,{options:i,value:n.repeatDirection||"h",onChange:l=>a("repeatDirection",l)})}})).addItem(new B.a({title:"Max per row",showIf:()=>Boolean(n.repeat&&n.repeatDirection==="h"),render:function(){const i=[2,3,4,6,8,12].map(l=>({label:l.toString(),value:l}));return e.createElement(ht.Ph,{options:i,value:n.maxPerRow,onChange:l=>a("maxPerRow",l.value)})}})))}var xa=o(57054);class Da{constructor(n,a){this.categories=n,this.overrides=a}search(n){const a=new RegExp(n,"i"),s=this.collectHits(this.categories,a,[]).sort(wt).map(c=>c.item),l=this.collectHits(this.overrides,a,[]).sort(wt).map(c=>c.item);return{optionHits:s,overrideHits:this.buildOverrideHitCategories(l),totalCount:this.getAllOptionsCount(this.categories)}}collectHits(n,a,r){for(const s of n){const i=a.test(s.props.title);for(const l of s.items){if(a.test(l.props.title)){r.push({item:l,rank:1});continue}if(l.props.description&&a.test(l.props.description)){r.push({item:l,rank:2});continue}i&&r.push({item:l,rank:3})}s.categories.length>0&&this.collectHits(s.categories,a,r)}return r}getAllOptionsCount(n){let a=0;for(const r of n)a+=r.items.length,r.categories.length>0&&(a+=this.getAllOptionsCount(r.categories));return a}buildOverrideHitCategories(n){const a={};for(const r of n){let s=a[r.parent.props.title];s||(s=a[r.parent.props.title]=new ee.j(r.parent.props),s.addItem(r.parent.items[0])),s.items[0].props.title!==r.props.title&&s.addItem(r)}return Object.values(a)}}function wt(t,n){return t.rank-n.rank}function Oa(t){const n=[];for(const a of t)for(const r of a.items)r.props.title==="Unit"&&(r.props.popularRank=2),r.props.title==="Min"&&(r.props.popularRank=3),r.props.title==="Max"&&(r.props.popularRank=4),r.props.title==="Display name"&&(r.props.popularRank=5),r.props.popularRank&&n.push(r);return n.sort((a,r)=>a.props.popularRank-r.props.popularRank)}const wa=t=>{const{plugin:n,dashboard:a,panel:r}=t,[s,i]=(0,e.useState)(""),[l,c]=(0,e.useState)(J.All),d=(0,b.wW)(Ia),[p,u,g]=(0,e.useMemo)(()=>[Ta(t),(0,xa.AL)(t),ya(t)],[r.configRev,t.data,t.instanceState,s]),f=(0,e.useMemo)(()=>ga(t,s),[r.configRev,t.data,t.instanceState,s]),h=[],E=s.length>0,y=(0,e.useMemo)(Na,[]),L=(0,pe.V)(r)?[g,p,...u]:[p,...u];if(E)h.push(Ra(L,f,s)),t.plugin.angularPanelCtrl&&h.push(e.createElement("div",{className:d.searchNotice,key:"Search notice"},"This is an old visualization type that does not support searching all options."));else switch(l){case J.All:(0,pe.V)(r)&&h.push(g.render()),h.push(p.render()),t.plugin.angularPanelCtrl&&h.push(e.createElement(oa,{plugin:n,dashboard:a,panel:r,key:"AngularOptions"}));for(const O of u)h.push(O.render());for(const O of f)h.push(O.render());break;case J.Overrides:for(const O of f)h.push(O.render());break;case J.Recent:h.push(e.createElement(Ze.u,{id:"Recent options",title:"Recent options",key:"Recent options",forceOpen:1},Oa(L).map(O=>O.render())));break}const S=!E&&!n.fieldConfigRegistry.isEmpty();return e.createElement("div",{className:d.wrapper},e.createElement("div",{className:d.formBox},e.createElement("div",{className:d.formRow},e.createElement(Pt.H,{width:0,value:s,onChange:i,placeholder:"Search options"})),S&&e.createElement("div",{className:d.formRow},e.createElement(Oe.S,{options:y,value:l,fullWidth:!0,onChange:c}))),e.createElement("div",{className:d.scrollWrapper},e.createElement(me.$,{autoHeightMin:"100%"},e.createElement("div",{className:d.mainBox},h))))};function Na(){return[{label:J.All,value:J.All},{label:J.Overrides,value:J.Overrides}]}var J=(t=>(t.All="All",t.Overrides="Overrides",t.Recent="Recent",t))(J||{});function Ra(t,n,a){const r=new Da(t,n),{optionHits:s,totalCount:i,overrideHits:l}=r.search(a);return e.createElement("div",{key:"search results"},e.createElement(Ze.u,{id:"Found options",title:`Matched ${s.length}/${i} options`,key:"Normal options",forceOpen:1},s.map(c=>c.render(a))),l.map(c=>c.render(a)))}const Ia=t=>({wrapper:m.css`
    height: 100%;
    display: flex;
    flex-direction: column;
    flex: 1 1 0;

    .search-fragment-highlight {
      color: ${t.colors.warning.text};
      background: transparent;
    }
  `,searchBox:m.css`
    display: flex;
    flex-direction: column;
    min-height: 0;
  `,formRow:m.css`
    margin-bottom: ${t.spacing(1)};
  `,formBox:m.css`
    padding: ${t.spacing(1)};
    background: ${t.colors.background.primary};
    border: 1px solid ${t.components.panel.borderColor};
    border-top-left-radius: ${t.shape.borderRadius(1.5)};
    border-bottom: none;
  `,closeButton:m.css`
    margin-left: ${t.spacing(1)};
  `,searchHits:m.css`
    padding: ${t.spacing(1,1,0,1)};
  `,scrollWrapper:m.css`
    flex-grow: 1;
    min-height: 0;
  `,searchNotice:m.css`
    font-size: ${t.typography.size.sm};
    color: ${t.colors.text.secondary};
    padding: ${t.spacing(1)};
    text-align: center;
  `,mainBox:m.css`
    background: ${t.colors.background.primary};
    border: 1px solid ${t.components.panel.borderColor};
    border-top: none;
    flex-grow: 1;
  `});var Ma=o(75952),Aa=o(35974);const Nt=t=>n=>n.plugins.panels[t]||(0,Aa.X)(`Panel plugin not found (${t})`,!0),Qe=({panel:t})=>{const n=(0,T.useDispatch)(),a=(0,T.useSelector)(Nt(t.type)),r=(0,T.useSelector)(c=>c.panelEditor.ui.isPanelOptionsVisible),s=(0,T.useSelector)(c=>c.panelEditor.isVizPickerOpen),i=()=>{n((0,j.g_)(!s))},l=()=>{n(Fe({isPanelOptionsVisible:!r}))};return a?e.createElement("div",{className:Rt.wrapper},e.createElement(Ma.h,null,e.createElement(we.h,{className:Rt.vizButton,tooltip:"Click to change visualization",imgSrc:a.meta.info.logos.small,isOpen:s,onClick:i,"aria-label":v.wl.components.PanelEditor.toggleVizPicker,variant:"canvas",fullWidth:!0},a.meta.name),e.createElement(we.h,{tooltip:r?"Close options pane":"Show options pane",icon:r?"angle-right":"angle-left",onClick:l,variant:"canvas","aria-label":v.wl.components.PanelEditor.toggleVizOptions}))):null};Qe.displayName="VisualizationTab";const Rt={wrapper:m.css`
    display: flex;
    flex-direction: column;
  `,vizButton:m.css`
    text-align: left;
  `};var $a=o(24664),La=o(84952),Ua=o(9398),za=o(53708),Fa=o(76647),It=o(81202);const Ba=({onConfirm:t,onDismiss:n,panel:a})=>{const r=(0,pe.V)(a),s=`${r?"Changing":"Replace with"} library panel`,i=`${r?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return e.createElement(It.s,{onConfirm:t,onDismiss:n,confirmText:r?"Change":"Replace",title:s,body:i,dismissText:"Cancel",isOpen:!0})};var Wa=o(18027);const Va=({panel:t,searchQuery:n})=>{const[a,r]=(0,e.useState)(!1),[s,i]=(0,e.useState)(void 0),[l,c]=(0,e.useState)([]),d=(0,e.useCallback)(E=>{c(E.map(y=>y.id))},[c]),p=(0,Ua.h4)().getCurrent(),u=(0,T.useDispatch)(),g=async()=>{s&&(i(void 0),u((0,be.ih)(t,s)))},f=()=>r(!0),h=()=>i(void 0);return e.createElement(A.wc,{spacing:"md"},!t.libraryPanel&&e.createElement(A.wc,{align:"center"},e.createElement(C.zx,{icon:"plus",onClick:f,variant:"secondary",fullWidth:!0},"Create new library panel")),e.createElement(za.j,{onChange:d}),e.createElement("div",{className:ka.libraryPanelsView},e.createElement(Wa.u,{currentPanelId:t.libraryPanel?.uid,searchString:n,panelFilter:l,onClickCard:i,showSecondaryActions:!0})),a&&e.createElement(Fa.c,{panel:t,onDismiss:()=>r(!1),initialFolderUid:p?.meta.folderUid,isOpen:a}),s&&e.createElement(Ba,{panel:t,onDismiss:h,onConfirm:g}))},ka={libraryPanelsView:m.css`
    width: 100%;
  `};var Ge=o(20251),Ha=o(38490);const Ka=["timeseries","barchart","gauge","stat","piechart","bargauge","table","state-timeline","status-history","logs","candlestick"];async function Za(t,n){const a=new Ge.mi(t,n);for(const s of Ka){const l=(await(0,Ha.Ub)(s)).getSuggestionsSupplier();l&&l.getSuggestionsForData(a)}const r=a.getList();if(a.dataSummary.fieldCount===0)for(const s of Object.values(P.v.panels))!s.skipDataQuery||s.hideFromList||r.push({name:s.name,pluginId:s.id,description:s.info.description,cardOptions:{imgSrc:s.info.logos.small}});return r.sort((s,i)=>(i.score??Ge._.OK)-(s.score??Ge._.OK))}var Mt=o(98141);function Qa({data:t,suggestion:n,onChange:a,width:r}){const s=(0,b.wW)(Ga),{innerStyles:i,outerStyles:l,renderWidth:c,renderHeight:d}=ja(r),p=n.cardOptions??{},u={"aria-label":n.name,className:s.vizBox,"data-testid":v.wl.components.VisualizationPreview.card(n.name),style:l,onClick:()=>{a({pluginId:n.pluginId,options:n.options,fieldConfig:n.fieldConfig})}};if(p.imgSrc)return e.createElement(ue.u,{content:n.description??n.name},e.createElement("button",{...u,className:(0,m.cx)(s.vizBox,s.imgBox)},e.createElement("div",{className:s.name},n.name),e.createElement("img",{className:s.img,src:p.imgSrc,alt:n.name})));let g=n;return n.cardOptions?.previewModifier&&(g=(0,H.cloneDeep)(n),n.cardOptions.previewModifier(g)),e.createElement("button",{...u},e.createElement(ue.u,{content:n.name},e.createElement("div",{style:i,className:s.renderContainer},e.createElement(Mt.$,{title:"",data:t,pluginId:n.pluginId,width:c,height:d,options:g.options,fieldConfig:g.fieldConfig}),e.createElement("div",{className:s.hoverPane}))))}const Ga=t=>({hoverPane:(0,m.css)({position:"absolute",top:0,right:0,left:0,borderRadius:t.spacing(2),bottom:0}),vizBox:m.css`
      position: relative;
      background: none;
      border-radius: ${t.shape.borderRadius(1)};
      cursor: pointer;
      border: 1px solid ${t.colors.border.medium};

      transition: ${t.transitions.create(["background"],{duration:t.transitions.duration.short})};

      &:hover {
        background: ${t.colors.background.secondary};
      }
    `,imgBox:m.css`
      display: flex;
      flex-direction: column;
      height: 100%;

      justify-self: center;
      color: ${t.colors.text.primary};
      width: 100%;
      display: flex;

      justify-content: center;
      align-items: center;
      text-align: center;
    `,name:m.css`
      padding-bottom: ${t.spacing(.5)};
      margin-top: ${t.spacing(-1)};
      font-size: ${t.typography.bodySmall.fontSize};
      white-space: nowrap;
      overflow: hidden;
      color: ${t.colors.text.secondary};
      font-weight: ${t.typography.fontWeightMedium};
      text-overflow: ellipsis;
    `,img:m.css`
      max-width: ${t.spacing(8)};
      max-height: ${t.spacing(8)};
    `,renderContainer:m.css`
      position: absolute;
      transform-origin: left top;
      top: 6px;
      left: 6px;
    `});function ja(t){const a=t,r=t*(1/1.6),s=350,i=s*(1/1.6),l=6,c=(a-l*2)/s,d=(r-l*2)/i;return{renderHeight:i,renderWidth:s,outerStyles:{width:a,height:r},innerStyles:{width:s,height:i,transform:`scale(${c}, ${d})`}}}function Ja({onChange:t,data:n,panel:a,searchQuery:r}){const s=(0,b.wW)(Xa),{value:i}=(0,ve.Z)(()=>Za(n,a),[n,a]),l=Ya(r,i);return e.createElement(Ce.Z,{disableHeight:!0,style:{width:"100%",height:"100%"}},({width:c})=>{if(!c)return null;const d=Math.floor(c/170),p=8*(d-1),u=(c-p)/d;return e.createElement("div",null,e.createElement("div",{className:s.filterRow},e.createElement("div",{className:s.infoText},"Based on current data")),e.createElement("div",{className:s.grid,style:{gridTemplateColumns:`repeat(auto-fill, ${u-1}px)`}},l.map((g,f)=>e.createElement(Qa,{key:f,data:n,suggestion:g,onChange:t,width:u})),r&&l.length===0&&e.createElement("div",{className:s.infoText},"No results matched your query")))})}function Ya(t,n){if(!t||!n)return n||[];const a=new RegExp(t,"i");return n.filter(r=>a.test(r.name)||a.test(r.pluginId))}const Xa=t=>({heading:(0,m.css)({...t.typography.h5,margin:t.spacing(0,.5,1)}),filterRow:(0,m.css)({display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",paddingBottom:"8px"}),infoText:(0,m.css)({fontSize:t.typography.bodySmall.fontSize,color:t.colors.text.secondary,fontStyle:"italic"}),grid:(0,m.css)({display:"grid",gridGap:t.spacing(1),gridTemplateColumns:"repeat(auto-fill, 144px)",marginBottom:t.spacing(1),justifyContent:"space-evenly"})});var qa=o(42682),At=o(13440),_a=o(89710);const $t=({isCurrent:t,plugin:n,onClick:a,disabled:r})=>e.createElement(_a.X,{title:n.name,plugin:n,description:n.info.description,onClick:a,isCurrent:t,disabled:r,showBadge:!0});$t.displayName="VizTypePickerPlugin";function er({searchQuery:t,onChange:n,current:a,data:r}){const s=(0,b.wW)(tr),i=(0,e.useMemo)(()=>(0,At.x)(),[]),l=(0,e.useMemo)(()=>(0,At.r)(i,t,a),[a,i,t]);return l.length===0?e.createElement(qa.K,null,"Could not find anything matching your query"):e.createElement("div",{className:s.grid},l.map((c,d)=>e.createElement($t,{disabled:!1,key:c.id,isCurrent:c.id===a.id,plugin:c,onClick:p=>n({pluginId:c.id,withModKey:Boolean(p.metaKey||p.ctrlKey||p.altKey)})})))}const tr=t=>({grid:m.css`
      max-width: 100%;
      display: grid;
      grid-gap: ${t.spacing(.5)};
    `,heading:(0,m.css)({...t.typography.h5,margin:t.spacing(0,.5,1)})});var x=o(16200);const Lt=({panel:t,data:n})=>{const a=(0,T.useSelector)(Nt(t.type)),[r,s]=(0,e.useState)(""),[i,l]=(0,$a.Z)(La.FL,x.Ok.Visualizations),c=(0,T.useDispatch)(),d=(0,b.wW)(nr),p=(0,e.useRef)(null),u=(0,e.useCallback)(h=>{c((0,be.Kc)({panel:t,...h})),h.withModKey||c((0,j.g_)(!1))},[c,t]),g=()=>{c((0,j.g_)(!1))};if(!a)return null;const f=[{label:"Visualizations",value:x.Ok.Visualizations},{label:"Suggestions",value:x.Ok.Suggestions},{label:"Library panels",value:x.Ok.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}];return e.createElement("div",{className:d.openWrapper},e.createElement("div",{className:d.formBox},e.createElement("div",{className:d.searchRow},e.createElement(Pt.H,{value:r,onChange:s,ref:p,autoFocus:!0,placeholder:"Search for..."}),e.createElement(C.zx,{title:"Close",variant:"secondary",icon:"angle-up",className:d.closeButton,"aria-label":v.wl.components.PanelEditor.toggleVizPicker,onClick:g})),e.createElement(le.g,{className:d.customFieldMargin},e.createElement(Oe.S,{options:f,value:i,onChange:l,fullWidth:!0}))),e.createElement("div",{className:d.scrollWrapper},e.createElement(me.$,{autoHeightMin:"100%"},e.createElement("div",{className:d.scrollContent},i===x.Ok.Visualizations&&e.createElement(er,{current:a.meta,onChange:u,searchQuery:r,data:n,onClose:()=>{}}),i===x.Ok.Suggestions&&e.createElement(Ja,{current:a.meta,onChange:u,searchQuery:r,panel:t,data:n,onClose:()=>{}}),i===x.Ok.LibraryPanels&&e.createElement(Va,{searchQuery:r,panel:t,key:"Panel Library"})))))};Lt.displayName="VisualizationSelectPane";const nr=t=>({icon:m.css`
      color: ${t.v1.palette.gray33};
    `,wrapper:m.css`
      display: flex;
      flex-direction: column;
      flex: 1 1 0;
      height: 100%;
    `,vizButton:m.css`
      text-align: left;
    `,scrollWrapper:m.css`
      flex-grow: 1;
      min-height: 0;
    `,scrollContent:m.css`
      padding: ${t.spacing(1)};
    `,openWrapper:m.css`
      display: flex;
      flex-direction: column;
      flex: 1 1 100%;
      height: 100%;
      background: ${t.colors.background.primary};
      border: 1px solid ${t.colors.border.weak};
    `,searchRow:m.css`
      display: flex;
      margin-bottom: ${t.spacing(1)};
    `,closeButton:m.css`
      margin-left: ${t.spacing(1)};
    `,customFieldMargin:m.css`
      margin-bottom: ${t.spacing(1)};
    `,formBox:m.css`
      padding: ${t.spacing(1)};
      padding-bottom: 0;
    `}),ar=({plugin:t,panel:n,onFieldConfigsChange:a,onPanelOptionsChanged:r,onPanelConfigChange:s,dashboard:i,instanceState:l})=>{const c=(0,b.wW)(rr),d=(0,T.useSelector)(u=>u.panelEditor.isVizPickerOpen),{data:p}=Ve(n,{withTransforms:!0,withFieldConfig:!1},!0);return e.createElement("div",{className:c.wrapper,"aria-label":v.wl.components.PanelEditor.OptionsPane.content},!d&&e.createElement(e.Fragment,null,e.createElement("div",{className:c.vizButtonWrapper},e.createElement(Qe,{panel:n})),e.createElement("div",{className:c.optionsWrapper},e.createElement(wa,{panel:n,dashboard:i,plugin:t,instanceState:l,data:p,onFieldConfigsChange:a,onPanelOptionsChanged:r,onPanelConfigChange:s}))),d&&e.createElement(Lt,{panel:n,data:p}))},rr=t=>({wrapper:m.css`
      height: 100%;
      width: 100%;
      display: flex;
      flex: 1 1 0;
      flex-direction: column;
      padding: 0;
    `,optionsWrapper:m.css`
      flex-grow: 1;
      min-height: 0;
    `,vizButtonWrapper:m.css`
      padding: 0 ${t.spacing(2,2)} 0;
    `,legacyOptions:m.css`
      label: legacy-options;
      .panel-options-grid {
        display: flex;
        flex-direction: column;
      }
      .panel-options-group {
        margin-bottom: 0;
      }
      .panel-options-group__body {
        padding: ${t.spacing(2)} 0;
      }

      .section {
        display: block;
        margin: ${t.spacing(2)} 0;

        &:first-child {
          margin-top: 0;
        }
      }
    `});var Ut=o(1821),sr=o(86016),or=o(2476),ir=o(53821);function lr({width:t,height:n,panel:a,dashboard:r}){const{data:s}=Ve(a,{withTransforms:!0,withFieldConfig:!1},!1),[i,l]=(0,e.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});return(0,e.useEffect)(()=>{const c=(0,ce.$t)(),d=a.events.subscribe(Ut.U5,()=>{const p=(0,or.W1)(a,c.timeRange());a.runAllPanelQueries({dashboardId:r.id,dashboardUID:r.uid,dashboardTimezone:r.getTimezone(),timeData:p,width:t})});return()=>{d.unsubscribe()}},[a,r,t]),s?e.createElement(sr.fm,{width:t,height:n,padding:"none"},(c,d)=>e.createElement(e.Fragment,null,e.createElement(ir.Z,{panel:a,error:s?.error?.message}),e.createElement(Mt.$,{title:"Raw data",pluginId:"table",width:c,height:d,data:s,options:i,onOptionsChange:l}))):null}var zt=o(80313),je=o(84666),cr=o(51142),dr=o(85081),ur=o(69142);function Ft({message:t}){const n=(0,e.useCallback)(()=>{D.E1.partial({tab:x.Ip.Query})},[]);return e.createElement(A.Ar,{justify:"center",style:{marginTop:"100px"}},e.createElement(A.wc,{spacing:"md"},e.createElement("h2",null,t),e.createElement("div",null,e.createElement(C.zx,{size:"md",variant:"secondary",icon:"arrow-left",onClick:n},"Go back to Queries"))))}var Je=o(47214),pr=o(91252),Bt=o(67162);class mr extends e.PureComponent{constructor(){super(...arguments),this.state={stateHistoryItems:[]},this.clearHistory=async()=>{const{dashboard:n,panelId:a,onRefresh:r}=this.props;await(0,Je.i)().post("/api/annotations/mass-delete",{dashboardId:n.id,panelId:a}),this.setState({stateHistoryItems:[]}),r()}}componentDidMount(){const{dashboard:n,panelId:a}=this.props;(0,Je.i)().get(`/api/annotations?dashboardId=${n.id}&panelId=${a}&limit=50&type=alert`,{},`state-history-${n.id}-${a}`).then(r=>{const s=r.map(i=>({stateModel:Bt.Z.getStateDisplayModel(i.newState),time:n.formatDate(i.time,"MMM D, YYYY HH:mm:ss"),info:Bt.Z.getAlertAnnotationInfo(i)}));this.setState({stateHistoryItems:s})})}render(){const{stateHistoryItems:n}=this.state;return e.createElement("div",null,n.length>0&&e.createElement("div",{className:"p-b-1"},e.createElement("span",{className:"muted"},"Last 50 state changes"),e.createElement(pr.p,{onConfirm:this.clearHistory,confirmVariant:"destructive",confirmText:"Clear"},e.createElement(C.zx,{className:m.css`
                  direction: ltr;
                `,variant:"destructive",icon:"trash-alt"},"Clear history"))),e.createElement("ol",{className:"alert-rule-list"},n.length>0?n.map((a,r)=>e.createElement("li",{className:"alert-rule-item",key:`${a.time}-${r}`},e.createElement("div",{className:`alert-rule-item__icon ${a.stateModel.stateClass}`},e.createElement(K.J,{name:a.stateModel.iconClass,size:"xl"})),e.createElement("div",{className:"alert-rule-item__body"},e.createElement("div",{className:"alert-rule-item__header"},e.createElement("p",{className:"alert-rule-item__name"},a.alertName),e.createElement("div",{className:"alert-rule-item__text"},e.createElement("span",{className:`${a.stateModel.stateClass}`},a.stateModel.text))),a.info),e.createElement("div",{className:"alert-rule-item__time"},a.time))):e.createElement("i",null,"No state changes recorded")))}}const gr=mr;var Wt=o(90090),Ye=o(16558);class hr extends e.PureComponent{constructor(){super(...arguments),this.state={isLoading:!1,allNodesExpanded:null,testRuleResponse:{}},this.setFormattedJson=n=>{this.formattedJson=n},this.getTextForClipboard=()=>JSON.stringify(this.formattedJson,null,2),this.onToggleExpand=()=>{this.setState(n=>({...n,allNodesExpanded:!this.state.allNodesExpanded}))},this.getNrOfOpenNodes=()=>this.state.allNodesExpanded===null?3:this.state.allNodesExpanded?20:1,this.renderExpandCollapse=()=>{const{allNodesExpanded:n}=this.state,a=e.createElement(e.Fragment,null,e.createElement(K.J,{name:"minus-circle"})," Collapse All"),r=e.createElement(e.Fragment,null,e.createElement(K.J,{name:"plus-circle"})," Expand All");return n?a:r}}componentDidMount(){this.testRule()}async testRule(){const{dashboard:n,panel:a}=this.props,r=n.getSaveModelClone();r.panels=r.panels.map(l=>l.id===a.id?a.getSaveModel():l);const s={dashboard:r,panelId:a.id};this.setState({isLoading:!0});const i=await(0,Je.i)().post("/api/alerts/test",s);this.setState({isLoading:!1,testRuleResponse:i})}render(){const{testRuleResponse:n,isLoading:a}=this.state;if(a===!0)return e.createElement(Wt.u,{text:"Evaluating rule"});const r=this.getNrOfOpenNodes();return e.createElement(e.Fragment,null,e.createElement("div",{className:"pull-right"},e.createElement(A.Lh,{spacing:"md"},e.createElement("div",{onClick:this.onToggleExpand},this.renderExpandCollapse()),e.createElement(We.m,{getText:this.getTextForClipboard,icon:"copy"},"Copy to Clipboard"))),e.createElement(Ye.g,{json:n,open:r,onDidRender:this.setFormattedJson}))}}var fr=o(44927);class vr extends e.PureComponent{constructor(){super(...arguments),this.state={validationMessage:"",showStateHistory:!1,showDeleteConfirmation:!1,showTestRule:!1},this.onAngularPanelUpdated=()=>{this.forceUpdate()},this.onAddAlert=()=>{this.panelCtrl?._enableAlert(),this.component?.digest(),this.forceUpdate()},this.onToggleModal=n=>{const a=this.state[n];this.setState({...this.state,[n]:!a})},this.renderTestRule=()=>{if(!this.state.showTestRule)return null;const{panel:n,dashboard:a}=this.props,r=()=>this.onToggleModal("showTestRule");return e.createElement(te.u,{isOpen:!0,icon:"bug",title:"Testing rule",onDismiss:r,onClickBackdrop:r},e.createElement(hr,{panel:n,dashboard:a}))},this.renderDeleteConfirmation=()=>{if(!this.state.showDeleteConfirmation)return null;const{panel:n}=this.props,a=()=>this.onToggleModal("showDeleteConfirmation");return e.createElement(It.s,{isOpen:!0,icon:"trash-alt",title:"Delete",body:e.createElement("div",null,"Are you sure you want to delete this alert rule?",e.createElement("br",null),e.createElement("small",null,"You need to save dashboard for the delete to take effect.")),confirmText:"Delete alert",onDismiss:a,onConfirm:()=>{delete n.alert,n.thresholds=[],this.panelCtrl&&(this.panelCtrl.alertState=null,this.panelCtrl.render()),this.component?.digest(),a()}})},this.renderStateHistory=()=>{if(!this.state.showStateHistory)return null;const{panel:n,dashboard:a}=this.props,r=()=>this.onToggleModal("showStateHistory");return e.createElement(te.u,{isOpen:!0,icon:"history",title:"State history",onDismiss:r,onClickBackdrop:r},e.createElement(gr,{dashboard:a,panelId:n.id,onRefresh:()=>this.panelCtrl?.refresh()}))}}async componentDidMount(){P.v.angularSupportEnabled?(await o.e(5718).then(o.bind(o,30789)),this.loadAlertTab()):alert("Angular support disabled, legacy alerting cannot function without angular support")}componentDidUpdate(n){this.loadAlertTab()}componentWillUnmount(){this.component&&this.component.destroy()}async loadAlertTab(){const{panel:n,angularPanelComponent:a}=this.props;if(!this.element||this.component)return;if(a){const c=a.getScope();if(!c.$$childHead){setTimeout(()=>{this.forceUpdate()});return}this.panelCtrl=c.$$childHead.ctrl}else this.panelCtrl=this.getReactAlertPanelCtrl();const r=(0,Ct.w)(),s="<alert-tab />",i={ctrl:this.panelCtrl};this.component=r.load(this.element,i,s);const l=await(0,fr.E)(n.transformations,n.targets,(0,vt.F)(),n.datasource);l&&this.setState({validationMessage:l})}getReactAlertPanelCtrl(){return{panel:this.props.panel,events:new dr.F,render:()=>{this.props.panel.render()}}}render(){const{alert:n,transformations:a}=this.props.panel,{validationMessage:r}=this.state,s=a&&a.length>0;if(!n&&r)return e.createElement(Ft,{message:r});const i={title:"Panel has no alert rule defined",buttonIcon:"bell",onClick:this.onAddAlert,buttonTitle:"Create Alert"};return e.createElement(e.Fragment,null,e.createElement(me.$,{autoHeightMin:"100%"},e.createElement(A.W2,{padding:"md"},e.createElement("div",{"aria-label":v.wl.components.AlertTab.content},n&&s&&e.createElement(_.b,{severity:T.AppNotificationSeverity.Error,title:"Transformations are not supported in alert queries"}),e.createElement("div",{ref:l=>this.element=l}),n&&e.createElement(A.Lh,null,e.createElement(C.zx,{onClick:()=>this.onToggleModal("showStateHistory"),variant:"secondary"},"State history"),e.createElement(C.zx,{onClick:()=>this.onToggleModal("showTestRule"),variant:"secondary"},"Test rule"),e.createElement(C.zx,{onClick:()=>this.onToggleModal("showDeleteConfirmation"),variant:"destructive"},"Delete")),!n&&!r&&e.createElement(ur.Z,{...i})))),this.renderTestRule(),this.renderDeleteConfirmation(),this.renderStateHistory())}}const Er=(t,n)=>({angularPanelComponent:(0,Pe.i)(t,n.panel)?.angularComponent}),br={},yr=(0,R.connect)(Er,br)(vr);var Pr=o(27677),Cr=o(184),Sr=o(41904),Tr=o(21767);const Vt=({dashboard:t,panel:n,className:a})=>{const r=(0,T.useSelector)(d=>d.templating),s=(0,se.TH)(),{loading:i,value:l}=(0,ve.Z)(()=>(0,Tr.aR)(n,t),[n,t,r]);if(i)return e.createElement(C.zx,{disabled:!0},"Create alert rule from this panel");if(!l)return e.createElement(_.b,{severity:"info",title:"No alerting capable query found"},"Cannot create alerts from this panel because no query to an alerting capable datasource is found.");const c=Pr.Cj.renderUrl("alerting/new",{defaults:JSON.stringify(l),returnTo:s.pathname+s.search});return e.createElement(C.Qj,{icon:"bell",onClick:()=>(0,Cr.PN)(Sr.z7.alertRuleFromPanel),href:c,className:a,"data-testid":"create-alert-rule-button"},"Create alert rule from this panel")};var xr=o(25048),kt=o(72004),Xe=o(37190),ae=o(45849),Ht=o(46818),Dr=o(61627),Kt=o(79370);function Zt({dashboard:t,panel:n,poll:a=!1}){const r=(0,T.useDispatch)(),s=(0,Kt._)(u=>u.promRules[ae.GC])??Ht.oq,i=(0,Kt._)(u=>u.rulerRules[ae.GC])??Ht.oq;(0,e.useEffect)(()=>{const u=()=>{r((0,kt.y6)({rulesSourceName:ae.GC,filter:{dashboardUID:t.uid,panelId:n.id}})),r((0,kt.UR)({rulesSourceName:ae.GC,filter:{dashboardUID:t.uid,panelId:n.id}}))};if(u(),a){const g=setInterval(u,Xe.p4);return()=>{clearInterval(g)}}return()=>{}},[r,a,n.id,t.uid]);const l=s.loading||i.loading,c=[s.error,i.error].filter(u=>!!u),d=(0,Dr.Zo)(ae.GC);return{rules:(0,e.useMemo)(()=>d.flatMap(u=>u.groups).flatMap(u=>u.rules).filter(u=>u.annotations[Xe.q6.dashboardUID]===t.uid&&u.annotations[Xe.q6.panelID]===String(n.id)),[d,t,n]),errors:c,loading:l}}var Qt=o(97953);const Or=({dashboard:t,panel:n})=>{const a=(0,b.wW)(wr),{errors:r,loading:s,rules:i}=Zt({dashboard:t,panel:n,poll:!0}),l=(0,Qt.Bz)("grafana"),c=oe.Vt.hasPermission(l.create),d=r.length?e.createElement(_.b,{title:"Errors loading rules",severity:"error"},r.map((p,u)=>e.createElement("div",{key:u},"Failed to load Grafana rules state: ",p.message||"Unknown error."))):null;return s&&!i.length?e.createElement("div",{className:a.innerWrapper},d,e.createElement(Wt.u,{text:"Loading rules..."})):i.length?e.createElement(me.$,{autoHeightMin:"100%"},e.createElement("div",{className:a.innerWrapper},d,e.createElement(xr.i,{rules:i}),!!t.meta.canSave&&c&&e.createElement(Vt,{className:a.newButton,panel:n,dashboard:t}))):e.createElement("div",{"aria-label":v.wl.components.PanelAlertTabContent.content,className:a.noRulesWrapper},d,!!t.uid&&e.createElement(e.Fragment,null,e.createElement("p",null,"There are no alert rules linked to this panel."),!!t.meta.canSave&&c&&e.createElement(Vt,{panel:n,dashboard:t})),!t.uid&&!!t.meta.canSave&&e.createElement(_.b,{severity:"info",title:"Dashboard not saved"},"Dashboard must be saved before alerts can be added."))},wr=t=>({newButton:m.css`
    margin-top: ${t.spacing(3)};
  `,innerWrapper:m.css`
    padding: ${t.spacing(2)};
  `,noRulesWrapper:m.css`
    margin: ${t.spacing(2)};
    background-color: ${t.colors.background.secondary};
    padding: ${t.spacing(3)};
  `}),Nr=P.v.unifiedAlertingEnabled?Or:yr,Rr=({panel:t,dashboard:n,...a})=>{const{rules:r,loading:s}=Zt({panel:t,dashboard:n});return e.createElement(ie.O,{...a,counter:s?null:r.length})};var Gt=o(19677),qe=o(20256),Me=o(80548),Ae=o(66208),Ir=o(59796);const Mr={[Me.x.Transformations]:"https://grafana.com/docs/grafana/latest/panels/transformations",[Me.x.FieldConfig]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/",[Me.x.FieldConfigOverrides]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/#override-a-field"},Ar=t=>Mr[t];var jt=o(81731),Jt=o(86253),$r=o(19117),$e=o(1029),Lr=o(67254),Ur=o(98356),_e=o(79720);const zr=({debugMode:t,index:n,data:a,uiConfig:r,configs:s,onChange:i})=>{const l=(0,b.wW)(Fr),[c,d]=(0,e.useState)([]),[p,u]=(0,e.useState)([]),g=(0,e.useMemo)(()=>s[n],[s,n]);(0,e.useEffect)(()=>{const h=s.slice(0,n).map(S=>S.transformation),E=s.slice(n,n+1).map(S=>S.transformation),y=(0,_e.H)(h,a).subscribe(d),L=(0,_e.H)(h,a).pipe((0,Ur.z)(S=>(0,_e.H)(E,S))).subscribe(u);return function(){y.unsubscribe(),L.unsubscribe()}},[n,a,s]);const f=(0,e.useMemo)(()=>e.createElement(r.editor,{options:{...r.transformation.defaultOptions,...g.transformation.options},input:c,onChange:h=>{i(n,{id:g.transformation.id,options:h})}}),[r.editor,r.transformation.defaultOptions,g.transformation.options,g.transformation.id,c,i,n]);return e.createElement("div",{className:l.editor,"aria-label":v.wl.components.TransformTab.transformationEditor(r.name)},f,t&&e.createElement("div",{className:l.debugWrapper,"aria-label":v.wl.components.TransformTab.transformationEditorDebugger(r.name)},e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Transformation input data"),e.createElement("div",{className:l.debugJson},e.createElement(Ye.g,{json:c}))),e.createElement("div",{className:l.debugSeparator},e.createElement(K.J,{name:"arrow-right"})),e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Transformation output data"),e.createElement("div",{className:l.debugJson},p&&e.createElement(Ye.g,{json:p})))))},Fr=t=>{const n=t.isLight?t.v1.palette.gray85:t.v1.palette.gray15;return{title:m.css`
      display: flex;
      padding: 4px 8px 4px 8px;
      position: relative;
      height: 35px;
      border-radius: 4px 4px 0 0;
      flex-wrap: nowrap;
      justify-content: space-between;
      align-items: center;
    `,name:m.css`
      font-weight: ${t.typography.fontWeightMedium};
      color: ${t.colors.primary.text};
    `,iconRow:m.css`
      display: flex;
    `,icon:m.css`
      background: transparent;
      border: none;
      box-shadow: none;
      cursor: pointer;
      color: ${t.colors.text.secondary};
      margin-left: ${t.spacing(1)};
      &:hover {
        color: ${t.colors.text};
      }
    `,editor:m.css``,debugWrapper:m.css`
      display: flex;
      flex-direction: row;
    `,debugSeparator:m.css`
      width: 48px;
      min-height: 300px;
      display: flex;
      align-items: center;
      align-self: stretch;
      justify-content: center;
      margin: 0 ${t.spacing(.5)};
      color: ${t.colors.primary.text};
    `,debugTitle:m.css`
      padding: ${t.spacing(1)} ${t.spacing(.25)};
      font-family: ${t.typography.fontFamilyMonospace};
      font-size: ${t.typography.bodySmall.fontSize};
      color: ${t.colors.text};
      border-bottom: 1px solid ${n};
      flex-grow: 0;
      flex-shrink: 1;
    `,debug:m.css`
      margin-top: ${t.spacing(1)};
      padding: 0 ${t.spacing(1,1,1)};
      border: 1px solid ${n};
      background: ${t.isLight?t.v1.palette.white:t.v1.palette.gray05};
      border-radius: ${t.shape.borderRadius(1)};
      width: 100%;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-self: stretch;
    `,debugJson:m.css`
      flex-grow: 1;
      height: 100%;
      overflow: hidden;
      padding: ${t.spacing(.5)};
    `}},Br=({onRemove:t,index:n,id:a,data:r,configs:s,uiConfig:i,onChange:l})=>{const[c,d]=(0,Jt.Z)(!1),[p,u]=(0,Jt.Z)(!1),g=s[n].transformation.disabled,f=(0,e.useCallback)(E=>{const y=s[E].transformation;l(E,{...y,disabled:y.disabled?void 0:!0})},[l,s]),h=({isOpen:E})=>e.createElement(A.Lh,{align:"center",width:"auto"},i.state&&e.createElement(jt.u,{state:i.state}),e.createElement($e.y,{title:"Show/hide transform help",icon:"info-circle",onClick:u,active:p}),e.createElement($e.y,{title:"Debug",disabled:!E,icon:"bug",onClick:d,active:c}),e.createElement($e.y,{title:"Disable/Enable transformation",icon:g?"eye-slash":"eye",onClick:()=>f(n),active:g}),e.createElement($e.y,{title:"Remove",icon:"trash-alt",onClick:()=>t(n)}));return e.createElement(Lr.t,{id:a,index:n,title:i.name,draggable:!0,actions:h,disabled:g},p&&e.createElement($r.h,{markdown:Wr(i)}),e.createElement(zr,{debugMode:c,index:n,data:r,configs:s,uiConfig:i,onChange:l}))};function Wr(t){return`
${t.help??t.description}

Go the <a href="https://grafana.com/docs/grafana/latest/panels/transformations/?utm_source=grafana" target="_blank" rel="noreferrer">
transformation documentation
</a> for more.
`}const Vr=({data:t,onChange:n,onRemove:a,configs:r})=>e.createElement(e.Fragment,null,r.map((s,i)=>{const l=qe.Z.getIfExists(s.transformation.id);return l?e.createElement(Br,{index:i,id:`${s.id}`,key:`${s.id}`,data:t,configs:r,uiConfig:l,onRemove:a,onChange:n}):null})),kr="dashboard.components.TransformationEditor.featureInfoBox.isDismissed";class Hr extends e.PureComponent{constructor(n){super(n),this.onSearchChange=s=>{this.setState({search:s.target.value})},this.onSearchKeyDown=s=>{if(s.key==="Enter"){const{search:i}=this.state;if(i){const l=i.toLowerCase(),c=qe.Z.list().filter(d=>(d.name+d.description).toLowerCase().indexOf(l)>=0);c.length>0&&this.onTransformationAdd({value:c[0].id})}}else s.keyCode===27&&(this.setState({search:"",showPicker:!1}),s.stopPropagation())},this.getTransformationNextId=s=>{const{transformations:i}=this.state;let l=0;const c=i.filter(d=>d.id.startsWith(s)).map(d=>d.id);return c.length!==0&&(l=Math.max(...c.map(d=>parseInt(d.match(/\d+/)[0],10)))+1),`${s}-${l}`},this.onTransformationAdd=s=>{const{transformations:i}=this.state,l=this.getTransformationNextId(s.value);this.setState({search:"",showPicker:!1}),this.onChange([...i,{id:l,transformation:{id:s.value,options:{}}}])},this.onTransformationChange=(s,i)=>{const{transformations:l}=this.state,c=Array.from(l);c[s].transformation=i,this.onChange(c)},this.onTransformationRemove=s=>{const{transformations:i}=this.state,l=Array.from(i);l.splice(s,1),this.onChange(l)},this.onDragEnd=s=>{const{transformations:i}=this.state;if(!s||!s.destination)return;const l=s.source.index,c=s.destination.index;if(l===c)return;const d=Array.from(i),[p]=d.splice(l,1);d.splice(c,0,p),this.onChange(d)},this.renderTransformationEditors=()=>{const{data:s,transformations:i}=this.state;return e.createElement(Gt.Z5,{onDragEnd:this.onDragEnd},e.createElement(Gt.bK,{droppableId:"transformations-list",direction:"vertical"},l=>e.createElement("div",{ref:l.innerRef,...l.droppableProps},e.createElement(Vr,{configs:i,data:s,onRemove:this.onTransformationRemove,onChange:this.onTransformationChange}),l.placeholder)))};const a=n.panel.transformations||[],r=this.buildTransformationIds(a);this.state={transformations:a.map((s,i)=>({transformation:s,id:r[i]})),data:[],search:""}}buildTransformationIds(n){const a={},r=[];for(let s=0;s<n.length;s++){const i=n[s];a[i.id]===void 0?a[i.id]=0:a[i.id]+=1,r.push(`${n[s].id}-${a[n[s].id]}`)}return r}componentDidMount(){this.subscription=this.props.panel.getQueryRunner().getData({withTransforms:!1,withFieldConfig:!1}).subscribe({next:n=>this.setState({data:n.series})})}componentWillUnmount(){this.subscription&&this.subscription.unsubscribe()}onChange(n){this.setState({transformations:n}),this.props.panel.setTransformations(n.map(a=>a.transformation))}renderTransformsPicker(){const{transformations:n,search:a}=this.state;let r=null,s=qe.Z.list().sort((c,d)=>c.name>d.name?1:d.name>c.name?-1:0);if(a){const c=a.toLowerCase(),d=s.filter(p=>(p.name+p.description).toLowerCase().indexOf(c)>=0);r=e.createElement(e.Fragment,null,d.length," / ",s.length," \xA0\xA0",e.createElement(Ie.h,{name:"times",onClick:()=>{this.setState({search:""})}})),s=d}const i=!n?.length,l=i||this.state.showPicker;return!r&&l&&!i&&(r=e.createElement(Ie.h,{name:"times",onClick:()=>{this.setState({showPicker:!1})}})),e.createElement(e.Fragment,null,i&&e.createElement(A.W2,{grow:1},e.createElement(Ir.G,{storageKey:kr,defaultValue:!1},(c,d)=>c?null:e.createElement(_.b,{title:"Transformations",severity:"info",onRemove:()=>{d(!0)}},e.createElement("p",null,"Transformations allow you to join, calculate, re-order, hide, and rename your query results before they are visualized. ",e.createElement("br",null),"Many transforms are not suitable if you're using the Graph visualization, as it currently only supports time series data. ",e.createElement("br",null),"It can help to switch to the Table visualization to understand what a transformation is doing."," "),e.createElement("a",{href:Ar(Me.x.Transformations),className:"external-link",target:"_blank",rel:"noreferrer"},"Read more")))),l?e.createElement(A.wc,null,e.createElement(Ee.I,{"aria-label":v.wl.components.Transforms.searchInput,value:a??"",autoFocus:!i,placeholder:"Add transformation",onChange:this.onSearchChange,onKeyDown:this.onSearchKeyDown,suffix:r}),s.map(c=>e.createElement(Kr,{key:c.name,transform:c,onClick:()=>{this.onTransformationAdd({value:c.id})}}))):e.createElement(C.zx,{icon:"plus",variant:"secondary",onClick:()=>{this.setState({showPicker:!0})}},"Add transformation"))}render(){const{panel:{alert:n}}=this.props,{transformations:a}=this.state,r=a.length>0;return!r&&n?e.createElement(Ft,{message:"Transformations can't be used on a panel with existing alerts"}):e.createElement(me.$,{autoHeightMin:"100%"},e.createElement(A.W2,{padding:"md"},e.createElement("div",{"aria-label":v.wl.components.TransformTab.content},r&&n?e.createElement(_.b,{severity:T.AppNotificationSeverity.Error,title:"Transformations can't be used on a panel with alerts"}):null,r&&this.renderTransformationEditors(),this.renderTransformsPicker())))}}function Kr({transform:t,onClick:n}){const a=(0,b.wW)(Zr);return e.createElement(Ae.Z,{className:a.card,"aria-label":v.wl.components.TransformTab.newTransform(t.name),onClick:n},e.createElement(Ae.Z.Heading,null,t.name),e.createElement(Ae.Z.Description,null,t.description),t.state&&e.createElement(Ae.Z.Tags,null,e.createElement(jt.u,{state:t.state})))}const Zr=t=>({card:m.css`
      margin: 0;
      padding: ${t.spacing(1)};
    `}),Qr=(0,b.Zz)(Hr);var Gr=o(5916),Yt=o(91162),jr=o(98016);class Jr extends e.PureComponent{constructor(n){super(n),this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{D.E1.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=a=>{const{panel:r}=this.props;r.updateQueries(a),a.dataSource.uid!==r.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(n){const a=n.datasource??{default:!0},r=(0,Yt.ak)().getInstanceSettings(a);return{cacheTimeout:r?.meta.queryOptions?.cacheTimeout?n.cacheTimeout:void 0,dataSource:{default:r?.isDefault,type:r?.type,uid:r?.uid},queries:n.targets,maxDataPoints:n.maxDataPoints,minInterval:n.interval,savedQueryUid:n.savedQueryLink?.ref.uid??null,timeRange:{from:n.timeFrom,shift:n.timeShift,hide:n.hideTimeOverride}}}async componentDidMount(){const{panel:n}=this.props;if(!n.datasource){const a=(0,Yt.ak)().getInstanceSettings(null);n.datasource=(0,Gr.iU)(a),this.forceUpdate()}}render(){const{panel:n}=this.props;if(!n.datasource)return null;const a=this.buildQueryOptions(n);return e.createElement(jr.D,{options:a,queryRunner:n.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const Xt=e.memo(({panel:t,dashboard:n,tabs:a,onChangeTab:r})=>{const s=(0,zt.N)(),i=(0,b.wW)(Xr);(0,e.useEffect)(()=>{const c=new Et.w0;return c.add(t.events.subscribe(I.pO,s)),c.add(t.events.subscribe(I.Xw,s)),()=>c.unsubscribe()},[t,n,s]);const l=a.find(c=>c.active);return a.length===0?null:e.createElement("div",{className:i.wrapper},e.createElement(Be.J,{className:i.tabBar,hideBorder:!0},a.map(c=>c.id===x.Ip.Alert?Yr(c,t,n,r):e.createElement(ie.O,{key:c.id,label:c.text,active:c.active,onChangeTab:()=>r(c),icon:(0,je.toIconName)(c.icon),counter:qt(t,c)}))),e.createElement(cr.I,{className:i.tabContent},l.id===x.Ip.Query&&e.createElement(Jr,{panel:t,queries:t.targets}),l.id===x.Ip.Alert&&e.createElement(Nr,{panel:t,dashboard:n}),l.id===x.Ip.Transform&&e.createElement(Qr,{panel:t})))});Xt.displayName="PanelEditorTabs";function qt(t,n){switch(n.id){case x.Ip.Query:return t.targets.length;case x.Ip.Alert:return t.alert?1:0;case x.Ip.Transform:return(t.getTransformations()??[]).length}return null}function Yr(t,n,a,r){return!P.v.alertingEnabled&&!P.v.unifiedAlertingEnabled?null:P.v.unifiedAlertingEnabled?e.createElement(Rr,{key:t.id,label:t.text,active:t.active,onChangeTab:()=>r(t),icon:(0,je.toIconName)(t.icon),panel:n,dashboard:a}):P.v.alertingEnabled?e.createElement(ie.O,{key:t.id,label:t.text,active:t.active,onChangeTab:()=>r(t),icon:(0,je.toIconName)(t.icon),counter:qt(n,t)}):null}const Xr=t=>({wrapper:m.css`
      display: flex;
      flex-direction: column;
      height: 100%;
    `,tabBar:m.css`
      padding-left: ${t.spacing(2)};
    `,tabContent:m.css`
      padding: 0;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      min-height: 0;
      background: ${t.colors.background.primary};
      border: 1px solid ${t.components.panel.borderColor};
      border-left: none;
      border-bottom: none;
      border-top-right-radius: ${t.shape.borderRadius(1.5)};
    `});var qr=o(58635),_r=o(47694);const es=(0,qr.Z)((t,n)=>{const a=[];if(!n)return a;let r=x.Ip.Visualize;if(n.meta.skipDataQuery)return[];n.meta.skipDataQuery||(r=x.Ip.Query,a.push({id:x.Ip.Query,text:"Query",icon:"database",active:!1}),a.push({id:x.Ip.Transform,text:"Transform",icon:"process",active:!1}));const{alertingEnabled:s,unifiedAlertingEnabled:i}=(0,_r.iE)(),l=oe.Vt.hasPermission((0,Qt.Bz)(ae.GC).read),c=s||i&&l,d=n.meta.id==="graph",p=n.meta.id==="timeseries";(c&&d||p)&&a.push({id:x.Ip.Alert,text:"Alert",icon:"bell",active:!1});const u=a.find(g=>g.id===(t||r))??a[0];return u.active=!0,a}),ts=(t,n)=>{const a=t.panelEditor.getPanel(),r=(0,Pe.i)(t,a);return{panel:a,plugin:r?.plugin,instanceState:r?.instanceState,initDone:t.panelEditor.initDone,uiState:t.panelEditor.ui,tableViewEnabled:t.panelEditor.tableViewEnabled,variables:(0,Ke.gt)(n.dashboard.uid,t)}},ns={initPanelEditor:dn,discardPanelChanges:lt,updatePanelEditorUIState:Fe,updateTimeZoneForSession:qn.YT,toggleTableView:j.OT,notifyApp:z.$l},as=(0,R.connect)(ts,ns);class rs extends e.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{D.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{jn.h$.publish(new I.Dn({component:na.d,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,pe.V)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=n=>{D.E1.partial({tab:n.id})},this.onFieldConfigChange=n=>{this.props.panel.updateFieldConfig({...n})},this.onPanelOptionsChanged=n=>{this.props.panel.updateOptions(n)},this.onPanelConfigChanged=(n,a)=>{this.props.panel.setProperty(n,a),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=n=>{const{updatePanelEditorUIState:a}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),a({mode:n})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{D.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:n,initDone:a}=this.props;a&&!this.eventSubs&&(this.eventSubs=new Et.w0,this.eventSubs.add(n.events.subscribe(I.Wj,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(n,a){const{dashboard:r,panel:s,uiState:i,tableViewEnabled:l,theme:c}=this.props;return e.createElement("div",{className:n.mainPaneWrapper,key:"panel"},this.renderPanelToolbar(n),e.createElement("div",{className:n.panelWrapper},e.createElement(Ce.Z,null,({width:d,height:p})=>{if(d<3||p<3)return null;if(a&&(p-=c.spacing.gridSize*2),l)return e.createElement(lr,{width:d,height:p,panel:s,dashboard:r});const u=(0,ke.jF)(i.mode,d,p,s);return e.createElement("div",{className:n.centeringContainer,style:{width:d,height:p}},e.createElement("div",{style:u,"data-panelid":s.id},e.createElement(ea.l,{key:s.key,stateKey:s.key,dashboard:r,panel:s,isEditing:!0,isViewing:!1,lazy:!1,width:u.width,height:u.height})))})))}renderPanelAndEditor(n,a){const{panel:r,dashboard:s,plugin:i,tab:l}=this.props,c=es(l,i),d=c.length===0,p=this.renderPanel(a,d);return c.length===0?e.createElement("div",{className:a.onlyPanel},p):e.createElement(bt.U,{splitOrientation:"horizontal",maxSize:-200,paneSize:n.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:u=>{u&&Fe({topPaneSize:u/window.innerHeight})}},p,e.createElement("div",{className:a.tabsWrapper,"aria-label":v.wl.components.PanelEditor.DataPane.content,key:"panel-editor-tabs"},e.createElement(Xt,{key:r.key,panel:r,dashboard:s,tabs:c,onChangeTab:this.onChangeTab})))}renderTemplateVariables(n){const{variables:a}=this.props;return a.length?e.createElement("div",{className:n.variablesWrapper},e.createElement(yt,{variables:a})):null}renderPanelToolbar(n){const{dashboard:a,uiState:r,variables:s,updateTimeZoneForSession:i,panel:l,tableViewEnabled:c}=this.props;return e.createElement("div",{className:n.panelToolbar},e.createElement(A.Lh,{justify:s.length>0?"space-between":"flex-end",align:"flex-start"},this.renderTemplateVariables(n),e.createElement(Se.Stack,{gap:1},e.createElement(ne.x,{label:"Table view",showLabel:!0,id:"table-view",value:c,onClick:this.onToggleTableView,"aria-label":v.wl.components.PanelEditor.toggleTableView}),e.createElement(Oe.S,{value:r.mode,options:x.d7,onChange:this.onDisplayModeChange}),e.createElement(ta.C,{dashboard:a,onChangeTimeZone:i,isOnCanvas:!0}),!r.isPanelOptionsVisible&&e.createElement(Qe,{panel:l}))))}renderEditorActions(){const n=P.v.featureToggles.topnav?"sm":"md";let a=[e.createElement(C.zx,{onClick:this.onDiscard,title:"Undo all changes",key:"discard",size:n,variant:"destructive",fill:"outline"},"Discard"),this.props.panel.libraryPanel?e.createElement(C.zx,{onClick:this.onSaveLibraryPanel,variant:"primary",size:n,title:"Apply changes and save library panel",key:"save-panel"},"Save library panel"):e.createElement(C.zx,{onClick:this.onSaveDashboard,title:"Apply changes and save dashboard",key:"save",size:n,variant:"secondary"},"Save"),e.createElement(C.zx,{onClick:this.onBack,variant:"primary",title:"Apply changes and go back to dashboard","data-testid":v.wl.components.PanelEditor.applyButton,key:"apply",size:n},"Apply")];return this.props.panel.libraryPanel&&(a.splice(1,0,e.createElement(st.JY,{key:"unlink-controller"},({showModal:r,hideModal:s})=>e.createElement(we.h,{onClick:()=>{r(_n.i,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:s,isOpen:!0})},title:"Disconnects this panel from the library panel so that you can edit it regularly.",key:"unlink"},"Unlink"))),a.pop()),a}renderOptionsPane(){const{plugin:n,dashboard:a,panel:r,instanceState:s}=this.props;return n?e.createElement(ar,{plugin:n,dashboard:a,panel:r,instanceState:s,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):e.createElement("div",null)}renderToolbar(){return P.v.featureToggles.topnav?e.createElement(Gn.A,{actions:e.createElement(Kn.R,{alignment:"right"},this.renderEditorActions())}):e.createElement(Zn.X,{title:this.props.dashboard.title,section:"Edit Panel",onGoBack:this.onGoBackToDashboard},this.renderEditorActions())}render(){const{initDone:n,uiState:a,theme:r,sectionNav:s,pageNav:i,className:l,updatePanelEditorUIState:c}=this.props,d=os(r,this.props);return n?e.createElement(M.T,{navModel:s,pageNav:i,"aria-label":v.wl.components.PanelEditor.General.content,layout:w.Qz.Custom,toolbar:this.renderToolbar(),className:l},e.createElement("div",{className:d.wrapper},e.createElement("div",{className:d.verticalSplitPanesWrapper},a.isPanelOptionsVisible?e.createElement(bt.U,{splitOrientation:"vertical",maxSize:-300,paneSize:a.rightPaneSize,primary:"second",onDragFinished:p=>{p&&c({rightPaneSize:p/window.innerWidth})}},this.renderPanelAndEditor(a,d),this.renderOptionsPane()):this.renderPanelAndEditor(a,d)),this.state.showSaveLibraryPanelModal&&e.createElement(ot,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel}))):null}}const ss=(0,b.HE)(as(rs)),os=(0,Qn.B)((t,n)=>{const{uiState:a}=n,r=t.spacing(2);return{wrapper:(0,m.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:P.v.featureToggles.topnav?t.spacing(2):0}),verticalSplitPanesWrapper:m.css`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      position: relative;
    `,mainPaneWrapper:m.css`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      padding-right: ${a.isPanelOptionsVisible?0:r};
    `,variablesWrapper:m.css`
      label: variablesWrapper;
      display: flex;
      flex-grow: 1;
      flex-wrap: wrap;
      gap: ${t.spacing(1,2)};
    `,panelWrapper:m.css`
      flex: 1 1 0;
      min-height: 0;
      width: 100%;
      padding-left: ${r};
    `,tabsWrapper:m.css`
      height: 100%;
      width: 100%;
    `,panelToolbar:m.css`
      display: flex;
      padding: 0 0 ${r} ${r};
      justify-content: space-between;
      flex-wrap: wrap;
    `,toolbarLeft:m.css`
      padding-left: ${t.spacing(1)};
    `,centeringContainer:m.css`
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      flex-direction: column;
    `,onlyPanel:m.css`
      height: 100%;
      position: absolute;
      overflow: hidden;
      width: 100%;
    `}});var is=o(9274),ls=o(71210),cs=o(48484),ds=o(87865);const us=({annotation:t,events:n,onEnabledChanged:a})=>{const[r,s]=(0,e.useState)(!1),i=(0,b.wW)(ps),l=()=>(0,ds.kt)().cancel(t);return(0,e.useEffect)(()=>{const c=n.getStream(I.z).subscribe({next:p=>{p.payload===t&&s(!0)}}),d=n.getStream(I.RB).subscribe({next:p=>{p.payload===t&&s(!1)}});return()=>{c.unsubscribe(),d.unsubscribe()}}),e.createElement("div",{key:t.name,className:i.annotation},e.createElement(is.Z,null,e.createElement(ls._,{label:t.name,disabled:r},e.createElement(ne.x,{value:t.enable,onChange:()=>a(t),disabled:r})),e.createElement("div",{className:i.indicator},e.createElement(cs.T,{loading:r,onCancel:l}))))};function ps(t){return{annotation:m.css`
      display: inline-block;
      margin-right: ${t.spacing(1)};

      .fa-caret-down {
        font-size: 75%;
        padding-left: ${t.spacing(1)};
      }

      .gf-form-inline .gf-form {
        margin-bottom: 0;
      }
    `,indicator:m.css`
      align-self: center;
      padding: 0 ${t.spacing(.5)};
    `}}const ms=({annotations:t,onAnnotationChanged:n,events:a})=>{const[r,s]=(0,e.useState)([]);return(0,e.useEffect)(()=>{s(t.filter(i=>i.hide!==!0))},[t]),r.length===0?null:e.createElement(e.Fragment,null,r.map(i=>e.createElement(us,{events:a,annotation:i,onEnabledChanged:n,key:i.name})))};var gs=o(58252),et=o(68004),hs=o(18428),fs=o(29930);const vs=t=>{const{link:n,linkInfo:a}=t,r=(0,e.useRef)(null),[s,i]=(0,e.useState)("invisible"),[l,c]=(0,e.useState)(0),d=Es(t,l),p=(0,b.wW)(Cs);return(0,e.useLayoutEffect)(()=>{i(Ps(r.current))},[d]),n.asDropdown?e.createElement(_t,{link:n,key:"dashlinks-dropdown","data-testid":v.wl.components.DashboardLinks.dropDown},e.createElement(e.Fragment,null,e.createElement(we.h,{onClick:()=>c(Date.now()),className:(0,m.cx)("gf-form-label gf-form-label--dashlink",p.button),"data-placement":"bottom","data-toggle":"dropdown","aria-expanded":!!l,"aria-controls":"dropdown-list","aria-haspopup":"menu"},e.createElement(K.J,{"aria-hidden":!0,name:"bars",className:p.iconMargin}),e.createElement("span",null,a.title)),e.createElement("ul",{id:"dropdown-list",className:`dropdown-menu ${p.dropdown} ${s}`,role:"menu",ref:r},d.length>0&&d.map((u,g)=>e.createElement("li",{role:"none",key:`dashlinks-dropdown-item-${u.uid}-${g}`},e.createElement("a",{role:"menuitem",href:u.url,target:n.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":v.wl.components.DashboardLinks.link,"aria-label":`${u.title} dashboard`},u.title)))))):e.createElement(e.Fragment,null,d.length>0&&d.map((u,g)=>e.createElement(_t,{link:n,key:`dashlinks-list-item-${u.uid}-${g}`,"data-testid":v.wl.components.DashboardLinks.container},e.createElement("a",{className:"gf-form-label gf-form-label--dashlink",href:u.url,target:n.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":v.wl.components.DashboardLinks.link,"aria-label":`${u.title} dashboard`},e.createElement(K.J,{"aria-hidden":!0,name:"apps",style:{marginRight:"4px"}}),e.createElement("span",null,u.title)))))},_t=t=>{const{link:n,children:a,...r}=t;return e.createElement("div",{...r,className:"gf-form"},n.tooltip&&e.createElement(ue.u,{content:n.tooltip},a),!n.tooltip&&e.createElement(e.Fragment,null,a))},Es=({link:t,dashboardUID:n},a)=>{const{tags:r}=t,s=(0,ve.Z)(()=>bs(r),[r,a]);return s.value?ys(n,t,s.value):[]};async function bs(t,n={getBackendSrv:fs.i}){return await n.getBackendSrv().search({tag:t,limit:100})}function ys(t,n,a,r={getLinkSrv:Re.Bq,sanitize:et.Nw,sanitizeUrl:et.Nm}){return a.filter(s=>s.uid!==t).map(s=>{const i=s.uid,l=r.sanitize(s.title),c=r.getLinkSrv().getLinkUrl({...n,url:s.url}),d=r.sanitizeUrl(c);return{uid:i,title:l,url:d}})}function Ps(t){if(!t)return"invisible";const n=t.parentElement.getBoundingClientRect(),a=t.getBoundingClientRect();return a.width===0?"invisible":n.left+a.width+10>window.innerWidth?"pull-left":"pull-right"}function Cs(t){return{iconMargin:(0,m.css)({marginRight:t.spacing(.5)}),dropdown:(0,m.css)({maxWidth:"max(30vw, 300px)",maxHeight:"70vh",overflowY:"auto",a:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}),button:(0,m.css)({color:t.colors.text.primary})}}const Ss=({dashboard:t,links:n})=>{const a=(0,zt.N)();return(0,gs.Z)(()=>{const r=t.events.subscribe(Ut.md,a);return()=>r.unsubscribe()}),n.length?e.createElement(e.Fragment,null,n.map((r,s)=>{const i=(0,Re.Bq)().getAnchorInfo(r),l=`${r.title}-$${s}`;if(r.type==="dashboards")return e.createElement(vs,{key:l,link:r,linkInfo:i,dashboardUID:t.uid});const c=hs.xy[r.icon],d=e.createElement("a",{className:"gf-form-label gf-form-label--dashlink",href:(0,et.Nm)(i.href),target:r.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":v.wl.components.DashboardLinks.link},c&&e.createElement(K.J,{"aria-hidden":!0,name:c,style:{marginRight:"4px"}}),e.createElement("span",null,i.title));return e.createElement("div",{key:l,className:"gf-form","data-testid":v.wl.components.DashboardLinks.container},r.tooltip?e.createElement(ue.u,{content:i.tooltip},d):d)})):null};class Ts extends e.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=n=>{for(let a=0;a<this.props.dashboard.annotations.list.length;a++){const r=this.props.dashboard.annotations.list[a];if(r.name===n.name){r.enable=!r.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()}}render(){const{dashboard:n,variables:a,links:r,annotations:s}=this.props;if(!n.isSubMenuVisible())return null;const i=n.meta.isSnapshot??!1;return e.createElement("div",{className:"submenu-controls"},e.createElement("form",{"aria-label":"Template variables",className:Ds},e.createElement(yt,{variables:a,readOnly:i})),e.createElement(ms,{annotations:s,onAnnotationChanged:this.onAnnotationStateChanged,events:n.events}),e.createElement("div",{className:"gf-form gf-form--grow"}),n&&e.createElement(Ss,{dashboard:n,links:r}))}}const xs=(t,n)=>{const{uid:a}=n.dashboard,r=(0,Ke.AE)(a,t);return{variables:(0,Ke.IV)(a,r.variables)}},Ds=m.css`
  display: flex;
  flex-wrap: wrap;
  display: contents;
`,en=(0,R.connect)(xs)(Ts);en.displayName="SubMenu";var Os=o(56130),ws=o(6911),Ns=o(86977);const tn=t=>({initPhase:t.dashboard.initPhase,initError:t.dashboard.initError,dashboard:t.dashboard.getModel(),navIndex:t.navIndex}),Rs={initDashboard:xe.mV,cleanUpDashboardAndVariables:Ns.lw,notifyApp:z.$l,cancelVariables:fe.wX,templateVarsChangedInUrl:fe.xs},Is=(0,R.connect)(tn,Rs);class tt extends e.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.updateLiveTimer=()=>{let n;this.props.dashboard?.liveNow&&(n=(0,ce.$t)().timeRange()),ws.A.setLiveTimeRange(n)},this.onAddPanel=()=>{const{dashboard:n}=this.props;if(!n||n.panels.length>0&&n.panels[0].type==="add-panel")return;const a=8;for(const r of n.panelIterator())r.gridPos.y+=a;n.addPanel({type:"add-panel",gridPos:{x:0,y:0,w:12,h:a},title:"Panel Title"}),this.setState({updateScrollTop:0})},this.setScrollRef=n=>{this.setState({scrollElement:n})}}getCleanState(){return{editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.history.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:n,match:a,queryParams:r}=this.props;n&&this.closeDashboard(),this.props.initDashboard({urlSlug:a.params.slug,urlUid:a.params.uid,urlType:a.params.type,urlFolderUid:r.folderUid,panelType:r.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:a.params.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(n,a){const{dashboard:r,match:s,templateVarsChangedInUrl:i}=this.props,l=this.props.history.location.state?.routeReloadCounter;if(r){if(n.match.params.uid!==s.params.uid||l!==void 0&&this.forceRouteReloadCounter!==l){this.initDashboard(),this.forceRouteReloadCounter=l;return}if(n.location.search!==this.props.location.search){const c=n.queryParams,d=this.props.queryParams;(d?.from!==c?.from||d?.to!==c?.to)&&((0,ce.$t)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!c?.refresh&&d?.refresh&&(0,ce.$t)().setAutoRefresh(d.refresh);const p=(0,rt.xT)(this.props.queryParams,n.queryParams);p&&i(r.uid,p)}this.state.editPanel&&!a.editPanel&&(W.H.setEditingState(!0),this.props.dashboard?.events.publish(new I.xF(this.state.editPanel.id))),!this.state.editPanel&&a.editPanel&&(W.H.setEditingState(!1),this.props.dashboard?.events.publish(new I.Yr(a.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,G.t_)("Permission to edit panel denied")),D.E1.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,G.t_)("Panel not found")),D.E1.partial({editPanel:null,viewPanel:null}))}}static getDerivedStateFromProps(n,a){const{dashboard:r,queryParams:s}=n,i=s.editPanel,l=s.viewPanel;if(!r)return a;const c={...a};if(!a.editPanel&&i){const d=r.getPanelByUrlId(i);d?r.canEditPanel(d)?(c.editPanel=d,c.rememberScrollTop=a.scrollElement?.scrollTop):c.editPanelAccessDenied=!0:c.panelNotFound=!0}else a.editPanel&&!i&&(c.editPanel=null,c.updateScrollTop=a.rememberScrollTop);if(!a.viewPanel&&l){const d=r.getPanelByUrlId(l);d?(r.initViewPanel(d),c.viewPanel=d,c.rememberScrollTop=a.scrollElement?.scrollTop,c.updateScrollTop=0):c.panelNotFound=!0}else a.viewPanel&&!l&&(r.exitViewPanel(a.viewPanel),c.viewPanel=null,c.updateScrollTop=a.rememberScrollTop);return(a.panelNotFound||a.editPanelAccessDenied&&!i)&&(c.panelNotFound=!1,c.editPanelAccessDenied=!1),Ms(n,c)}getInspectPanel(){const{dashboard:n,queryParams:a}=this.props,r=a.inspect;if(!n||!r)return null;const s=n.getPanelById(parseInt(r,10));return s||null}render(){const{dashboard:n,initError:a,queryParams:r}=this.props,{editPanel:s,viewPanel:i,updateScrollTop:l,pageNav:c,sectionNav:d}=this.state,p=(0,X.U)(this.props.queryParams);if(!n||!c||!d)return e.createElement(re.B,{initPhase:this.props.initPhase});const u=this.getInspectPanel(),g=!s&&!p&&!this.props.queryParams.editview,f=p!==T.KioskMode.Full&&!r.editview&&e.createElement("header",{"data-testid":v.wl.pages.Dashboard.DashNav.navV2},e.createElement(Ue.t,{dashboard:n,title:n.title,folderTitle:n.meta.folderTitle,isFullscreen:!!i,onAddPanel:this.onAddPanel,kioskMode:p,hideTimePicker:n.timepicker.hidden,shareModalActiveTab:this.props.queryParams.shareView})),h=(0,m.cx)({"panel-in-fullscreen":Boolean(i),"page-hidden":Boolean(r.editview||s)});return e.createElement(e.Fragment,null,e.createElement(M.T,{navModel:d,pageNav:c,layout:w.Qz.Canvas,toolbar:f,className:h,scrollRef:this.setScrollRef,scrollTop:l},e.createElement(ct,{dashboard:n}),a&&e.createElement(q.u,null),g&&e.createElement("section",{"aria-label":v.wl.pages.Dashboard.SubMenu.submenu},e.createElement(en,{dashboard:n,annotations:n.annotations.list,links:n.links})),e.createElement(Os.Z,{dashboard:n,isEditable:!!n.meta.canEdit,viewPanel:i,editPanel:s}),u&&e.createElement(Hn,{dashboard:n,panel:u})),s&&e.createElement(ss,{dashboard:n,sourcePanel:s,tab:this.props.queryParams.tab,sectionNav:d,pageNav:c}),r.editview&&e.createElement(vn.D,{dashboard:n,editview:r.editview,pageNav:c,sectionNav:d}))}}tt.contextType=Q.h;function Ms(t,n){const{dashboard:a}=t;if(!a)return n;let r=n.pageNav,s=n.sectionNav;(!r||a.title!==r.text)&&(r={text:a.title,url:V.u.getUrlForPartial(t.history.location,{editview:null,editPanel:null,viewPanel:null})});const{folderTitle:i,folderUid:l}=a.meta;if(i&&l&&r&&r.parentItem?.text!==i&&(r={...r,parentItem:{text:i,url:`/dashboards/f/${a.meta.folderUid}`}}),t.route.routeName===T.DashboardRoutes.Path){s=(0,k.getRootContentNavModel)();const c=(0,k.getPageNavFromSlug)(t.match.params.slug);c?.parentItem&&(c.parentItem=c.parentItem)}else s=(0,F.ht)(t.navIndex,P.v.featureToggles.topnav?"dashboards/browse":"dashboards");return(n.editPanel||n.viewPanel)&&(r={...r,text:`${n.editPanel?"Edit":"View"} panel`,parentItem:r,url:void 0}),n.pageNav===r&&n.sectionNav===s?n:{...n,pageNav:r,sectionNav:s}}const nt=(0,b.HE)(tt);nt.displayName="DashboardPage";const As=Is(nt)},66959:(he,U,o)=>{o.r(U),o.d(U,{default:()=>b});var m=o(68404),e=o(58252),R=o(93003),w=o(35287),V=o(87513),v=o(25e3),D=o(81168),P=o(53860);function b(z){const M=(0,D.useDispatch)();(0,e.Z)(()=>{M((0,v.bZ)())});const{hasDatasource:Q,loading:G}=(0,D.useSelector)(k=>({hasDatasource:k.dataSources.dataSourcesCount>0,loading:!k.dataSources.hasFetched})),[X,F]=(0,m.useState)(!1);return Q||X||!R.v.featureToggles.datasourceOnboarding?m.createElement(P.default,{...z}):m.createElement(V.O,{onCTAClick:()=>F(!0),loading:G,title:(0,w.t)("datasource-onboarding.welcome","Welcome to Grafana dashboards!"),CTAText:(0,w.t)("datasource-onboarding.sampleData","Or set up a new dashboard with sample data"),navId:"dashboards/browse",pageNav:{text:(0,w.t)("datasource-onboarding.new-dashboard","New dashboard"),url:"/dashboard/new"}})}},81704:(he,U,o)=>{o.r(U),o.d(U,{default:()=>v});var m=o(68404),e=o(77213),R=o(57388),w=o(79396),V=o(87464);function v(D){const[P,b]=(0,m.useState)(null),{datasourceUid:z}=D.match.params;return(0,m.useEffect)(()=>{const M=(0,e.F)().getInstanceSettings(z);if(!M){b("Data source not found");return}const Q=(0,V.ZQ)(),{dashboard:G}=Q;G.panels[0]={...G.panels[0],datasource:{uid:M.uid,type:M.type}},(0,V.$M)(Q),R.E1.replace("/dashboard/new")},[z]),P?m.createElement(w.T,{navId:"dashboards"},m.createElement(w.T.Contents,null,m.createElement("div",null,'Data source with UID "',z,'" not found.'))):null}},60265:(he,U,o)=>{o.r(U),o.d(U,{StorageFolderPage:()=>z,default:()=>G,getPageNavFromSlug:()=>M,getRootContentNavModel:()=>Q});var m=o(68404),e=o(22350),R=o(93003),w=o(66208),V=o(81697),v=o(40008),D=o(2323),P=o(79396),b=o(63163);function z(X){const F=X.match.params.slug??"",W=(0,e.Z)(()=>(0,b.$)().list("content/"+F),[F]),k=F.length>0?`g/${F}/`:"g/",T=M(F),I=()=>W.value?W.value.fields[0].values.toArray().map(Ue=>{let q=Ue;const re=q.indexOf(".")<0,H=!re&&q.endsWith(".json"),se=`${k}${q}`;return m.createElement(w.Z,{key:q,href:re||H?se:void 0},m.createElement(w.Z.Heading,null,q),m.createElement(w.Z.Figure,null,m.createElement(V.J,{name:re?"folder":H?"gf-grid":"file-alt",size:"sm"})))}):W.loading?m.createElement(v.$,null):m.createElement("div",null,"?"),fe=Q();return m.createElement(P.T,{navModel:fe,pageNav:T},!R.v.featureToggles.topnav&&m.createElement("div",null,m.createElement(D.b,{title:"Enable the topnav feature toggle"},"This page is designed assuming topnav is enabled")),I())}function M(X){const F=X.split("/");let W=[],k="g",T;for(let I=0;I<F.length;I++)k+=`/${F[I]}`,W.push({text:F[I],url:k,parentItem:T}),T=W[W.length-1];return T}function Q(){return{main:{text:"C:"},node:{text:"Content",url:"/g"}}}const G=z}}]);

//# sourceMappingURL=DashboardPage.72796191b95cc7e56e87.js.map