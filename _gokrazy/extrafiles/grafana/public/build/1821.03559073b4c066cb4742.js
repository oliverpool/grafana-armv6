"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1821],{19870:(L,D,t)=>{t.d(D,{H:()=>oe});var e=t(68404),m=t(94929),l=t(77213),S=t(2555),d=t(81168),n=t(25e3),p=t(52423),C=t(68183),E=t(71210),F=t(25474),I=t(44727),U=t(29516),b=t(68884);function j({dataSourceName:a,isDefault:s,onDefaultChange:r,onNameChange:i,alertingSupported:u,disabled:f}){return e.createElement(e.Fragment,null,e.createElement($,{enabled:u}),e.createElement("div",{className:"gf-form-group","aria-label":"Datasource settings page basic settings"},e.createElement("div",{className:"gf-form-inline"},e.createElement("div",{className:"gf-form max-width-30"},e.createElement(E._,{label:"Name",tooltip:`The name is used when you select the data source in panels. The default data source is
              'preselected in new panels.`,grow:!0,disabled:f},e.createElement(F.I,{id:"basic-settings-name",type:"text",value:a,placeholder:"Name",onChange:h=>i(h.currentTarget.value),required:!0,"aria-label":C.wl.pages.DataSource.name}))),e.createElement(E._,{label:"Default",labelWidth:8,disabled:f},e.createElement(I.x,{id:"basic-settings-default",value:s,onChange:h=>{r(h.currentTarget.checked)}})))))}function $({enabled:a}){const s=(0,U.wW)(H);return e.createElement("div",{className:s.badge},a?e.createElement(b.C,{color:"green",icon:"check-circle",text:"Alerting supported"}):e.createElement(b.C,{color:"orange",icon:"exclamation-triangle",text:"Alerting not supported"}))}const H=a=>({badge:p.css`
    margin-bottom: ${a.spacing(2)};
  `});var v=t(90723),J=t(77582);function Q({canSave:a,canDelete:s,onDelete:r,onSubmit:i,onTest:u,exploreUrl:f}){const h=J.Vt.hasPermission(d.AccessControlAction.DataSourcesExplore);return e.createElement("div",{className:"gf-form-button-row"},e.createElement(v.zx,{variant:"secondary",fill:"solid",type:"button",onClick:()=>history.back()},"Back"),e.createElement(v.Qj,{variant:"secondary",fill:"solid",href:f,disabled:!h},"Explore"),e.createElement(v.zx,{type:"button",variant:"destructive",disabled:!s,onClick:r,"aria-label":C.wl.pages.DataSource.delete},"Delete"),a&&e.createElement(v.zx,{type:"submit",variant:"primary",disabled:!a,onClick:T=>i(T),"aria-label":C.wl.pages.DataSource.saveAndTest},"Save & test"),!a&&e.createElement(v.zx,{variant:"primary",onClick:u},"Test"))}var W=(a=>(a.OpenSource="Open Source",a.Pro="Pro",a.Enterprise="Enterprise",a))(W||{}),M=t(2323),Z=t(59796),w=t(47694);const K="datasources.settings.cloudInfoBox.isDismissed";function G({dataSource:a}){let s="",r="";if(a.readOnly||(a.version??0)>2||w.vc.buildInfo.edition!==W.OpenSource)return null;switch(a.type){case"prometheus":s="Prometheus",r="Loki";break;case"loki":s="Loki",r="Prometheus";break;default:return null}return e.createElement(Z.G,{storageKey:K,defaultValue:!1},(i,u)=>i?null:e.createElement(M.b,{title:`Configure your ${s} data source below`,severity:"info",bottomSpacing:4,onRemove:()=>{u(!0)}},"Or skip the effort and get ",s," (and ",r,") as fully-managed, scalable, and hosted data sources from Grafana Labs with the"," ",e.createElement("a",{className:"external-link",href:`https://grafana.com/signup/cloud/connect-account?src=grafana-oss&cnt=${a.type}-settings`,target:"_blank",rel:"noreferrer",title:"The free plan includes 10k active metrics and 50gb storage."},"free-forever Grafana Cloud plan"),"."))}const X="This data source was added by config and cannot be modified using the UI. Please contact your server admin to update this data source.";function x(){return e.createElement(M.b,{"aria-label":C.wl.pages.DataSource.readOnly,severity:"info",title:"Provisioned data source"},X)}function o({dataSourceRights:a,onDelete:s}){const{readOnly:r,hasDeleteRights:i}=a,u=!r&&i,f=()=>history.back();return e.createElement(e.Fragment,null,r&&e.createElement(x,null),e.createElement("div",{className:"gf-form-button-row"},u&&e.createElement(v.zx,{type:"submit",variant:"destructive",onClick:s},"Delete"),e.createElement(v.zx,{variant:"secondary",fill:"outline",type:"button",onClick:f},"Back")))}const c="You are not allowed to modify this data source. Please contact your server admin to update this data source.";function g(){return e.createElement(M.b,{severity:"info",title:"Missing rights"},c)}function P({plugin:a,pageId:s}){if(!a||!a.configPages)return null;const r=a.configPages.find(({id:i})=>i===s);return r?e.createElement(r.body,{plugin:a,query:{}}):e.createElement("div",null,"Page not found: ",r)}var O=t(82897),_=t(37210);class N extends e.PureComponent{constructor(s){super(s),this.element=null,this.onModelChanged=r=>{this.props.onModelChange(r)},this.scopeProps={ctrl:{datasourceMeta:s.dataSourceMeta,current:(0,O.cloneDeep)(s.dataSource)},onModelChanged:this.onModelChanged},this.onModelChanged=this.onModelChanged.bind(this)}componentDidMount(){const{plugin:s}=this.props;if(this.element&&!s.components.ConfigEditor){const r=(0,_.w)(),i='<plugin-component type="datasource-config-ctrl" />';this.component=r.load(this.element,this.scopeProps,i)}}componentDidUpdate(s){const{plugin:r}=this.props;!r.components.ConfigEditor&&this.props.dataSource!==s.dataSource&&(this.scopeProps.ctrl.current=(0,O.cloneDeep)(this.props.dataSource),this.component?.digest())}componentWillUnmount(){this.component&&this.component.destroy()}render(){const{plugin:s,dataSource:r}=this.props;return s?e.createElement("div",{ref:i=>this.element=i},s.components.ConfigEditor&&e.createElement(s.components.ConfigEditor,{options:r,onOptionsChange:this.onModelChanged})):null}}var V=t(81731);function A({state:a}){return e.createElement("div",{className:"gf-form"},e.createElement("div",{className:"gf-form-label width-10"},"Plugin state"),e.createElement("div",{className:"gf-form-label gf-form-label--transparent"},e.createElement(V.u,{state:a})))}function se({testingStatus:a}){const s=a?.status==="error",r=a?.message,i=a?.details?.message,u=a?.details?.verboseMessage;return r?e.createElement("div",{className:"gf-form-group p-t-2"},e.createElement(M.b,{severity:s?"error":"success",title:r,"aria-label":C.wl.pages.DataSource.alert},a?.details&&e.createElement(e.Fragment,null,i,u?e.createElement("details",{style:{whiteSpace:"pre-wrap"}},u):null))):null}function oe({uid:a,pageId:s}){(0,n.E)(a);const r=(0,d.useDispatch)(),i=(0,n.wl)(a),u=(0,n.Qs)(i.type),f=(0,n._l)(),h=(0,n.YY)(a),T=(0,n.Rz)(a),k=(0,n.q6)(),q=(0,n.hw)(a),z=(0,n.qj)(),ee=y=>r((0,n.yr)(y)),B=y=>r((0,n.BX)(y)),te=y=>r((0,n.rl)(y));return e.createElement(re,{pageId:s,dataSource:i,dataSourceMeta:u,dataSourceSettings:f,dataSourceRights:h,exploreUrl:T,onDelete:k,onDefaultChange:ee,onNameChange:B,onOptionsChange:te,onTest:q,onUpdate:z})}function re({pageId:a,dataSource:s,dataSourceMeta:r,dataSourceSettings:i,dataSourceRights:u,exploreUrl:f,onDelete:h,onDefaultChange:T,onNameChange:k,onOptionsChange:q,onTest:z,onUpdate:ee}){const{plugin:B,loadError:te,testingStatus:y,loading:ce}=i,{readOnly:Y,hasWriteRights:ae,hasDeleteRights:le}=u,ie=s.id>0,R=(0,l.F)()?.getInstanceSettings(s.uid),ue=Boolean(R?.meta?.alerting??!1),de=R?.type==="alertmanager",me=ue||de,ne=async Ee=>{Ee.preventDefault(),await ee({...s}),z()};return te?e.createElement(o,{dataSourceRights:u,onDelete:h}):ce?e.createElement(S.Z,null):!ie||!R?null:a?e.createElement(m.n,{instanceSettings:R},e.createElement(P,{pageId:a,plugin:B}),";"):e.createElement("form",{onSubmit:ne},!ae&&e.createElement(g,null),Y&&e.createElement(x,null),r.state&&e.createElement(A,{state:r.state}),e.createElement(G,{dataSource:s}),e.createElement(j,{dataSourceName:s.name,isDefault:s.isDefault,onDefaultChange:T,onNameChange:k,alertingSupported:me,disabled:Y||!ae}),B&&e.createElement(m.n,{instanceSettings:R},e.createElement(N,{plugin:B,dataSource:s,dataSourceMeta:r,onModelChange:q})),e.createElement(se,{testingStatus:y}),e.createElement(Q,{onSubmit:ne,onDelete:h,onTest:z,exploreUrl:f,canSave:!Y&&ae,canDelete:!Y&&le}))}},59332:(L,D,t)=>{t.d(D,{V:()=>l});var e=t(68404),m=t(3597);const l=(0,e.createContext)(m.n)},24231:(L,D,t)=>{t.d(D,{E:()=>b,IA:()=>Z,MF:()=>G,OU:()=>v,Qs:()=>w,YY:()=>X,_l:()=>K,d7:()=>x,hw:()=>j,nH:()=>J,q6:()=>W,qj:()=>Q,wi:()=>H,wl:()=>M,zJ:()=>$});var e=t(68404),m=t(70431),l=t(97063),S=t(77582),d=t(86245),n=t(81168),p=t(45984),C=t(85597),E=t(40897),F=t(59332),I=t(79508),U=t(93769);const b=o=>{const c=(0,n.useDispatch)();(0,e.useEffect)(()=>(c((0,E.M9)(o)),function(){c((0,m.e)({cleanupAction:P=>P.dataSourceSettings}))}),[o,c])},j=o=>{const c=(0,n.useDispatch)();return()=>c((0,E.kY)(o))},$=()=>{const o=(0,n.useDispatch)();(0,e.useEffect)(()=>{o((0,E.bZ)())},[o])},H=o=>{const c=(0,n.useDispatch)();(0,e.useEffect)(()=>{c((0,E.gv)(o))},[c,o])},v=()=>{const o=(0,n.useDispatch)();(0,e.useEffect)(()=>{o((0,E.Kj)())},[o])},J=()=>{const o=(0,n.useDispatch)(),c=x();return g=>{o((0,E.J_)(g,c.Edit))}},Q=()=>{const o=(0,n.useDispatch)();return async c=>o((0,E.oe)(c))},W=()=>{const o=(0,n.useDispatch)(),{name:c}=(0,n.useSelector)(g=>g.dataSources.dataSource);return()=>{l.Z.publish(new p.VJ({title:"Delete",text:`Are you sure you want to delete the "${c}" data source?`,yesText:"Delete",icon:"trash-alt",onConfirm:()=>o((0,E.F5)())}))}},M=o=>(0,n.useSelector)(c=>(0,U.f6)(c.dataSources,o)),Z=o=>{const c=M(o);return(0,C.iU)(c)},w=o=>(0,n.useSelector)(c=>(0,U.G4)(c.dataSources,o)),K=()=>(0,n.useSelector)(o=>o.dataSourceSettings),G=(o,c)=>{const g=M(o),{plugin:P,loadError:O,loading:_}=K(),N=(0,n.useSelector)(A=>A.navIndex),V=c?`datasource-${c}-${o}`:`datasource-settings-${o}`;if(O){const A={text:O,subTitle:"Data Source Error",icon:"exclamation-triangle"};return{node:A,main:A}}return _||!P?(0,d.ht)(N,V,(0,I.xG)("settings")):(0,d.ht)(N,V,(0,I.nI)((0,I.B1)(g,P),c||"settings"))},X=o=>{const c=M(o),g=c.readOnly===!0,P=S.Vt.hasPermissionInMetadata(n.AccessControlAction.DataSourcesWrite,c),O=S.Vt.hasPermissionInMetadata(n.AccessControlAction.DataSourcesDelete,c);return{readOnly:g,hasWriteRights:P,hasDeleteRights:O}},x=()=>(0,e.useContext)(F.V)},25e3:(L,D,t)=>{t.d(D,{BX:()=>d.BX,E:()=>l.E,Ht:()=>d.Ht,I5:()=>n.I5,IA:()=>n.IA,IO:()=>n.IO,MF:()=>l.MF,Nu:()=>d.Nu,OU:()=>l.OU,Qs:()=>l.Qs,Rz:()=>l.IA,Vj:()=>m.V,YY:()=>l.YY,_l:()=>l._l,bZ:()=>e.bZ,d7:()=>l.d7,hw:()=>l.hw,mt:()=>n.mt,nH:()=>l.nH,q6:()=>l.q6,qj:()=>l.qj,r7:()=>n.r7,rl:()=>d.rl,wi:()=>l.wi,wl:()=>l.wl,yr:()=>d.yr,zJ:()=>l.zJ,zT:()=>d.zT});var e=t(40897),m=t(59332),l=t(24231),S=t(79508),d=t(71128),n=t(93769)},81731:(L,D,t)=>{t.d(D,{u:()=>S});var e=t(68404),m=t(24699),l=t(68884);const S=n=>{const p=d(n.state);return p?e.createElement(l.C,{color:p.color,title:p.tooltip,text:p.text,icon:p.icon}):null};function d(n){switch(n){case m.BV.deprecated:return{text:"Deprecated",color:"red",tooltip:"This feature is deprecated and will be removed in a future release"};case m.BV.alpha:return{text:"Alpha",color:"blue",tooltip:"This feature is experimental and future updates might not be backward compatible"};case m.BV.beta:return{text:"Beta",color:"blue",tooltip:"This feature is close to complete but not fully tested"};default:return null}}}}]);

//# sourceMappingURL=1821.03559073b4c066cb4742.js.map