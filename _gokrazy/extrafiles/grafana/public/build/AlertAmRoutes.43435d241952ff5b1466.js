"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8648],{2979:(z,R,a)=>{a.r(R),a.d(R,{default:()=>ft});var n=a(52423),e=a(68404),g=a(29516),m=a(2323),O=a(90090),B=a(78758),h=a(81168),W=a(40014),x=a(30173),S=a(94984),$=a(45524),J=a(731),H=a(88331),D=a(40106),I=a(90723),U=a(51981),F=a(97953),k=a(4403),N=a(74955),V=a(11017),w=a(46739),ae=a(90031),$e=a(7917),Z=a(25474),re=a(82897),ie=a(39031),Q=a(20194),ye=a(45849),Y=a(58593);const he=["",""],Ce=(t,o)=>Object.entries(t??{}).reduce((l,[c,i])=>[...l,{name:c,value:i,operator:o?ie._M.regex:ie._M.equal}],[]),ce=(t,o)=>{if(!t)return o??he;const[l,c]=t?(0,Y.bG)(t):[void 0,void 0],i=Y.qr.find(r=>r.value===c);return!l||!i?he:[String(l),i.value]},Ie=t=>t.value,Ge=t=>(t??[]).map(Ie),Ae={name:"",value:"",operator:ie._M.equal},Le=["grafana_folder","alertname"],Te=[{label:"grafana_folder",value:"grafana_folder"},{label:"alertname",value:"alertname"},{label:"Disable (...)",value:"..."}],le={id:"",overrideGrouping:!1,groupBy:Le,object_matchers:[],routes:[],continue:!1,receiver:"",overrideTimings:!1,groupWaitValue:"",groupWaitValueType:Y.qr[0].value,groupIntervalValue:"",groupIntervalValueType:Y.qr[0].value,repeatIntervalValue:"",repeatIntervalValueType:Y.qr[0].value,muteTimeIntervals:[]},Pe=t=>{if(!t)return[le,{}];const o=String(Math.random()),l={[o]:t};if(Object.keys(t).length===0)return[{...le,id:o},l];const c=[];t.routes?.forEach(d=>{const[P,y]=Pe(d);c.push(P),Object.assign(l,y)});const i=t.matchers?t.matchers?.map(d=>(0,Q.cm)((0,Q.tC)(d)))??[]:t.object_matchers?.map(d=>({name:d[0],operator:d[1],value:d[2]}))??[],[r,s]=ce(t.group_wait,["","s"]),[A,T]=ce(t.group_interval,["","m"]),[v,p]=ce(t.repeat_interval,["","h"]);return[{id:o,object_matchers:[...i,...Ce(t.match,!1),...Ce(t.match_re,!0)],continue:t.continue??!1,receiver:t.receiver??"",overrideGrouping:Array.isArray(t.group_by)&&t.group_by.length!==0,groupBy:t.group_by??[],overrideTimings:[r,A,v].some(Boolean),groupWaitValue:r,groupWaitValueType:s,groupIntervalValue:A,groupIntervalValueType:T,repeatIntervalValue:v,repeatIntervalValueType:p,routes:c,muteTimeIntervals:t.mute_time_intervals??[]},l]},Me=(t,o,l)=>{const c=l[o.id],{overrideGrouping:i,groupBy:r,overrideTimings:s,groupWaitValue:A,groupWaitValueType:T,groupIntervalValue:v,groupIntervalValueType:p,repeatIntervalValue:d,repeatIntervalValueType:P}=o,y=i&&r?r:[],u=s&&A?`${A}${T}`:void 0,b=s&&v?`${v}${p}`:void 0,G=s&&d?`${d}${P}`:void 0,K={...c??{},continue:o.continue,group_by:y,object_matchers:o.object_matchers.length?o.object_matchers.map(L=>[L.name,L.operator,L.value]):void 0,match:void 0,match_re:void 0,group_wait:u,group_interval:b,repeat_interval:G,routes:o.routes.map(L=>Me(t,L,l)),mute_time_intervals:o.muteTimeIntervals};return t!==ye.GC?(K.matchers=o.object_matchers.map(({name:L,operator:_,value:f})=>`${L}${_}${f}`),K.object_matchers=void 0):K.matchers=void 0,o.receiver&&(K.receiver=o.receiver),(0,re.omitBy)(K,re.isUndefined)},me=t=>({label:t,value:t}),Re=t=>(t??[]).map(me),X=t=>t?Ie(t)??"":"",ue=t=>t?Ge(t):[],q=t=>{if(t)return/^\d+$/.test(t)?void 0:"Must be a positive integer."};var ee=a(10505);const Oe=t=>({container:n.css`
      align-items: center;
      display: flex;
      flex-flow: row nowrap;

      & > * + * {
        margin-left: ${t.spacing(1)};
      }
    `,input:n.css`
      flex: 1;
    `,timingContainer:n.css`
      max-width: ${t.spacing(33)};
    `,smallInput:n.css`
      width: ${t.spacing(6.5)};
    `,linkText:n.css`
      text-decoration: underline;
    `,collapse:n.css`
      border: none;
      background: none;
      color: ${t.colors.text.primary};
    `}),Ue=({alertManagerSourceName:t,onCancel:o,onSave:l,receivers:c,routes:i})=>{const r=(0,g.wW)(Oe),[s,A]=(0,e.useState)(!1),[T,v]=(0,e.useState)(Re(i.groupBy));return e.createElement(k.l,{defaultValues:{...i,overrideTimings:!0,overrideGrouping:!0},onSubmit:l},({control:p,errors:d,setValue:P})=>e.createElement(e.Fragment,null,e.createElement(N.g,{label:"Default contact point",invalid:!!d.receiver,error:d.receiver?.message},e.createElement(e.Fragment,null,e.createElement("div",{className:r.container,"data-testid":"am-receiver-select"},e.createElement(V.g,{render:({field:{onChange:y,ref:C,...u}})=>e.createElement(w.Ph,{"aria-label":"Default contact point",...u,className:r.input,onChange:E=>y(X(E)),options:c}),control:p,name:"receiver",rules:{required:{value:!0,message:"Required."}}}),e.createElement("span",null,"or"),e.createElement(ae.r,{className:r.linkText,href:(0,ee.eQ)("/alerting/notifications/receivers/new",t)},"Create a contact point")))),e.createElement(N.g,{label:"Group by",description:"Group alerts when you receive a notification based on labels.","data-testid":"am-group-select"},e.createElement(V.g,{render:({field:{onChange:y,ref:C,...u}})=>e.createElement(w.NU,{"aria-label":"Group by",...u,allowCustomValue:!0,className:r.input,onCreateOption:E=>{v(b=>[...b,me(E)]),P("groupBy",[...u.value,E])},onChange:E=>y(ue(E)),options:[...Te,...T]}),control:p,name:"groupBy"})),e.createElement($e.U,{collapsible:!0,className:r.collapse,isOpen:s,label:"Timing options",onToggle:A},e.createElement(N.g,{label:"Group wait",description:"The waiting time until the initial notification is sent for a new group created by an incoming alert. Default 30 seconds.",invalid:!!d.groupWaitValue,error:d.groupWaitValue?.message,"data-testid":"am-group-wait"},e.createElement(e.Fragment,null,e.createElement("div",{className:(0,n.cx)(r.container,r.timingContainer)},e.createElement(V.g,{render:({field:y,fieldState:{invalid:C}})=>e.createElement(Z.I,{...y,className:r.smallInput,invalid:C,placeholder:"30"}),control:p,name:"groupWaitValue",rules:{validate:q}}),e.createElement(V.g,{render:({field:{onChange:y,ref:C,...u}})=>e.createElement(w.Ph,{...u,className:r.input,onChange:E=>y(X(E)),options:Y.qr,"aria-label":"Group wait type"}),control:p,name:"groupWaitValueType"})))),e.createElement(N.g,{label:"Group interval",description:"The waiting time to send a batch of new alerts for that group after the first notification was sent. Default 5 minutes.",invalid:!!d.groupIntervalValue,error:d.groupIntervalValue?.message,"data-testid":"am-group-interval"},e.createElement(e.Fragment,null,e.createElement("div",{className:(0,n.cx)(r.container,r.timingContainer)},e.createElement(V.g,{render:({field:y,fieldState:{invalid:C}})=>e.createElement(Z.I,{...y,className:r.smallInput,invalid:C,placeholder:"5"}),control:p,name:"groupIntervalValue",rules:{validate:q}}),e.createElement(V.g,{render:({field:{onChange:y,ref:C,...u}})=>e.createElement(w.Ph,{...u,className:r.input,onChange:E=>y(X(E)),options:Y.qr,"aria-label":"Group interval type"}),control:p,name:"groupIntervalValueType"})))),e.createElement(N.g,{label:"Repeat interval",description:"The waiting time to resend an alert after they have successfully been sent. Default 4 hours.",invalid:!!d.repeatIntervalValue,error:d.repeatIntervalValue?.message,"data-testid":"am-repeat-interval"},e.createElement(e.Fragment,null,e.createElement("div",{className:(0,n.cx)(r.container,r.timingContainer)},e.createElement(V.g,{render:({field:y,fieldState:{invalid:C}})=>e.createElement(Z.I,{...y,className:r.smallInput,invalid:C,placeholder:"4"}),control:p,name:"repeatIntervalValue",rules:{validate:q}}),e.createElement(V.g,{render:({field:{onChange:y,ref:C,...u}})=>e.createElement(w.Ph,{...u,className:r.input,menuPlacement:"top",onChange:E=>y(X(E)),options:Y.qr,"aria-label":"Repeat interval type"}),control:p,name:"repeatIntervalValueType"}))))),e.createElement("div",{className:r.container},e.createElement(I.zx,{type:"submit"},"Save"),e.createElement(I.zx,{onClick:o,type:"reset",variant:"secondary",fill:"outline"},"Cancel"))))},De=t=>({container:n.css`
      display: grid;
      font-style: ${t.typography.fontSize};
      grid-template-columns: ${t.spacing(15.5)} auto;

      ${t.breakpoints.down("md")} {
        grid-template-columns: 100%;
      }
    `,titleCell:n.css`
      color: ${t.colors.text.primary};
    `,valueCell:n.css`
      color: ${t.colors.text.secondary};
      margin-bottom: ${t.spacing(1)};
    `}),Ke=({routes:t})=>{const o=(0,g.wW)(De),l=t.receiver||"-",c=t.groupBy.join(", ")||"-",i=t.groupWaitValue?`${t.groupWaitValue}${t.groupWaitValueType}`:"-",r=t.groupIntervalValue?`${t.groupIntervalValue}${t.groupIntervalValueType}`:"-",s=t.repeatIntervalValue?`${t.repeatIntervalValue}${t.repeatIntervalValueType}`:"-";return e.createElement("div",{className:o.container},e.createElement("div",{className:o.titleCell},"Contact point"),e.createElement("div",{className:o.valueCell,"data-testid":"am-routes-root-receiver"},l),e.createElement("div",{className:o.titleCell},"Group by"),e.createElement("div",{className:o.valueCell,"data-testid":"am-routes-root-group-by"},c),e.createElement("div",{className:o.titleCell},"Timings"),e.createElement("div",{className:o.valueCell,"data-testid":"am-routes-root-timings"},"Group wait: ",i," | Group interval: ",r," | Repeat interval: ",s))},Fe=({isEditMode:t,onSave:o,onEnterEditMode:l,onExitEditMode:c,receivers:i,routes:r,alertManagerSourceName:s,readOnly:A=!1})=>{const T=(0,g.wW)(je),v=(0,F.Ko)(s);return e.createElement("div",{className:T.container,"data-testid":"am-root-route-container"},e.createElement("div",{className:T.titleContainer},e.createElement("h5",{className:T.title},"Root policy - ",e.createElement("i",null,"default for all alerts")),!t&&!A&&e.createElement(U.q,{actions:[v.update]},e.createElement(I.zx,{icon:"pen",onClick:l,size:"sm",type:"button",variant:"secondary"},"Edit"))),e.createElement("p",null,"All alerts will go to the default contact point, unless you set additional matchers in the specific routing area."),t?e.createElement(Ue,{alertManagerSourceName:s,onCancel:c,onSave:o,receivers:i,routes:r}):e.createElement(Ke,{routes:r}))},je=t=>({container:n.css`
      background-color: ${t.colors.background.secondary};
      color: ${t.colors.text.secondary};
      padding: ${t.spacing(2)};
    `,titleContainer:n.css`
      color: ${t.colors.text.primary};
      display: flex;
      flex-flow: row nowrap;
    `,title:n.css`
      flex: 100%;
    `});var ze=a(70197),we=a(38835),_e=a(81697),te=a(82002),Je=a(31808);const oe=({children:t})=>{const o=(0,g.wW)(Qe);return e.createElement("div",{className:o.container},t)},Qe=t=>({container:n.css`
      background-color: ${t.colors.background.secondary};
      color: ${t.colors.text.secondary};
      padding: ${t.spacing(4)};
      text-align: center;
    `}),de=({buttonIcon:t,buttonLabel:o,buttonSize:l="lg",buttonVariant:c="primary",onButtonClick:i,text:r,href:s,showButton:A=!0})=>{const T=(0,g.wW)(Ye),v={className:T.button,icon:t,size:l,variant:c};return e.createElement(oe,null,e.createElement(e.Fragment,null,e.createElement("p",{className:T.text},r),A&&(s?e.createElement(I.Qj,{href:s,type:"button",...v},o):e.createElement(I.zx,{onClick:i,type:"button",...v},o))))},Ye=t=>({container:n.css`
      background-color: ${t.colors.background.secondary};
      color: ${t.colors.text.secondary};
      padding: ${t.spacing(4)};
      text-align: center;
    `,text:n.css`
      margin-bottom: ${t.spacing(2)};
    `,button:n.css`
      margin: ${t.spacing(2,0,1)};
    `});var He=a(30151),ge=a(90701),ne=a(20017),be=a(81202);const Ze=(t,o)=>t.map((l,c)=>({id:o?.(l)??c,data:l}));var We=a(53731),Xe=a(44479),ke=a(99631),qe=a(14206),et=a(68884),pe=a(44727),se=a(46818),xe=a(29614),Be=a(23403),ve=a(79370);function tt(){const t=(0,Be.k)("notification"),[o]=(0,xe.k)(t),l=(0,ve._)(c=>c.amConfigs);return(0,e.useMemo)(()=>{const{result:c}=o&&l[o]||se.oq;return(c?.alertmanager_config??{})?.mute_time_intervals?.map(s=>({value:s.name,label:s.name,description:s.time_intervals.map(A=>(0,Q.uK)(A)).join(", AND ")}))??[]},[o,l])}var at=a(2390);const nt=({onCancel:t,onSave:o,receivers:l,routes:c})=>{const i=(0,g.wW)(rt),r=(0,g.wW)(Oe),[s,A]=(0,e.useState)(Re(c.groupBy)),T=tt(),v=l.sort((p,d)=>p.grafanaAppReceiverType===at.W.OnCall?-1:0);return e.createElement(k.l,{defaultValues:c,onSubmit:o},({control:p,register:d,errors:P,setValue:y,watch:C})=>e.createElement(e.Fragment,null,e.createElement("input",{type:"hidden",...d("id")}),e.createElement(qe.F,{name:"object_matchers",control:p},({fields:u,append:E,remove:b})=>e.createElement(e.Fragment,null,e.createElement(ge.wc,{justify:"flex-start",spacing:"md"},e.createElement("div",null,"Matching labels"),u.length===0&&e.createElement(et.C,{color:"orange",className:i.noMatchersWarning,icon:"exclamation-triangle",text:"If no matchers are specified, this notification policy will handle all alert instances."}),u.length>0&&e.createElement("div",{className:i.matchersContainer},u.map((M,G)=>{const K=`object_matchers[${G}]`;return e.createElement(ge.Lh,{key:M.id,align:"flex-start",height:"auto"},e.createElement(N.g,{label:"Label",invalid:!!P.object_matchers?.[G]?.name,error:P.object_matchers?.[G]?.name?.message},e.createElement(Z.I,{...d(`${K}.name`,{required:"Field is required"}),defaultValue:M.name,placeholder:"label"})),e.createElement(N.g,{label:"Operator"},e.createElement(V.g,{render:({field:{onChange:L,ref:_,...f}})=>e.createElement(w.Ph,{...f,className:i.matchersOperator,onChange:j=>L(j?.value),options:Q.tA,"aria-label":"Operator"}),defaultValue:M.operator,control:p,name:`${K}.operator`,rules:{required:{value:!0,message:"Required."}}})),e.createElement(N.g,{label:"Value",invalid:!!P.object_matchers?.[G]?.value,error:P.object_matchers?.[G]?.value?.message},e.createElement(Z.I,{...d(`${K}.value`,{required:"Field is required"}),defaultValue:M.value,placeholder:"value"})),e.createElement(ne.h,{className:i.removeButton,tooltip:"Remove matcher",name:"trash-alt",onClick:()=>b(G)},"Remove"))})),e.createElement(I.zx,{className:i.addMatcherBtn,icon:"plus",onClick:()=>E(Ae),variant:"secondary",type:"button"},"Add matcher")))),e.createElement(N.g,{label:"Contact point"},e.createElement(V.g,{render:({field:{onChange:u,ref:E,...b}})=>e.createElement(w.Ph,{"aria-label":"Contact point",...b,className:r.input,onChange:M=>u(X(M)),options:v}),control:p,name:"receiver"})),e.createElement(N.g,{label:"Continue matching subsequent sibling nodes"},e.createElement(pe.r,{id:"continue-toggle",...d("continue")})),e.createElement(N.g,{label:"Override grouping"},e.createElement(pe.r,{id:"override-grouping-toggle",...d("overrideGrouping")})),C().overrideGrouping&&e.createElement(N.g,{label:"Group by",description:"Group alerts when you receive a notification based on labels. If empty it will be inherited from the parent policy."},e.createElement(V.g,{render:({field:{onChange:u,ref:E,...b}})=>e.createElement(w.NU,{"aria-label":"Group by",...b,allowCustomValue:!0,className:r.input,onCreateOption:M=>{A(G=>[...G,me(M)]),y("groupBy",[...b.value,M])},onChange:M=>u(ue(M)),options:[...Te,...s]}),control:p,name:"groupBy"})),e.createElement(N.g,{label:"Override general timings"},e.createElement(pe.r,{id:"override-timings-toggle",...d("overrideTimings")})),C().overrideTimings&&e.createElement(e.Fragment,null,e.createElement(N.g,{label:"Group wait",description:"The waiting time until the initial notification is sent for a new group created by an incoming alert. If empty it will be inherited from the parent policy.",invalid:!!P.groupWaitValue,error:P.groupWaitValue?.message},e.createElement(e.Fragment,null,e.createElement("div",{className:(0,n.cx)(r.container,r.timingContainer)},e.createElement(V.g,{render:({field:u,fieldState:{invalid:E}})=>e.createElement(Z.I,{...u,className:r.smallInput,invalid:E,"aria-label":"Group wait value"}),control:p,name:"groupWaitValue",rules:{validate:q}}),e.createElement(V.g,{render:({field:{onChange:u,ref:E,...b}})=>e.createElement(w.Ph,{...b,className:r.input,onChange:M=>u(X(M)),options:Y.qr,"aria-label":"Group wait type"}),control:p,name:"groupWaitValueType"})))),e.createElement(N.g,{label:"Group interval",description:"The waiting time to send a batch of new alerts for that group after the first notification was sent. If empty it will be inherited from the parent policy.",invalid:!!P.groupIntervalValue,error:P.groupIntervalValue?.message},e.createElement(e.Fragment,null,e.createElement("div",{className:(0,n.cx)(r.container,r.timingContainer)},e.createElement(V.g,{render:({field:u,fieldState:{invalid:E}})=>e.createElement(Z.I,{...u,className:r.smallInput,invalid:E,"aria-label":"Group interval value"}),control:p,name:"groupIntervalValue",rules:{validate:q}}),e.createElement(V.g,{render:({field:{onChange:u,ref:E,...b}})=>e.createElement(w.Ph,{...b,className:r.input,onChange:M=>u(X(M)),options:Y.qr,"aria-label":"Group interval type"}),control:p,name:"groupIntervalValueType"})))),e.createElement(N.g,{label:"Repeat interval",description:"The waiting time to resend an alert after they have successfully been sent.",invalid:!!P.repeatIntervalValue,error:P.repeatIntervalValue?.message},e.createElement(e.Fragment,null,e.createElement("div",{className:(0,n.cx)(r.container,r.timingContainer)},e.createElement(V.g,{render:({field:u,fieldState:{invalid:E}})=>e.createElement(Z.I,{...u,className:r.smallInput,invalid:E,"aria-label":"Repeat interval value"}),control:p,name:"repeatIntervalValue",rules:{validate:q}}),e.createElement(V.g,{render:({field:{onChange:u,ref:E,...b}})=>e.createElement(w.Ph,{...b,className:r.input,menuPlacement:"top",onChange:M=>u(X(M)),options:Y.qr,"aria-label":"Repeat interval type"}),control:p,name:"repeatIntervalValueType"}))))),e.createElement(N.g,{label:"Mute timings","data-testid":"am-mute-timing-select",description:"Add mute timing to policy",invalid:!!P.muteTimeIntervals},e.createElement(V.g,{render:({field:{onChange:u,ref:E,...b}})=>e.createElement(w.NU,{"aria-label":"Mute timings",...b,className:r.input,onChange:M=>u(ue(M)),options:T}),control:p,name:"muteTimeIntervals"})),e.createElement("div",{className:i.buttonGroup},e.createElement(I.zx,{type:"submit"},"Save policy"),e.createElement(I.zx,{onClick:t,fill:"outline",type:"button",variant:"secondary"},"Cancel"))))},rt=t=>{const o=t.spacing(3.5);return{addMatcherBtn:n.css`
      margin-bottom: ${o};
    `,matchersContainer:n.css`
      background-color: ${t.colors.background.secondary};
      margin: ${t.spacing(1,0)};
      padding: ${t.spacing(1,4.6,1,1.5)};
      width: fit-content;
    `,matchersOperator:n.css`
      min-width: 140px;
    `,nestedPolicies:n.css`
      margin-top: ${o};
    `,removeButton:n.css`
      margin-left: ${t.spacing(1)};
      margin-top: ${t.spacing(2.5)};
    `,buttonGroup:n.css`
      margin: ${t.spacing(6)} 0 ${o};

      & > * + * {
        margin-left: ${t.spacing(1.5)};
      }
    `,noMatchersWarning:n.css`
      padding: ${t.spacing(1)} ${t.spacing(2)};
    `}};var Ee=a(72004);const Se=({alertManagerSourceName:t,muteTimingNames:o,hideActions:l})=>{const c=(0,g.wW)(st),i=(0,h.useDispatch)(),r=(0,F.Ko)(t),s=(0,ve._)(P=>P.amConfigs),[A,T]=(0,e.useState)(""),{result:v}=t&&s[t]||se.oq,p=(0,e.useMemo)(()=>{const P=v?.alertmanager_config?.mute_time_intervals??[],y=v?.alertmanager_config?.muteTimeProvenances??{};return P.filter(({name:C})=>o?o.includes(C):!0).map(C=>({id:C.name,data:{...C,provenance:y[C.name]}}))},[v?.alertmanager_config?.mute_time_intervals,v?.alertmanager_config?.muteTimeProvenances,o]),d=lt(t,l,T);return e.createElement("div",{className:c.container},!l&&e.createElement("h5",null,"Mute timings"),!l&&e.createElement("p",null,"Mute timings are a named interval of time that may be referenced in the notification policy tree to mute particular notification policies for specific times of the day."),!l&&p.length>0&&e.createElement(U.q,{actions:[r.create]},e.createElement(I.Qj,{className:c.addMuteButton,icon:"plus",variant:"primary",href:(0,ee.eQ)("alerting/routes/mute-timing/new",t)},"New mute timing")),p.length>0?e.createElement(We.t,{items:p,cols:d}):l?e.createElement("p",null,"No mute timings configured"):e.createElement(de,{text:"You haven't created any mute timings yet",buttonLabel:"Add mute timing",buttonIcon:"plus",buttonSize:"lg",href:(0,ee.eQ)("alerting/routes/mute-timing/new",t),showButton:te.Vt.hasPermission(r.create)}),!l&&e.createElement(be.s,{isOpen:!!A,title:"Delete mute timing",body:`Are you sure you would like to delete "${A}"`,confirmText:"Delete",onConfirm:()=>i((0,Ee.r0)(t,A)),onDismiss:()=>T("")}))};function lt(t,o=!1,l){const c=(0,F.Ko)(t),i=te.Vt.hasPermission(c.update),r=te.Vt.hasPermission(c.delete),s=!o&&(i||r);return(0,e.useMemo)(()=>{const A=[{id:"name",label:"Name",renderCell:function({data:v}){return e.createElement(e.Fragment,null,v.name," ",v.provenance&&e.createElement(D.C0,null))},size:"250px"},{id:"timeRange",label:"Time range",renderCell:({data:T})=>ot(T.time_intervals)}];return s&&A.push({id:"actions",label:"Actions",renderCell:function({data:v}){return v.provenance?e.createElement("div",null,e.createElement(ae.r,{href:(0,ee.eQ)("/alerting/routes/mute-timing/edit",t,{muteName:v.name})},e.createElement(ne.h,{name:"file-alt",title:"View mute timing"}))):e.createElement("div",null,e.createElement(U.q,{actions:[c.update]},e.createElement(ae.r,{href:(0,ee.eQ)("/alerting/routes/mute-timing/edit",t,{muteName:v.name})},e.createElement(ne.h,{name:"edit",title:"Edit mute timing"}))),e.createElement(U.q,{actions:[c.delete]},e.createElement(ne.h,{name:"trash-alt",title:"Delete mute timing",onClick:()=>l(v.name)})))},size:"100px"}),A},[t,l,s,c])}function ot(t){return t.map((o,l)=>{const{times:c,weekdays:i,days_of_month:r,months:s,years:A}=o,T=(0,Q.u6)(c),v=(0,Q.v7)(i),p=(0,Q.J8)(r),d=(0,Q.m8)(s),P=(0,Q.qw)(A);return e.createElement(e.Fragment,{key:JSON.stringify(o)+l},`${T} ${v}`,e.createElement("br",null),[p,d,P].join(" | "),e.createElement("br",null))})}const st=t=>({container:n.css`
    display: flex;
    flex-flow: column nowrap;
  `,addMuteButton:n.css`
    margin-bottom: ${t.spacing(2)};
    align-self: flex-end;
  `}),it=({onChange:t,receivers:o,routes:l,readOnly:c=!1,alertManagerSourceName:i})=>{const r=(0,g.wW)(ct),s=(0,g.wW)(De),A=(0,F.Ko)(i),T=l.groupWaitValue?`${l.groupWaitValue}${l.groupWaitValueType}`:"-",v=l.groupIntervalValue?`${l.groupIntervalValue}${l.groupIntervalValueType}`:"-",p=l.repeatIntervalValue?`${l.repeatIntervalValue}${l.repeatIntervalValueType}`:"-",[d,P]=(0,e.useState)(l.routes),[y,C]=(0,e.useState)(!1);return e.createElement("div",{className:s.container},e.createElement("div",{className:s.titleCell},"Group wait"),e.createElement("div",{className:s.valueCell},T),e.createElement("div",{className:s.titleCell},"Group interval"),e.createElement("div",{className:s.valueCell},v),e.createElement("div",{className:s.titleCell},"Repeat interval"),e.createElement("div",{className:s.valueCell},p),e.createElement("div",{className:s.titleCell},"Nested policies"),e.createElement("div",{className:s.valueCell},d.length?e.createElement(Ve,{isAddMode:y,onCancelAdd:()=>{C(!1),P(u=>{const E=[...u];return E.pop(),E})},onChange:u=>{t({...l,routes:u}),y&&C(!1)},receivers:o,routes:d,alertManagerSourceName:i}):e.createElement("p",null,"No nested policies configured."),!y&&!c&&e.createElement(U.q,{actions:[A.create]},e.createElement(I.zx,{className:r.addNestedRoutingBtn,icon:"plus",onClick:()=>{P(u=>[...u,le]),C(!0)},variant:"secondary",type:"button"},"Add nested policy"))),e.createElement("div",{className:s.titleCell},"Mute timings"),e.createElement("div",{className:s.valueCell},e.createElement(Se,{alertManagerSourceName:i,muteTimingNames:l.muteTimeIntervals,hideActions:!0})))},ct=t=>({addNestedRoutingBtn:n.css`
      margin-top: ${t.spacing(2)};
    `}),mt=(t,o,l)=>{const c=(0,Q.Zh)(o??"");let i=t;return c.length&&(i=t.filter(r=>{const s=r.object_matchers.map(Q._J);return(0,re.intersectionWith)(s,c,re.isEqual).length>0})),l&&l.length>0&&(i=i.filter(r=>r.receiver.toLowerCase().includes(l.toLowerCase()))),i},Ne=(t,o)=>{const l=[...t],c=l.findIndex(i=>i.id===o.id);return c>=0&&(l[c]={...l[c],...o}),l},ut=(t,o)=>t.filter(l=>l.id!==o),dt=(t,o)=>t.find(l=>l.label===o)?.grafanaAppReceiverType,Ve=({isAddMode:t,onCancelAdd:o,onChange:l,receivers:c,routes:i,filters:r,readOnly:s=!1,alertManagerSourceName:A})=>{const[T,v]=(0,e.useState)(!1),[p,d]=(0,e.useState)(void 0),[P,y]=(0,e.useState)(),C=(0,F.Ko)(A),u=te.Vt.hasPermission(C.update),E=te.Vt.hasPermission(C.delete),b=!s&&(u||E),M=(0,e.useCallback)(f=>y(f.id),[]),G=(0,e.useCallback)(()=>y(void 0),[]),K=[{id:"matchingCriteria",label:"Matching labels",renderCell:f=>f.data.object_matchers.length?e.createElement(ke.g,{matchers:f.data.object_matchers.map(Q._J)}):e.createElement("span",null,"Matches all alert instances"),size:10},{id:"groupBy",label:"Group by",renderCell:f=>f.data.overrideGrouping&&f.data.groupBy.join(", ")||"-",size:5},{id:"receiverChannel",label:"Contact point",renderCell:f=>{const j=dt(c,f.data.receiver);return f.data.receiver?e.createElement(e.Fragment,null,f.data.receiver," ",j&&e.createElement(Xe.i,{grafanaAppType:j})):"-"},size:5},{id:"muteTimings",label:"Mute timings",renderCell:f=>f.data.muteTimeIntervals.join(", ")||"-",size:5},...b?[{id:"actions",label:"Actions",renderCell:f=>{if(f.renderExpandedContent)return null;const j=()=>{M(f),v(!0)};return e.createElement(e.Fragment,null,e.createElement(ge.Lh,null,e.createElement(I.zx,{"aria-label":"Edit route",icon:"pen",onClick:j,size:"sm",type:"button",variant:"secondary"},"Edit"),e.createElement(ne.h,{"aria-label":"Delete route",name:"trash-alt",onClick:()=>{d(f.data.id)},type:"button"})))},size:"100px"}]:[]],L=(0,e.useMemo)(()=>mt(i,r?.queryString,r?.contactPoint),[i,r]),_=(0,e.useMemo)(()=>Ze(t?i:L),[t,i,L]);return(0,e.useEffect)(()=>{t&&_.length&&y(_[_.length-1].id),!t&&_.length&&y(void 0)},[t,_]),i.length>0&&L.length===0?e.createElement(oe,null,e.createElement("p",null,"No policies found")):e.createElement(e.Fragment,null,e.createElement(We.t,{cols:K,isExpandable:!0,items:_,testIdGenerator:()=>"am-routes-row",onCollapse:G,onExpand:M,isExpanded:f=>P===f.id,renderExpandedContent:f=>t||T?e.createElement(nt,{onCancel:()=>{t&&o(),v(!1)},onSave:j=>{const fe=Ne(i,j);v(!1),l(fe)},receivers:c,routes:f.data}):e.createElement(it,{onChange:j=>{const fe=Ne(i,j);l(fe)},receivers:c,routes:f.data,readOnly:s,alertManagerSourceName:A})}),e.createElement(be.s,{isOpen:!!p,title:"Delete notification policy",body:"Deleting this notification policy will permanently remove it. Are you sure you want to delete this policy?",confirmText:"Yes, delete",icon:"exclamation-triangle",onConfirm:()=>{if(p){const f=ut(i,p);l(f),d(void 0)}},onDismiss:()=>d(void 0)}))},gt=({alertManagerSourceName:t,onChange:o,onRootRouteEdit:l,receivers:c,routes:i,readOnly:r=!1})=>{const[s,A]=(0,e.useState)([...i.routes]),[T,v]=(0,e.useState)(!1),p=(0,F.Ko)(t),d=te.Vt.hasPermission(p.create),[P,y]=(0,Je.j)(),{queryString:C,contactPoint:u}=(0,ee.$f)(P),[E,b]=(0,e.useState)({queryString:C,contactPoint:u});(0,ze.Z)(()=>{y({queryString:E.queryString,contactPoint:E.contactPoint})},400,[E]);const M=(0,g.wW)(pt),G=()=>{b({queryString:void 0,contactPoint:void 0}),y({queryString:void 0,contactPoint:void 0})},K=()=>{G(),v(!0),A(()=>[...i.routes,{...le,matchers:[Ae]}])},L=()=>{v(!1),A([...i.routes])},_=f=>{o({...i,routes:f}),T&&v(!1)};return e.createElement("div",{className:M.container},e.createElement("h5",null,"Specific routing"),e.createElement("p",null,"Send specific alerts to chosen contact points, based on matching criteria"),i.receiver?s.length>0?e.createElement(e.Fragment,null,e.createElement("div",null,!T&&e.createElement("div",{className:M.searchContainer},e.createElement(He.F,{onFilterChange:f=>b(j=>({...j,queryString:f})),defaultQueryString:E.queryString??"",className:M.filterInput}),e.createElement("div",{className:M.filterInput},e.createElement(we._,null,"Search by contact point"),e.createElement(Z.I,{onChange:({currentTarget:f})=>b(j=>({...j,contactPoint:f.value})),value:E.contactPoint??"",placeholder:"Search by contact point","data-testid":"search-query-input",prefix:e.createElement(_e.J,{name:"search"})})),(C||u)&&e.createElement(I.zx,{variant:"secondary",icon:"times",onClick:G,className:M.clearFilterBtn},"Clear filters")),!T&&!r&&e.createElement(U.q,{actions:[p.create]},e.createElement("div",{className:M.addMatcherBtnRow},e.createElement(I.zx,{className:M.addMatcherBtn,icon:"plus",onClick:K,type:"button"},"New policy")))),e.createElement(Ve,{isAddMode:T,readOnly:r,onCancelAdd:L,onChange:_,receivers:c,routes:s,filters:{queryString:C,contactPoint:u},alertManagerSourceName:t})):r?e.createElement(oe,null,e.createElement("p",null,"There are no specific policies configured.")):e.createElement(de,{buttonIcon:"plus",buttonLabel:"New specific policy",onButtonClick:K,text:"You haven't created any specific policies yet.",showButton:d}):r?e.createElement(oe,null,e.createElement("p",null,"There is no default contact point configured for the root route.")):e.createElement(de,{buttonIcon:"rocket",buttonLabel:"Set a default contact point",onButtonClick:l,text:"You haven't set a default contact point for the root route yet.",showButton:d}))},pt=t=>({container:n.css`
      display: flex;
      flex-flow: column wrap;
    `,searchContainer:n.css`
      display: flex;
      flex-flow: row nowrap;
      padding-bottom: ${t.spacing(2)};
      border-bottom: 1px solid ${t.colors.border.strong};
    `,clearFilterBtn:n.css`
      align-self: flex-end;
      margin-left: ${t.spacing(1)};
    `,filterInput:n.css`
      width: 340px;
      & + & {
        margin-left: ${t.spacing(1)};
      }
    `,addMatcherBtnRow:n.css`
      display: flex;
      flex-flow: column nowrap;
      padding: ${t.spacing(2)} 0;
    `,addMatcherBtn:n.css`
      align-self: flex-end;
    `});var vt=a(52259);const Et=()=>{const t=(0,h.useDispatch)(),{useGetAlertmanagerChoiceQuery:o}=x.h,l=(0,g.wW)(yt),[c,i]=(0,e.useState)(!1),r=(0,Be.k)("notification"),[s,A]=(0,xe.k)(r),{currentData:T}=o(),v=(0,ve._)(f=>f.amConfigs),p=(0,e.useCallback)(()=>{s&&t((0,Ee.Yh)(s))},[s,t]);(0,e.useEffect)(()=>{p()},[p]);const{result:d,loading:P,error:y}=s&&v[s]||se.oq,C=d?.alertmanager_config,[u,E]=(0,e.useMemo)(()=>Pe(C?.route),[C?.route]),b=(0,vt.Kt)(C?.receivers??[]),M=(0,e.useMemo)(()=>Boolean(C?.route?.provenance),[C?.route]),G=()=>{i(!0)},K=()=>{i(!1)};(0,W.x)(f=>f.unifiedAlerting.saveAMConfig=se.oq);const L=f=>{if(!d)return;const j=Me(s,{...u,...f},E);c&&K(),t((0,Ee.mM)({newConfig:{...d,alertmanager_config:{...d.alertmanager_config,route:j}},oldConfig:d,alertManagerSourceName:s,successMessage:"Saved",refetch:!0}))};if(!s)return e.createElement($.J,{pageId:"am-routes"},e.createElement(H.I,{availableAlertManagers:r}));const _=s?(0,ye.RY)(s)||M:!0;return e.createElement($.J,{pageId:"am-routes"},e.createElement(S.P,{current:s,onChange:A,dataSources:r}),y&&!P&&e.createElement(m.b,{severity:"error",title:"Error loading Alertmanager config"},y.message||"Unknown error."),e.createElement(J.u,{currentAlertmanager:s,alertmanagerChoice:T}),M&&e.createElement(D.Xq,{resource:D.Uv.RootNotificationPolicy}),P&&e.createElement(O.u,{text:"Loading Alertmanager config..."}),d&&!P&&!y&&e.createElement(e.Fragment,null,e.createElement(Fe,{readOnly:_,alertManagerSourceName:s,isEditMode:c,onSave:L,onEnterEditMode:G,onExitEditMode:K,receivers:b,routes:u}),e.createElement("div",{className:l.break}),e.createElement(gt,{alertManagerSourceName:s,onChange:L,readOnly:_,onRootRouteEdit:G,receivers:b,routes:u}),e.createElement("div",{className:l.break}),e.createElement(Se,{alertManagerSourceName:s})))},ft=(0,B.Pf)(Et,{style:"page"}),yt=t=>({break:n.css`
    width: 100%;
    height: 0;
    margin-bottom: ${t.spacing(2)};
  `})},30173:(z,R,a)=>{a.d(R,{h:()=>e});var n=a(29427);const e=n.C.injectEndpoints({endpoints:g=>({getAlertmanagerChoice:g.query({query:()=>({url:"/api/v1/ngalert"}),providesTags:["AlertmanagerChoice"],transformResponse:m=>m.alertmanagersChoice}),getExternalAlertmanagerConfig:g.query({query:()=>({url:"/api/v1/ngalert/admin_config"}),providesTags:["AlertmanagerChoice"]}),getExternalAlertmanagers:g.query({query:()=>({url:"/api/v1/ngalert/alertmanagers"}),transformResponse:m=>m.data}),saveExternalAlertmanagersConfig:g.mutation({query:m=>({url:"/api/v1/ngalert/admin_config",method:"POST",data:m}),invalidatesTags:["AlertmanagerChoice"]})})})},45524:(z,R,a)=>{a.d(R,{J:()=>g});var n=a(68404),e=a(79396);const g=({children:m,pageId:O,pageNav:B,isLoading:h})=>n.createElement(e.T,{pageNav:B,navId:O},n.createElement(e.T.Contents,{isLoading:h},m))},51981:(z,R,a)=>{a.d(R,{q:()=>g});var n=a(68404),e=a(82002);const g=({actions:m,children:O,fallback:B=!0})=>m.some(h=>e.Vt.hasAccess(h,B))?n.createElement(n.Fragment,null,O):null},731:(z,R,a)=>{a.d(R,{u:()=>h});var n=a(52423),e=a(68404),g=a(29516),m=a(2323),O=a(39031),B=a(45849);function h({alertmanagerChoice:x,currentAlertmanager:S}){const $=(0,g.wW)(W);return S!==B.GC||x!==O.TE.External?null:e.createElement(m.b,{title:"Grafana alerts are not delivered to Grafana Alertmanager"},"Grafana is configured to send alerts to external Alertmanagers only. Changing Grafana Alertmanager configuration will not affect delivery of your alerts!",e.createElement("div",{className:$.adminHint},"You can change the configuration on the Alerting Admin page. If you do not have access, contact your Administrator"))}const W=x=>({adminHint:n.css`
    font-size: ${x.typography.bodySmall.fontSize};
    font-weight: ${x.typography.bodySmall.fontWeight};
  `})},88331:(z,R,a)=>{a.d(R,{I:()=>h});var n=a(68404),e=a(2323),g=a(29614),m=a(94984);const O=()=>n.createElement(e.b,{title:"No Alertmanager found",severity:"warning"},"We could not find any external Alertmanagers and you may not have access to the built-in Grafana Alertmanager."),B=()=>n.createElement(e.b,{title:"Selected Alertmanager not found. Select a different Alertmanager.",severity:"warning"},"Selected Alertmanager no longer exists or you may not have permission to access it."),h=({availableAlertManagers:W})=>{const[x,S]=(0,g.k)(W),$=W.length>0;return n.createElement("div",null,$?n.createElement(n.Fragment,null,n.createElement(m.P,{onChange:S,dataSources:W}),n.createElement(B,null)):n.createElement(O,null))}},40106:(z,R,a)=>{a.d(R,{C0:()=>B,Uv:()=>m,Xq:()=>O});var n=a(68404),e=a(2323),g=a(68884),m=(h=>(h.ContactPoint="contact point",h.Template="template",h.MuteTiming="mute timing",h.AlertRule="alert rule",h.RootNotificationPolicy="root notification policy",h))(m||{});const O=({resource:h})=>n.createElement(e.b,{title:`This ${h} cannot be edited through the UI`,severity:"info"},"This ",h," has been provisioned, that means it was created by config. Please contact your server admin to update this ",h,"."),B=()=>n.createElement(g.C,{text:"Provisioned",color:"purple"})},30151:(z,R,a)=>{a.d(R,{F:()=>H});var n=a(52423),e=a(82897),g=a.n(e),m=a(68404),O=a(26418),B=a(184),h=a(29516),W=a(81697),x=a(38835),S=a(48756),$=a(25474),J=a(41904);const H=({className:I,onFilterChange:U,defaultQueryString:F})=>{const k=(0,h.wW)(D),N=(0,m.useMemo)(()=>(0,e.debounce)(w=>{(0,B.PN)(J.z7.filterByLabel);const ae=w.target;U(ae.value)},600),[U]);(0,m.useEffect)(()=>N.cancel(),[N]);const V=m.createElement(W.J,{name:"search"});return m.createElement("div",{className:I},m.createElement(x._,null,m.createElement(O.Stack,{gap:.5},m.createElement("span",null,"Search by label"),m.createElement(S.u,{content:m.createElement("div",null,"Filter alerts using label querying, ex:",m.createElement("pre",null,'{severity="critical", instance=~"cluster-us-.+"}'))},m.createElement(W.J,{className:k.icon,name:"info-circle",size:"sm"})))),m.createElement($.I,{placeholder:"Search",defaultValue:F,onChange:N,"data-testid":"search-query-input",prefix:V,className:k.inputWidth}))},D=I=>({icon:n.css`
    margin-right: ${I.spacing(.5)};
  `,inputWidth:n.css`
    width: 340px;
    flex-grow: 0;
  `})},44479:(z,R,a)=>{a.d(R,{i:()=>h});var n=a(52423),e=a(68404),g=a(29516),m=a(90701),O=a(2390);const B={[O.W.OnCall]:"public/img/alerting/oncall_logo.svg",[O.W.Incident]:"",[O.W.MachineLearning]:""},h=({grafanaAppType:x})=>{const S=(0,g.wW)(W);return e.createElement("div",{className:S.wrapper},e.createElement(m.Lh,{align:"center",spacing:"xs"},e.createElement("img",{src:B[x],alt:"",height:"12px"}),e.createElement("span",null,x)))},W=x=>({wrapper:n.css`
    text-align: left;
    height: 22px;
    display: inline-flex;
    padding: 1px 4px;
    border-radius: 3px;
    border: 1px solid rgba(245, 95, 62, 1);
    color: rgba(245, 95, 62, 1);
    font-weight: ${x.typography.fontWeightRegular};
  `})},52259:(z,R,a)=>{a.d(R,{Kt:()=>J,HU:()=>H});var n=a(3363),e=a(47214),g=a(29427);const m=g.C.injectEndpoints({endpoints:D=>({getOnCallIntegrations:D.query({queryFn:async()=>({data:await O()}),providesTags:["AlertmanagerChoice"]})})});async function O(){try{return(await(0,n.n)((0,e.i)().fetch({url:"/api/plugin-proxy/grafana-oncall-app/api/internal/v1/alert_receive_channels/",showErrorAlert:!1,showSuccessAlert:!1}))).data.map(I=>I.integration_url)}catch{return[]}}const{useGetOnCallIntegrationsQuery:B}=m;var h=a(58509),W=a(2390);const x=(D,I)=>I.includes(D),S=(D,I)=>{if(!D.grafana_managed_receiver_configs)return!1;const U=D.grafana_managed_receiver_configs.length===1,F=x(D.grafana_managed_receiver_configs[0]?.settings?.url??"",I);return U&&F},$=()=>{const{installed:D}=(0,h.n)(W.W.OnCall),{data:I}=B(void 0,{skip:!D});return F=>{if(D&&S(F,I??[]))return W.W.OnCall}},J=D=>{const I=$(),U=F=>({label:F.name,value:F.name,grafanaAppReceiverType:I(F)});return D.map(U)},H=D=>{const I=$();return D.map(U=>({...U,grafanaAppReceiverType:I(U)}))}},99631:(z,R,a)=>{a.d(R,{g:()=>B});var n=a(52423),e=a(68404),g=a(29516),m=a(36012),O=a(20194);const B=({matchers:W})=>{const x=(0,g.wW)(h);return e.createElement("div",null,e.createElement(m.P,{className:x.tags,tags:W.map(S=>`${S.name}${(0,O.zy)(S)}${S.value}`)}))},h=()=>({tags:n.css`
    justify-content: flex-start;
  `})},29614:(z,R,a)=>{a.d(R,{k:()=>h});var n=a(68404),e=a(96044),g=a(58379),m=a(37190),O=a(45849);function B(W){return(0,n.useCallback)(x=>W.map($=>$.name).includes(x),[W])}function h(W){const[x,S]=(0,e.K)(),$=B(W),J=(0,n.useCallback)(I=>{$(I)&&(I===O.GC?(g.Z.delete(m.de),S({[m.c4]:null})):(g.Z.set(m.de,I),S({[m.c4]:I})))},[S,$]),H=x[m.c4];if(H&&typeof H=="string")return $(H)?[H,J]:[void 0,J];const D=g.Z.get(m.de);return D&&typeof D=="string"&&$(D)?(J(D),[D,J]):$(O.GC)?[O.GC,J]:[void 0,J]}},23403:(z,R,a)=>{a.d(R,{k:()=>g});var n=a(68404),e=a(45849);function g(m){return(0,n.useMemo)(()=>(0,e.LE)(m),[m])}},58509:(z,R,a)=>{a.d(R,{n:()=>g});var n=a(22350),e=a(13011);function g(m){const{loading:O,error:B,value:h}=(0,n.Z)(()=>(0,e.a)(m,{showErrorAlert:!1})),W=h&&!B&&!O,x=h?.enabled;return O&&!h?{loading:!0}:!W||!x?{loading:!1,installed:!1}:{loading:O,installed:!0,settings:h}}},31808:(z,R,a)=>{a.d(R,{j:()=>m});var n=a(68404),e=a(70356),g=a(57388);function m(){const{search:O}=(0,e.TH)(),B=(0,n.useMemo)(()=>new URLSearchParams(O),[O]),h=(0,n.useCallback)((W,x)=>{g.E1.partial(W,x)},[]);return[B,h]}},2390:(z,R,a)=>{a.d(R,{W:()=>n});var n=(e=>(e.Incident="grafana-incident-app",e.OnCall="grafana-oncall-app",e.MachineLearning="grafana-ml-app",e))(n||{})}}]);

//# sourceMappingURL=AlertAmRoutes.43435d241952ff5b1466.js.map