"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2461,4286],{65007:(Y,F,a)=>{a.r(F),a.d(F,{AlertRuleListUnconnected:()=>de,default:()=>ve});var n=a(68404),e=a(36635),A=a(57388),O=a(93003),N=a(79230),M=a(46739),P=a(90723),w=a(90701),L=a(97063),K=a(79396),H=a(45984),z=a(6694);function y({onDismiss:E}){return n.createElement(z.u,{title:"Adding an Alert",isOpen:!0,onDismiss:E,onClickBackdrop:E},n.createElement(w.wc,{spacing:"sm"},n.createElement("img",{src:"public/img/alert_howto_new.png",alt:""}),n.createElement("p",null,"Alerts are added and configured in the Alert tab of any dashboard graph panel, letting you build and visualize an alert using existing queries."),n.createElement("p",null,"Remember to save the dashboard to persist your alert rule changes.")))}var D=a(47846),$=a.n(D),B=a(66208),ee=a(81697);const Ce=({rule:E,search:S,onTogglePause:G})=>{const oe=`${E.url}?editPanel=${E.panelId}&tab=alert`,j=(0,n.useCallback)(ae=>n.createElement($(),{key:ae,highlightClassName:"highlight-search-match",textToHighlight:ae,searchWords:[S]}),[S]);return n.createElement(B.Z,null,n.createElement(B.Z.Heading,null,j(E.name)),n.createElement(B.Z.Figure,null,n.createElement(ee.J,{size:"xl",name:E.stateIcon,className:`alert-rule-item__icon ${E.stateClass}`})),n.createElement(B.Z.Meta,null,n.createElement("span",{key:"state"},n.createElement("span",{key:"text",className:`${E.stateClass}`},j(E.stateText)," "),"for ",E.stateAge),E.info?j(E.info):null),n.createElement(B.Z.Actions,null,n.createElement(P.zx,{key:"play",variant:"secondary",icon:E.state==="paused"?"play":"pause",onClick:G},E.state==="paused"?"Resume":"Pause"),n.createElement(P.Qj,{key:"edit",variant:"secondary",href:oe,icon:"cog"},"Edit alert")))};var le=a(2323);const Fe="grafana.legacyalerting.unifiedalertingpromo",Se=()=>n.createElement(le.b,{severity:"warning",title:"Grafana legacy alerting is going away soon"},n.createElement("p",null,"You are using Grafana legacy alerting, it has been deprecated and will be removed in the next major version of Grafana.",n.createElement("br",null),"We encourage you to upgrade to the new Grafana Alerting experience."),n.createElement("p",null,"See"," ",n.createElement("a",{href:"https://grafana.com/docs/grafana/latest/alerting/unified-alerting/difference-old-new/"},"What\u2019s New with Grafana Alerting")," ","to learn more about what\u2018s new or learn"," ",n.createElement("a",{href:"https://grafana.com/docs/grafana/latest/alerting/unified-alerting/opt-in/"},"how to enable the new Grafana Alerting feature"),"."));var se=a(69119),Q=a(11626);const b=E=>E.searchQuery,te=E=>{const S=new RegExp(E.alertRules.searchQuery,"i");return E.alertRules.items.filter(G=>S.test(G.name)||S.test(G.stateText)||S.test(G.info))},W=(E,S)=>E.notificationChannel.id===S?E.notificationChannel:null;function xe(E){return{alertRules:te(E),search:b(E.alertRules),isLoading:E.alertRules.isLoading}}const Ne={getAlertRulesAsync:se.Au,setSearchQuery:Q.ql,togglePauseAlertRule:se.en},he=(0,e.connect)(xe,Ne);class de extends n.PureComponent{constructor(){super(...arguments),this.stateFilters=[{label:"All",value:"all"},{label:"OK",value:"ok"},{label:"Not OK",value:"not_ok"},{label:"Alerting",value:"alerting"},{label:"No data",value:"no_data"},{label:"Paused",value:"paused"},{label:"Pending",value:"pending"}],this.onStateFilterChanged=S=>{A.E1.partial({state:S.value})},this.onOpenHowTo=()=>{L.Z.publish(new H.Dn({component:y}))},this.onSearchQueryChange=S=>{this.props.setSearchQuery(S)},this.onTogglePause=S=>{this.props.togglePauseAlertRule(S.id,{paused:S.state!=="paused"})},this.alertStateFilterOption=({text:S,value:G})=>n.createElement("option",{key:G,value:G},S)}componentDidMount(){this.fetchRules()}componentDidUpdate(S){S.queryParams.state!==this.props.queryParams.state&&this.fetchRules()}async fetchRules(){await this.props.getAlertRulesAsync({state:this.getStateFilter()})}getStateFilter(){return this.props.queryParams.state??"all"}render(){const{alertRules:S,search:G,isLoading:oe}=this.props;return n.createElement(K.T,{navId:"alert-list"},n.createElement(K.T.Contents,{isLoading:oe},n.createElement("div",{className:"page-action-bar"},n.createElement("div",{className:"gf-form gf-form--grow"},n.createElement(N.H,{placeholder:"Search alerts",value:G,onChange:this.onSearchQueryChange})),n.createElement("div",{className:"gf-form"},n.createElement("label",{className:"gf-form-label",htmlFor:"alert-state-filter"},"States"),n.createElement("div",{className:"width-13"},n.createElement(M.Ph,{inputId:"alert-state-filter",options:this.stateFilters,onChange:this.onStateFilterChanged,value:this.getStateFilter()}))),n.createElement("div",{className:"page-action-bar__spacer"}),O.v.unifiedAlertingEnabled&&n.createElement(P.Qj,{variant:"primary",href:"alerting/ng/new"},"Add NG Alert"),n.createElement(P.zx,{variant:"secondary",onClick:this.onOpenHowTo},"How to add an alert")),n.createElement(Se,null),n.createElement(w.wc,{spacing:"none"},S.map(j=>n.createElement(Ce,{rule:j,key:j.id,search:G,onTogglePause:()=>this.onTogglePause(j)})))))}}const ve=he(de)},69119:(Y,F,a)=>{a.d(F,{Au:()=>M,C2:()=>w,c1:()=>K,en:()=>P,fA:()=>H,fg:()=>L,tk:()=>z});var n=a(47214),e=a(57388),A=a(659),O=a(60499),N=a(11626);function M(y){return async D=>{D((0,N.gz)());const $=await(0,n.i)().get("/api/alerts",y);D((0,N.Oc)($))}}function P(y,D){return async $=>{await(0,n.i)().post(`/api/alerts/${y}/pause`,D);const B=e.E1.getSearchObject().state||"all";$(M({state:B.toString()}))}}function w(y){return async D=>{try{await(0,n.i)().post("/api/alert-notifications",y),D((0,A.$l)((0,O.AT)("Notification created"))),e.E1.push("/alerting/notifications")}catch($){(0,n.kW)($)&&D((0,A.$l)((0,O.t_)($.data.error)))}}}function L(y){return async D=>{try{await(0,n.i)().put(`/api/alert-notifications/${y.id}`,y),D((0,A.$l)((0,O.AT)("Notification updated")))}catch($){(0,n.kW)($)&&D((0,A.$l)((0,O.t_)($.data.error)))}}}function K(y){return async(D,$)=>{const B=$().notificationChannel.notificationChannel;await(0,n.i)().post("/api/alert-notifications/test",{id:B.id,...y})}}function H(){return async y=>{const $=(await(0,n.i)().get("/api/alert-notifiers")).sort((B,ee)=>B.name>ee.name?1:-1);y((0,N.T2)($))}}function z(y){return async D=>{await D(H());const $=await(0,n.i)().get(`/api/alert-notifications/${y}`);D((0,N.K)($))}}},67376:(Y,F,a)=>{a.r(F),a.d(F,{default:()=>Mt});var n=a(52423),e=a(68404),A=a(70356),O=a(671),N=a(78337),M=a(27677),P=a(184),w=a(78758),L=a(29516),K=a(90723),H=a(96044),z=a(81168),y=a(41904),D=a(45524),$=a(86373),B=a(69142),ee=a(39910);const Ie=()=>{const{canCreateGrafanaRules:t,canCreateCloudRules:r}=(0,ee.B)();return t||r?e.createElement(B.Z,{title:"You haven`t created any alert rules yet",buttonIcon:"bell",buttonLink:"alerting/new",buttonTitle:"New alert rule",proTip:"you can also create alert rules from existing panels and queries.",proTipLink:"https://grafana.com/docs/",proTipLinkTitle:"Learn more",proTipTarget:"_blank",onClick:()=>(0,P.PN)(y.z7.alertRuleFromScratch)}):e.createElement($._,{message:"No rules exist yet.",callToActionElement:e.createElement("div",null)})};var Ce=a(64681),le=a.n(Ce),Fe=a(24664),Se=a(2323),se=a(48756),Q=a(79370),b=a(45849),te=a(10505),W=a(79662);function xe(){const[t,r]=(0,e.useState)(!1),[s,i]=(0,Fe.Z)("grafana.unifiedalerting.hideErrors",!1),l=(0,Q._)(m=>m.dataSources),c=(0,Q._)(m=>m.promRules),u=(0,Q._)(m=>m.rulerRules),o=(0,L.wW)(he),g=(0,e.useMemo)(()=>{const[m,v,p]=[l,c,u].map(f=>(0,b.Eu)().reduce((d,U)=>{const V=f[U.name]?.error;return f[U.name]&&V&&!(0,W.m$)(f[U.name])?[...d,{dataSource:U,error:V}]:d},[])),R=c[b.GC]?.error,x=u[b.GC]?.error,T=[];return R&&T.push(e.createElement(e.Fragment,null,"Failed to load Grafana rules state: ",R.message||"Unknown error.")),x&&T.push(e.createElement(e.Fragment,null,"Failed to load Grafana rules config: ",x.message||"Unknown error.")),m.forEach(({dataSource:f,error:d})=>{T.push(e.createElement(e.Fragment,null,"Failed to load the data source configuration for"," ",e.createElement("a",{href:(0,te.__)(f),className:o.dsLink},f.name),": ",d.message||"Unknown error."))}),v.forEach(({dataSource:f,error:d})=>T.push(e.createElement(e.Fragment,null,"Failed to load rules state from"," ",e.createElement("a",{href:(0,te.__)(f),className:o.dsLink},f.name),": ",d.message||"Unknown error."))),p.forEach(({dataSource:f,error:d})=>T.push(e.createElement(e.Fragment,null,"Failed to load rules config from"," ",e.createElement("a",{href:(0,te.__)(f),className:o.dsLink},f.name),": ",d.message||"Unknown error."))),T},[l,c,u,o.dsLink]);return e.createElement(e.Fragment,null,!!g.length&&s&&e.createElement(Ne,{count:g.length,onClick:()=>i(m=>!m)}),!!g.length&&!s&&e.createElement(Se.b,{"data-testid":"cloud-rulessource-errors",title:"Errors loading rules",severity:"error",onRemove:()=>i(!0)},t&&g.map((m,v)=>e.createElement("div",{key:v},m)),!t&&e.createElement(e.Fragment,null,e.createElement("div",null,g[0]),g.length>=2&&e.createElement(K.zx,{className:o.moreButton,fill:"text",icon:"angle-right",size:"sm",onClick:()=>r(!0)},g.length-1," more ",le()("error",g.length-1)))))}const Ne=({count:t,onClick:r})=>{const s=(0,L.wW)(he);return e.createElement("div",{className:s.floatRight},e.createElement(se.u,{content:"Show all errors",placement:"bottom"},e.createElement(K.zx,{fill:"text",variant:"destructive",icon:"exclamation-triangle",onClick:r},t>1?e.createElement(e.Fragment,null,t," errors"):e.createElement(e.Fragment,null,"1 error"))))},he=t=>({moreButton:n.css`
    padding: 0;
  `,floatRight:n.css`
    display: flex;
    justify-content: flex-end;
  `,dsLink:n.css`
    font-weight: ${t.typography.fontWeightBold};
  `});var de=a(51981),ve=a(90090),E=a(40008),S=a(89891),G=a(84952),oe=a(25724),j=a(1562),ae=a(46818),X=a(26418),Qe=a(90701),ce=a(81697),J=a(68884),je=a(81202),Ve=a(55485),Ze=a(8055),ye=a(72004),De=a(33950),$e=a(29721),ne=a(65750),Je=a(61068),ke=a(9085),Oe=a.n(ke),ge=a(82897),Pe=a(19677),Ye=a(6694),Xe=a(3153),qe=a(60048),_e=a(45608);const et=t=>{const{group:r,namespace:s,onClose:i}=t,[l,c]=(0,e.useState)(!1),[u,o]=(0,e.useState)(r.rules),g=(0,L.wW)(Ae),m=(0,e.useCallback)(p=>{if(!p.destination||p.destination.index===p.source.index)return;const x=at(u,p.source.index,p.destination.index);o(x);const T=(0,b.EG)(s.rulesSource),f=(0,ge.compact)(x.map(d=>d.rulerRule));c(!0),(0,Xe.WI)((0,ye.tg)({namespaceName:s.name,groupName:r.name,rulesSourceName:T,newRules:f})).unwrap().finally(()=>{c(!1)})},[r.name,s.name,s.rulesSource,u]),v=u.map(p=>({...p,uid:String((0,qe.Om)(p.rulerRule))}));return e.createElement(Ye.u,{className:g.modal,isOpen:!0,title:e.createElement(tt,{namespace:s,group:r}),onDismiss:i,onClickBackdrop:i},e.createElement(Pe.Z5,{onDragEnd:m},e.createElement(Pe.bK,{droppableId:"alert-list",mode:"standard",renderClone:(p,R,x)=>e.createElement(Me,{provided:p,rule:v[x.source.index],isClone:!0})},p=>e.createElement("div",{ref:p.innerRef,className:Oe()(g.listContainer,l&&g.disabled),...p.droppableProps},v.map((R,x)=>e.createElement(Pe._l,{key:R.uid,draggableId:R.uid,index:x,isDragDisabled:l},T=>e.createElement(Me,{key:R.uid,provided:T,rule:R}))),p.placeholder))))},Me=({provided:t,rule:r,isClone:s=!1,isDragging:i=!1})=>{const l=(0,L.wW)(Ae);return e.createElement("div",{className:Oe()(l.listItem,s&&"isClone",i&&"isDragging"),ref:t.innerRef,...t.draggableProps,...t.dragHandleProps},(0,W.x_)(r.promRule)&&e.createElement(_e.l,{state:r.promRule.state}),(0,W.OP)(r.promRule)&&e.createElement(J.C,{text:"Recording",color:"blue"}),e.createElement("div",{className:l.listItemName},r.name),e.createElement(ce.J,{name:"draggabledots"}))},tt=({namespace:t,group:r})=>{const s=(0,L.wW)(Ae);return e.createElement("div",{className:s.header},e.createElement(ce.J,{name:"folder"}),(0,b.jq)(t.rulesSource)&&e.createElement(se.u,{content:t.rulesSource.name,placement:"top"},e.createElement("img",{alt:t.rulesSource.meta.name,className:s.dataSourceIcon,src:t.rulesSource.meta.info.logos.small})),e.createElement("span",null,t.name),e.createElement(ce.J,{name:"angle-right"}),e.createElement("span",null,r.name))},Ae=t=>({modal:n.css`
    max-width: 640px;
    max-height: 80%;
    overflow: hidden;
  `,listItem:n.css`
    display: flex;
    flex-direction: row;
    align-items: center;

    gap: ${t.spacing()};

    background: ${t.colors.background.primary};
    color: ${t.colors.text.secondary};

    border-bottom: solid 1px ${t.colors.border.medium};
    padding: ${t.spacing(1)} ${t.spacing(2)};

    &:last-child {
      border-bottom: none;
    }

    &.isClone {
      border: solid 1px ${t.colors.primary.shade};
    }
  `,listContainer:n.css`
    user-select: none;
    border: solid 1px ${t.colors.border.medium};
  `,disabled:n.css`
    opacity: 0.5;
    pointer-events: none;
  `,listItemName:n.css`
    flex: 1;

    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  `,header:n.css`
    display: flex;
    align-items: center;

    gap: ${t.spacing(1)};
  `,dataSourceIcon:n.css`
    width: ${t.spacing(2)};
    height: ${t.spacing(2)};
  `});function at(t,r,s){const i=Array.from(t),[l]=i.splice(r,1);return i.splice(s,0,l),i}var h=a(46063);const nt={total:0,recording:0,[h.x_.Firing]:0,[h.x_.Pending]:0,[h.x_.Inactive]:0,error:0},be=({group:t,namespaces:r,includeTotal:s})=>{const i=t?.interval,l=(0,e.useMemo)(()=>{const o={...nt},g=m=>{m.promRule&&(0,W.x_)(m.promRule)&&(o[m.promRule.state]+=1),rt(m)&&(o.error+=1),(m.promRule&&(0,W.OP)(m.promRule)||m.rulerRule&&(0,W.yF)(m.rulerRule))&&(o.recording+=1),o.total+=1};return t&&t.rules.forEach(g),r&&r.forEach(m=>m.groups.forEach(v=>v.rules.forEach(g))),o},[t,r]),c=[];s&&c.push(e.createElement(e.Fragment,{key:"total"},l.total," ",le()("rule",l.total))),l[h.x_.Firing]&&c.push(e.createElement(J.C,{color:"red",key:"firing",text:`${l[h.x_.Firing]} firing`})),l.error&&c.push(e.createElement(J.C,{color:"red",key:"errors",text:`${l.error} errors`})),l[h.x_.Pending]&&c.push(e.createElement(J.C,{color:"orange",key:"pending",text:`${l[h.x_.Pending]} pending`})),l[h.x_.Inactive]&&c.push(e.createElement(J.C,{color:"green",key:"inactive",text:`${l[h.x_.Inactive]} normal`})),l.recording&&c.push(e.createElement(J.C,{color:"purple",key:"recording",text:`${l.recording} recording`}));const u=Boolean(c.length);return e.createElement(X.Stack,{direction:"row"},u&&e.createElement("div",null,e.createElement(X.Stack,{gap:.5},c)),i&&e.createElement(e.Fragment,null,e.createElement("div",null,"|"),e.createElement(J.C,{text:i,icon:"clock-nine",color:"blue"})))};function rt(t){return t.promRule?.health==="err"||t.promRule?.health==="error"}var We=a(25048);const Le=e.memo(({group:t,namespace:r,expandAll:s,viewMode:i})=>{const{rulesSource:l}=r,c=(0,z.useDispatch)(),u=(0,L.wW)(lt),[o,g]=(0,e.useState)(!1),[m,v]=(0,e.useState)(!1),[p,R]=(0,e.useState)(!1),[x,T]=(0,e.useState)(!s),{canEditRules:f}=(0,ee.B)();(0,e.useEffect)(()=>{T(!s)},[s]);const{hasRuler:d,rulerRulesLoaded:U}=(0,Ze.h)(),V=t.rules[0]?.rulerRule,ie=V&&(0,W.Pc)(V)&&V.grafana_alert.namespace_uid||void 0,{folder:ue}=(0,Ve.W)(ie),re=d(l)&&U(l)&&!t.rules.find(k=>!!k.rulerRule),me=(0,W.Jq)(t),I=t.rules.some(k=>(0,W.Pc)(k.rulerRule)&&k.rulerRule.grafana_alert.provenance),C=i==="list",_=i==="grouped",bt=()=>{c((0,ye.oE)(r,t)),v(!1)},Z=[];if(re)Z.push(e.createElement(Qe.Lh,{key:"is-deleting"},e.createElement(E.$,null),"deleting"));else if(l===b.GC){if(ie){const k=(0,te.HV)(ie);ue?.canSave&&(_&&!I&&(Z.push(e.createElement(ne.A,{"aria-label":"edit rule group","data-testid":"edit-group",key:"edit",icon:"pen",tooltip:"edit rule group",onClick:()=>g(!0)})),Z.push(e.createElement(ne.A,{"aria-label":"re-order rules","data-testid":"reorder-group",key:"reorder",icon:"exchange-alt",tooltip:"reorder rules",className:u.rotate90,onClick:()=>R(!0)}))),C&&Z.push(e.createElement(ne.A,{"aria-label":"go to folder",key:"goto",icon:"folder-open",tooltip:"go to folder",to:k,target:"__blank"}))),ue?.canAdmin&&C&&Z.push(e.createElement(ne.A,{"aria-label":"manage permissions",key:"manage-perms",icon:"lock",tooltip:"manage permissions",to:k+"/permissions",target:"__blank"}))}}else f(l.name)&&d(l)&&(me||(Z.push(e.createElement(ne.A,{"aria-label":"edit rule group","data-testid":"edit-group",key:"edit",icon:"pen",tooltip:"edit rule group",onClick:()=>g(!0)})),Z.push(e.createElement(ne.A,{"aria-label":"re-order rules","data-testid":"reorder-group",key:"reorder",icon:"exchange-alt",tooltip:"re-order rules",className:u.rotate90,onClick:()=>R(!0)}))),Z.push(e.createElement(ne.A,{"aria-label":"delete rule group","data-testid":"delete-group",key:"delete-group",icon:"trash-alt",tooltip:"delete rule group",onClick:()=>v(!0)})));const Wt=C?e.createElement($e.V,{namespace:r.name}):e.createElement($e.V,{namespace:r.name,group:t.name}),Gt=(k=!1)=>{k||(0,P.PN)(y.z7.leavingRuleGroupEdit),g(!1)};return e.createElement("div",{className:u.wrapper,"data-testid":"rule-group"},e.createElement("div",{className:u.header,"data-testid":"rule-group-header"},e.createElement(De.U,{size:"sm",className:u.collapseToggle,isCollapsed:x,onToggle:T,"data-testid":"group-collapse-toggle"}),e.createElement(ce.J,{name:x?"folder":"folder-open"}),(0,b.jq)(l)&&e.createElement(se.u,{content:l.name,placement:"top"},e.createElement("img",{alt:l.meta.name,className:u.dataSourceIcon,src:l.meta.info.logos.small})),e.createElement("h6",{className:u.heading},me&&e.createElement(J.C,{color:"purple",text:"Federated"})," ",Wt),e.createElement("div",{className:u.spacer}),e.createElement("div",{className:u.headerStats},e.createElement(be,{group:t})),I&&e.createElement(e.Fragment,null,e.createElement("div",{className:u.actionsSeparator},"|"),e.createElement("div",{className:u.actionIcons},e.createElement(J.C,{color:"purple",text:"Provisioned"}))),!!Z.length&&e.createElement(e.Fragment,null,e.createElement("div",{className:u.actionsSeparator},"|"),e.createElement("div",{className:u.actionIcons},e.createElement(X.Stack,{gap:.5},Z)))),!x&&e.createElement(We.i,{showSummaryColumn:!0,className:u.rulesTable,showGuidelines:!0,rules:t.rules}),o&&e.createElement(Je.vq,{groupInterval:t.interval??"",nameSpaceAndGroup:{group:t,namespace:r},sourceName:(0,b.EG)(r.rulesSource),onClose:()=>Gt()}),p&&e.createElement(et,{group:t,namespace:r,onClose:()=>R(!1)}),e.createElement(je.s,{isOpen:m,title:"Delete group",body:e.createElement("div",null,"Deleting this group will permanently remove the group",e.createElement("br",null),"and ",t.rules.length," alert ",le()("rule",t.rules.length)," belonging to it.",e.createElement("br",null),"Are you sure you want to delete this group?"),onConfirm:bt,onDismiss:()=>v(!1),confirmText:"Delete"}))});Le.displayName="RulesGroup";const lt=t=>({wrapper:n.css`
    & + & {
      margin-top: ${t.spacing(2)};
    }
  `,header:n.css`
    display: flex;
    flex-direction: row;
    align-items: center;
    padding: ${t.spacing(1)} ${t.spacing(1)} ${t.spacing(1)} 0;
    background-color: ${t.colors.background.secondary};
    flex-wrap: wrap;
  `,headerStats:n.css`
    span {
      vertical-align: middle;
    }

    ${t.breakpoints.down("sm")} {
      order: 2;
      width: 100%;
      padding-left: ${t.spacing(1)};
    }
  `,heading:n.css`
    margin-left: ${t.spacing(1)};
    margin-bottom: 0;
  `,spacer:n.css`
    flex: 1;
  `,collapseToggle:n.css`
    background: none;
    border: none;
    margin-top: -${t.spacing(1)};
    margin-bottom: -${t.spacing(1)};

    svg {
      margin-bottom: 0;
    }
  `,dataSourceIcon:n.css`
    width: ${t.spacing(2)};
    height: ${t.spacing(2)};
    margin-left: ${t.spacing(2)};
  `,dataSourceOrigin:n.css`
    margin-right: 1em;
    color: ${t.colors.text.disabled};
  `,actionsSeparator:n.css`
    margin: 0 ${t.spacing(2)};
  `,actionIcons:n.css`
    width: 80px;
    align-items: center;
  `,rulesTable:n.css`
    margin-top: ${t.spacing(3)};
  `,rotate90:n.css`
    transform: rotate(90deg);
  `});function Ge(t){return(0,e.useMemo)(()=>t.flatMap(r=>r.groups.map(s=>({namespace:r,group:s}))),[t])}const st=({namespaces:t,expandAll:r})=>{const s=(0,L.wW)(ot),i=(0,Q._)(d=>d.dataSources),l=(0,Q._)(d=>d.promRules),c=(0,e.useMemo)(b.Eu,[]),u=Ge(t),o=(0,e.useMemo)(()=>c.filter(d=>(0,ae.op)(l[d.name])||(0,ae.op)(i[d.name])),[l,i,c]),g=c.some(d=>l[d.name]?.result?.length??0>0),m=c.length>0,v=o.length>0,p=t.length>0,{numberOfPages:R,onPageChange:x,page:T,pageItems:f}=(0,oe.h)(u,1,G.gN);return e.createElement("section",{className:s.wrapper},e.createElement("div",{className:s.sectionHeader},e.createElement("h5",null,"Mimir / Cortex / Loki"),o.length?e.createElement(ve.u,{className:s.loader,text:`Loading rules from ${o.length} ${le()("source",o.length)}`}):e.createElement("div",null)),f.map(({group:d,namespace:U})=>e.createElement(Le,{group:d,key:`${(0,b.v_)(U.rulesSource)}-${U.name}-${d.name}`,namespace:U,expandAll:r,viewMode:"grouped"})),!m&&e.createElement("p",null,"There are no Prometheus or Loki data sources configured."),m&&!v&&!p&&e.createElement("p",null,"No rules found."),!g&&v&&e.createElement(E.$,{size:24,className:s.spinner}),e.createElement(S.t,{className:s.pagination,currentPage:T,numberOfPages:R,onNavigate:x,hideWhenSinglePage:!0}))},ot=t=>({loader:n.css`
    margin-bottom: 0;
  `,sectionHeader:n.css`
    display: flex;
    justify-content: space-between;
  `,wrapper:n.css`
    margin-bottom: ${t.spacing(4)};
  `,spinner:n.css`
    text-align: center;
    padding: ${t.spacing(2)};
  `,pagination:(0,j.Z)(t)});var Ue=a(61627);const ct=({namespaces:t,expandAll:r})=>{const s=(0,L.wW)(it),[i]=(0,H.K)(),{prom:l,ruler:c}=(0,Q._)(f=>({prom:f.promRules[b.GC]||ae.oq,ruler:f.rulerRules[b.GC]||ae.oq})),u=l.loading||c.loading,o=!!l.result||!!c.result,g=i.view==="list",m=g?(0,Ue.Kd)(t):t,v=Ge(m),{numberOfPages:p,onPageChange:R,page:x,pageItems:T}=(0,oe.h)(v,1,G.gN);return e.createElement("section",{className:s.wrapper},e.createElement("div",{className:s.sectionHeader},e.createElement("h5",null,"Grafana"),u?e.createElement(ve.u,{className:s.loader,text:"Loading..."}):e.createElement("div",null)),T.map(({group:f,namespace:d})=>e.createElement(Le,{group:f,key:`${d.name}-${f.name}`,namespace:d,expandAll:r,viewMode:g?"list":"grouped"})),o&&m?.length===0&&e.createElement("p",null,"No rules found."),!o&&u&&e.createElement(E.$,{size:24,className:s.spinner}),e.createElement(S.t,{className:s.pagination,currentPage:x,numberOfPages:p,onNavigate:R,hideWhenSinglePage:!0}))},it=t=>({loader:n.css`
    margin-bottom: 0;
  `,sectionHeader:n.css`
    display: flex;
    justify-content: space-between;
  `,wrapper:n.css`
    margin-bottom: ${t.spacing(4)};
  `,spinner:n.css`
    text-align: center;
    padding: ${t.spacing(2)};
  `,pagination:(0,j.Z)(t)}),ut=({namespaces:t,expandAll:r})=>{const[s,i]=(0,e.useMemo)(()=>{const l=t.map(c=>({...c,groups:c.groups.sort((u,o)=>u.name.localeCompare(o.name))})).sort((c,u)=>c.name.localeCompare(u.name));return[l.filter(c=>(0,b.HY)(c.rulesSource)),l.filter(c=>(0,b.jq)(c.rulesSource))]},[t]);return(0,e.useEffect)(()=>{(0,P.PN)(y.z7.loadedList)},[]),e.createElement(e.Fragment,null,e.createElement(de.q,{actions:[z.AccessControlAction.AlertingRuleRead]},e.createElement(ct,{namespaces:s,expandAll:r})),e.createElement(de.q,{actions:[z.AccessControlAction.AlertingRuleExternalRead]},e.createElement(st,{namespaces:i,expandAll:r})))},Te=({rules:t,state:r,defaultCollapsed:s=!1})=>{const[i,l]=(0,e.useState)(s),c=(0,L.wW)(mt);return e.createElement(e.Fragment,null,e.createElement("h4",{className:c.header},e.createElement(De.U,{className:c.collapseToggle,size:"xxl",isCollapsed:i,onToggle:()=>l(!i)}),(0,W.SS)(r)," (",t.length,")"),!i&&e.createElement(We.i,{className:c.rulesTable,rules:t,showGroupColumn:!0}))},mt=t=>({collapseToggle:n.css`
    vertical-align: middle;
  `,header:n.css`
    margin-top: ${t.spacing(2)};
  `,rulesTable:n.css`
    margin-top: ${t.spacing(3)};
  `}),dt=({namespaces:t})=>{const r=(0,te.lC)((0,H.K)()[0]),s=(0,e.useMemo)(()=>{const i={[h.x_.Firing]:[],[h.x_.Inactive]:[],[h.x_.Pending]:[]};return t.forEach(l=>l.groups.forEach(c=>c.rules.forEach(u=>{u.promRule&&(0,W.x_)(u.promRule)&&i[u.promRule.state].push(u)}))),Object.values(i).forEach(l=>l.sort((c,u)=>c.name.localeCompare(u.name))),i},[t]);return e.createElement(e.Fragment,null,(!r.alertState||r.alertState===h.x_.Firing)&&e.createElement(Te,{state:h.x_.Firing,rules:s[h.x_.Firing]}),(!r.alertState||r.alertState===h.x_.Pending)&&e.createElement(Te,{state:h.x_.Pending,rules:s[h.x_.Pending]}),(!r.alertState||r.alertState===h.x_.Inactive)&&e.createElement(Te,{defaultCollapsed:r.alertState!==h.x_.Inactive,state:h.x_.Inactive,rules:s[h.x_.Inactive]}))};var gt=a(2248),Be=a(74955),pe=a(38835),Re=a(318),pt=a(25474),Et=a(64421),ft=a(77213),Ee=a(734),fe=a(20194),ht=a(31808);function Ke(){const[t,r]=(0,ht.j)(),s=t.get("search")??"",i=(0,Ee.ug)(s),l=Object.values(i).some(o=>!(0,ge.isEmpty)(o)),c=(0,e.useCallback)(o=>{const g=(0,Ee.HY)(s,o);r({search:g})},[s,r]),u=(0,e.useCallback)(o=>{r({search:o})},[r]);return(0,e.useEffect)(()=>{const o={dataSource:t.get("dataSource")??void 0,alertState:t.get("alertState")??void 0,ruleType:t.get("ruleType")??void 0,labels:(0,fe.Zh)(t.get("queryString")??"").map(fe.cm)};Object.values(o).some(m=>!(0,ge.isEmpty)(m))&&(r({dataSource:void 0,alertState:void 0,ruleType:void 0,queryString:void 0}),c((0,Et.ZP)(i,m=>{if(m.dataSourceName??=o.dataSource,o.alertState&&(0,h.I9)(o.alertState)&&(m.ruleState??=o.alertState),o.ruleType&&(0,W.Wd)(o.ruleType)&&(m.ruleType??=o.ruleType),m.labels.length===0&&o.labels.length>0){const v=o.labels.map(({name:p,operator:R,value:x})=>`${p}${R}${x}`);m.labels.push(...v)}})))},[t,c,i,r]),{filterState:i,hasActiveFilters:l,searchQuery:s,setSearchQuery:u,updateFilters:c}}const vt=(t,r)=>(0,e.useMemo)(()=>yt(t,r),[t,r]),yt=(t,r={labels:[],freeFormWords:[]})=>t.filter(s=>r.namespace?s.name.toLowerCase().includes(r.namespace.toLowerCase()):!0).filter(({rulesSource:s})=>r.dataSourceName&&(0,b.jq)(s)?s.name===r.dataSourceName:!0).reduce(Rt(r),[]),Rt=t=>(r,s)=>{const i=s.groups.filter(l=>t.groupName?l.name.toLowerCase().includes(t.groupName.toLowerCase()):!0).reduce(Ct(t),[]);return i.length&&r.push({...s,groups:i}),r},Ct=t=>(r,s)=>{const i=s.rules.filter(l=>{if(t.ruleType&&t.ruleType!==l.promRule?.type)return!1;const c=(0,W.Pc)(l.rulerRule)&&!xt(l.rulerRule,t);if(t.dataSourceName&&c)return!1;const u=l.name?.toLocaleLowerCase();if(t.freeFormWords.length>0&&!t.freeFormWords.every(o=>u.includes(o.toLocaleLowerCase()))||t.ruleName&&!l.name?.toLocaleLowerCase().includes(t.ruleName.toLocaleLowerCase()))return!1;if(t.ruleHealth&&l.promRule){const o=(0,W.vU)(l.promRule.health);return t.ruleHealth===o}if(t.labels.length>0){const o=(0,ge.compact)(t.labels.map(St)),g=o.length>0&&(0,fe.eD)(l.labels,o),m=o.length>0&&l.promRule&&l.promRule.type===h.pz.Alerting&&l.promRule.alerts&&l.promRule.alerts.some(v=>(0,fe.eD)(v.labels,o));if(!(g||m))return!1}return!(t.ruleState&&!(l.promRule&&(0,W.x_)(l.promRule)&&l.promRule.state===t.ruleState))});return i.length&&r.push({...s,rules:i}),r};function St(t){try{return(0,fe.tC)(t)}catch{return{name:t,value:"",isRegex:!0,isEqual:!0}}}const xt=(t,r)=>r.dataSourceName?!!t.grafana_alert.data.find(s=>s.datasourceUid?(0,ft.F)().getInstanceSettings(s.datasourceUid)?.name===r.dataSourceName:!1):!0;var Nt=a(42042);const He=[{icon:"folder",label:"Grouped",value:"grouped"},{icon:"list-ul",label:"List",value:"list"},{icon:"heart-rate",label:"State",value:"state"}],Pt=[{label:"Alert ",value:h.pz.Alerting},{label:"Recording ",value:h.pz.Recording}],At=[{label:"Ok",value:Ee.VG.Ok},{label:"No Data",value:Ee.VG.NoData},{label:"Error",value:Ee.VG.Error}],Lt=({onFilterCleared:t=()=>{}})=>{const[r,s]=(0,H.K)(),[i,l]=(0,e.useState)(Math.floor(Math.random()*100)),c=`dataSource-${i}`,u=`queryString-${i}`,{filterState:o,hasActiveFilters:g,searchQuery:m,setSearchQuery:v,updateFilters:p}=Ke(),R=(0,L.wW)(Tt),x=Object.entries(h.x_).map(([I,C])=>({label:(0,W.SS)(C),value:C})),T=I=>{p({...o,dataSourceName:I.name}),l(C=>C+1)},f=()=>{p({...o,dataSourceName:void 0}),l(I=>I+1)},d=(0,ge.debounce)(I=>{const C=I.target;v(C.value)},600),U=I=>{(0,P.PN)(y.z7.clickingAlertStateFilters),p({...o,ruleState:I}),l(C=>C+1)},V=I=>{s({view:I})},ie=I=>{p({...o,ruleType:I}),l(C=>C+1)},ue=I=>{p({...o,ruleHealth:I}),l(C=>C+1)},re=()=>{v(void 0),t(),setTimeout(()=>l(i+1),100)},me=e.createElement(ce.J,{name:"search"});return e.createElement("div",{className:R.container},e.createElement(X.Stack,{direction:"column",gap:1},e.createElement(X.Stack,{direction:"row",gap:1},e.createElement(Be.g,{className:R.dsPickerContainer,label:"Search by data source"},e.createElement(gt.q,{key:c,alerting:!0,noDefault:!0,placeholder:"All data sources",current:o.dataSourceName,onChange:T,onClear:f})),e.createElement("div",null,e.createElement(pe._,null,"State"),e.createElement(Re.S,{options:x,value:o.ruleState,onChange:U})),e.createElement("div",null,e.createElement(pe._,null,"Rule type"),e.createElement(Re.S,{options:Pt,value:o.ruleType,onChange:ie})),e.createElement("div",null,e.createElement(pe._,null,"Health"),e.createElement(Re.S,{options:At,value:o.ruleHealth,onChange:ue}))),e.createElement(X.Stack,{direction:"column",gap:1},e.createElement(X.Stack,{direction:"row",gap:1},e.createElement(Be.g,{className:R.searchInput,label:e.createElement(pe._,null,e.createElement(X.Stack,{gap:.5},e.createElement("span",null,"Search"),e.createElement(Nt.z,{content:e.createElement(It,null)},e.createElement(ce.J,{name:"info-circle",size:"sm"}))))},e.createElement(pt.I,{key:u,prefix:me,onChange:d,defaultValue:m,placeholder:"Search","data-testid":"search-query-input"})),e.createElement("div",null,e.createElement(pe._,null,"View as"),e.createElement(Re.S,{options:He,value:String(r.view??He[0].value),onChange:V}))),g&&e.createElement("div",null,e.createElement(K.zx,{fullWidth:!1,icon:"times",variant:"secondary",onClick:re},"Clear filters")))))},Tt=t=>({container:n.css`
      margin-bottom: ${t.spacing(1)};
    `,dsPickerContainer:n.css`
      width: 250px;
      flex-grow: 0;
      margin: 0;
    `,searchInput:n.css`
      flex: 1;
      margin: 0;
    `});function It(){const t=(0,L.wW)(ze);return e.createElement("div",null,e.createElement("div",null,"Search syntax allows to query alert rules by the parameters defined below."),e.createElement("hr",null),e.createElement("div",{className:t.grid},e.createElement("div",null,"Filter type"),e.createElement("div",null,"Expression"),e.createElement(q,{title:"Datasource",expr:"datasource:mimir"}),e.createElement(q,{title:"Folder/Namespace",expr:"namespace:global"}),e.createElement(q,{title:"Group",expr:"group:cpu-usage"}),e.createElement(q,{title:"Rule",expr:'rule:"cpu 80%"'}),e.createElement(q,{title:"Labels",expr:"label:team=A label:cluster=a1"}),e.createElement(q,{title:"State",expr:"state:firing|normal|pending"}),e.createElement(q,{title:"Type",expr:"type:alerting|recording"}),e.createElement(q,{title:"Health",expr:"health:ok|nodata|error"})))}function q({title:t,expr:r}){const s=(0,L.wW)(ze);return e.createElement(e.Fragment,null,e.createElement("div",null,t),e.createElement("code",{className:s.code},r))}const ze=t=>({grid:n.css`
    display: grid;
    grid-template-columns: max-content auto;
    gap: ${t.spacing(1)};
    align-items: center;
  `,code:n.css`
    display: block;
    text-align: center;
  `}),Ft=Lt;var Dt=a(37190);const we={groups:ut,state:dt},$t=(0,w.Pf)(()=>{const t=(0,z.useDispatch)(),r=(0,L.wW)(Ot),s=(0,e.useMemo)(b.mA,[]),i=(0,A.TH)(),[l,c]=(0,e.useState)(!1),[u]=(0,H.K)(),{filterState:o,hasActiveFilters:g}=Ke(),{canCreateGrafanaRules:m,canCreateCloudRules:v}=(0,ee.B)(),p=we[u.view]?u.view:"groups",R=we[p],x=(0,Q._)(C=>C.promRules),T=(0,Q._)(C=>C.rulerRules),f=s.some(C=>x[C]?.loading||T[C]?.loading),d=Object.entries(x),U=d.every(([C,_])=>_.dispatched&&(_?.result!==void 0||_?.error!==void 0)),V=d.every(([C,_])=>_.dispatched&&_?.result?.length===0),[ie,ue]=(0,O.Z)(async()=>{f||await t((0,ye.ei)())},[f]);(0,e.useEffect)(()=>{t((0,ye.ei)())},[t]),(0,N.Z)(ue,Dt.p4);const re=U&&V&&d.length>0,me=(0,Ue.Zo)(),I=vt(me,o);return e.createElement(D.J,{pageId:"alert-list",isLoading:!1},e.createElement(xe,null),e.createElement(Ft,{onFilterCleared:()=>c(!1)}),!re&&e.createElement(e.Fragment,null,e.createElement("div",{className:r.break}),e.createElement("div",{className:r.buttonsContainer},e.createElement("div",{className:r.statsContainer},p==="groups"&&g&&e.createElement(K.zx,{className:r.expandAllButton,icon:l?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>c(!l)},l?"Collapse all":"Expand all"),e.createElement(be,{namespaces:I,includeTotal:!0})),(m||v)&&e.createElement(K.Qj,{href:M.Cj.renderUrl("alerting/new",{returnTo:i.pathname+i.search}),icon:"plus",onClick:()=>(0,P.PN)(y.z7.alertRuleFromScratch)},"New alert rule"))),re&&e.createElement(Ie,null),!re&&e.createElement(R,{expandAll:l,namespaces:I}))},{style:"page"}),Ot=t=>({break:n.css`
    width: 100%;
    height: 0;
    margin-bottom: ${t.spacing(2)};
    border-bottom: solid 1px ${t.colors.border.medium};
  `,buttonsContainer:n.css`
    margin-bottom: ${t.spacing(2)};
    display: flex;
    justify-content: space-between;
  `,statsContainer:n.css`
    display: flex;
    flex-direction: row;
    align-items: center;
  `,expandAllButton:n.css`
    margin-right: ${t.spacing(1)};
  `}),Mt=$t},45524:(Y,F,a)=>{a.d(F,{J:()=>A});var n=a(68404),e=a(79396);const A=({children:O,pageId:N,pageNav:M,isLoading:P})=>n.createElement(e.T,{pageNav:M,navId:N},n.createElement(e.T.Contents,{isLoading:P},O))},51981:(Y,F,a)=>{a.d(F,{q:()=>A});var n=a(68404),e=a(82002);const A=({actions:O,children:N,fallback:M=!0})=>O.some(P=>e.Vt.hasAccess(P,M))?n.createElement(n.Fragment,null,N):null},65750:(Y,F,a)=>{a.d(F,{A:()=>O});var n=a(68404),e=a(48756),A=a(90723);const O=({tooltip:N,icon:M,to:P,target:w,onClick:L,className:K,tooltipPlacement:H="top",...z})=>{const y=typeof N=="string"?N:void 0;return n.createElement(e.u,{content:N,placement:H},P?n.createElement(A.Qj,{variant:"secondary",fill:"text",icon:M,href:P,size:"sm",target:w,...z,"aria-label":y}):n.createElement(A.zx,{className:K,variant:"secondary",fill:"text",size:"sm",icon:M,type:"button",onClick:L,...z,"aria-label":y}))}},31808:(Y,F,a)=>{a.d(F,{j:()=>O});var n=a(68404),e=a(70356),A=a(57388);function O(){const{search:N}=(0,e.TH)(),M=(0,n.useMemo)(()=>new URLSearchParams(N),[N]),P=(0,n.useCallback)((w,L)=>{A.E1.partial(w,L)},[]);return[M,P]}},39910:(Y,F,a)=>{a.d(F,{B:()=>A});var n=a(68404),e=a(97953);function A(){return(0,n.useMemo)(()=>(0,e.Rv)(),[])}},78337:(Y,F,a)=>{a.d(F,{Z:()=>A});var n=a(68404),e=function(O,N){var M=(0,n.useRef)(function(){});(0,n.useEffect)(function(){M.current=O}),(0,n.useEffect)(function(){if(N!==null){var P=setInterval(function(){return M.current()},N||0);return function(){return clearInterval(P)}}},[N])};const A=e}}]);

//# sourceMappingURL=AlertRuleListIndex.5911f949e37638e4bd5c.js.map