"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7323],{18885:(Z,P,t)=>{t.d(P,{Z:()=>w,v:()=>N});var e=t(52423),a=t(68404),c=t(40400),p=t(68183),T=t(93003),O=t(77274),D=t(4403),y=t(65587),g=t(74955),r=t(318),L=t(38835),I=t(68172),n=t(84498),l=t(69369),K=t(46739),A=t(90723),H=t(82385),W=t(99661),u=t(35287),x=t(19719),j=t(42454);function V(){const F=x.a2.map(s=>({value:s.code,label:s.name}));return[{value:"",label:(0,u.t)("common.locale.default","Default")},...F]}const _=Boolean(T.v.featureToggles.internationalization);class N extends a.PureComponent{constructor(d){super(d),this.onSubmitForm=async()=>{if(this.props.onConfirm?await this.props.onConfirm():!0){const{homeDashboardUID:B,theme:z,timezone:R,weekStart:b,language:M,queryHistory:m}=this.state;await this.service.update({homeDashboardUID:B,theme:z,timezone:R,weekStart:b,language:M,queryHistory:m}),window.location.reload()}},this.onThemeChanged=s=>{this.setState({theme:s})},this.onTimeZoneChanged=s=>{s&&this.setState({timezone:s})},this.onWeekStartChanged=s=>{this.setState({weekStart:s})},this.onHomeDashboardChanged=s=>{this.setState({homeDashboardUID:s})},this.onLanguageChanged=s=>{this.setState({language:s}),(0,O.ff)("grafana_preferences_language_changed",{toLanguage:s,preferenceType:this.props.preferenceType})},this.service=new j.y(d.resourceUri),this.state={theme:"",timezone:"",weekStart:"",language:"",queryHistory:{homeTab:""}},this.themeOptions=[{value:"",label:(0,u.t)("shared-preferences.theme.default-label","Default")},{value:"dark",label:(0,u.t)("shared-preferences.theme.dark-label","Dark")},{value:"light",label:(0,u.t)("shared-preferences.theme.light-label","Light")}]}async componentDidMount(){const d=await this.service.load();this.setState({homeDashboardUID:d.homeDashboardUID,theme:d.theme,timezone:d.timezone,weekStart:d.weekStart,language:d.language,queryHistory:d.queryHistory})}render(){const{theme:d,timezone:s,weekStart:B,homeDashboardUID:z,language:R}=this.state,{disabled:b}=this.props,M=$(),m=V();let E=this.themeOptions[0].value;return d?.length&&(E=this.themeOptions.find(o=>o.value===d)?.value),a.createElement(D.l,{onSubmit:this.onSubmitForm},()=>a.createElement(y.C,{label:a.createElement(u.cC,{i18nKey:"shared-preferences.title"},"Preferences"),disabled:b},a.createElement(g.g,{label:(0,u.t)("shared-preferences.fields.theme-label","UI Theme")},a.createElement(r.S,{options:this.themeOptions,value:E,onChange:this.onThemeChanged})),a.createElement(g.g,{label:a.createElement(L._,{htmlFor:"home-dashboard-select"},a.createElement("span",{className:M.labelText},a.createElement(u.cC,{i18nKey:"shared-preferences.fields.home-dashboard-label"},"Home Dashboard"))),"data-testid":"User preferences home dashboard drop down"},a.createElement(W.o,{value:z,onChange:o=>this.onHomeDashboardChanged(o?.uid??""),defaultOptions:!0,isClearable:!0,placeholder:(0,u.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})),a.createElement(g.g,{label:(0,u.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":p.wl.components.TimeZonePicker.containerV2},a.createElement(I.O,{includeInternal:!0,value:s,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})),a.createElement(g.g,{label:(0,u.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":p.wl.components.WeekStartPicker.containerV2},a.createElement(n.z,{value:B||"",onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})),_?a.createElement(g.g,{label:a.createElement(L._,{htmlFor:"locale-select"},a.createElement("span",{className:M.labelText},a.createElement(u.cC,{i18nKey:"shared-preferences.fields.locale-label"},"Language")),a.createElement(l.a,{featureState:c.CQ.beta})),"data-testid":"User preferences language drop down"},a.createElement(K.Ph,{value:m.find(o=>o.value===R),onChange:o=>this.onLanguageChanged(o.value??""),options:m,placeholder:(0,u.t)("shared-preferences.fields.locale-placeholder","Choose language"),inputId:"locale-select"})):null,a.createElement("div",{className:"gf-form-button-row"},a.createElement(A.zx,{type:"submit",variant:"primary","data-testid":p.wl.components.UserProfile.preferencesSaveButton},a.createElement(u.cC,{i18nKey:"common.save"},"Save")))))}}const w=N,$=(0,H.B)(()=>({labelText:e.css`
      margin-right: 6px;
    `}))},87807:(Z,P,t)=>{t.r(P),t.d(P,{UserProfileEditPage:()=>b,default:()=>M});var e=t(68404),a=t(36635),c=t(95700),p=t(90701),T=t(79396),O=t(18885),D=t(68183),y=t(90090),g=t(90723),r=t(35287);class L extends e.PureComponent{render(){const{isLoading:E,orgs:o,user:f}=this.props;return E?e.createElement(y.u,{text:"Loading organizations..."}):o.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},e.createElement(r.cC,{i18nKey:"user-orgs.title"},"Organizations")),e.createElement("div",{className:"gf-form-group"},e.createElement("table",{className:"filter-table form-inline","data-testid":D.wl.components.UserProfile.orgsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(r.cC,{i18nKey:"user-orgs.name-column"},"Name")),e.createElement("th",null,e.createElement(r.cC,{i18nKey:"user-orgs.role-column"},"Role")),e.createElement("th",null))),e.createElement("tbody",null,o.map((i,v)=>e.createElement("tr",{key:v},e.createElement("td",null,i.name),e.createElement("td",null,i.role),e.createElement("td",{className:"text-right"},i.orgId===f?.orgId?e.createElement(g.zx,{variant:"secondary",size:"sm",disabled:!0},e.createElement(r.cC,{i18nKey:"user-orgs.current-org-button"},"Current")):e.createElement(g.zx,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(i)}},e.createElement(r.cC,{i18nKey:"user-orgs.select-org-button"},"Select organisation")))))))))}}const I=L;var n=t(4403),l=t(65587),K=t(74955),A=t(25474),H=t(48756),W=t(81697),u=t(47694);const{disableLoginForm:x}=u.ZP,V=({user:m,isSavingUser:E,updateProfile:o})=>{const f=h=>{o(h)},i=(m&&m.isExternal)??!1,v=i&&m&&m.authLabels?m.authLabels[0]:"",U=v?` (Synced via ${v})`:"",C=x||i;return e.createElement(n.l,{onSubmit:f,validateOn:"onBlur"},({register:h,errors:S})=>e.createElement(l.C,null,e.createElement(K.g,{label:(0,r.t)("user-profile.fields.name-label","Name")+U,invalid:!!S.name,error:e.createElement(r.cC,{i18nKey:"user-profile.fields.name-error"},"Name is required"),disabled:C},e.createElement(A.I,{...h("name",{required:!0}),id:"edit-user-profile-name",placeholder:(0,r.t)("user-profile.fields.name-label","Name"),defaultValue:m?.name??"",suffix:e.createElement(_,null)})),e.createElement(K.g,{label:(0,r.t)("user-profile.fields.email-label","Email")+U,invalid:!!S.email,error:e.createElement(r.cC,{i18nKey:"user-profile.fields.email-error"},"Email is required"),disabled:C},e.createElement(A.I,{...h("email",{required:!0}),id:"edit-user-profile-email",placeholder:(0,r.t)("user-profile.fields.email-label","Email"),defaultValue:m?.email??"",suffix:e.createElement(_,null)})),e.createElement(K.g,{label:(0,r.t)("user-profile.fields.username-label","Username")+U,disabled:C},e.createElement(A.I,{...h("login"),id:"edit-user-profile-username",defaultValue:m?.login??"",placeholder:(0,r.t)("user-profile.fields.username-label","Username")+U,suffix:e.createElement(_,null)})),e.createElement("div",{className:"gf-form-button-row"},e.createElement(g.zx,{variant:"primary",disabled:E||C,"data-testid":D.wl.components.UserProfile.profileSaveButton,type:"submit"},e.createElement(r.cC,{i18nKey:"common.save"},"Save")))))},_=()=>x?e.createElement(H.u,{content:"Login details locked because they are managed in another system."},e.createElement(W.J,{name:"lock"})):null;var N=t(36509);class w extends e.PureComponent{render(){const{isLoading:E,sessions:o,revokeUserSession:f}=this.props;return E?e.createElement(y.u,{text:e.createElement(r.cC,{i18nKey:"user-sessions.loading"},"Loading sessions...")}):e.createElement("div",null,o.length>0&&e.createElement(e.Fragment,null,e.createElement("h3",{className:"page-sub-heading"},"Sessions"),e.createElement("div",{className:"gf-form-group"},e.createElement("table",{className:"filter-table form-inline","data-testid":D.wl.components.UserProfile.sessionsTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(r.cC,{i18nKey:"user-session.seen-at-column"},"Last seen")),e.createElement("th",null,e.createElement(r.cC,{i18nKey:"user-session.created-at-column"},"Logged on")),e.createElement("th",null,e.createElement(r.cC,{i18nKey:"user-session.ip-column"},"IP address")),e.createElement("th",null,e.createElement(r.cC,{i18nKey:"user-session.browser-column"},"Browser & OS")),e.createElement("th",null))),e.createElement("tbody",null,o.map((i,v)=>e.createElement("tr",{key:v},i.isActive?e.createElement("td",null,"Now"):e.createElement("td",null,i.seenAt),e.createElement("td",null,(0,r.$q)(i.createdAt,{dateStyle:"long"})),e.createElement("td",null,i.clientIp),e.createElement("td",null,i.browser," on ",i.os," ",i.osVersion),e.createElement("td",null,e.createElement(g.zx,{size:"sm",variant:"destructive",onClick:()=>f(i.id),"aria-label":(0,N.t)("user-session.revoke","Revoke user session")},e.createElement(W.J,{name:"power"}))))))))))}}const $=w;class F extends e.PureComponent{render(){const{isLoading:E,teams:o}=this.props;return E?e.createElement(y.u,{text:"Loading teams..."}):o.length===0?null:e.createElement("div",null,e.createElement("h3",{className:"page-sub-heading"},"Teams"),e.createElement("div",{className:"gf-form-group"},e.createElement("table",{className:"filter-table form-inline","aria-label":"User teams table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Name"),e.createElement("th",null,"Email"),e.createElement("th",null,"Members"))),e.createElement("tbody",null,o.map((f,i)=>e.createElement("tr",{key:i},e.createElement("td",{className:"width-4 text-center"},e.createElement("img",{className:"filter-table__avatar",src:f.avatarUrl,alt:""})),e.createElement("td",null,f.name),e.createElement("td",null,f.email),e.createElement("td",null,f.memberCount)))))))}}const d=null;var s=t(20523);function B(m){const E=m.user,{user:o,teams:f,orgs:i,sessions:v,teamsAreLoading:U,orgsAreLoading:C,sessionsAreLoading:h,isUpdating:S}=E;return{orgsAreLoading:C,sessionsAreLoading:h,teamsAreLoading:U,orgs:i,sessions:v,teams:f,isUpdating:S,user:o}}const z={initUserProfilePage:s.PA,revokeUserSession:s.cc,changeUserOrg:s.hz,updateUserProfile:s.Lj},R=(0,a.connect)(B,z);function b({orgsAreLoading:m,sessionsAreLoading:E,teamsAreLoading:o,initUserProfilePage:f,orgs:i,sessions:v,teams:U,isUpdating:C,user:h,revokeUserSession:S,changeUserOrg:J,updateUserProfile:X}){return(0,c.Z)(()=>f()),e.createElement(T.T,{navId:"profile/settings"},e.createElement(T.T.Contents,{isLoading:!h},e.createElement(p.wc,{spacing:"md"},e.createElement(V,{updateProfile:X,isSavingUser:C,user:h}),e.createElement(O.Z,{resourceUri:"user",preferenceType:"user"}),e.createElement(F,{isLoading:o,teams:U}),e.createElement(I,{isLoading:m,setUserOrg:J,orgs:i,user:h}),e.createElement($,{isLoading:E,revokeUserSession:S,sessions:v}))))}const M=R(b)},20523:(Z,P,t)=>{t.d(P,{Cp:()=>p,II:()=>O,Lj:()=>I,PA:()=>T,cc:()=>r,hz:()=>L});var e=t(93003),a=t(19360),c=t(54294);function p(n){return async function(l){l((0,c.zc)({updating:!0})),await a.h.changePassword(n),l((0,c.zc)({updating:!1}))}}function T(){return async function(n){await n(O()),n(D()),n(y()),n(g())}}function O(){return async function(n){const l=await a.h.loadUser();n((0,c.aw)({user:l}))}}function D(){return async function(n){n((0,c.qD)());const l=await a.h.loadTeams();n((0,c.PL)({teams:l}))}}function y(){return async function(n){n((0,c.$S)());const l=await a.h.loadOrgs();n((0,c.Ns)({orgs:l}))}}function g(){return async function(n){n((0,c.Uk)());const l=await a.h.loadSessions();n((0,c.z0)({sessions:l}))}}function r(n){return async function(l){l((0,c.zc)({updating:!0})),await a.h.revokeUserSession(n),l((0,c.p$)({tokenId:n}))}}function L(n){return async function(l){l((0,c.zc)({updating:!0})),await a.h.setUserOrg(n),window.location.href=e.v.appSubUrl+"/profile"}}function I(n){return async function(l){l((0,c.zc)({updating:!0})),await a.h.updateUserProfile(n),await l(O()),l((0,c.zc)({updating:!1}))}}},95700:(Z,P,t)=>{t.d(P,{Z:()=>c});var e=t(58252),a=function(p){(0,e.Z)(function(){p()})};const c=a}}]);

//# sourceMappingURL=UserProfileEditPage.6c0fce9e9e316f40e548.js.map