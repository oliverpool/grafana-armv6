"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3959],{"./public/app/features/datasources/settings/DataSourceSettingsPage.tsx":(e,t,a)=>{a.r(t),a.d(t,{DataSourceSettingsPage:()=>_,default:()=>V});var s,r=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n=a("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/3/opt/drone/yarncache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),o=a("./packages/grafana-data/src/index.ts"),i=a("./packages/grafana-e2e-selectors/src/index.ts"),l=a("./packages/grafana-ui/src/index.ts"),c=a("./public/app/core/actions/cleanUp.ts"),d=a("./public/app/core/app_events.ts"),u=a("./public/app/core/components/Page/Page.tsx"),p=a("./public/app/core/core.ts"),h=a("./public/app/core/selectors/navModel.ts"),g=a("./public/app/features/plugins/components/PluginStateInfo.tsx"),m=a("./public/app/types/index.ts"),f=a("./public/app/types/events.ts"),b=a("./public/app/features/datasources/state/actions.ts"),S=a("./public/app/features/datasources/state/navModel.ts"),x=a("./public/app/features/datasources/state/reducers.ts"),v=a("./public/app/features/datasources/state/selectors.ts"),y=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const{Input:D,Switch:j}=l.LegacyForms,C=e=>{let{dataSourceName:t,isDefault:a,onDefaultChange:r,onNameChange:n}=e;return(0,y.jsx)("div",{className:"gf-form-group","aria-label":"Datasource settings page basic settings",children:(0,y.jsxs)("div",{className:"gf-form-inline",children:[(0,y.jsxs)("div",{className:"gf-form max-width-30",style:{marginRight:"3px"},children:[s||(s=(0,y.jsx)(l.InlineFormLabel,{tooltip:"The name is used when you select the data source in panels. The default data source is preselected in new panels.",children:"Name"})),(0,y.jsx)(D,{className:"gf-form-input max-width-23",type:"text",value:t,placeholder:"Name",onChange:e=>n(e.target.value),required:!0,"aria-label":i.wl.pages.DataSource.name})]}),(0,y.jsx)(j,{label:"Default",checked:a,onChange:e=>{r(e.target.checked)}})]})})},M=e=>{let{canSave:t,canDelete:a,onDelete:s,onSubmit:r,onTest:n,exploreUrl:o}=e;const c=p.Vt.hasPermission(m.bW.DataSourcesExplore);return(0,y.jsxs)("div",{className:"gf-form-button-row",children:[(0,y.jsx)(l.Button,{variant:"secondary",fill:"solid",type:"button",onClick:()=>history.back(),children:"Back"}),(0,y.jsx)(l.LinkButton,{variant:"secondary",fill:"solid",href:o,disabled:!c,children:"Explore"}),(0,y.jsx)(l.Button,{type:"button",variant:"destructive",disabled:!a,onClick:s,"aria-label":i.wl.pages.DataSource.delete,children:"Delete"}),t&&(0,y.jsx)(l.Button,{type:"submit",variant:"primary",disabled:!t,onClick:e=>r(e),"aria-label":i.wl.pages.DataSource.saveAndTest,children:"Save & test"}),!t&&(0,y.jsx)(l.Button,{type:"submit",variant:"primary",onClick:n,children:"Test"})]})};var k=a("./packages/grafana-data/src/types/config.ts"),P=a("./public/app/core/components/LocalStorageValueProvider/index.tsx"),w=a("./public/app/core/config.ts");const N=e=>{var t;let{dataSource:a}=e,s="",r="";if(a.readOnly||(null!==(t=a.version)&&void 0!==t?t:0)>2)return null;if(w.vc.buildInfo.edition!==k.e.OpenSource)return null;switch(a.type){case"prometheus":s="Prometheus",r="Loki";break;case"loki":s="Loki",r="Prometheus";break;default:return null}return(0,y.jsx)(P.G,{storageKey:"datasources.settings.cloudInfoBox.isDismissed",defaultValue:!1,children:(e,t)=>e?null:(0,y.jsxs)(l.Alert,{title:`Configure your ${s} data source below`,severity:"info",bottomSpacing:4,onRemove:()=>{t(!0)},children:["Or skip the effort and get ",s," (and ",r,") as fully-managed, scalable, and hosted data sources from Grafana Labs with the"," ",(0,y.jsx)("a",{className:"external-link",href:`https://grafana.com/signup/cloud/connect-account?src=grafana-oss&cnt=${a.type}-settings`,target:"_blank",rel:"noreferrer",title:"The free plan includes 10k active metrics and 50gb storage.",children:"free-forever Grafana Cloud plan"}),"."]})})};var I=a("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),O=a("./packages/grafana-runtime/src/index.ts");function E(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class T extends r.PureComponent{constructor(e){super(e),E(this,"element",null),E(this,"component",void 0),E(this,"scopeProps",void 0),E(this,"onModelChanged",(e=>{this.props.onModelChange(e)})),this.scopeProps={ctrl:{datasourceMeta:e.dataSourceMeta,current:(0,I.cloneDeep)(e.dataSource)},onModelChanged:this.onModelChanged},this.onModelChanged=this.onModelChanged.bind(this)}componentDidMount(){const{plugin:e}=this.props;if(this.element&&!e.components.ConfigEditor){const e=(0,O.getAngularLoader)(),t='<plugin-component type="datasource-config-ctrl" />';this.component=e.load(this.element,this.scopeProps,t)}}componentDidUpdate(e){const{plugin:t}=this.props;var a;t.components.ConfigEditor||this.props.dataSource===e.dataSource||(this.scopeProps.ctrl.current=(0,I.cloneDeep)(this.props.dataSource),null===(a=this.component)||void 0===a||a.digest())}componentWillUnmount(){this.component&&this.component.destroy()}render(){const{plugin:e,dataSource:t}=this.props;return e?(0,y.jsx)("div",{ref:e=>this.element=e,children:e.components.ConfigEditor&&r.createElement(e.components.ConfigEditor,{options:t,onOptionsChange:this.onModelChanged})}):null}}var B,L;function R(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const U={deleteDataSource:b.xU,loadDataSource:b.gv,setDataSourceName:x.BX,updateDataSource:b.oe,setIsDefault:x.yr,dataSourceLoaded:x.rl,initDataSourceSettings:b.M9,testDataSource:b.kY,cleanUpAction:c.e},A=(0,n.connect)((function(e,t){const a=t.match.params.uid,s=new URLSearchParams(t.location.search),r=(0,v.f6)(e.dataSources,a),{plugin:n,loadError:o,loading:i,testingStatus:l}=e.dataSourceSettings,c=s.get("page"),d=n?(0,S.nI)((0,S.B1)(r,n),c||"settings"):(0,S.xG)("settings"),u=(0,h.h)(e.navIndex,c?`datasource-page-${c}`:`datasource-settings-${a}`,d);return{dataSource:(0,v.f6)(e.dataSources,a),dataSourceMeta:(0,v.G4)(e.dataSources,r.type),dataSourceId:a,page:c,plugin:n,loadError:o,loading:i,testingStatus:l,navModel:u}}),U);class _ extends r.PureComponent{constructor(){super(...arguments),R(this,"onSubmit",(async e=>{e.preventDefault(),await this.props.updateDataSource(Object.assign({},this.props.dataSource)),this.testDataSource()})),R(this,"onTest",(async e=>{e.preventDefault(),this.testDataSource()})),R(this,"onDelete",(()=>{d.Z.publish(new f.VJ({title:"Delete",text:`Are you sure you want to delete the "${this.props.dataSource.name}" data source?`,yesText:"Delete",icon:"trash-alt",onConfirm:()=>{this.confirmDelete()}}))})),R(this,"confirmDelete",(()=>{this.props.deleteDataSource()})),R(this,"onModelChange",(e=>{this.props.dataSourceLoaded(e)}))}componentDidMount(){const{initDataSourceSettings:e,dataSourceId:t}=this.props;e(t)}componentWillUnmount(){this.props.cleanUpAction({stateSelector:e=>e.dataSourceSettings})}isReadOnly(){return!0===this.props.dataSource.readOnly}renderIsReadOnlyMessage(){return(0,y.jsx)(l.Alert,{"aria-label":i.wl.pages.DataSource.readOnly,severity:"info",title:"Provisioned data source",children:"This data source was added by config and cannot be modified using the UI. Please contact your server admin to update this data source."})}renderMissingEditRightsMessage(){return B||(B=(0,y.jsx)(l.Alert,{severity:"info",title:"Missing rights",children:"You are not allowed to modify this data source. Please contact your server admin to update this data source."}))}testDataSource(){const{dataSource:e,testDataSource:t}=this.props;t(e.name)}get hasDataSource(){return this.props.dataSource.id>0}onNavigateToExplore(){const{dataSource:e}=this.props,t=JSON.stringify({datasource:e.name,context:"explore"});return o.urlUtil.renderUrl("/explore",{left:t})}renderLoadError(){const{loadError:e,dataSource:t}=this.props,a=!this.isReadOnly()&&p.Vt.hasPermissionInMetadata(m.bW.DataSourcesDelete,t),s={text:e,subTitle:"Data Source Error",icon:"exclamation-triangle"},r={node:s,main:s};return(0,y.jsx)(u.Z,{navModel:r,children:(0,y.jsxs)(u.Z.Contents,{isLoading:this.props.loading,children:[this.isReadOnly()&&this.renderIsReadOnlyMessage(),(0,y.jsxs)("div",{className:"gf-form-button-row",children:[a&&(0,y.jsx)(l.Button,{type:"submit",variant:"destructive",onClick:this.onDelete,children:"Delete"}),(0,y.jsx)(l.Button,{variant:"secondary",fill:"outline",type:"button",onClick:()=>history.back(),children:"Back"})]})]})})}renderConfigPageBody(e){const{plugin:t}=this.props;if(!t||!t.configPages)return null;for(const a of t.configPages)if(a.id===e)return(0,y.jsx)(a.body,{plugin:t,query:{}});return(0,y.jsxs)("div",{children:["Page not found: ",e]})}renderAlertDetails(){var e,t,a;const{testingStatus:s}=this.props;return(0,y.jsxs)(y.Fragment,{children:[null==s||null===(e=s.details)||void 0===e?void 0:e.message,null!=s&&null!==(t=s.details)&&void 0!==t&&t.verboseMessage?(0,y.jsx)("details",{style:{whiteSpace:"pre-wrap"},children:null==s||null===(a=s.details)||void 0===a?void 0:a.verboseMessage}):null]})}renderSettings(){const{dataSourceMeta:e,setDataSourceName:t,setIsDefault:a,dataSource:s,plugin:r,testingStatus:n}=this.props,o=p.Vt.hasPermissionInMetadata(m.bW.DataSourcesWrite,s),c=p.Vt.hasPermissionInMetadata(m.bW.DataSourcesDelete,s);return(0,y.jsxs)("form",{onSubmit:this.onSubmit,children:[!o&&this.renderMissingEditRightsMessage(),this.isReadOnly()&&this.renderIsReadOnlyMessage(),e.state&&(0,y.jsxs)("div",{className:"gf-form",children:[L||(L=(0,y.jsx)("label",{className:"gf-form-label width-10",children:"Plugin state"})),(0,y.jsx)("label",{className:"gf-form-label gf-form-label--transparent",children:(0,y.jsx)(g.u,{state:e.state})})]}),(0,y.jsx)(N,{dataSource:s}),(0,y.jsx)(C,{dataSourceName:s.name,isDefault:s.isDefault,onDefaultChange:e=>a(e),onNameChange:e=>t(e)}),r&&(0,y.jsx)(T,{plugin:r,dataSource:s,dataSourceMeta:e,onModelChange:this.onModelChange}),(null==n?void 0:n.message)&&(0,y.jsx)("div",{className:"gf-form-group p-t-2",children:(0,y.jsx)(l.Alert,{severity:"error"===n.status?"error":"success",title:n.message,"aria-label":i.wl.pages.DataSource.alert,children:n.details&&this.renderAlertDetails()})}),(0,y.jsx)(M,{onSubmit:e=>this.onSubmit(e),canSave:!this.isReadOnly()&&o,canDelete:!this.isReadOnly()&&c,onDelete:this.onDelete,onTest:e=>this.onTest(e),exploreUrl:this.onNavigateToExplore()})]})}render(){const{navModel:e,page:t,loadError:a,loading:s}=this.props;return a?this.renderLoadError():(0,y.jsx)(u.Z,{navModel:e,children:(0,y.jsx)(u.Z.Contents,{isLoading:s,children:this.hasDataSource?(0,y.jsx)("div",{children:t?this.renderConfigPageBody(t):this.renderSettings()}):null})})}}const V=A(_)},"./public/app/features/plugins/components/PluginStateInfo.tsx":(e,t,a)=>{a.d(t,{u:()=>o});a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var s=a("./packages/grafana-data/src/index.ts"),r=a("./packages/grafana-ui/src/index.ts"),n=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const o=e=>{const t=function(e){switch(e){case s.PluginState.deprecated:return{text:"Deprecated",color:"red",tooltip:"This feature is deprecated and will be removed in a future release"};case s.PluginState.alpha:return{text:"Alpha",color:"blue",tooltip:"This feature is experimental and future updates might not be backward compatible"};case s.PluginState.beta:return{text:"Beta",color:"blue",tooltip:"This feature is close to complete but not fully tested"};default:return null}}(e.state);return t?(0,n.jsx)(r.Badge,{color:t.color,title:t.tooltip,text:t.text,icon:t.icon}):null}}}]);
//# sourceMappingURL=DataSourceSettingsPage.326a5ae471165dde1160.js.map