"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1783],{"./public/app/core/hooks/useCleanup.ts":(e,t,a)=>{a.d(t,{x:()=>i});var s=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n=a("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/3/opt/drone/yarncache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),r=a("./public/app/core/actions/cleanUp.ts");function i(e){const t=(0,n.useDispatch)(),a=(0,s.useRef)(e);a.current=e,(0,s.useEffect)((()=>()=>{t((0,r.e)({stateSelector:a.current}))}),[t])}},"./public/app/features/alerting/unified/Silences.tsx":(e,t,a)=>{a.r(t),a.d(t,{default:()=>Be});var s,n=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),r=a("./packages/grafana-ui/src/index.ts"),i=a("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/3/opt/drone/yarncache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),l=a("./.yarn/__virtual__/react-router-virtual-31642fe47a/3/opt/drone/yarncache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js"),c=a("./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx"),o=a("./packages/grafana-data/src/index.ts"),d=a("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),u=a("./public/app/plugins/datasource/alertmanager/types.ts"),p=a("./public/app/core/components/EmptyListCTA/EmptyListCTA.tsx"),m=a("./public/app/core/services/context_srv.ts"),h=a("./public/app/features/alerting/unified/utils/access-control.ts"),g=a("./public/app/features/alerting/unified/utils/misc.ts"),f=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const x=e=>{let{alertManagerSourceName:t}=e;const a=(0,h.QX)(t);return m.Vt.hasAccess(a.create,m.Vt.isEditor)?(0,f.jsx)(p.Z,{title:"You haven't created any silences yet",buttonIcon:"bell-slash",buttonLink:(0,g.eQ)("alerting/silence/new",t),buttonTitle:"New silence"}):s||(s=(0,f.jsx)(r.CallToActionCard,{callToActionElement:(0,f.jsx)("div",{}),message:"No silences found."}))};var b,v,j=a("./public/app/core/hooks/useQueryParams.ts"),y=a("./public/app/features/alerting/unified/utils/alertmanager.ts"),S=a("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),_=a("./.yarn/__virtual__/@grafana-experimental-virtual-920bad95a1/3/opt/drone/yarncache/@grafana-experimental-npm-0.0.2-canary.22-45d2c4f135-b9a64c0abc.zip/node_modules/@grafana/experimental/index.js");const A=Object.entries(u.As).map((e=>{let[t,a]=e;return{label:t,value:a}})),w=()=>(0,S.uniqueId)("query-string-"),k=()=>{const[e,t]=(0,n.useState)(w()),[a,s]=(0,j.K)(),{queryString:i,silenceState:l}=(0,g.pF)(a),c=(0,r.useStyles2)(N),o=(0,S.debounce)((e=>{const t=e.target;s({queryString:t.value||null})}),400),d=!!(i&&i.length>3)&&0===(0,y.Zh)(i).length;return(0,f.jsxs)("div",{className:c.flexRow,children:[(0,f.jsx)(r.Field,{className:c.rowChild,label:b||(b=(0,f.jsx)(r.Label,{children:(0,f.jsxs)(_.Stack,{gap:.5,children:[(0,f.jsx)("span",{children:"Search by matchers"}),(0,f.jsx)(r.Tooltip,{content:(0,f.jsxs)("div",{children:["Filter silences by matchers using a comma separated list of matchers, ie:",(0,f.jsx)("pre",{children:"severity=critical, instance=~cluster-us-.+"})]}),children:(0,f.jsx)(r.Icon,{name:"info-circle",size:"sm"})})]})})),invalid:d,error:d?"Query must use valid matcher syntax":null,children:(0,f.jsx)(r.Input,{className:c.searchInput,prefix:v||(v=(0,f.jsx)(r.Icon,{name:"search"})),onChange:o,defaultValue:null!=i?i:"",placeholder:"Search","data-testid":"search-query-input"},e)}),(0,f.jsx)(r.Field,{className:c.rowChild,label:"State",children:(0,f.jsx)(r.RadioButtonGroup,{options:A,value:l,onChange:e=>{s({silenceState:e})}})}),(i||l)&&(0,f.jsx)("div",{className:c.rowChild,children:(0,f.jsx)(r.Button,{variant:"secondary",icon:"times",onClick:()=>{s({queryString:null,silenceState:null}),setTimeout((()=>t(w())))},children:"Clear filters"})})]})},N=e=>({searchInput:d.css`
    width: 360px;
  `,flexRow:d.css`
    display: flex;
    flex-direction: row;
    align-items: flex-end;
    padding-bottom: ${e.spacing(2)};
    border-bottom: 1px solid ${e.colors.border.strong};
  `,rowChild:d.css`
    margin-right: ${e.spacing(1)};
    margin-bottom: 0;
    max-height: 52px;
  `,fieldLabel:d.css`
    font-size: 12px;
    font-weight: 500;
  `});var C=a("./public/app/features/alerting/unified/components/DynamicTable.tsx"),D=a("./public/app/features/alerting/unified/components/StateTag.tsx");const $={[u.As.Active]:"good",[u.As.Expired]:"neutral",[u.As.Pending]:"neutral"},M=e=>{let{state:t}=e;return(0,f.jsx)(D.i,{state:$[t],children:t})};var R=a("./public/app/features/alerting/unified/components/silences/Matchers.tsx"),z=a("./packages/grafana-ui/src/components/Button/index.ts");const T=["className"];const q=e=>{let{className:t}=e,a=function(e,t){if(null==e)return{};var a,s,n={},r=Object.keys(e);for(s=0;s<r.length;s++)a=r[s],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,T);return(0,f.jsx)(z.zx,Object.assign({variant:"secondary",size:"xs",className:(0,d.cx)((0,r.useStyles)(O),t)},a))},O=e=>d.css`
  height: 24px;
  font-size: ${e.typography.size.sm};
`;var I,B=a("./public/app/features/alerting/unified/components/rules/ActionIcon.tsx"),E=a("./public/app/features/alerting/unified/state/actions.ts"),Z=a("./public/app/features/alerting/unified/styles/table.ts"),F=a("./public/app/features/alerting/unified/components/CollapseToggle.tsx"),V=a("./public/app/features/alerting/unified/components/AlertLabels.tsx"),L=a("./public/app/features/alerting/unified/components/silences/AmAlertStateTag.tsx");const Y=e=>{let{alert:t,className:a}=e;const[s,r]=(0,n.useState)(!0),i=(0,o.intervalToAbbreviatedDurationString)({start:new Date(t.startsAt),end:new Date(t.endsAt)}),l=Object.entries(t.labels).reduce(((e,t)=>{let[a,s]=t;return"alertname"!==a&&"__alert_rule_title__"!==a||(e=s),e}),"");return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("tr",{className:a,children:[(0,f.jsx)("td",{children:(0,f.jsx)(F.U,{isCollapsed:s,onToggle:e=>r(e)})}),(0,f.jsx)("td",{children:(0,f.jsx)(L.G,{state:t.status.state})}),(0,f.jsxs)("td",{children:["for ",i," seconds"]}),(0,f.jsx)("td",{children:l})]}),!s&&(0,f.jsxs)("tr",{className:a,children:[I||(I=(0,f.jsx)("td",{})),(0,f.jsx)("td",{colSpan:5,children:(0,f.jsx)(V.s,{labels:t.labels})})]})]})};var P,Q;const U=e=>({tableMargin:d.css`
    margin-bottom: ${e.spacing(1)};
  `,colState:d.css`
    width: 110px;
  `,colName:d.css`
    width: 65%;
  `}),H=e=>{let{silencedAlerts:t}=e;const a=(0,r.useStyles2)(Z.D),s=(0,r.useStyles2)(U);return t.length?(0,f.jsxs)("table",{className:(0,d.cx)(a.table,s.tableMargin),children:[(0,f.jsxs)("colgroup",{children:[(0,f.jsx)("col",{className:a.colExpand}),(0,f.jsx)("col",{className:s.colState}),P||(P=(0,f.jsx)("col",{})),(0,f.jsx)("col",{className:s.colName})]}),Q||(Q=(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{}),(0,f.jsx)("th",{children:"State"}),(0,f.jsx)("th",{}),(0,f.jsx)("th",{children:"Alert name"})]})})),(0,f.jsx)("tbody",{children:t.map(((e,t)=>(0,f.jsx)(Y,{alert:e,className:t%2==0?a.evenRow:""},e.fingerprint)))})]}):null},G=e=>{let{silence:t}=e;const{startsAt:a,endsAt:s,comment:n,createdBy:i,silencedAlerts:l}=t,c=(0,r.useStyles2)(W),d="YYYY-MM-DD HH:mm",u=o.dateMath.parse(a),p=o.dateMath.parse(s),m=(0,o.intervalToAbbreviatedDurationString)({start:new Date(a),end:new Date(s)});return(0,f.jsxs)("div",{className:c.container,children:[(0,f.jsx)("div",{className:c.title,children:"Comment"}),(0,f.jsx)("div",{children:n}),(0,f.jsx)("div",{className:c.title,children:"Schedule"}),(0,f.jsx)("div",{children:`${null==u?void 0:u.format(d)} - ${null==p?void 0:p.format(d)}`}),(0,f.jsx)("div",{className:c.title,children:"Duration"}),(0,f.jsxs)("div",{children:[" ",m]}),(0,f.jsx)("div",{className:c.title,children:"Created by"}),(0,f.jsxs)("div",{children:[" ",i]}),(0,f.jsx)("div",{className:c.title,children:"Affected alerts"}),(0,f.jsx)(H,{silencedAlerts:l})]})},W=e=>({container:d.css`
    display: grid;
    grid-template-columns: 1fr 9fr;
    grid-row-gap: 1rem;
  `,title:d.css`
    color: ${e.colors.text.primary};
  `,row:d.css`
    margin: ${e.spacing(1,0)};
  `});var J,K,X,ee,te=a("./public/app/features/alerting/unified/components/Authorize.tsx");const ae=e=>{const[t]=(0,j.K)();return(0,n.useMemo)((()=>{const{queryString:a,silenceState:s}=(0,g.pF)(t),n=null==t?void 0:t.silenceIds;return e.filter((e=>{if("string"==typeof n){if(!n.split(",").includes(e.id))return!1}if(a){if(!(0,y.Zh)(a).every((t=>{var a;return null===(a=e.matchers)||void 0===a?void 0:a.some((e=>{let{name:a,value:s,isEqual:n,isRegex:r}=e;return t.name===a&&t.value===s&&t.isEqual===n&&t.isRegex===r}))})))return!1}if(s){if(!(e.status.state===s))return!1}return!0}))}),[t,e])},se=e=>({topButtonContainer:d.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-end;
  `,addNewSilence:d.css`
    margin: ${e.spacing(2,0)};
  `,callout:d.css`
    background-color: ${e.colors.background.secondary};
    border-top: 3px solid ${e.colors.info.border};
    border-radius: 2px;
    height: 62px;
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-top: ${e.spacing(2)};

    & > * {
      margin-left: ${e.spacing(1)};
    }
  `,calloutIcon:d.css`
    color: ${e.colors.info.text};
  `,editButton:d.css`
    margin-left: ${e.spacing(.5)};
  `});const ne=e=>{let{silences:t,alertManagerAlerts:a,alertManagerSourceName:s}=e;const l=(0,r.useStyles2)(se),[c]=(0,j.K)(),d=ae(t),p=(0,h.QX)(s),{silenceState:b}=(0,g.pF)(c),v=!!d.length&&(void 0===b||b===u.As.Expired),y=function(e){const t=(0,i.useDispatch)(),a=(0,r.useStyles2)(se),s=(0,h.QX)(e);return(0,n.useMemo)((()=>{const n=a=>{t((0,E.yO)(e,a))},i=[{id:"state",label:"State",renderCell:function(e){let{data:{status:t}}=e;return(0,f.jsx)(M,{state:t.state})},size:"88px"},{id:"matchers",label:"Matching labels",renderCell:function(e){let{data:{matchers:t}}=e;return(0,f.jsx)(R.g,{matchers:t||[]})},size:9},{id:"alerts",label:"Alerts",renderCell:function(e){let{data:{silencedAlerts:t}}=e;return(0,f.jsx)("span",{"data-testid":"alerts",children:t.length})},size:1},{id:"schedule",label:"Schedule",renderCell:function(e){let{data:{startsAt:t,endsAt:a}}=e;const s=o.dateMath.parse(t),n=o.dateMath.parse(a),r="YYYY-MM-DD HH:mm";return(0,f.jsxs)(f.Fragment,{children:[" ",null==s?void 0:s.format(r)," ","-",X||(X=(0,f.jsx)("br",{})),null==n?void 0:n.format(r)]})},size:"150px"}];return m.Vt.hasAccess(s.update,m.Vt.isEditor)&&i.push({id:"actions",label:"Actions",renderCell:function(t){let{data:s}=t;return(0,f.jsxs)(_.Stack,{gap:.5,children:["expired"===s.status.state?(0,f.jsx)(r.Link,{href:(0,g.eQ)(`/alerting/silence/${s.id}/edit`,e),children:ee||(ee=(0,f.jsx)(q,{icon:"sync",children:"Recreate"}))}):(0,f.jsx)(q,{icon:"bell",onClick:()=>n(s.id),children:"Unsilence"}),"expired"!==s.status.state&&(0,f.jsx)(B.A,{className:a.editButton,to:(0,g.eQ)(`/alerting/silence/${s.id}/edit`,e),icon:"pen",tooltip:"edit"})]})},size:"147px"}),i}),[e,t,a,s])}(s),S=(0,n.useMemo)((()=>d.map((e=>{const t=(s=e.id,a.filter((e=>e.status.silencedBy.includes(s))));var s;return{id:e.id,data:Object.assign({},e,{silencedAlerts:t})}}))),[d,a]);return(0,f.jsxs)("div",{"data-testid":"silences-table",children:[!!t.length&&(0,f.jsxs)(f.Fragment,{children:[J||(J=(0,f.jsx)(k,{})),(0,f.jsx)(te.q,{actions:[p.create],fallback:m.Vt.isEditor,children:(0,f.jsx)("div",{className:l.topButtonContainer,children:(0,f.jsx)(r.Link,{href:(0,g.eQ)("/alerting/silence/new",s),children:(0,f.jsx)(r.Button,{className:l.addNewSilence,icon:"plus",children:"New Silence"})})})}),S.length?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(C.t,{items:S,cols:y,isExpandable:!0,renderExpandedContent:e=>{let{data:t}=e;return(0,f.jsx)(G,{silence:t})}}),v&&(0,f.jsxs)("div",{className:l.callout,children:[(0,f.jsx)(r.Icon,{className:l.calloutIcon,name:"info-circle"}),K||(K=(0,f.jsx)("span",{children:"Expired silences are automatically deleted after 5 days."}))]})]}):"No matching silences found"]}),!t.length&&(0,f.jsx)(x,{alertManagerSourceName:s})]})};var re=a("./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts"),ie=a("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts"),le=a("./public/app/features/alerting/unified/utils/constants.ts"),ce=a("./public/app/features/alerting/unified/utils/redux.ts"),oe=a("./.yarn/__virtual__/react-use-virtual-00326e70ba/3/opt/drone/yarncache/react-use-npm-17.3.2-a032cbeb01-7379460f51.zip/node_modules/react-use/esm/useDebounce.js"),de=a("./packages/grafana-runtime/src/index.ts"),ue=a("./.yarn/__virtual__/react-hook-form-virtual-92b6119fd4/3/opt/drone/yarncache/react-hook-form-npm-7.5.3-f9cc466c62-fbfaa3b664.zip/node_modules/react-hook-form/dist/index.esm.js");const pe=["onChange","ref"];const me=e=>({wrapper:d.css`
      margin-top: ${e.spacing(2)};
    `,row:d.css`
      display: flex;
      align-items: flex-start;
      flex-direction: row;
      background-color: ${e.colors.background.secondary};
      padding: ${e.spacing(1)} ${e.spacing(1)} 0 ${e.spacing(1)};
      & > * + * {
        margin-left: ${e.spacing(2)};
      }
    `,removeButton:d.css`
      margin-left: ${e.spacing(1)};
      margin-top: ${e.spacing(2.5)};
    `,matcherOptions:d.css`
      min-width: 140px;
    `,matchers:d.css`
      max-width: ${e.breakpoints.values.sm}px;
      margin: ${e.spacing(1)} 0;
      padding-top: ${e.spacing(.5)};
    `}),he=e=>{let{className:t}=e;const a=(0,r.useStyles2)(me),s=(0,ue.Gc)(),{control:n,register:i,formState:{errors:l}}=s,{fields:c=[],append:o,remove:p}=(0,ue.Dq)({name:"matchers"});return(0,f.jsx)("div",{className:(0,d.cx)(t,a.wrapper),children:(0,f.jsx)(r.Field,{label:"Matching labels",required:!0,children:(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:a.matchers,children:c.map(((e,t)=>{var s,o,d,u,m,h,g,x,b,v;return(0,f.jsxs)("div",{className:a.row,"data-testid":"matcher",children:[(0,f.jsx)(r.Field,{label:"Label",invalid:!(null==l||null===(s=l.matchers)||void 0===s||null===(o=s[t])||void 0===o||!o.name),error:null==l||null===(d=l.matchers)||void 0===d||null===(u=d[t])||void 0===u||null===(m=u.name)||void 0===m?void 0:m.message,children:(0,f.jsx)(r.Input,Object.assign({},i(`matchers.${t}.name`,{required:{value:!0,message:"Required."}}),{defaultValue:e.name,placeholder:"label"}))}),(0,f.jsx)(r.Field,{label:"Operator",children:(0,f.jsx)(r.InputControl,{control:n,render:e=>{let{field:{onChange:t}}=e,s=function(e,t){if(null==e)return{};var a,s,n={},r=Object.keys(e);for(s=0;s<r.length;s++)a=r[s],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e.field,pe);return(0,f.jsx)(r.Select,Object.assign({},s,{menuShouldPortal:!0,onChange:e=>t(e.value),className:a.matcherOptions,options:y.tA,"aria-label":"operator"}))},defaultValue:e.operator||y.tA[0].value,name:`matchers.${t}.operator`,rules:{required:{value:!0,message:"Required."}}})}),(0,f.jsx)(r.Field,{label:"Value",invalid:!(null==l||null===(h=l.matchers)||void 0===h||null===(g=h[t])||void 0===g||!g.value),error:null==l||null===(x=l.matchers)||void 0===x||null===(b=x[t])||void 0===b||null===(v=b.value)||void 0===v?void 0:v.message,children:(0,f.jsx)(r.Input,Object.assign({},i(`matchers.${t}.value`,{required:{value:!0,message:"Required."}}),{defaultValue:e.value,placeholder:"value"}))}),c.length>1&&(0,f.jsx)(r.IconButton,{className:a.removeButton,tooltip:"Remove matcher",name:"trash-alt",onClick:()=>p(t),children:"Remove"})]},`${e.id}`)}))}),(0,f.jsx)(r.Button,{type:"button",icon:"plus",variant:"secondary",onClick:()=>{const e={name:"",value:"",operator:u._M.equal};o(e)},children:"Add matcher"})]})})})};var ge,fe=a("./public/app/features/alerting/unified/hooks/useCombinedRuleNamespaces.ts"),xe=a("./public/app/features/alerting/unified/utils/matchers.ts"),be=a("./public/app/features/alerting/unified/utils/rules.ts"),ve=a("./public/app/features/alerting/unified/components/rules/AlertStateTag.tsx");const je=()=>{var e;const[t,a]=(0,n.useState)([]),s=(0,ue.Gc)(),l=(0,i.useDispatch)(),{watch:c}=s,d=c("matchers"),u=(0,r.useStyles2)(ye),p=[{id:"state",label:"State",renderCell:function(e){let{data:{matchedInstance:t}}=e;return(0,f.jsx)(ve.l,{state:t.state})},size:"160px"},{id:"labels",label:"Labels",renderCell:function(e){let{data:{matchedInstance:t}}=e;return(0,f.jsx)(V.s,{labels:t.labels})},size:"250px"},{id:"created",label:"Created",renderCell:function(e){let{data:{matchedInstance:t}}=e;return(0,f.jsx)(f.Fragment,{children:t.activeAt.startsWith("0001")?"-":(0,o.dateTime)(t.activeAt).format("YYYY-MM-DD HH:mm:ss")})},size:"400px"}];(0,n.useEffect)((()=>{l((0,E.ei)())}),[l]);const m=(0,fe.Zo)();return(0,oe.Z)((()=>{const e=m.flatMap((e=>e.groups.flatMap((e=>e.rules.map((e=>e.promRule)).filter((e=>(0,be.x_)(e))).flatMap((e=>{var t;return(0,xe.TZ)(null!==(t=e.alerts)&&void 0!==t?t:[],d)}))))));a(e)}),500,[m,d]),(0,f.jsxs)("div",{children:[(0,f.jsxs)("h4",{className:u.title,children:["Affected alert instances",t.length>0?(0,f.jsx)(r.Badge,{className:u.badge,color:"blue",text:t.length}):null]}),(0,f.jsx)("div",{className:u.table,children:d.every((e=>!e.value&&!e.name))?ge||(ge=(0,f.jsx)("span",{children:"Add a valid matcher to see affected alerts"})):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(C.t,{items:null!==(e=t.slice(0,5))&&void 0!==e?e:[],isExpandable:!1,cols:p}),t.length>5&&(0,f.jsxs)("div",{className:u.moreMatches,children:["and ",t.length-5," more"]})]})})]})};const ye=e=>({table:d.css`
    max-width: ${e.breakpoints.values.lg}px;
  `,moreMatches:d.css`
    margin-top: ${e.spacing(1)};
  `,title:d.css`
    display: flex;
    align-items: center;
  `,badge:d.css`
    margin-left: ${e.spacing(1)};
  `}),Se=()=>{const{control:e,getValues:t}=(0,ue.Gc)(),a=(0,r.useStyles)(_e),{field:{onChange:s,value:n},fieldState:{invalid:i}}=(0,ue.bc)({name:"startsAt",control:e,rules:{validate:e=>t().endsAt>e}}),{field:{onChange:l,value:c},fieldState:{invalid:d}}=(0,ue.bc)({name:"endsAt",control:e,rules:{validate:e=>t().startsAt<e}}),{field:{onChange:u,value:p}}=(0,ue.bc)({name:"timeZone",control:e}),m=i||d,h=(0,o.dateTime)(n),g=(0,o.dateTime)(c);return(0,f.jsx)(r.Field,{className:a.timeRange,label:"Silence start and end",error:m?"To is before or the same as from":"",invalid:m,children:(0,f.jsx)(r.TimeRangeInput,{value:{from:h,to:g,raw:{from:h,to:g}},timeZone:p,onChange:e=>{s((0,o.dateTime)(e.from)),l((0,o.dateTime)(e.to))},onChangeTimeZone:e=>u(e),hideTimeZone:!1,hideQuickRanges:!0,placeholder:"Select time range"})})},_e=e=>({timeRange:d.css`
    width: 400px;
  `});var Ae,we,ke,Ne,Ce,De=a("./public/app/core/hooks/useCleanup.ts"),$e=a("./public/app/features/alerting/unified/hooks/useURLSearchParams.ts");const Me=(e,t)=>{const a=new Date;if(t){var s;const e=Date.parse(t.endsAt)<Date.now()?{start:a,end:(0,o.addDurationToDate)(a,{hours:2})}:{start:new Date(t.startsAt),end:new Date(t.endsAt)};return{id:t.id,startsAt:e.start.toISOString(),endsAt:e.end.toISOString(),comment:t.comment,createdBy:t.createdBy,duration:(0,o.intervalToAbbreviatedDurationString)(e),isRegex:!1,matchers:(null===(s=t.matchers)||void 0===s?void 0:s.map(y.cm))||[],matcherName:"",matcherValue:"",timeZone:o.DefaultTimeZone}}{const t=(0,o.addDurationToDate)(a,{hours:2});return Object.assign({id:"",startsAt:a.toISOString(),endsAt:t.toISOString(),comment:`created ${(0,o.dateTime)().format("YYYY-MM-DD HH:mm")}`,createdBy:de.config.bootData.user.name,duration:"2h",isRegex:!1,matchers:[{name:"",value:"",operator:u._M.equal}],matcherName:"",matcherValue:"",timeZone:o.DefaultTimeZone},(e=>{const t={},a=e.get("comment"),s=e.getAll("matcher"),n=(0,xe.RT)(s);return n.length&&(t.matchers=n.map(y.cm)),a&&(t.comment=a),t})(e))}},Re=e=>({field:d.css`
    margin: ${e.spacing(1,0)};
  `,textArea:d.css`
    max-width: ${e.breakpoints.values.sm}px;
  `,createdBy:d.css`
    width: 200px;
  `,flexRow:d.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;

    & > * {
      margin-right: ${e.spacing(1)};
    }
  `,silencePeriod:d.css`
    max-width: ${e.breakpoints.values.sm}px;
  `}),ze=e=>{var t;let{silence:a,alertManagerSourceName:s}=e;const[l]=(0,$e.j)(),c=(0,n.useMemo)((()=>Me(l,a)),[a,l]),u=(0,ue.cI)({defaultValues:c}),p=(0,i.useDispatch)(),m=(0,r.useStyles2)(Re),{loading:h}=(0,ie._)((e=>e.updateSilence));(0,De.x)((e=>e.unifiedAlerting.updateSilence));const{register:x,handleSubmit:b,formState:v,watch:j,setValue:_,clearErrors:A}=u,w=j("duration"),k=j("startsAt"),N=j("endsAt"),[C,D]=(0,n.useState)(w);return(0,oe.Z)((()=>{if((0,o.isValidDate)(k)&&(0,o.isValidDate)(N))if(w!==C)_("endsAt",(0,o.dateTime)((0,o.addDurationToDate)(new Date(k),(0,o.parseDuration)(w))).toISOString()),D(w);else{const e=new Date(k).valueOf();if(new Date(N).valueOf()>e){const e=(0,o.intervalToAbbreviatedDurationString)({start:new Date(k),end:new Date(N)});_("duration",e),D(e)}}}),700,[A,w,N,C,_,k]),(0,f.jsx)(ue.RV,Object.assign({},u,{children:(0,f.jsxs)("form",{onSubmit:b((e=>{const{id:t,startsAt:a,endsAt:n,comment:r,createdBy:i,matchers:l}=e,c=l.map(y._J),o=(0,S.pickBy)({id:t,startsAt:a,endsAt:n,comment:r,createdBy:i,matchers:c},(e=>!!e));p((0,E.QY)({alertManagerSourceName:s,payload:o,exitOnSave:!0,successMessage:"Silence "+(o.id?"updated":"created")}))})),children:[(0,f.jsxs)(r.FieldSet,{label:""+(a?"Recreate silence":"Create silence"),children:[(0,f.jsxs)("div",{className:(0,d.cx)(m.flexRow,m.silencePeriod),children:[Ae||(Ae=(0,f.jsx)(Se,{})),(0,f.jsx)(r.Field,{label:"Duration",invalid:!!v.errors.duration,error:v.errors.duration&&("required"===v.errors.duration.type?"Required field":v.errors.duration.message),children:(0,f.jsx)(r.Input,Object.assign({className:m.createdBy},x("duration",{validate:e=>0===Object.keys((0,o.parseDuration)(e)).length?"Invalid duration. Valid example: 1d 4h (Available units: y, M, w, d, h, m, s)":void 0}),{id:"duration"}))})]}),we||(we=(0,f.jsx)(he,{})),(0,f.jsx)(r.Field,{className:(0,d.cx)(m.field,m.textArea),label:"Comment",required:!0,error:null===(t=v.errors.comment)||void 0===t?void 0:t.message,invalid:!!v.errors.comment,children:(0,f.jsx)(r.TextArea,Object.assign({},x("comment",{required:{value:!0,message:"Required."}}),{rows:5,placeholder:"Details about the silence"}))}),ke||(ke=(0,f.jsx)(je,{}))]}),(0,f.jsxs)("div",{className:m.flexRow,children:[h&&(Ne||(Ne=(0,f.jsx)(r.Button,{disabled:!0,icon:"fa fa-spinner",variant:"primary",children:"Saving..."}))),!h&&(Ce||(Ce=(0,f.jsx)(r.Button,{type:"submit",children:"Submit"}))),(0,f.jsx)(r.LinkButton,{href:(0,g.eQ)("alerting/silences",s),variant:"secondary",fill:"outline",children:"Cancel"})]})]})}))};var Te,qe,Oe=a("./public/app/features/alerting/unified/components/AlertManagerPicker.tsx"),Ie=a("./public/app/types/index.ts");const Be=(0,r.withErrorBoundary)((()=>{var e,t;const[a,s]=(0,re.k)(),o=(0,i.useDispatch)(),d=(0,ie._)((e=>e.silences)),u=(0,ie._)((e=>e.amAlerts)),p=a?u[a]||ce.oq:void 0,m=(0,l.TH)().pathname.endsWith("/alerting/silences");(0,n.useEffect)((()=>{function e(){a&&(o((0,E.je)(a)),o((0,E.dB)(a)))}e();const t=setInterval((()=>e),le.cm);return()=>{clearInterval(t)}}),[a,o]);const{result:h,loading:g,error:x}=a&&d[a]||ce.oq,b=(0,n.useCallback)((e=>h&&h.find((t=>t.id===e))),[h]);return a?(0,f.jsxs)(c.J,{pageId:"silences",children:[(0,f.jsx)(te.q,{actions:[Ie.bW.AlertingInstancesExternalRead],children:(0,f.jsx)(Oe.P,{disabled:!m,current:a,onChange:s})}),x&&!g&&(0,f.jsx)(r.Alert,{severity:"error",title:"Error loading silences",children:x.message||"Unknown error."}),(null==p?void 0:p.error)&&!(null!=p&&p.loading)&&(0,f.jsx)(r.Alert,{severity:"error",title:"Error loading Alertmanager alerts",children:(null===(e=p.error)||void 0===e?void 0:e.message)||"Unknown error."}),g&&(qe||(qe=(0,f.jsx)(r.LoadingPlaceholder,{text:"loading silences..."}))),h&&!x&&(0,f.jsxs)(l.rs,{children:[(0,f.jsx)(l.AW,{exact:!0,path:"/alerting/silences",children:(0,f.jsx)(ne,{silences:h,alertManagerAlerts:null!==(t=null==p?void 0:p.result)&&void 0!==t?t:[],alertManagerSourceName:a})}),(0,f.jsx)(l.AW,{exact:!0,path:"/alerting/silence/new",children:(0,f.jsx)(ze,{alertManagerSourceName:a})}),(0,f.jsx)(l.AW,{exact:!0,path:"/alerting/silence/:id/edit",children:e=>{let{match:t}=e;return(null==t?void 0:t.params.id)&&(0,f.jsx)(ze,{silence:b(t.params.id),alertManagerSourceName:a})}})]})]}):Te||(Te=(0,f.jsx)(l.l_,{to:"/alerting/silences"}))}),{style:"page"})},"./public/app/features/alerting/unified/components/AlertingPageWrapper.tsx":(e,t,a)=>{a.d(t,{J:()=>l});a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var s=a("./public/app/core/components/Page/Page.tsx"),n=a("./public/app/core/selectors/navModel.ts"),r=a("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/3/opt/drone/yarncache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),i=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const l=e=>{let{children:t,pageId:a,isLoading:l}=e;const c=(0,n.h)((0,r.useSelector)((e=>e.navIndex)),a);return(0,i.jsx)(s.Z,{navModel:c,children:(0,i.jsx)(s.Z.Contents,{isLoading:l,children:t})})}},"./public/app/features/alerting/unified/components/Authorize.tsx":(e,t,a)=>{a.d(t,{q:()=>r});a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var s=a("./public/app/core/services/context_srv.ts"),n=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const r=e=>{let{actions:t,children:a,fallback:r=!0}=e;return t.some((e=>s.Vt.hasAccess(e,r)))?(0,n.jsx)(n.Fragment,{children:a}):null}},"./public/app/features/alerting/unified/components/rules/ActionIcon.tsx":(e,t,a)=>{a.d(t,{A:()=>i});var s=a("./packages/grafana-ui/src/index.ts"),n=(a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js"));const r=["tooltip","icon","to","target","onClick","className","tooltipPlacement"];const i=e=>{let{tooltip:t,icon:a,to:i,target:l,onClick:c,className:o,tooltipPlacement:d="top"}=e,u=function(e,t){if(null==e)return{};var a,s,n={},r=Object.keys(e);for(s=0;s<r.length;s++)a=r[s],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,r);const p="string"==typeof t?t:void 0;return(0,n.jsx)(s.Tooltip,{content:t,placement:d,children:i?(0,n.jsx)(s.LinkButton,Object.assign({variant:"secondary",fill:"text",icon:a,href:i,size:"sm",target:l},u,{"aria-label":p})):(0,n.jsx)(s.Button,Object.assign({className:o,variant:"secondary",fill:"text",size:"sm",icon:a,type:"button",onClick:c},u,{"aria-label":p}))})}},"./public/app/features/alerting/unified/components/silences/AmAlertStateTag.tsx":(e,t,a)=>{a.d(t,{G:()=>l});var s=a("./public/app/plugins/datasource/alertmanager/types.ts"),n=(a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),a("./public/app/features/alerting/unified/components/StateTag.tsx")),r=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const i={[s.Z9.Active]:"bad",[s.Z9.Unprocessed]:"neutral",[s.Z9.Suppressed]:"info"},l=e=>{let{state:t}=e;return(0,r.jsx)(n.i,{state:i[t],children:t})}},"./public/app/features/alerting/unified/components/silences/Matchers.tsx":(e,t,a)=>{a.d(t,{g:()=>l});a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var s=a("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),n=a("./packages/grafana-ui/src/index.ts"),r=a("./public/app/features/alerting/unified/utils/alertmanager.ts"),i=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const l=e=>{let{matchers:t}=e;const a=(0,n.useStyles2)(c);return(0,i.jsx)("div",{children:(0,i.jsx)(n.TagList,{className:a.tags,tags:t.map((e=>`${e.name}${(0,r.zy)(e)}${e.value}`))})})},c=()=>({tags:s.css`
    justify-content: flex-start;
  `})},"./public/app/features/alerting/unified/hooks/useAlertManagerSourceName.ts":(e,t,a)=>{a.d(t,{k:()=>o});var s=a("./public/app/core/hooks/useQueryParams.ts"),n=a("./public/app/core/store.ts"),r=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),i=a("./public/app/features/alerting/unified/utils/constants.ts"),l=a("./public/app/features/alerting/unified/utils/datasource.ts");function c(e){return e===l.GC||!!(0,l.aM)().find((t=>t.name===e))}function o(){const[e,t]=(0,s.K)(),a=(0,r.useCallback)((e=>{c(e)&&(e===l.GC?(n.Z.delete(i.de),t({[i.c4]:null})):(n.Z.set(i.de,e),t({[i.c4]:e})))}),[t]),o=e[i.c4];if(o&&"string"==typeof o)return c(o)?[o,a]:[void 0,a];const d=n.Z.get(i.de);return d&&"string"==typeof d&&c(d)?(a(d),[d,a]):[l.GC,a]}},"./public/app/features/alerting/unified/hooks/useCombinedRuleNamespaces.ts":(e,t,a)=>{a.d(t,{Kd:()=>c,Zo:()=>l});var s=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n=a("./public/app/features/alerting/unified/utils/datasource.ts"),r=a("./public/app/features/alerting/unified/utils/rules.ts"),i=a("./public/app/features/alerting/unified/hooks/useUnifiedAlertingSelector.ts");function l(e){const t=(0,i._)((e=>e.promRules)),a=(0,i._)((e=>e.rulerRules)),l=(0,s.useRef)({}),c=(0,s.useMemo)((()=>{if(e){const t=(0,n.o_)(e);if(!t)throw new Error(`Unknown rules source: ${e}`);return[t]}return(0,n.h_)()}),[e]);return(0,s.useMemo)((()=>c.map((e=>{var s,i;const c=(0,n.jq)(e)?e.name:e,d=null===(s=t[c])||void 0===s?void 0:s.result,u=null===(i=a[c])||void 0===i?void 0:i.result,p=l.current[c];if(p&&p.promRules===d&&p.rulerRules===u)return p.result;const m={};Object.entries(u||{}).forEach((t=>{let[a,s]=t;const n={rulesSource:e,name:a,groups:[]};m[a]=n,function(e,t){e.groups=t.map((t=>{const a={name:t.name,interval:t.interval,source_tenants:t.source_tenants,rules:[]};return a.rules=t.rules.map((t=>function(e,t,a){return(0,r.cG)(e)?{name:e.alert,query:e.expr,labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:t,group:a}:(0,r.yF)(e)?{name:e.record,query:e.expr,labels:e.labels||{},annotations:{},rulerRule:e,namespace:t,group:a}:{name:e.grafana_alert.title,query:"",labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:t,group:a}}(t,e,a))),a}))}(n,s)})),null==d||d.forEach((t=>{let{name:a,groups:s}=t;!function(e,t){t.forEach((t=>{var a;let s=e.groups.find((e=>e.name===t.name));s||(s={name:t.name,rules:[]},e.groups.push(s)),(null!==(a=t.rules)&&void 0!==a?a:[]).forEach((t=>{const a=function(e,t,a){var s;if((0,n.HY)(a))return t.rules.find((t=>t.name===e.name));return null!==(s=t.rules.find((t=>!t.promRule&&o(t,e,!0))))&&void 0!==s?s:t.rules.find((t=>!t.promRule&&o(t,e,!1)))}(t,s,e.rulesSource);a?a.promRule=t:s.rules.push(function(e,t,a){return{name:e.name,query:e.query,labels:e.labels||{},annotations:(0,r.x_)(e)&&e.annotations||{},promRule:e,namespace:t,group:a}}(t,e,s))}))}))}(m[a]=m[a]||{rulesSource:e,name:a,groups:[]},s)}));const h=Object.values(m);return l.current[c]={promRules:d,rulerRules:u,result:h},h})).flat()),[t,a,c])}function c(e){return e.map((e=>{const t=Object.assign({},e,{groups:[]});var a;return t.groups.push({name:"default",rules:(a=e.groups.flatMap((e=>e.rules)),a.sort(((e,t)=>e.name.localeCompare(t.name))))}),t}))}function o(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.name===t.name&&JSON.stringify([a?d(e.query):"",e.labels,e.annotations])===JSON.stringify([a?d(t.query):"",t.labels||{},(0,r.x_)(t)&&t.annotations||{}])}function d(e){return e.length>1&&"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,-1)),(e=e.replace(/\s|\n/g,"")).split("").sort().join("")}},"./public/app/features/alerting/unified/hooks/useURLSearchParams.ts":(e,t,a)=>{a.d(t,{j:()=>i});var s=a("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n=a("./.yarn/__virtual__/react-router-virtual-31642fe47a/3/opt/drone/yarncache/react-router-npm-5.2.1-ea754d7473-7daae084bf.zip/node_modules/react-router/esm/react-router.js"),r=a("./packages/grafana-runtime/src/index.ts");function i(){const{search:e}=(0,n.TH)();return[(0,s.useMemo)((()=>new URLSearchParams(e)),[e]),(0,s.useCallback)(((e,t)=>{r.locationService.partial(e,t)}),[])]}},"./public/app/features/alerting/unified/styles/table.ts":(e,t,a)=>{a.d(t,{D:()=>n});var s=a("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js");const n=e=>({table:s.css`
    width: 100%;
    border-radius: ${e.shape.borderRadius()};
    border: solid 1px ${e.colors.border.weak};
    background-color: ${e.colors.background.secondary};

    th {
      padding: ${e.spacing(1)};
    }

    td {
      padding: 0 ${e.spacing(1)};
    }

    tr {
      height: 38px;
    }
  `,evenRow:s.css`
    background-color: ${e.colors.background.primary};
  `,colExpand:s.css`
    width: 36px;
  `,actionsCell:s.css`
    text-align: right;
    width: 1%;
    white-space: nowrap;

    & > * + * {
      margin-left: ${e.spacing(.5)};
    }
  `})}}]);
//# sourceMappingURL=AlertSilences.15718e8e3083449662a7.js.map