"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9619],{58439:(b,P,a)=>{a.d(P,{B:()=>_});var n=a(52423),t=a(68404),v=a(41959),O=a(29516);function _({title:l,stepNumber:h,markdown:o,children:c}){const d=(0,O.wW)(u);return t.createElement("div",{className:d.box},h!==void 0&&t.createElement("div",{className:d.stepNumber},h),t.createElement("div",{className:d.boxInner},l&&t.createElement("div",{className:d.header},t.createElement("span",null,l)),t.createElement("div",{className:d.body},o&&t.createElement("div",{dangerouslySetInnerHTML:{__html:(0,v.a)(o)}}),c)))}const u=l=>({box:(0,n.css)({background:l.colors.background.secondary,padding:l.spacing(1),borderRadius:l.shape.borderRadius(),position:"relative"}),boxInner:(0,n.css)({marginLeft:l.spacing(4)}),stepNumber:(0,n.css)({fontWeight:l.typography.fontWeightMedium,background:l.colors.secondary.main,width:"20px",height:"20px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"10px",left:"11px",fontSize:l.typography.bodySmall.fontSize}),header:(0,n.css)({paddingBottom:l.spacing(.5),display:"flex",alignItems:"center",fontFamily:l.typography.fontFamilyMonospace}),body:(0,n.css)({color:l.colors.text.secondary,"p:last-child":{margin:0},a:{color:l.colors.text.link,textDecoration:"underline"}})})},41285:(b,P,a)=>{a.d(P,{P:()=>re});var n=a(52423),t=a(68404),v=a(19677),O=a(24015),_=a(54291),u=a(26418),l=a(29516),h=a(76100),o=a(90723),c=a(48756),d=a(81697),g=a(46739),E=a(85361),B=a(41959),L=a(97635);const K=t.memo(({def:e,operation:r})=>{const i=(0,l.wW)(H),[m,p]=(0,t.useState)(!1),{getTooltipProps:C,setTooltipRef:S,setTriggerRef:R,visible:M}=(0,E.O)({placement:"top",visible:m,offset:[0,16],onVisibleChange:p,interactive:!0,trigger:["click"]});return t.createElement(t.Fragment,null,t.createElement(o.zx,{title:"Click to show description",ref:R,icon:"info-circle",size:"sm",variant:"secondary",fill:"text"}),M&&t.createElement(L.h_,null,t.createElement("div",{ref:S,...C(),className:i.docBox},t.createElement("div",{className:i.docBoxHeader},t.createElement("span",null,e.renderer(r,e,"<expr>")),t.createElement(u.FlexItem,{grow:1}),t.createElement(o.zx,{icon:"times",onClick:()=>p(!1),fill:"text",variant:"secondary",title:"Remove operation"})),t.createElement("div",{className:i.docBoxBody,dangerouslySetInnerHTML:{__html:I(e,r)}}))))});K.displayName="OperationDocs";const H=e=>({docBox:(0,n.css)({overflow:"hidden",background:e.colors.background.primary,border:`1px solid ${e.colors.border.strong}`,boxShadow:e.shadows.z3,maxWidth:"600px",padding:e.spacing(1),borderRadius:e.shape.borderRadius(),zIndex:e.zIndex.tooltip}),docBoxHeader:(0,n.css)({fontSize:e.typography.h5.fontSize,fontFamily:e.typography.fontFamilyMonospace,paddingBottom:e.spacing(1),display:"flex",alignItems:"center"}),docBoxBody:(0,n.css)({marginBottom:e.spacing(-1),color:e.colors.text.secondary}),signature:(0,n.css)({fontSize:e.typography.bodySmall.fontSize,fontFamily:e.typography.fontFamilyMonospace}),dropdown:(0,n.css)({opacity:0,color:e.colors.text.secondary})});function I(e,r){return(0,B.a)(e.explainHandler?e.explainHandler(r,e):e.documentation??"no docs")}const z=t.memo(({operation:e,def:r,index:i,onChange:m,onRemove:p,queryModeller:C,dragHandleProps:S})=>{const R=(0,l.wW)(F),[M,U]=(0,t.useState)({}),D=()=>{if(M.isOpen)U({...M,isOpen:!1});else{const x=C.getAlternativeOperations(r.alternativesKey).map(W=>({label:W.name,value:W}));U({isOpen:!0,alternatives:x})}};return t.createElement("div",{className:R.header},!M.isOpen&&t.createElement(t.Fragment,null,t.createElement("div",{...S},r.name??r.id),t.createElement(u.FlexItem,{grow:1}),t.createElement("div",{className:`${R.operationHeaderButtons} operation-header-show-on-hover`},t.createElement(o.zx,{icon:"angle-down",size:"sm",onClick:D,fill:"text",variant:"secondary",title:"Click to view alternative operations"}),t.createElement(K,{def:r,operation:e}),t.createElement(o.zx,{icon:"times",size:"sm",onClick:()=>p(i),fill:"text",variant:"secondary",title:"Remove operation"}))),M.isOpen&&t.createElement("div",{className:R.selectWrapper},t.createElement(g.Ph,{autoFocus:!0,openMenuOnFocus:!0,placeholder:"Replace with",options:M.alternatives,isOpen:!0,onCloseMenu:D,onChange:x=>{if(x.value){const W=C.getOperationDef(x.value.id),A=[...W.defaultParams];for(let T=0;T<Math.min(e.params.length,A.length);T++)W.params[T].type===r.params[T].type&&(A[T]=e.params[T]);const N={...e,params:A,id:x.value.id};m(i,r.changeTypeHandler?r.changeTypeHandler(N,W):N)}}})))});z.displayName="OperationHeader";const F=e=>({header:(0,n.css)({borderBottom:`1px solid ${e.colors.border.medium}`,padding:e.spacing(.5,.5,.5,1),display:"flex",alignItems:"center","&:hover .operation-header-show-on-hover":(0,n.css)({opacity:1})}),operationHeaderButtons:(0,n.css)({opacity:0,transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.short})}),selectWrapper:(0,n.css)({paddingRight:e.spacing(2)})});var V=a(63134),k=a(53799),j=a(94338),w=a(8373);function J(e){if(e.editor)return e.editor;if(e.options)return Y;switch(e.type){case"boolean":return X;case"number":case"string":default:return G}}function G(e){return t.createElement(k.H,{id:(0,w.i1)(e.operationIndex,e.index),defaultValue:e.value?.toString(),minWidth:e.paramDef.minWidth,placeholder:e.paramDef.placeholder,title:e.paramDef.description,maxWidth:(e.paramDef.minWidth||20)*3,onCommitChange:r=>{e.onChange(e.index,r.currentTarget.value),e.paramDef.runQueryOnEnter&&r.type==="keydown"&&e.onRunQuery()}})}function X(e){return t.createElement(j.X,{id:(0,w.i1)(e.operationIndex,e.index),value:e.value,onChange:r=>e.onChange(e.index,r.currentTarget.checked)})}function Y({paramDef:e,value:r,index:i,operationIndex:m,onChange:p}){const C=(0,l.wW)(q);let S=e.options;S[0]?.label||(S=e.options.map(M=>({label:M.toString(),value:M})));let R=S.find(M=>M.value===r)??(0,V.E)(r);return!r&&e.optional?t.createElement("div",{className:C.optionalParam},t.createElement(o.zx,{size:"sm",variant:"secondary",title:`Add ${e.name}`,icon:"plus",onClick:()=>p(i,S[0].value)},e.name)):t.createElement(u.Stack,{gap:.5,direction:"row",alignItems:"center",wrap:!1},t.createElement(g.Ph,{id:(0,w.i1)(m,i),value:R,options:S,placeholder:e.placeholder,allowCustomValue:!0,onChange:M=>p(i,M.value)}),e.optional&&t.createElement(o.zx,{"data-testid":`operations.${i}.remove-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${e.name}`,onClick:()=>p(i,"")}))}const q=e=>({optionalParam:(0,n.css)({marginTop:e.spacing(1)})});function ee({operation:e,index:r,onRemove:i,onChange:m,onRunQuery:p,queryModeller:C,query:S,datasource:R,flash:M,highlight:U}){const D=(0,l.wW)(ne),x=C.getOperationDef(e.id),W=te(M);if(!x)return t.createElement("span",null,"Operation ",e.id," not found");const A=(s,y)=>{const $={...e,params:[...e.params]};$.params[s]=y,Z(x,$,r,s,m)},N=()=>{const s={...e,params:[...e.params,""]};Z(x,s,r,e.params.length,m)},T=s=>{const y={...e,params:[...e.params.slice(0,s),...e.params.slice(s+1)]};Z(x,y,r,s,m)},Q=[];for(let s=0;s<e.params.length;s++){const y=x.params[Math.min(x.params.length-1,s)],$=J(y);Q.push(t.createElement("div",{className:D.paramRow,key:`${s}-1`},!y.hideName&&t.createElement("div",{className:D.paramName},t.createElement("label",{htmlFor:(0,w.i1)(r,s)},y.name),y.description&&t.createElement(c.u,{placement:"top",content:y.description,theme:"info"},t.createElement(d.J,{name:"info-circle",size:"sm",className:D.infoIcon}))),t.createElement("div",{className:D.paramValue},t.createElement(u.Stack,{gap:.5,direction:"row",alignItems:"center",wrap:!1},t.createElement($,{index:s,paramDef:y,value:e.params[s],operation:e,operationIndex:r,onChange:A,onRunQuery:p,query:S,datasource:R}),y.restParam&&(e.params.length>x.params.length||y.optional)&&t.createElement(o.zx,{"data-testid":`operations.${r}.remove-rest-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${y.name}`,onClick:()=>T(s)})))))}let f;if(x.params.length>0){const s=x.params[x.params.length-1];s.restParam&&(f=ae(s,N,r,e.params.length,D))}return t.createElement(v._l,{draggableId:`operation-${r}`,index:r},s=>t.createElement("div",{className:(0,n.cx)(D.card,(W||U)&&D.cardHighlight),ref:s.innerRef,...s.draggableProps,"data-testid":`operations.${r}.wrapper`},t.createElement(z,{operation:e,dragHandleProps:s.dragHandleProps,def:x,index:r,onChange:m,onRemove:i,queryModeller:C}),t.createElement("div",{className:D.body},Q),f,r<S.operations.length-1&&t.createElement("div",{className:D.arrow},t.createElement("div",{className:D.arrowLine}),t.createElement("div",{className:D.arrowArrow}))))}function te(e){const[r,i]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{let m;return e?m=setTimeout(()=>{i(!1)},1e3):i(!0),()=>clearTimeout(m)},[e]),r&&e}function ae(e,r,i,m,p){return t.createElement("div",{className:p.restParam,key:`${m}-2`},t.createElement(o.zx,{size:"sm",icon:"plus",title:`Add ${e.name}`,variant:"secondary",onClick:r,"data-testid":`operations.${i}.add-rest-param`},e.name))}function Z(e,r,i,m,p){e.paramChangedHandler?p(i,e.paramChangedHandler(m,r,e)):p(i,r)}const ne=e=>({card:(0,n.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.medium}`,display:"flex",flexDirection:"column",cursor:"grab",borderRadius:e.shape.borderRadius(1),marginBottom:e.spacing(1),position:"relative",transition:"all 0.5s ease-in 0s"}),cardHighlight:(0,n.css)({boxShadow:`0px 0px 4px 0px ${e.colors.primary.border}`,border:`1px solid ${e.colors.primary.border}`}),infoIcon:(0,n.css)({marginLeft:e.spacing(.5),color:e.colors.text.secondary,":hover":{color:e.colors.text.primary}}),body:(0,n.css)({margin:e.spacing(1,1,.5,1),display:"table"}),paramRow:(0,n.css)({label:"paramRow",display:"table-row",verticalAlign:"middle"}),paramName:(0,n.css)({display:"table-cell",padding:e.spacing(0,1,0,0),fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,verticalAlign:"middle",height:"32px"}),paramValue:(0,n.css)({label:"paramValue",display:"table-cell",verticalAlign:"middle"}),restParam:(0,n.css)({padding:e.spacing(0,1,1,1)}),arrow:(0,n.css)({position:"absolute",top:"0",right:"-18px",display:"flex"}),arrowLine:(0,n.css)({height:"2px",width:"8px",backgroundColor:e.colors.border.strong,position:"relative",top:"14px"}),arrowArrow:(0,n.css)({width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:`7px solid ${e.colors.border.strong}`,position:"relative",top:"10px"})});function re({query:e,datasource:r,queryModeller:i,onChange:m,onRunQuery:p,highlightedOp:C}){const S=(0,l.wW)(le),{operations:R}=e,M=oe(R),[U,D]=(0,t.useState)(!1),x=(f,s)=>{const y=[...R];y.splice(f,1,s),m({...e,operations:y})},W=f=>{const s=[...R.slice(0,f),...R.slice(f+1)];m({...e,operations:s})},A=i.getCategories().map(f=>({value:f,label:f,items:i.getOperationsForCategory(f).map(s=>({value:s.id,label:s.name,isLeaf:!0}))})),N=f=>{const s=i.getOperationDef(f);s&&(m(s.addOperationHandler(s,e,i)),D(!1))},T=f=>{if(!f.destination)return;const s=[...R],y=s[f.source.index];s.splice(f.source.index,1),s.splice(f.destination.index,0,y),m({...e,operations:s})},Q=()=>{D(!1)};return t.createElement(u.Stack,{gap:1,direction:"column"},t.createElement(u.Stack,{gap:1},R.length>0&&t.createElement(v.Z5,{onDragEnd:T},t.createElement(v.bK,{droppableId:"sortable-field-mappings",direction:"horizontal"},f=>t.createElement("div",{className:S.operationList,ref:f.innerRef,...f.droppableProps},R.map((s,y)=>t.createElement(ee,{key:s.id+JSON.stringify(s.params)+y,queryModeller:i,index:y,operation:s,query:e,datasource:r,onChange:x,onRemove:W,onRunQuery:p,flash:M[y],highlight:C===s})),f.placeholder))),t.createElement("div",{className:S.addButton},U?t.createElement(h.v,{options:A,onSelect:N,onBlur:Q,autoFocus:!0,alwaysOpen:!0,hideActiveLevelLabel:!0,placeholder:"Search"}):t.createElement(o.zx,{icon:"plus",variant:"secondary",onClick:()=>D(!0),title:"Add operation"},"Operations"))))}function oe(e){const r=(0,O.Z)(),i=(0,_.Z)(e);if(!r())return e.map(()=>!1);if(!i)return e.map(()=>!0);let m=[];if(i.length-1===e.length&&e.every(p=>i.includes(p)))return e.map(()=>!1);if(i.length+1===e.length&&i.every(p=>e.includes(p))){const p=e.find(C=>!i.includes(C));m=e.map(C=>C===p)}else m=e.map((p,C)=>!se(p.id,i[C]?.id));return m}function se(e,r){return e===r||`__${e}_by`===r||e===`__${r}_by`}const le=e=>({heading:(0,n.css)({label:"heading",fontSize:12,fontWeight:e.typography.fontWeightMedium,marginBottom:0}),operationList:(0,n.css)({label:"operationList",display:"flex",flexWrap:"wrap",gap:e.spacing(2)}),addButton:(0,n.css)({label:"addButton",width:126,paddingBottom:e.spacing(1)})})},19023:(b,P,a)=>{a.d(P,{V:()=>O});var n=a(68404),t=a(58439),v=a(45204);function O({query:_,queryModeller:u,stepNumber:l,lang:h,onMouseEnter:o,onMouseLeave:c}){return n.createElement(n.Fragment,null,_.operations.map((d,g)=>{const E=u.getOperationDef(d.id);if(!E)return`Operation ${d.id} not found`;const B=E.renderer(d,E,"<expr>"),L=E.explainHandler?E.explainHandler(d,E):E.documentation??"no docs";return n.createElement("div",{key:g,onMouseEnter:()=>o?.(d,g),onMouseLeave:()=>c?.(d,g)},n.createElement(t.B,{stepNumber:g+l,title:n.createElement(v.U,{query:B,lang:h}),markdown:L}))}))}},73250:(b,P,a)=>{a.d(P,{B:()=>_});var n=a(52423),t=a(68404),v=a(26418),O=a(29516);function _({children:l}){const h=(0,O.wW)(u);return t.createElement("div",{className:h.root},t.createElement(v.Stack,{gap:1},l))}const u=l=>({root:(0,n.css)({padding:l.spacing(1,1,0,1),backgroundColor:l.colors.background.secondary,borderRadius:l.shape.borderRadius(1)})})},75765:(b,P,a)=>{a.d(P,{L:()=>l});var n=a(52423),t=a(68404),v=a(77274),O=a(29516),_=a(48756),u=a(90723);const l=({datasource:o,query:c,onChange:d,data:g,queryModeller:E,buildVisualQueryFromString:B})=>{const[L,K]=(0,t.useState)([]),H=(0,O.wW)(h);return(0,t.useEffect)(()=>{const I={expr:E.renderQuery(c),refId:""},z=o.getQueryHints(I,g?.series||[]).filter(F=>F.fix?.action);K(z)},[o,c,g,E]),t.createElement(t.Fragment,null,L.length>0&&t.createElement("div",{className:H.container},L.map(I=>t.createElement(_.u,{content:`${I.label} ${I.fix?.label}`,key:I.type},t.createElement(u.zx,{onClick:()=>{if((0,v.ff)("grafana_query_builder_hints_clicked",{hint:I.type,datasourceType:o.type}),I?.fix?.action){const z={expr:E.renderQuery(c),refId:""},F=o.modifyQuery(z,I.fix.action),V=B(F.expr);return d(V.query)}},fill:"outline",size:"sm",className:H.hint},"hint: ",I.fix?.title||I.fix?.action?.type.toLowerCase().replace("_"," "))))))};l.displayName="QueryBuilderHints";const h=o=>({container:n.css`
      display: flex;
      align-items: start;
    `,hint:n.css`
      margin-right: ${o.spacing(1)};
    `})},92611:(b,P,a)=>{a.d(P,{k:()=>_});var n=a(68404),t=a(318),v=a(58079);const O=[{label:"Builder",value:v.c.Builder},{label:"Code",value:v.c.Code}];function _({mode:u,onChange:l}){return n.createElement("div",{"data-testid":"QueryEditorModeToggle"},n.createElement(t.S,{options:O,size:"sm",value:u,onChange:l}))}},89318:(b,P,a)=>{a.d(P,{n:()=>h});var n=a(52423),t=a(82897),v=a.n(t),O=a(68404),_=a(26418),u=a(29516),l=a(44727);function h({label:c,...d}){const g=c.replace(" ","-"),E=(0,O.useRef)((0,t.uniqueId)(`switch-${g}`)),B=(0,u.wW)(o);return O.createElement(_.Stack,{gap:1},O.createElement("label",{htmlFor:E.current,className:B.switchLabel},c),O.createElement(l.r,{...d,id:E.current}))}const o=c=>({switchLabel:(0,n.css)({color:c.colors.text.secondary,cursor:"pointer",fontSize:c.typography.bodySmall.fontSize,"&:hover":{color:c.colors.text.primary}})})},38435:(b,P,a)=>{a.d(P,{d:()=>l});var n=a(52423),t=a(68404),v=a(86253),O=a(26418),_=a(29516),u=a(81697);function l({title:o,children:c,collapsedInfo:d}){const[g,E]=(0,v.Z)(!1),B=(0,_.wW)(h);return t.createElement(O.Stack,{gap:0,direction:"column"},t.createElement("div",{className:B.header,onClick:E,title:"Click to edit options"},t.createElement("div",{className:B.toggle},t.createElement(u.J,{name:g?"angle-down":"angle-right"})),t.createElement("h6",{className:B.title},o),!g&&t.createElement("div",{className:B.description},d.map((L,K)=>t.createElement("span",{key:K},L)))),g&&t.createElement("div",{className:B.body},c))}const h=o=>({switchLabel:(0,n.css)({color:o.colors.text.secondary,cursor:"pointer",fontSize:o.typography.bodySmall.fontSize,"&:hover":{color:o.colors.text.primary}}),header:(0,n.css)({display:"flex",cursor:"pointer",alignItems:"baseline",color:o.colors.text.primary,"&:hover":{background:o.colors.emphasize(o.colors.background.primary,.03)}}),title:(0,n.css)({flexGrow:1,overflow:"hidden",fontSize:o.typography.bodySmall.fontSize,fontWeight:o.typography.fontWeightMedium,margin:0}),description:(0,n.css)({color:o.colors.text.secondary,fontSize:o.typography.bodySmall.fontSize,paddingLeft:o.spacing(2),gap:o.spacing(2),display:"flex"}),body:(0,n.css)({display:"flex",paddingTop:o.spacing(2),gap:o.spacing(2),flexWrap:"wrap"}),toggle:(0,n.css)({color:o.colors.text.secondary,marginRight:`${o.spacing(1)}`})})},45204:(b,P,a)=>{a.d(P,{U:()=>u});var n=a(52423),t=a(57706),v=a.n(t),O=a(68404),_=a(29516);function u({query:h,lang:o,className:c}){const d=(0,_.l4)(),g=l(d),E=v().highlight(h,o.grammar,o.name);return O.createElement("div",{className:(0,n.cx)(g.editorField,"prism-syntax-highlight",c),"aria-label":"selector",dangerouslySetInnerHTML:{__html:E}})}const l=h=>({editorField:(0,n.css)({fontFamily:h.typography.fontFamilyMonospace,fontSize:h.typography.bodySmall.fontSize})})},89290:(b,P,a)=>{a.d(P,{P5:()=>o,ar:()=>v,iS:()=>_});var n=a(68404),t=a(58379);const v="PrometheusQueryEditorExplainDefault",O="PrometheusQueryEditorRawQueryDefault",_="LokiQueryEditorExplainDefault",u="LokiQueryEditorRawQueryDefault";function l(c,d=!1){const g=t.Z.get(c);return g===void 0?d:Boolean(parseInt(g,10))}function h(c,d){t.Z.set(c,d?"1":"0")}function o(c,d=!1){const[g,E]=(0,n.useState)(l(c,d)),B=(0,n.useCallback)(L=>{h(c,L),E(L)},[c]);return{flag:g,setFlag:B}}}}]);

//# sourceMappingURL=9619.f14d10313879a6d36114.js.map