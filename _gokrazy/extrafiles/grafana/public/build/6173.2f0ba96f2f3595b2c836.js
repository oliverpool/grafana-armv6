"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6173],{61802:(ne,k,n)=>{n.d(k,{l:()=>xt});var a=n(68404),y=n(36635),$=n(32294),M=n(46732),G=n(58252),j=n(56991);function c({children:r,width:e,height:s,onLoad:t,onChange:o}){const i=(0,j.L)(),[l,d]=(0,a.useState)(!1),[u,f]=(0,a.useState)(!1),z=(0,a.useRef)(null);return(0,G.Z)(()=>{c.addCallback(i,Z=>{!l&&Z.isIntersecting&&(d(!0),t?.()),f(Z.isIntersecting),o?.(Z.isIntersecting)});const L=z.current;return L&&c.observer.observe(L),()=>{delete c.callbacks[i],L&&c.observer.unobserve(L),Object.keys(c.callbacks).length===0&&c.observer.disconnect()}}),a.createElement("div",{id:i,ref:z,style:{width:e,height:s}},l&&(typeof r=="function"?r({isInView:u}):r))}c.callbacks={},c.addCallback=(r,e)=>c.callbacks[r]=e,c.observer=new IntersectionObserver(r=>{for(const e of r)c.callbacks[e.target.id](e)},{rootMargin:"100px"});var b=n(9085),U=n.n(b),N=n(95484),v=n(49922),E=n(69311),g=n(68183),x=n(37210),O=n(57388),w=n(47694),P=n(84952),h=n(73952);function D(r){return/(d-solo|dashboard-solo)/.test(r?.toLowerCase())}function F(r,e){return Boolean(e.find(s=>s.id==="apps")?.children?.find(s=>s.id===`plugin-page-${r}`)?.children?.some(s=>s.url?.endsWith(`/a/${r}`)))}var T=n(19349),S=n(52423),W=n(29516),K=n(57319),A=n(81697),Q=n(69600),_=n(53821),J=n(48756);const ae=({state:r,onClick:e})=>{const s=(0,W.wW)(re);return r===v.Gu.Loading?a.createElement("div",{className:"panel-loading",onClick:e},a.createElement(J.u,{content:"Cancel query"},a.createElement(A.J,{className:"panel-loading__spinner spin-clockwise",name:"sync"}))):r===v.Gu.Streaming?a.createElement("div",{className:"panel-loading",onClick:e},a.createElement("div",{title:"Streaming (click to stop)",className:s.streamIndicator})):null};function re(r){return{streamIndicator:S.css`
      width: 10px;
      height: 10px;
      background: ${r.colors.text.disabled};
      box-shadow: 0 0 2px ${r.colors.text.disabled};
      border-radius: 50%;
      position: relative;
      top: 6px;
      right: 1px;
    `}}function ie({children:r,...e}){const[s,t]=(0,a.useState)({x:0,y:0}),[o,i]=(0,a.useState)(!1),l=(0,a.useCallback)(u=>{ve(s,le(u))&&i(!o)},[s,o,i]),d=(0,a.useCallback)(u=>{t(le(u))},[t]);return a.createElement("header",{...e,className:"panel-title-container",onClick:l,onMouseDown:d},r({panelMenuOpen:o,closeMenu:()=>i(!1)}))}function ve(r,e,s=3.5){return Math.sqrt((r.x-e.x)**2+(r.y-e.y)**2)<=s}function le(r){return{x:r.clientX,y:r.clientY}}var C=n(79860);class R extends a.PureComponent{constructor(){super(...arguments),this.renderItems=(e,s=!1)=>a.createElement("ul",{className:"dropdown-menu dropdown-menu--menu panel-menu",style:this.props.style,role:s?"":"menu"},e.map((t,o)=>a.createElement(C.u,{key:`${t.text}${o}`,type:t.type,text:t.text,iconClassName:t.iconClassName,onClick:t.onClick,shortcut:t.shortcut},t.subMenu&&this.renderItems(t.subMenu,!0))))}render(){return a.createElement("div",{className:"panel-menu-container dropdown open"},this.renderItems(this.props.items))}}var V=n(81168),H=n(77274),p=n(77213),Y=n(85596),I=n(35287),ce=n(82002),Oe=n(55935),q=n(2476),se=n(39653),te=n(6297),Re=n(3153),Ke=n(48197);function ze(r,e,s,t){const o=m=>{m.preventDefault(),O.E1.partial({viewPanel:e.id})},i=m=>{m.preventDefault(),O.E1.partial({editPanel:e.id})},l=m=>{m.preventDefault(),(0,q.Po)(r,e)},d=m=>{m.preventDefault(),(0,q.Kq)(r,e)},u=m=>{m.preventDefault(),(0,q.oe)(e)},f=m=>{O.E1.partial({inspect:e.id,inspectTab:m}),(0,H.ff)("grafana_panel_menu_inspect",{tab:m??se.q.Data})},z=m=>{m.preventDefault()},L=m=>{m.preventDefault(),(0,q.jN)(r,e)},Z=m=>{m.preventDefault(),(0,q.bY)(e)},oe=m=>{m.preventDefault(),(0,q.WJ)(r,e,!0)},de=m=>{m.preventDefault();const fe=m.ctrlKey||m.metaKey?Ie=>window.open(`${w.ZP.appSubUrl}${Ie}`):void 0;Re.h.dispatch((0,Ke.m$)(e,{getDataSourceSrv:p.F,getTimeSrv:T.$t,getExploreUrl:Oe.H6,openInNewWindow:fe}))},he=m=>{m.preventDefault(),(0,q.qw)(e)},pe=m=>{m.preventDefault(),e.getQueryRunner().cancelQuery()},B=[];e.isEditing||B.push({text:(0,I.t)("panel.header-menu.view","View"),iconClassName:"eye",onClick:o,shortcut:"v"}),r.canEditPanel(e)&&!e.isEditing&&B.push({text:(0,I.t)("panel.header-menu.edit","Edit"),iconClassName:"edit",onClick:i,shortcut:"e"}),r.canEditPanel(e)&&(s===Y.Gu.Streaming||s===Y.Gu.Loading)&&B.push({text:"Stop query",iconClassName:"circle",onClick:pe}),B.push({text:(0,I.t)("panel.header-menu.share","Share"),iconClassName:"share-alt",onClick:l,shortcut:"p s"}),ce.Vt.hasAccessToExplore()&&!(e.plugin&&e.plugin.meta.skipDataQuery)&&B.push({text:(0,I.t)("panel.header-menu.explore","Explore"),iconClassName:"compass",onClick:de,shortcut:"x"});const ee=[];e.plugin&&!e.plugin.meta.skipDataQuery&&(ee.push({text:(0,I.t)("panel.header-menu.inspect-data","Data"),onClick:m=>f(se.q.Data)}),r.meta.canEdit&&ee.push({text:(0,I.t)("panel.header-menu.query","Query"),onClick:m=>f(se.q.Query)})),ee.push({text:(0,I.t)("panel.header-menu.inspect-json","Panel JSON"),onClick:m=>f(se.q.JSON)}),B.push({type:"submenu",text:(0,I.t)("panel.header-menu.inspect","Inspect"),iconClassName:"info-circle",onClick:m=>f(),shortcut:"i",subMenu:ee});const X=[],ge=r.canEditPanel(e);if(ge&&!(e.isViewing||e.isEditing)&&(X.push({text:(0,I.t)("panel.header-menu.duplicate","Duplicate"),onClick:L,shortcut:"p d"}),X.push({text:(0,I.t)("panel.header-menu.copy","Copy"),onClick:Z}),(0,te.V)(e)?X.push({text:(0,I.t)("panel.header-menu.unlink-library-panel","Unlink library panel"),onClick:u}):X.push({text:(0,I.t)("panel.header-menu.create-library-panel","Create library panel"),onClick:d})),t){const m=t.getScope(),fe=m.$$childHead.ctrl,Ie=fe.getExtendedMenu();for(const ue of Ie){const we={text:ue.text,href:ue.href,shortcut:ue.shortcut};ue.click&&(we.onClick=()=>{m.$eval(ue.click,{ctrl:fe})}),X.push(we)}}return e.options.legend&&X.push({text:e.options.legend.showLegend?(0,I.t)("panel.header-menu.hide-legend","Hide legend"):(0,I.t)("panel.header-menu.show-legend","Show legend"),onClick:he,shortcut:"p l"}),e.isEditing&&(X.length=0),ge&&e.plugin&&!e.plugin.meta.skipDataQuery&&X.push({text:(0,I.t)("panel.header-menu.get-help","Get help"),onClick:m=>f(se.q.Help)}),X.length&&B.push({type:"submenu",text:(0,I.t)("panel.header-menu.more","More..."),iconClassName:"cube",subMenu:X,onClick:z}),r.canEditPanel(e)&&!e.isEditing&&!e.isViewing&&(B.push({type:"divider",text:""}),B.push({text:(0,I.t)("panel.header-menu.remove","Remove"),iconClassName:"trash-alt",onClick:oe,shortcut:"p r"})),B}function $e({panel:r,dashboard:e,loadingState:s,children:t}){const[o,i]=(0,a.useState)([]),l=(0,V.useSelector)(d=>(0,h.i)(d,r)?.angularComponent);return(0,a.useEffect)(()=>{i(ze(e,r,s,l))},[e,r,l,s,i]),t({items:o})}function Te({style:r,panel:e,dashboard:s,loadingState:t}){return a.createElement($e,{panel:e,dashboard:s,loadingState:t},({items:o})=>a.createElement(R,{style:r,items:o}))}var Le=n(26408),Me=n(19253);const Qe=({notice:r,onClick:e})=>{const s=(0,W.wW)(Je),t=r.severity==="error"||r.severity==="warning"?"exclamation-triangle":"info-circle";return r.inspect&&e?a.createElement(Le.h,{className:s.notice,icon:t,key:r.severity,tooltip:r.text,onClick:o=>e(o,r.inspect)}):r.link?a.createElement("a",{className:s.notice,"aria-label":r.text,href:r.link,target:"_blank",rel:"noreferrer"},a.createElement(A.J,{name:t,style:{marginRight:"8px"}})):a.createElement(J.u,{key:r.severity,content:r.text},a.createElement("span",{className:s.iconTooltip},a.createElement(A.J,{name:t,size:"lg"})))},Je=r=>({notice:(0,S.css)({border:"none",borderRadius:r.shape.borderRadius()}),iconTooltip:(0,S.css)({color:`${r.colors.text.secondary}`,backgroundColor:`${r.colors.background.primary}`,cursor:"auto",border:"none",borderRadius:`${r.shape.borderRadius()}`,padding:`${r.spacing(0,1)}`,height:` ${r.spacing(r.components.height.md)}`,display:"flex",alignItems:"center",justifyContent:"center","&:focus, &:focus-visible":{...(0,Me.getFocusStyles)(r),zIndex:1},"&: focus:not(:focus-visible)":(0,Me.getMouseFocusStyles)(r),"&:hover ":{boxShadow:`${r.shadows.z1}`,color:`${r.colors.text.primary}`,background:`${r.colors.background.secondary}`}})}),be=({frames:r,panelId:e})=>{const s=(0,a.useCallback)((o,i)=>{o.stopPropagation(),O.E1.partial({inspect:e,inspectTab:i})},[e]),t={};for(const o of r)if(!(!o.meta||!o.meta.notices))for(const i of o.meta.notices)t[i.severity]=i;return a.createElement(a.Fragment,null,Object.values(t).map(o=>a.createElement(Qe,{notice:o,onClick:s,key:o.severity})))};function Ae({panel:r,error:e,isViewing:s,isEditing:t,data:o,alertState:i,dashboard:l}){const d=()=>r.getQueryRunner().cancelQuery(),u=r.getDisplayTitle(),f=(0,S.cx)("panel-header",s||t?"":"grid-drag-handle"),z=(0,W.wW)(Ze);return a.createElement(a.Fragment,null,a.createElement(ae,{state:o.state,onClick:d}),a.createElement(_.Z,{panel:r,title:r.title,description:r.description,scopedVars:r.scopedVars,links:(0,Q.H)(r),error:e}),a.createElement("div",{className:f},a.createElement(ie,{"data-testid":g.wl.components.Panels.Panel.title(u)},({closeMenu:L,panelMenuOpen:Z})=>a.createElement(K.L,{onClick:L,parent:document},a.createElement("div",{className:"panel-title"},a.createElement(be,{frames:o.series,panelId:r.id}),i?a.createElement(A.J,{name:i==="alerting"?"heart-break":"heart",className:"icon-gf panel-alert-icon",style:{marginRight:"4px"},size:"sm"}):null,a.createElement("h2",{className:z.titleText},u),!l.meta.publicDashboardAccessToken&&a.createElement("div",{"data-testid":"panel-dropdown"},a.createElement(A.J,{name:"angle-down",className:"panel-menu-toggle"}),Z?a.createElement(Te,{panel:r,dashboard:l,onClose:L}):null),o.request&&o.request.timeInfo&&a.createElement("span",{className:"panel-time-info"},a.createElement(A.J,{name:"clock-nine",size:"sm"})," ",o.request.timeInfo))))))}const Ze=r=>({titleText:S.css`
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
      max-width: calc(100% - 38px);
      cursor: pointer;
      font-weight: ${r.typography.fontWeightMedium};
      font-size: ${r.typography.body.fontSize};
      margin: 0;

      &:hover {
        color: ${r.colors.text.primary};
      }
      .panel-has-alert & {
        max-width: calc(100% - 54px);
      }
    `});class Ge extends a.PureComponent{constructor(e){super(e),this.element=null,this.timeSrv=(0,T.$t)(),this.subs=new N.w0,this.state={data:{state:v.Gu.NotStarted,series:[],timeRange:(0,E.JK)()}}}componentDidMount(){const{panel:e}=this.props;this.loadAngularPanel();const s=e.getQueryRunner();this.subs.add(s.getData({withTransforms:!1,withFieldConfig:!1}).subscribe({next:t=>this.onPanelDataUpdate(t)}))}onPanelDataUpdate(e){let s;if(e.state===v.Gu.Error){const{error:t}=e;t&&s!==t.message&&(s=t.message)}this.setState({data:e,errorMessage:s})}componentWillUnmount(){this.subs.unsubscribe(),this.props.angularComponent&&this.props.angularComponent?.destroy()}componentDidUpdate(e,s){const{plugin:t,height:o,width:i,panel:l}=this.props;e.plugin!==t&&this.loadAngularPanel(),(e.width!==i||e.height!==o)&&this.scopeProps&&(this.scopeProps.size.height=this.getInnerPanelHeight(),this.scopeProps.size.width=this.getInnerPanelWidth(),l.render())}getInnerPanelHeight(){const{plugin:e,height:s}=this.props,{theme:t}=w.ZP,o=this.hasOverlayHeader()?0:t.panelHeaderHeight,i=e.noPadding?0:t.panelPadding;return s-o-i*2-P.QO}getInnerPanelWidth(){const{plugin:e,width:s}=this.props,{theme:t}=w.ZP,o=e.noPadding?0:t.panelPadding;return s-o*2-P.QO}loadAngularPanel(){const{panel:e,dashboard:s,setPanelAngularComponent:t}=this.props;if(!this.element)return;const o=(0,x.w)(),i='<plugin-component type="panel" class="panel-height-helper"></plugin-component>';this.scopeProps={panel:e,dashboard:s,size:{width:this.getInnerPanelWidth(),height:this.getInnerPanelHeight()}},t({key:e.key,angularComponent:o.load(this.element,this.scopeProps,i)})}hasOverlayHeader(){const{panel:e}=this.props,{data:s}=this.state;return s.request&&s.request.timeInfo?!1:!e.hasTitle()}render(){const{dashboard:e,panel:s,isViewing:t,isEditing:o,plugin:i}=this.props,{errorMessage:l,data:d}=this.state,{transparent:u}=s,f=d.alertState?.state,z=U()({"panel-container":!0,"panel-container--absolute":D(O.E1.getLocation().pathname),"panel-container--transparent":u,"panel-container--no-title":this.hasOverlayHeader(),"panel-has-alert":s.alert!==void 0,[`panel-alert-state--${f}`]:f!==void 0}),L=U()({"panel-content":!0,"panel-content--no-padding":i.noPadding});return a.createElement("div",{className:z,"aria-label":g.wl.components.Panels.Panel.containerByTitle(s.title)},a.createElement(Ae,{panel:s,dashboard:e,title:s.title,description:s.description,links:s.links,error:l,isViewing:t,isEditing:o,data:d,alertState:f}),a.createElement("div",{className:L},a.createElement("div",{ref:Z=>this.element=Z,className:"panel-height-helper"})))}}const je=(r,e)=>({angularComponent:(0,h.i)(r,e.panel)?.angularComponent}),Ye={setPanelAngularComponent:M.o8},Xe=(0,y.connect)(je,Ye)(Ge);var qe=n(29431),Ee=n(55294),Ne=n(46519),_e=n(5916),et=n(41959),Pe=n(40400),tt=n(16911),nt=n(20231),at=n(69934),st=n(1821),Ue=n(93003),Fe=n(71235),me=n(86016),We=n(78758),ke=n(29494),rt=n(91162),ot=n(30002),Ve=n(85854),it=n(66926);const lt=(r,e,s)=>{const{overrides:t}=s,o=s.overrides.findIndex(f=>f.matcher.id===Ve.mi.byName&&f.matcher.options===r);if(o<0)return{...s,overrides:[...s.overrides,ct(r,e)]};const i=Array.from(t),l=i[o],d=l.properties.findIndex(f=>f.id==="color");if(d<0)return i[o]={...l,properties:[...l.properties,Ce(e)]},{...s,overrides:i};const u=Array.from(l.properties);return u[d]=Ce(e),i[o]={...l,properties:u},{...s,overrides:i}},ct=(r,e)=>({matcher:{id:Ve.mi.byName,options:r},properties:[Ce(e)]}),Ce=r=>({id:"color",value:{mode:it.S.Fixed,fixedColor:r}});var dt=n(45984),ye=n(70659),De=n(87865),ht=n(57277),Se=n(23309),pt=n(85320),He=n(63346),ut=n(26639);function mt({panelLinks:r,onShowPanelLinks:e}){const s=(0,W.wW)(gt),t=()=>{const o=e();return a.createElement(He.v,null,o?.map((i,l)=>a.createElement(He.v.Item,{key:l,label:i.title,url:i.href,target:i.target})))};if(r.length===1){const o=e()[0];return a.createElement(me.fm.TitleItem,{href:o.href,onClick:o.onClick,target:o.target,title:o.title},a.createElement(A.J,{name:"external-link-alt",size:"lg"}))}else return a.createElement(ut.L,{overlay:t},a.createElement(Le.h,{icon:"external-link-alt","aria-label":"panel links",className:s.menuTrigger}))}const gt=r=>({menuTrigger:(0,S.css)({border:"none",borderRadius:`${r.shape.borderRadius()}`,cursor:"context-menu"})});function ft(r){const{alertState:e,data:s,panelId:t,onShowPanelLinks:o,panelLinks:i}=r,l=(0,W.wW)(vt),d=a.createElement(J.u,{content:`alerting is ${e}`},a.createElement(me.fm.TitleItem,{className:(0,S.cx)({[l.ok]:e===Se.Z.OK,[l.pending]:e===Se.Z.Pending,[l.alerting]:e===Se.Z.Alerting})},a.createElement(A.J,{name:e==="alerting"?"heart-break":"heart",className:"panel-alert-icon"}))),u=a.createElement(a.Fragment,null,s.request&&s.request.timeInfo&&a.createElement(J.u,{content:a.createElement(pt.IF,{timeRange:s.request?.range,timeZone:s.request?.timezone})},a.createElement(me.fm.TitleItem,{className:l.timeshift},a.createElement(A.J,{name:"clock-nine"}),s.request?.timeInfo)));return a.createElement(a.Fragment,null,i&&i.length>0&&o&&a.createElement(mt,{onShowPanelLinks:o,panelLinks:i}),a.createElement(be,{panelId:t,frames:s.series}),u,e&&d)}const vt=r=>({ok:(0,S.css)({color:r.colors.success.text}),pending:(0,S.css)({color:r.colors.warning.text}),alerting:(0,S.css)({color:r.colors.error.text}),timeshift:(0,S.css)({color:r.colors.text.link,"&:hover":{color:r.colors.emphasize(r.colors.text.link,.03)}})});var Et=n(91551),xe=n(6911);const Pt="Error in plugin";class Ct extends a.PureComponent{constructor(e){super(e),this.timeSrv=(0,T.$t)(),this.subs=new N.w0,this.eventFilter={onlyLocal:!0},this.getSync=()=>this.props.isEditing?qe.m.Off:this.props.dashboard.graphTooltip,this.onInstanceStateChange=t=>{this.props.onInstanceStateChange(t),this.setState({context:{...this.state.context,instanceState:t}})},this.onSeriesColorChange=(t,o)=>{this.onFieldConfigChange(lt(t,o,this.props.panel.fieldConfig))},this.onSeriesVisibilityChange=(t,o)=>{this.onFieldConfigChange((0,Et.N)(t,o,this.props.panel.fieldConfig,this.state.data.series))},this.onToggleLegendSort=t=>{const o=this.props.panel.options.legend;if(!o)return;let i=o.sortDesc,l=o.sortBy;t!==l&&(i=void 0),i===!1?(l=void 0,i=void 0):(i=!i,l=t),this.onOptionsChange({...this.props.panel.options,legend:{...o,sortBy:l,sortDesc:i}})},this.onRefresh=()=>{const{dashboard:t,panel:o,isInView:i,width:l}=this.props;if(!i){this.setState({refreshWhenInView:!0});return}const d=(0,q.W1)(o,this.timeSrv.timeRange());if(this.wantsQueryExecution){if(l<0)return;this.state.refreshWhenInView&&this.setState({refreshWhenInView:!1}),o.runAllPanelQueries({dashboardId:t.id,dashboardUID:t.uid,dashboardTimezone:t.getTimezone(),publicDashboardAccessToken:t.meta.publicDashboardAccessToken,timeData:d,width:l})}else this.setState({data:{...this.state.data,timeRange:this.timeSrv.timeRange()},renderCounter:this.state.renderCounter+1,liveTime:void 0})},this.onRender=()=>{const t={renderCounter:this.state.renderCounter+1};this.setState(t)},this.onOptionsChange=t=>{this.props.panel.updateOptions(t)},this.onFieldConfigChange=t=>{this.props.panel.updateFieldConfig(t)},this.onPanelError=t=>{const o=t.message||Pt;this.state.errorMessage!==o&&this.setState({errorMessage:o})},this.onPanelErrorRecover=()=>{this.setState({errorMessage:void 0})},this.onAnnotationCreate=async t=>{const o=t.from!==t.to,i={dashboardUID:this.props.dashboard.uid,panelId:this.props.panel.id,isRegion:o,time:t.from,timeEnd:o?t.to:0,tags:t.tags,text:t.description};await(0,ye.xD)(i),(0,De.kt)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new Ee.n1(i))},this.onAnnotationDelete=async t=>{await(0,ye.Dl)({id:t}),(0,De.kt)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new Ee.n1({id:t}))},this.onAnnotationUpdate=async t=>{const o=t.from!==t.to,i={id:t.id,dashboardUID:this.props.dashboard.uid,panelId:this.props.panel.id,isRegion:o,time:t.from,timeEnd:o?t.to:0,tags:t.tags,text:t.description};await(0,ye._E)(i),(0,De.kt)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new Ee.n1(i))},this.onChangeTimeRange=t=>{this.timeSrv.setTime({from:(0,Ne.zh)(t.from),to:(0,Ne.zh)(t.to)})},this.onAddAdHocFilter=t=>{const{key:o,value:i,operator:l}=t,d=(0,rt.ak)().getInstanceSettings(this.props.panel.datasource),u=d&&(0,_e.iU)(d);u&&(0,Re.WI)((0,ot.m2)({datasource:u,key:o,operator:l,value:i}))},this.onShowPanelDescription=()=>{const{panel:t}=this.props,o=(0,at.J)().replace(t.description,t.scopedVars);return(0,et.a)(o)},this.onShowPanelLinks=()=>{const{panel:t}=this.props,o=(0,Q.H)(t);return o?o&&o.getLinks(t.replaceVariables):[]},this.onOpenInspector=(t,o)=>{t.stopPropagation(),O.E1.partial({inspect:this.props.panel.id,inspectTab:o})},this.onOpenErrorInspect=t=>{t.stopPropagation(),O.E1.partial({inspect:this.props.panel.id,inspectTab:se.q.Error})};const s=e.dashboard.events.newScopedBus(`panel:${e.panel.id}`,this.eventFilter);this.state={isFirstLoad:!0,renderCounter:0,refreshWhenInView:!1,context:{eventBus:s,app:this.getPanelContextApp(),sync:this.getSync,onSeriesColorChange:this.onSeriesColorChange,onToggleSeriesVisibility:this.onSeriesVisibilityChange,onAnnotationCreate:this.onAnnotationCreate,onAnnotationUpdate:this.onAnnotationUpdate,onAnnotationDelete:this.onAnnotationDelete,onInstanceStateChange:this.onInstanceStateChange,onToggleLegendSort:this.onToggleLegendSort,canAddAnnotations:e.dashboard.canAddAnnotations.bind(e.dashboard),canEditAnnotations:e.dashboard.canEditAnnotations.bind(e.dashboard),canDeleteAnnotations:e.dashboard.canDeleteAnnotations.bind(e.dashboard),onAddAdHocFilter:this.onAddAdHocFilter},data:this.getInitialPanelDataState()}}getPanelContextApp(){return this.props.isEditing?Pe.zj.PanelEditor:this.props.isViewing?Pe.zj.PanelViewer:Pe.zj.Dashboard}getInitialPanelDataState(){return{state:v.Gu.NotStarted,series:[],timeRange:(0,E.JK)()}}componentDidMount(){const{panel:e,dashboard:s}=this.props;if(this.subs.add(e.events.subscribe(st.U5,this.onRefresh)),this.subs.add(e.events.subscribe(dt._z,this.onRender)),s.panelInitialized(this.props.panel),this.hasPanelSnapshot){this.setState({data:(0,ht.y)(e,s),isFirstLoad:!1});return}this.wantsQueryExecution||this.setState({isFirstLoad:!1}),this.subs.add(e.getQueryRunner().getData({withTransforms:!0,withFieldConfig:!0}).subscribe({next:t=>this.onDataUpdate(t)})),xe.A.listen(this)}componentWillUnmount(){this.subs.unsubscribe(),xe.A.remove(this)}liveTimeChanged(e){const{data:s}=this.state;if(s.timeRange){const t=e.to.valueOf()-s.timeRange.to.valueOf();if(t<100){console.log("Skip tick render",this.props.panel.title,t);return}}this.setState({liveTime:e})}componentDidUpdate(e){const{isInView:s,width:t}=this.props,{context:o}=this.state,i=this.getPanelContextApp();o.app!==i&&this.setState({context:{...o,app:i}}),s!==e.isInView&&s&&this.state.refreshWhenInView&&this.onRefresh(),t!==e.width&&xe.A.updateInterval(this)}onDataUpdate(e){const{dashboard:s,panel:t,plugin:o}=this.props;if(o.meta.skipDataQuery){this.setState({data:this.getInitialPanelDataState()});return}let{isFirstLoad:i}=this.state,l;switch(e.state){case v.Gu.Loading:if(this.state.data.state===v.Gu.Loading)return;break;case v.Gu.Error:const{error:d}=e;d&&l!==d.message&&(l=d.message);break;case v.Gu.Done:s.snapshot&&(t.snapshotData=e.series.map(u=>(0,tt.og)(u))),i&&(i=!1);break}this.setState({isFirstLoad:i,errorMessage:l,data:e,liveTime:void 0})}get hasPanelSnapshot(){const{panel:e}=this.props;return e.snapshotData&&e.snapshotData.length}get wantsQueryExecution(){return!(this.props.plugin.meta.skipDataQuery||this.hasPanelSnapshot)}shouldSignalRenderingCompleted(e,s){return e===v.Gu.Done||s.skipDataQuery}skipFirstRender(e){const{isFirstLoad:s}=this.state;return this.wantsQueryExecution&&s&&(e===v.Gu.Loading||e===v.Gu.NotStarted)}renderPanelContent(e,s){const{panel:t,plugin:o,dashboard:i}=this.props,{renderCounter:l,data:d}=this.state,{state:u}=d;if(this.skipFirstRender(u))return null;this.shouldSignalRenderingCompleted(u,o.meta)&&ke.r.renderingCompleted();const f=o.panel,z=this.state.liveTime??d.timeRange??this.timeSrv.timeRange(),L=t.getOptions();return this.eventFilter.onlyLocal=i.graphTooltip===0,a.createElement(a.Fragment,null,a.createElement(Fe._w,{value:this.state.context},a.createElement(f,{id:t.id,data:d,title:t.title,timeRange:z,timeZone:this.props.dashboard.getTimezone(),options:L,fieldConfig:t.fieldConfig,transparent:t.transparent,width:e,height:s,renderCounter:l,replaceVariables:t.replaceVariables,onOptionsChange:this.onOptionsChange,onFieldConfigChange:this.onFieldConfigChange,onChangeTimeRange:this.onChangeTimeRange,eventBus:i.events})))}renderPanel(e,s){const{panel:t,plugin:o,dashboard:i}=this.props,{renderCounter:l,data:d}=this.state,{theme:u}=Ue.v,{state:f}=d;if(this.skipFirstRender(f))return null;this.shouldSignalRenderingCompleted(f,o.meta)&&ke.r.renderingCompleted();const z=o.panel,L=this.state.liveTime??d.timeRange??this.timeSrv.timeRange(),Z=this.hasOverlayHeader()?0:u.panelHeaderHeight,oe=o.noPadding?0:u.panelPadding,de=e-oe*2-P.QO,he=s-Z-oe*2-P.QO,pe=U()({"panel-content":!0,"panel-content--no-padding":o.noPadding}),B=t.getOptions();this.eventFilter.onlyLocal=i.graphTooltip===0;const ee=this.props.timezone||this.props.dashboard.getTimezone();return a.createElement(a.Fragment,null,a.createElement("div",{className:pe},a.createElement(nt.b,{meta:o.meta},a.createElement(Fe._w,{value:this.state.context},a.createElement(z,{id:t.id,data:d,title:t.title,timeRange:L,timeZone:ee,options:B,fieldConfig:t.fieldConfig,transparent:t.transparent,width:de,height:he,renderCounter:l,replaceVariables:t.replaceVariables,onOptionsChange:this.onOptionsChange,onFieldConfigChange:this.onFieldConfigChange,onChangeTimeRange:this.onChangeTimeRange,eventBus:i.events})))))}hasOverlayHeader(){const{panel:e}=this.props,{data:s}=this.state;return s.request&&s.request.timeInfo?!1:!e.hasTitle()}render(){const{dashboard:e,panel:s,isViewing:t,isEditing:o,width:i,height:l,plugin:d}=this.props,{errorMessage:u,data:f}=this.state,{transparent:z}=s,L=f.alertState?.state,Z=U()({"panel-container":!0,"panel-container--absolute":D(O.E1.getLocation().pathname),"panel-container--transparent":z,"panel-container--no-title":this.hasOverlayHeader(),[`panel-alert-state--${L}`]:L!==void 0}),oe=s.getDisplayTitle(),de=d.noPadding?"none":"md",he=t||o?"":"grid-drag-handle",pe=[a.createElement(ft,{key:"title-items",alertState:L,data:f,panelId:s.id,panelLinks:s.links,onShowPanelLinks:this.onShowPanelLinks})];let B;return e.meta.publicDashboardAccessToken||(B=a.createElement("div",{"data-testid":"panel-dropdown"},a.createElement(Te,{style:{top:0},panel:s,dashboard:e,loadingState:f.state,onClose:()=>{}}))),Ue.v.featureToggles.newPanelChromeUI?a.createElement(me.fm,{width:i,height:l,title:oe,loadingState:f.state,statusMessage:u,statusMessageOnClick:this.onOpenErrorInspect,description:s.description?this.onShowPanelDescription:void 0,titleItems:pe,menu:B,dragClass:he,dragClassCancel:"grid-drag-cancel",padding:de},(ee,X)=>a.createElement(a.Fragment,null,a.createElement(We.SV,{dependencies:[f,d,s.getOptions()],onError:this.onPanelError,onRecover:this.onPanelErrorRecover},({error:ge})=>ge?null:this.renderPanelContent(ee,X)))):a.createElement("section",{className:Z,"aria-label":g.wl.components.Panels.Panel.containerByTitle(s.title)},a.createElement(Ae,{panel:s,dashboard:e,title:s.title,description:s.description,links:s.links,error:u,isEditing:o,isViewing:t,alertState:L,data:f}),a.createElement(We.SV,{dependencies:[f,d,s.getOptions()],onError:this.onPanelError,onRecover:this.onPanelErrorRecover},({error:ee})=>ee?null:this.renderPanel(i,l)))}}const yt=(r,e)=>{const s=r.panels[e.stateKey];return s?{plugin:s.plugin,instanceState:s.instanceState}:{plugin:null}},Dt={initPanelState:$.JI,setPanelInstanceState:M.pC},St=(0,y.connect)(yt,Dt);class Be extends a.PureComponent{constructor(){super(...arguments),this.onInstanceStateChange=e=>{this.props.setPanelInstanceState({key:this.props.stateKey,value:e})},this.onVisibilityChange=e=>{this.props.panel.isInView=e},this.onPanelLoad=()=>{this.props.plugin||this.props.initPanelState(this.props.panel)},this.renderPanel=e=>{const{dashboard:s,panel:t,isViewing:o,isEditing:i,width:l,height:d,plugin:u,timezone:f}=this.props;return u?u&&u.angularPanelCtrl?a.createElement(Xe,{plugin:u,panel:t,dashboard:s,isViewing:o,isEditing:i,isInView:e,width:l,height:d}):a.createElement(Ct,{plugin:u,panel:t,dashboard:s,isViewing:o,isEditing:i,isInView:e,width:l,height:d,onInstanceStateChange:this.onInstanceStateChange,timezone:f}):null}}componentDidMount(){this.props.panel.isInView=!this.props.lazy,this.props.lazy||this.onPanelLoad()}render(){const{width:e,height:s,lazy:t}=this.props;return t?a.createElement(c,{width:e,height:s,onChange:this.onVisibilityChange,onLoad:this.onPanelLoad},this.renderPanel):this.renderPanel(!0)}}Be.defaultProps={lazy:!0};const xt=St(Be)},53821:(ne,k,n)=>{n.d(k,{Z:()=>v});var a=n(68404),y=n(41959),$=n(68183),M=n(69934),G=n(57388),j=n(48756),c=n(19349),b=n(39653),U=(E=>(E.Error="Error",E.Info="Info",E.Links="Links",E))(U||{});class N extends a.Component{constructor(){super(...arguments),this.timeSrv=(0,c.$t)(),this.getInfoMode=()=>{const{panel:g,error:x}=this.props;if(x)return"Error";if(g.description)return"Info";if(g.links&&g.links.length)return"Links"},this.getInfoContent=()=>{const{panel:g}=this.props,x=g.description||"",O=(0,M.J)().replace(x,g.scopedVars),w=(0,y.a)(O),P=this.props.links&&this.props.links.getLinks(g.replaceVariables);return a.createElement("div",{className:"panel-info-content markdown-html"},a.createElement("div",{dangerouslySetInnerHTML:{__html:w}}),P&&P.length>0&&a.createElement("ul",{className:"panel-info-corner-links"},P.map((h,D)=>a.createElement("li",{key:D},a.createElement("a",{className:"panel-info-corner-links__item",href:h.href,target:h.target},h.title)))))},this.onClickError=()=>{G.E1.partial({inspect:this.props.panel.id,inspectTab:b.q.Error})}}renderCornerType(g,x,O){const w=g==="Error"?"error":"info",P=`panel-info-corner panel-info-corner--${g.toLowerCase()}`,h=$.wl.components.Panels.Panel.headerCornerInfo(g.toLowerCase());return a.createElement(j.u,{content:x,placement:"top-start",theme:w,interactive:!0},a.createElement("button",{type:"button",className:P,onClick:O,"aria-label":h},a.createElement("i",{"aria-hidden":!0,className:"fa"}),a.createElement("span",{className:"panel-info-corner-inner"})))}render(){const{error:g}=this.props,x=this.getInfoMode();return x?x==="Error"&&g?this.renderCornerType(x,g,this.onClickError):x==="Info"||x==="Links"?this.renderCornerType(x,this.getInfoContent):null:null}}const v=N},91551:(ne,k,n)=>{n.d(k,{N:()=>N});var a=n(68061),y=n(74188),$=n(85854),M=n(14582),G=n(89890),j=n(3249),c=n(85675);const b="hideSeriesFrom",U=(0,a.Y4)(b);function N(P,h,D,F){const{overrides:T}=D,S=P,W=T.findIndex(U);if(W<0){if(h===c.R.ToggleSelection){const ae=v([S,...w(T,F)]);return{...D,overrides:[...D.overrides,ae]}}const _=O(F,S),J=v(_);return{...D,overrides:[...D.overrides,J]}}const K=Array.from(T),[A]=K.splice(W,1);if(h===c.R.ToggleSelection){let _=g(A);const J=w(K,F);if(J.length>0&&(_=_.filter(re=>J.indexOf(re)<0)),_[0]===S&&_.length===1)return{...D,overrides:K};const ae=v([S,...J]);return{...D,overrides:[...K,ae]}}const Q=E(A,S);return x(Q,F)?{...D,overrides:K}:{...D,overrides:[...K,Q]}}function v(P,h=y.Ys.exclude,D){return D=D??{id:"custom.hideFrom",value:{viz:!0,legend:!1,tooltip:!1}},{__systemRef:b,matcher:{id:$.mi.byNames,options:{mode:h,names:P,prefix:h===y.Ys.exclude?"All except:":void 0,readOnly:!0}},properties:[{...D,value:{viz:!0,legend:!1,tooltip:!1}}]}}const E=(P,h,D=y.Ys.exclude)=>{const F=P.properties.find(W=>W.id==="custom.hideFrom"),T=g(P),S=T.findIndex(W=>W===h);return S<0?T.push(h):T.splice(S,1),v(T,D,F)},g=P=>{const h=P.matcher.options?.names;return Array.isArray(h)?[...h]:[]},x=(P,h)=>g(P).length===O(h).length,O=(P,h)=>{const D=new Set;for(const F of P)for(const T of F.fields){if(T.type!==M.fS.number)continue;const S=(0,G.C)(T,F,P);S!==h&&D.add(S)}return Array.from(D)},w=(P,h)=>{let D=[];for(const F of P){const T=F.properties.find(S=>S.id==="custom.hideFrom");if(T!==void 0&&T.value?.legend===!0){const W=j.Ls.get(F.matcher.id).get(F.matcher.options);for(const K of h)for(const A of K.fields){if(A.type!==M.fS.number)continue;const Q=(0,G.C)(A,K,h);W(A,K,h)&&D.push(Q)}}}return D}},87464:(ne,k,n)=>{n.d(k,{ZQ:()=>re,mV:()=>ae,f1:()=>le,$M:()=>ve});var a=n(83383),y=n(46519),$=n(55294),M=n(57388),G=n(47214),j=n(93003),c=n(659),b=n(97063),U=n(60499),N=n(29930),v=n(58379),E=n(87449),g=n(9398),x=n(19349),O=n(30992),w=n(10079),P=n(92624),h=n(81168),D=n(87865),F=n(85803),T=n(87095),S=n(82302),W=n(66799),K=n(77274);function A(C){const R={dashboardId:C.id,dashboardName:C.title,dashboardUid:C.uid,folderName:C.meta.folderTitle,eventName:W.ct.DashboardView};(0,K.r_)(R)}var Q=n(58790);async function _(C,R,V){const H=v.Z.getObject(ie);if(H)return le(),H;try{switch(C.routeName){case h.DashboardRoutes.Home:{const p=await N.ae.get("/api/dashboards/home");if(p.redirectUri){const Y=a.u.stripBaseFromUrl(p.redirectUri);return M.E1.replace(Y),null}return p.meta.canSave=!1,p.meta.canShare=!1,p.meta.canStar=!1,p}case h.DashboardRoutes.Public:return await E.pD.loadDashboard("public",C.urlSlug,C.accessToken);case h.DashboardRoutes.Normal:{const p=await E.pD.loadDashboard(C.urlType,C.urlSlug,C.urlUid);if(C.fixUrl&&p.meta.url&&!w.r0.isPlaying){const Y=a.u.stripBaseFromUrl(p.meta.url),I=M.E1.getLocation().pathname;Y!==I&&(M.E1.replace({...M.E1.getLocation(),pathname:Y}),console.log("not correct url correcting",Y,I))}return p}case h.DashboardRoutes.New:return re(C.urlFolderUid,C.panelType);case h.DashboardRoutes.Path:{const p=C.urlSlug??"";return await E.pD.loadDashboard(h.DashboardRoutes.Path,p,p)}default:throw{message:"Unknown route "+C.routeName}}}catch(p){return(0,G.kW)(p)&&p.cancelled||(R((0,Q.jA)({message:"Failed to fetch dashboard",error:p})),console.error(p)),null}}const J=(C,R={})=>(C.forEach(V=>{V.panels?J(V.panels,R):V.targets&&V.targets.forEach(H=>{H.datasource?.type&&(R[H.datasource.type]?R[H.datasource.type].push(H):R[H.datasource.type]=[H])})}),R);function ae(C){return async(R,V)=>{R((0,Q.sf)());const H=await _(C,R,V);if(!H)return;R((0,Q.Nv)());let p;try{p=new S.f(H.dashboard,H.meta)}catch(te){R((0,Q.jA)({message:"Failed create dashboard model",error:te})),console.error(te);return}const Y=V(),I=M.E1.getSearchObject();I.orgId||M.E1.partial({orgId:Y.user.orgId},!0);const ce=(0,x.$t)();(0,g.h4)().setCurrent(p),ce.init(p);const q=(0,P.mn)(C.urlUid??p.uid);if(await R((0,F.LX)(q,p)),(0,D.Tl)({dashboard:p,timeSrv:ce}).run({dashboard:p,range:ce.timeRange()}),(0,T.cp)(V())===q&&V().dashboard.initPhase===h.DashboardInitPhase.Services){try{p.processRepeats(),I.autofitpanels&&p.autoFitPanels(window.innerHeight,I.kiosk),C.keybindingSrv.setupDashboardBindings(p)}catch(te){te instanceof Error&&R((0,c.$l)((0,U.t_)("Dashboard init failed",te))),console.error(te)}C.routeName!==h.DashboardRoutes.New?(A(p),O.H.watch(p.uid)):O.H.leave(),p.weekStart!==""?(0,y.Ls)(p.weekStart):(0,y.Ls)(j.v.bootData.user.weekStart),b.Z.publish(new $.Pl({dashboardId:p.uid,orgId:Y.user.orgId,userId:Y.user.user?.id,grafanaVersion:j.v.buildInfo.version,queries:J(p.panels)})),R((0,Q.dS)(p))}}}function re(C,R){const V={meta:{canStar:!1,canShare:!1,canDelete:!1,isNew:!0,folderUid:""},dashboard:{title:"New dashboard",panels:[{type:R??"add-panel",gridPos:{x:0,y:0,w:12,h:9},title:"Panel Title"}]}};return C&&(V.meta.folderUid=C),V}const ie="DASHBOARD_FROM_LS_KEY";function ve(C){v.Z.setObject(ie,C)}function le(){v.Z.delete(ie)}},57277:(ne,k,n)=>{n.d(k,{y:()=>N});var a=n(16911),y=n(69311),$=n(71398),M=n(49922),G=n(36998),j=n(47694),c=n(56422),b=n(19349),U=n(2476);function N(v,E){const g=(0,a.F9)(v.snapshotData),x=new c.g,O={dashboard:E,range:(0,y.JK)()},w=x.canWork(O)?x.getAnnotationsInSnapshot(E,v.id):[],P=[new $.i(w)];return{timeRange:(0,U.W1)(v,(0,b.$t)().timeRange()).timeRange,state:M.Gu.Done,series:(0,G.SM)({data:g,fieldConfig:{defaults:{},overrides:[]},replaceVariables:v.replaceVariables,fieldConfigRegistry:v.plugin.fieldConfigRegistry,theme:j.vc.theme2,timeZone:E.getTimezone()}),annotations:P}}},39653:(ne,k,n)=>{n.d(k,{q:()=>a});var a=(y=>(y.Data="data",y.Meta="meta",y.Error="error",y.Stats="stats",y.JSON="json",y.Query="query",y.Actions="actions",y.Help="help",y))(a||{})},69600:(ne,k,n)=>{n.d(k,{H:()=>j,n:()=>G});var a=n(16911),y=n(20112),$=n(94847),M=n(64703);const G=c=>{const b=c.field.links;if(!(!b||b.length===0))return{getLinks:U=>{const N={};if(c.view){const{dataFrame:E}=c.view;N.__series={value:{name:E.name,refId:E.refId},text:"Series"};const g=c.colIndex!==void 0?E.fields[c.colIndex]:void 0;if(g){if(N.__field={value:{name:g.name,labels:g.labels},text:"Field"},c.rowIndex!==void 0&&c.rowIndex>=0){const{timeField:x}=(0,a.sV)(E);N.__value={value:{raw:g.values.get(c.rowIndex),numeric:c.display.numeric,text:(0,y.zc)(c.display),time:x?x.values.get(c.rowIndex):void 0},text:"Value"}}c.view&&(N.__data={value:{name:E.name,refId:E.refId,fields:(0,$.z)({frame:E,rowIndex:c.rowIndex})},text:"Data"})}else N.__value={value:{raw:c.display.numeric,numeric:c.display.numeric,text:(0,y.zc)(c.display),calc:c.name},text:"Value"}}else console.log("VALUE",c);const v=(E,g,x)=>{const O={...N,...g};return U(E,O,x)};return b.map(E=>(0,M.Bq)().getDataLinkUIModel(E,v,c))}}},j=c=>{const b=c.links;if(!(!b||b.length===0))return{getLinks:()=>b.map(U=>(0,M.Bq)().getDataLinkUIModel(U,c.replaceVariables,c))}}},73952:(ne,k,n)=>{n.d(k,{i:()=>a});function a(y,$){return y.panels[$.key]}}}]);

//# sourceMappingURL=6173.2f0ba96f2f3595b2c836.js.map