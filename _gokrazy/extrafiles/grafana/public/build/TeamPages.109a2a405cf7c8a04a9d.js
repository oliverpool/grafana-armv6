"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8612],{"./public/app/core/components/SharedPreferences/SharedPreferences.tsx":(e,s,t)=>{t.d(s,{v:()=>f,Z:()=>j});var a,n,i,r,o=t("./.yarn/__virtual__/@lingui-react-virtual-edf7967b4d/3/opt/drone/yarncache/@lingui-react-npm-3.13.0-279ef69307-ca97bd3e80.zip/node_modules/@lingui/react/esm/index.js"),l=t("../../opt/drone/yarncache/@lingui-core-npm-3.13.0-aa863e2651-6108eb43fa.zip/node_modules/@lingui/core/esm/index.js"),d=t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),c=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),m=t("./packages/grafana-ui/src/index.ts"),u=t("./packages/grafana-e2e-selectors/src/index.ts"),h=t("./public/app/core/services/backend_srv.ts"),p=t("./public/app/core/services/PreferencesService.ts"),g=t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");function b(e,s,t){return s in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}const x=[{value:"",label:l.ag._({id:"shared-preferences.theme.default-label",message:"Default"})},{value:"dark",label:l.ag._({id:"shared-preferences.theme.dark-label",message:"Dark"})},{value:"light",label:l.ag._({id:"shared-preferences.theme.light-label",message:"Light"})}];class f extends d.PureComponent{constructor(e){super(e),b(this,"service",void 0),b(this,"onSubmitForm",(async()=>{const{homeDashboardId:e,theme:s,timezone:t,weekStart:a}=this.state;await this.service.update({homeDashboardId:e,theme:s,timezone:t,weekStart:a}),window.location.reload()})),b(this,"onThemeChanged",(e=>{this.setState({theme:e})})),b(this,"onTimeZoneChanged",(e=>{e&&this.setState({timezone:e})})),b(this,"onWeekStartChanged",(e=>{this.setState({weekStart:e})})),b(this,"onHomeDashboardChanged",(e=>{this.setState({homeDashboardId:e})})),b(this,"getFullDashName",(e=>void 0===e.folderTitle||""===e.folderTitle?e.title:e.folderTitle+" / "+e.title)),this.service=new p.y(e.resourceUri),this.state={homeDashboardId:0,theme:"",timezone:"",weekStart:"",dashboards:[]}}async componentDidMount(){const e=await this.service.load(),s=await h.ae.search({starred:!0});if(e.homeDashboardId>0&&!s.find((s=>s.id===e.homeDashboardId))){const t=await h.ae.search({dashboardIds:[e.homeDashboardId]});t&&t.length>0&&s.push(t[0])}this.setState({homeDashboardId:e.homeDashboardId,theme:e.theme,timezone:e.timezone,weekStart:e.weekStart,dashboards:[{id:0,title:"Default",tags:[],type:"",uid:"",uri:"",url:"",folderId:0,folderTitle:"",folderUid:"",folderUrl:"",isStarred:!1,slug:"",items:[]},...s]})}render(){const{theme:e,timezone:s,weekStart:t,homeDashboardId:d,dashboards:c}=this.state,{disabled:h}=this.props,p=v(),b=a||(a=(0,g.jsx)(m.Tooltip,{content:(0,g.jsx)(o.cC,{id:"shared-preferences.fields.home-dashboard-tooltip"}),children:(0,g.jsx)(m.Icon,{name:"info-circle"})}));return(0,g.jsx)(m.Form,{onSubmit:this.onSubmitForm,children:()=>{var a;return(0,g.jsxs)(m.FieldSet,{label:n||(n=(0,g.jsx)(o.cC,{id:"shared-preferences.title"})),disabled:h,children:[(0,g.jsx)(m.Field,{label:l.ag._({id:"shared-preferences.fields.theme-label",message:"UI Theme"}),children:(0,g.jsx)(m.RadioButtonGroup,{options:x,value:null===(a=x.find((s=>s.value===e)))||void 0===a?void 0:a.value,onChange:this.onThemeChanged})}),(0,g.jsx)(m.Field,{label:(0,g.jsxs)(m.Label,{htmlFor:"home-dashboard-select",children:[(0,g.jsx)("span",{className:p.labelText,children:i||(i=(0,g.jsx)(o.cC,{id:"shared-preferences.fields.home-dashboard-label"}))}),b]}),"data-testid":"User preferences home dashboard drop down",children:(0,g.jsx)(m.Select,{menuShouldPortal:!0,value:c.find((e=>e.id===d)),getOptionValue:e=>e.id,getOptionLabel:this.getFullDashName,onChange:e=>this.onHomeDashboardChanged(e.id),options:c,placeholder:l.ag._({id:"shared-preferences.fields.home-dashboard-placeholder",message:"Choose default dashboard"}),inputId:"home-dashboard-select"})}),(0,g.jsx)(m.Field,{label:l.ag._({id:"shared-dashboard.fields.timezone-label",message:"Timezone"}),"data-testid":u.wl.components.TimeZonePicker.containerV2,children:(0,g.jsx)(m.TimeZonePicker,{includeInternal:!0,value:s,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})}),(0,g.jsx)(m.Field,{label:l.ag._({id:"shared-preferences.fields.week-start-label",message:"Week start"}),"data-testid":u.wl.components.WeekStartPicker.containerV2,children:(0,g.jsx)(m.WeekStartPicker,{value:t,onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})}),(0,g.jsx)("div",{className:"gf-form-button-row",children:(0,g.jsx)(m.Button,{variant:"primary","data-testid":u.wl.components.UserProfile.preferencesSaveButton,children:r||(r=(0,g.jsx)(o.cC,{id:"common.save"}))})})]})}})}}const j=f,v=(0,m.stylesFactory)((()=>({labelText:c.css`
      margin-right: 6px;
    `})))},"./public/app/features/teams/TeamPages.tsx":(e,s,t)=>{t.r(s),t.d(s,{TeamPages:()=>Qe,default:()=>He});var a=t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),n=t("./.yarn/__virtual__/react-redux-virtual-7ad20a440e/3/opt/drone/yarncache/react-redux-npm-7.2.6-134f5ed64d-0bf142ce0d.zip/node_modules/react-redux/es/index.js"),i=t("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),r=t("./packages/grafana-ui/src/index.ts"),o=t("./public/app/core/config.ts"),l=t("./public/app/core/components/Page/Page.tsx"),d=t("./public/app/core/components/Animations/SlideDown.tsx"),c=t("./public/app/core/components/Select/UserPicker.tsx"),m=t("./public/app/core/components/TagFilter/TagBadge.tsx"),u=t("./public/app/features/teams/state/actions.ts"),h=t("./public/app/features/teams/state/selectors.ts"),p=t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const g=e=>{let{featureToggle:s,children:t}=e;return!0===s?(0,p.jsx)(p.Fragment,{children:t}):null};var b,x=t("./public/app/core/services/context_srv.ts"),f=t("./public/app/types/index.ts");const{Select:j}=r.LegacyForms,v={removeTeamMember:u.zT,updateTeamMember:u.zZ},y=(0,n.connect)(null,v);class I extends a.PureComponent{constructor(e){var s,t,a;super(e),a=(e,s)=>{const t=e.value,a=Object.assign({},s,{permission:t});this.props.updateTeamMember(a)},(t="onPermissionChange")in(s=this)?Object.defineProperty(s,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[t]=a,this.renderLabels=this.renderLabels.bind(this),this.renderPermissions=this.renderPermissions.bind(this)}onRemoveMember(e){this.props.removeTeamMember(e.userId)}renderPermissions(e){const{editorsCanAdmin:s,signedInUserIsTeamAdmin:t}=this.props,a=f.eL.find((s=>s.value===e.permission));return(0,p.jsx)(g,{featureToggle:s,children:(0,p.jsx)("td",{className:"width-5 team-permissions",children:(0,p.jsxs)("div",{className:"gf-form",children:[t&&(0,p.jsx)(j,{menuShouldPortal:!0,isSearchable:!1,options:f.eL,onChange:s=>this.onPermissionChange(s,e),className:"gf-form-select-box__control--menu-right",value:a}),!t&&(0,p.jsx)("span",{children:a.label})]})})})}renderLabels(e){return e?(0,p.jsx)("td",{children:e.map((e=>(0,p.jsx)(m.e,{label:e,removeIcon:!1,count:0,onClick:()=>{}},e)))}):b||(b=(0,p.jsx)("td",{}))}render(){const{member:e,syncEnabled:s,signedInUserIsTeamAdmin:t}=this.props;return(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{className:"width-4 text-center",children:(0,p.jsx)("img",{"aria-label":`Avatar for team member "${e.name}"`,className:"filter-table__avatar",src:e.avatarUrl})}),(0,p.jsx)("td",{children:e.login}),(0,p.jsx)("td",{children:e.email}),(0,p.jsx)("td",{children:e.name}),this.renderPermissions(e),s&&this.renderLabels(e.labels),(0,p.jsx)("td",{className:"text-right",children:(0,p.jsx)(r.DeleteButton,{"aria-label":"Remove team member",size:"sm",disabled:!t,onConfirm:()=>this.onRemoveMember(e)})})]},e.userId)}}const T=y(I);var S,w,C,P,k,A,N,$,L=t("./public/app/features/teams/state/reducers.ts"),_=t("./public/app/core/components/CloseButton/CloseButton.tsx");function M(e,s,t){return s in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}const U={addTeamMember:u.Lt,setSearchMemberQuery:L.UD},R=(0,n.connect)((function(e){return{searchMemberQuery:(0,h.xc)(e.team),editorsCanAdmin:o.vc.editorsCanAdmin,signedInUser:x.Vt.user}}),U);class B extends a.PureComponent{constructor(e){super(e),M(this,"onSearchQueryChange",(e=>{this.props.setSearchMemberQuery(e)})),M(this,"onToggleAdding",(()=>{this.setState({isAdding:!this.state.isAdding})})),M(this,"onUserSelected",(e=>{this.setState({newTeamMember:e})})),M(this,"onAddUserToTeam",(async()=>{this.props.addTeamMember(this.state.newTeamMember.id),this.setState({newTeamMember:null})})),this.state={isAdding:!1,newTeamMember:null}}renderLabels(e){return e?(0,p.jsx)("td",{children:e.map((e=>(0,p.jsx)(m.e,{label:e,removeIcon:!1,count:0,onClick:()=>{}},e)))}):S||(S=(0,p.jsx)("td",{}))}render(){const{isAdding:e}=this.state,{searchMemberQuery:s,members:t,syncEnabled:a,editorsCanAdmin:n,signedInUser:i}=this.props,o=(0,h.vt)({members:t,editorsCanAdmin:n,signedInUser:i});return(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"page-action-bar",children:[(0,p.jsx)("div",{className:"gf-form gf-form--grow",children:(0,p.jsx)(r.FilterInput,{placeholder:"Search members",value:s,onChange:this.onSearchQueryChange})}),(0,p.jsx)(r.Button,{className:"pull-right",onClick:this.onToggleAdding,disabled:e||!o,children:"Add member"})]}),(0,p.jsx)(d.s,{in:e,children:(0,p.jsxs)("div",{className:"cta-form",children:[(0,p.jsx)(_.P,{"aria-label":"Close 'Add team member' dialogue",onClick:this.onToggleAdding}),w||(w=(0,p.jsx)(r.Label,{htmlFor:"user-picker",children:"Add team member"})),(0,p.jsxs)("div",{className:"gf-form-inline",children:[(0,p.jsx)(c.f,{inputId:"user-picker",onSelected:this.onUserSelected,className:"min-width-30"}),this.state.newTeamMember&&(0,p.jsx)(r.Button,{type:"submit",onClick:this.onAddUserToTeam,children:"Add to team"})]})]})}),(0,p.jsx)("div",{className:"admin-list-table",children:(0,p.jsxs)("table",{className:"filter-table filter-table--hover form-inline",children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{children:[C||(C=(0,p.jsx)("th",{})),P||(P=(0,p.jsx)("th",{children:"Login"})),k||(k=(0,p.jsx)("th",{children:"Email"})),A||(A=(0,p.jsx)("th",{children:"Name"})),(0,p.jsx)(g,{featureToggle:n,children:N||(N=(0,p.jsx)("th",{children:"Permission"}))}),a&&($||($=(0,p.jsx)("th",{}))),(0,p.jsx)("th",{style:{width:"1%"}})]})}),(0,p.jsx)("tbody",{children:t&&t.map((e=>(0,p.jsx)(T,{member:e,syncEnabled:a,editorsCanAdmin:n,signedInUserIsTeamAdmin:o},e.userId)))})]})})]})}}const G=R(B);var z=t("./public/app/core/services/backend_srv.ts"),D=t("./public/app/core/components/Select/TeamPicker.tsx"),F=t("./public/app/types/acl.ts");let E;var V,O;!function(e){e.Team="Team",e.User="User",e.BuiltInRole="builtInRole"}(E||(E={}));const W=e=>{let{title:s="Add Permission For",permissions:t,assignments:n,canListUsers:i,onAdd:o,onCancel:l}=e;const[d,m]=(0,a.useState)(E.User),[u,h]=(0,a.useState)(0),[g,b]=(0,a.useState)(0),[x,f]=(0,a.useState)(""),[j,v]=(0,a.useState)(""),y=(0,a.useMemo)((()=>{const e=[];return n.users&&i&&e.push({value:E.User,label:"User",isDisabled:!1}),n.teams&&e.push({value:E.Team,label:"Team"}),n.builtInRoles&&e.push({value:E.BuiltInRole,label:"Role"}),e}),[n,i]);(0,a.useEffect)((()=>{t.length>0&&v(t[0])}),[t]);return(0,p.jsxs)("div",{className:"cta-form","aria-label":"Permissions slider",children:[(0,p.jsx)(_.P,{onClick:l}),(0,p.jsx)("h5",{children:s}),d===E.User&&!i&&(V||(V=(0,p.jsx)(r.Alert,{severity:"info",title:"Missing permission",children:"You are missing the permission to list users (org.users:read). Please contact your administrator to get this resolved."}))),(0,p.jsx)(r.Form,{name:"addPermission",maxWidth:"none",onSubmit:()=>o({userId:g,teamId:u,builtInRole:x,permission:j,target:d}),children:()=>(0,p.jsxs)(r.HorizontalGroup,{children:[(0,p.jsx)(r.Select,{"aria-label":"Role to add new permission to",value:d,options:y,onChange:e=>m(e.value),disabled:0===y.length,menuShouldPortal:!0}),d===E.User&&i&&(0,p.jsx)(c.f,{onSelected:e=>b(e.value||0),className:"width-20"}),d===E.User&&!i&&(O||(O=(0,p.jsx)(r.Input,{disabled:!0,className:"width-20"}))),d===E.Team&&(0,p.jsx)(D.c,{onSelected:e=>{var s;return h((null===(s=e.value)||void 0===s?void 0:s.id)||0)},className:"width-20"}),d===E.BuiltInRole&&(0,p.jsx)(r.Select,{"aria-label":"Built-in role picker",menuShouldPortal:!0,options:Object.values(F.B5).map((e=>({value:e,label:e}))),onChange:e=>f(e.value||""),width:40}),(0,p.jsx)(r.Select,{"aria-label":"Permission Level",width:25,menuShouldPortal:!0,value:t.find((e=>e===j)),options:t.map((e=>({label:e,value:e}))),onChange:e=>v(e.value||"")}),(0,p.jsx)(r.Button,{type:"submit",disabled:!(d===E.Team&&u>0||d===E.User&&g>0||E.BuiltInRole&&F.B5.hasOwnProperty(x)),children:"Save"})]})})]})};var Z,Q,H,Y;const q=e=>{let{item:s,permissionLevels:t,canSet:a,onRemove:n,onChange:i}=e;return(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{style:{width:"1%"},children:J(s)}),(0,p.jsx)("td",{style:{width:"90%"},children:K(s)}),(0,p.jsx)("td",{children:(0,p.jsx)("div",{className:"gf-form",children:(0,p.jsx)(r.Select,{className:"width-20",menuShouldPortal:!0,disabled:!a||!s.isManaged,onChange:e=>i(s,e.value),value:t.find((e=>e===s.permission)),options:t.map((e=>({value:e,label:e})))})})}),(0,p.jsx)("td",{children:(0,p.jsx)(r.Tooltip,{content:ee(s),children:Z||(Z=(0,p.jsx)(r.Icon,{name:"info-circle"}))})}),(0,p.jsx)("td",{children:s.isManaged?(0,p.jsx)(r.Button,{size:"sm",icon:"times",variant:"destructive",disabled:!a,onClick:()=>n(s),"aria-label":`Remove permission for ${X(s)}`}):Q||(Q=(0,p.jsx)(r.Tooltip,{content:"Provisioned permission",children:(0,p.jsx)(r.Button,{size:"sm",icon:"lock"})}))})]})},J=e=>e.teamId?(0,p.jsx)("img",{className:"filter-table__avatar",src:e.teamAvatarUrl,alt:`Avatar for team ${e.teamId}`}):e.userId?(0,p.jsx)("img",{className:"filter-table__avatar",src:e.userAvatarUrl,alt:`Avatar for user ${e.userId}`}):H||(H=(0,p.jsx)(r.Icon,{size:"xl",name:"shield"})),X=e=>e.userId?e.userLogin:e.teamId?e.team:e.builtInRole,K=e=>e.userId?(0,p.jsxs)("span",{children:[e.userLogin," "]},"name"):e.teamId?(0,p.jsxs)("span",{children:[e.team," "]},"name"):e.builtInRole?(0,p.jsxs)("span",{children:[e.builtInRole," "]},"name"):Y||(Y=(0,p.jsx)("span",{},"name")),ee=e=>`Actions: ${[...new Set(e.actions)].sort().join(" ")}`;var se;const te=e=>{let{title:s,items:t,permissionLevels:a,canSet:n,onRemove:i,onChange:r}=e;return 0===t.length?null:(0,p.jsx)("div",{children:(0,p.jsxs)("table",{className:"filter-table gf-form-group",children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{style:{width:"1%"}}),(0,p.jsx)("th",{children:s}),se||(se=(0,p.jsx)("th",{children:"Permission"})),(0,p.jsx)("th",{style:{width:"1%"}}),(0,p.jsx)("th",{style:{width:"1%"}})]})}),(0,p.jsx)("tbody",{children:t.map(((e,s)=>(0,p.jsx)(q,{item:e,onRemove:i,onChange:r,canSet:n,permissionLevels:a},`${s}-${e.userId}`)))})]})})};var ae;const ne={permissions:[],assignments:{teams:!1,users:!1,builtInRoles:!1}},ie=e=>{let{title:s="Permissions",buttonLabel:t="Add a permission",resource:n,resourceId:o,canListUsers:l,canSetPermissions:c,addPermissionTitle:m}=e;const[u,h]=(0,a.useState)(!1),[g,b]=(0,a.useState)([]),[x,f]=(0,a.useState)(ne),j=(0,a.useCallback)((()=>oe(n,o).then((e=>b(e)))),[n,o]);(0,a.useEffect)((()=>{re(n).then((e=>(f(e),j())))}),[n,o,j]);const v=e=>{let s=null;e.target===E.User?s=le(n,o,e.userId,e.permission):e.target===E.Team?s=de(n,o,e.teamId,e.permission):e.target===E.BuiltInRole&&(s=ce(n,o,e.builtInRole,e.permission)),null!==s&&s.then(j)},y=e=>{let s=null;e.userId?s=le(n,o,e.userId,""):e.teamId?s=de(n,o,e.teamId,""):e.builtInRole&&(s=ce(n,o,e.builtInRole,"")),null!==s&&s.then(j)},I=(e,s)=>{e.permission!==s&&(e.userId?v({permission:s,userId:e.userId,target:E.User}):e.teamId?v({permission:s,teamId:e.teamId,target:E.Team}):e.builtInRole&&v({permission:s,builtInRole:e.builtInRole,target:E.BuiltInRole}))},T=(0,a.useMemo)((()=>(0,i.sortBy)(g.filter((e=>e.teamId)),["team"])),[g]),S=(0,a.useMemo)((()=>(0,i.sortBy)(g.filter((e=>e.userId)),["userLogin"])),[g]),w=(0,a.useMemo)((()=>(0,i.sortBy)(g.filter((e=>e.builtInRole)),["builtInRole"])),[g]);return(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"page-action-bar",children:[(0,p.jsx)("h3",{className:"page-sub-heading",children:s}),ae||(ae=(0,p.jsx)("div",{className:"page-action-bar__spacer"})),c&&(0,p.jsx)(r.Button,{variant:"primary",onClick:()=>h(!0),children:t},"add-permission")]}),(0,p.jsxs)("div",{children:[(0,p.jsx)(d.s,{in:u,children:(0,p.jsx)(W,{title:m,onAdd:v,permissions:x.permissions,assignments:x.assignments,canListUsers:l,onCancel:()=>h(!1)})}),(0,p.jsx)(te,{title:"Role",items:w,permissionLevels:x.permissions,onChange:I,onRemove:y,canSet:c}),(0,p.jsx)(te,{title:"User",items:S,permissionLevels:x.permissions,onChange:I,onRemove:y,canSet:c}),(0,p.jsx)(te,{title:"Team",items:T,permissionLevels:x.permissions,onChange:I,onRemove:y,canSet:c})]})]})},re=async e=>{try{return await(0,z.i)().get(`/api/access-control/${e}/description`)}catch(e){return console.error("failed to load resource description: ",e),ne}},oe=(e,s)=>(0,z.i)().get(`/api/access-control/${e}/${s}`),le=(e,s,t,a)=>me(e,s,"users",t,a),de=(e,s,t,a)=>me(e,s,"teams",t,a),ce=(e,s,t,a)=>me(e,s,"builtInRoles",t,a),me=(e,s,t,a,n)=>(0,z.i)().post(`/api/access-control/${e}/${s}/${t}/${a}`,{permission:n}),ue=e=>{const s=x.Vt.hasPermission(f.bW.OrgUsersRead),t=x.Vt.hasPermissionInMetadata(f.bW.ActionTeamsPermissionsWrite,e.team);return(0,p.jsx)(ie,{title:"Members",addPermissionTitle:"Add member",buttonLabel:"Add member",resource:"teams",resourceId:e.team.id,canListUsers:s,canSetPermissions:t})};var he=t("./public/app/core/components/SharedPreferences/SharedPreferences.tsx"),pe=t("./public/app/core/core.ts");const ge={updateTeam:u.fs},be=(0,n.connect)(null,ge)((e=>{let{team:s,updateTeam:t}=e;const a=pe.Vt.hasPermissionInMetadata(f.bW.ActionTeamsWrite,s);return(0,p.jsxs)(r.VerticalGroup,{children:[(0,p.jsx)(r.FieldSet,{label:"Team settings",children:(0,p.jsx)(r.Form,{defaultValues:Object.assign({},s),onSubmit:e=>{t(e.name,e.email)},disabled:!a,children:e=>{let{register:s}=e;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(r.Field,{label:"Name",disabled:!a,children:(0,p.jsx)(r.Input,Object.assign({},s("name",{required:!0}),{id:"name-input"}))}),(0,p.jsx)(r.Field,{label:"Email",description:"This is optional and is primarily used to set the team profile avatar (via gravatar service).",disabled:!a,children:(0,p.jsx)(r.Input,Object.assign({},s("email"),{placeholder:"team@email.com",type:"email",id:"email-input"}))}),(0,p.jsx)(r.Button,{type:"submit",disabled:!a,children:"Update"})]})}})}),(0,p.jsx)(he.v,{resourceUri:`teams/${s.id}`,disabled:!a})]})}));var xe,fe,je,ve,ye,Ie,Te,Se=t("./public/app/core/components/EmptyListCTA/EmptyListCTA.tsx");function we(e,s,t){return s in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}const{Input:Ce}=r.LegacyForms;function Pe(e){return{groups:(0,h.JB)(e.team)}}const ke={loadTeamGroups:u.j_,addTeamGroup:u.A_,removeTeamGroup:u.P5},Ae=((0,n.connect)(Pe,ke),"Sync LDAP or OAuth groups with your Grafana teams.");class Ne extends a.PureComponent{constructor(e){super(e),we(this,"onToggleAdding",(()=>{this.setState({isAdding:!this.state.isAdding})})),we(this,"onNewGroupIdChanged",(e=>{this.setState({newGroupId:e.target.value})})),we(this,"onAddGroup",(e=>{e.preventDefault(),this.props.addTeamGroup(this.state.newGroupId),this.setState({isAdding:!1,newGroupId:""})})),we(this,"onRemoveGroup",(e=>{this.props.removeTeamGroup(e.groupId)})),this.state={isAdding:!1,newGroupId:""}}componentDidMount(){this.fetchTeamGroups()}async fetchTeamGroups(){await this.props.loadTeamGroups()}isNewGroupValid(){return this.state.newGroupId.length>1}renderGroup(e){const{isReadOnly:s}=this.props;return(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{children:e.groupId}),(0,p.jsx)("td",{style:{width:"1%"},children:(0,p.jsx)(r.Button,{size:"sm",variant:"destructive",onClick:()=>this.onRemoveGroup(e),disabled:s,children:xe||(xe=(0,p.jsx)(r.Icon,{name:"times"}))})})]},e.groupId)}render(){const{isAdding:e,newGroupId:s}=this.state,{groups:t,isReadOnly:a}=this.props;return(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"page-action-bar",children:[fe||(fe=(0,p.jsx)("h3",{className:"page-sub-heading",children:"External group sync"})),je||(je=(0,p.jsx)(r.Tooltip,{placement:"auto",content:Ae,children:(0,p.jsx)(r.Icon,{className:"icon--has-hover page-sub-heading-icon",name:"question-circle"})})),ve||(ve=(0,p.jsx)("div",{className:"page-action-bar__spacer"})),t.length>0&&(0,p.jsxs)(r.Button,{className:"pull-right",onClick:this.onToggleAdding,disabled:a,children:[ye||(ye=(0,p.jsx)(r.Icon,{name:"plus"}))," Add group"]})]}),(0,p.jsx)(d.s,{in:e,children:(0,p.jsxs)("div",{className:"cta-form",children:[(0,p.jsx)(_.P,{onClick:this.onToggleAdding}),Ie||(Ie=(0,p.jsx)("h5",{children:"Add External Group"})),(0,p.jsxs)("form",{className:"gf-form-inline",onSubmit:this.onAddGroup,children:[(0,p.jsx)("div",{className:"gf-form",children:(0,p.jsx)(Ce,{type:"text",className:"gf-form-input width-30",value:s,onChange:this.onNewGroupIdChanged,placeholder:"cn=ops,ou=groups,dc=grafana,dc=org",disabled:a})}),(0,p.jsx)("div",{className:"gf-form",children:(0,p.jsx)(r.Button,{type:"submit",disabled:a||!this.isNewGroupValid(),children:"Add group"})})]})]})}),0===t.length&&!e&&(0,p.jsx)(Se.Z,{onClick:this.onToggleAdding,buttonIcon:"users-alt",title:"There are no external groups to sync with",buttonTitle:"Add Group",proTip:Ae,proTipLinkTitle:"Learn more",proTipLink:"http://docs.grafana.org/auth/enhanced_ldap/",proTipTarget:"_blank",buttonDisabled:a}),t.length>0&&(0,p.jsx)("div",{className:"admin-list-table",children:(0,p.jsxs)("table",{className:"filter-table filter-table--hover form-inline",children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{children:[Te||(Te=(0,p.jsx)("th",{children:"External Group ID"})),(0,p.jsx)("th",{style:{width:"1%"}})]})}),(0,p.jsx)("tbody",{children:t.map((e=>this.renderGroup(e)))})]})})]})}}const $e=(0,n.connect)(Pe,ke)(Ne);var Le=t("./public/app/features/teams/state/navModel.ts"),_e=t("./public/app/core/selectors/navModel.ts"),Me=t("./packages/grafana-runtime/src/index.ts"),Ue=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js");const Re=["featureName","className","children","size"];const Be=e=>{let{featureName:s,className:t,size:a="md"}=e,n=function(e,s){if(null==e)return{};var t,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],s.indexOf(t)>=0||(n[t]=e[t]);return n}(e,Re);const i=(0,r.useStyles2)((e=>Ge(e,a)));return(0,p.jsxs)("div",Object.assign({className:(0,Ue.cx)(i.box,t)},n,{children:[(0,p.jsx)(r.Icon,{name:"rocket",className:i.icon}),(0,p.jsxs)("div",{className:i.inner,children:[(0,p.jsxs)("p",{className:i.text,children:["You’ve discovered a Pro feature! Get the Grafana Pro plan to access ",s,"."]}),(0,p.jsx)(r.LinkButton,{variant:"secondary",size:a,className:i.button,href:"https://grafana.com/profile/org/subscription",target:"__blank",rel:"noopener noreferrer",children:"Upgrade"})]})]}))},Ge=(e,s)=>{const t=e.shape.borderRadius(2),a="md"===s?"body":"bodySmall";return{box:Ue.css`
      display: flex;
      align-items: center;
      position: relative;
      border-radius: ${t};
      background: ${e.colors.success.transparent};
      padding: ${e.spacing(2)};
      color: ${e.colors.success.text};
      font-size: ${e.typography[a].fontSize};
      text-align: left;
      line-height: 16px;
      margin: ${e.spacing(0,"auto",3,"auto")};
      max-width: ${e.breakpoints.values.xxl}px;
      width: 100%;
    `,inner:Ue.css`
      display: flex;
      align-items: center;
      width: 100%;
      justify-content: space-between;
    `,text:Ue.css`
      margin: 0;
    `,button:Ue.css`
      background-color: ${e.colors.success.main};
      font-weight: ${e.typography.fontWeightLight};
      color: white;

      &:hover {
        background-color: ${e.colors.success.main};
      }

      &:focus-visible {
        box-shadow: none;
        color: ${e.colors.text.primary};
        outline: 2px solid ${e.colors.primary.main};
      }
    `,icon:Ue.css`
      margin: ${e.spacing(.5,1,.5,.5)};
    `}},ze=e=>{let{listItems:s,image:t,featureUrl:a,featureName:n,description:i,caption:o}=e;const l=(0,r.useStyles2)(De);return(0,p.jsxs)("div",{className:l.container,children:[(0,p.jsxs)("div",{className:l.content,children:[(0,p.jsxs)("h3",{className:l.title,children:["Get started with ",n]}),i&&(0,p.jsx)("h6",{className:l.description,children:i}),(0,p.jsx)("ul",{className:l.list,children:s.map(((e,s)=>(0,p.jsxs)("li",{children:[(0,p.jsx)(r.Icon,{name:"check",size:"xl",className:l.icon})," ",e]},s)))}),a&&(0,p.jsx)(r.LinkButton,{fill:"text",href:a,className:l.link,target:"_blank",rel:"noreferrer noopener",children:"Learn more"})]}),(0,p.jsxs)("div",{className:l.media,children:[(0,p.jsx)("img",{src:Fe(t),alt:"Feature screenshot"}),o&&(0,p.jsx)("p",{className:l.caption,children:o})]})]})},De=e=>({container:Ue.css`
      display: flex;
      justify-content: space-between;
    `,content:Ue.css`
      width: 45%;
      margin-right: ${e.spacing(4)};
    `,media:Ue.css`
      width: 55%;

      img {
        width: 100%;
      }
    `,description:Ue.css`
      color: ${e.colors.text.primary};
      font-weight: ${e.typography.fontWeightLight};
    `,list:Ue.css`
      list-style: none;
      margin: ${e.spacing(4,0,2,0)};

      li {
        display: flex;
        align-items: flex-start;
        color: ${e.colors.text.primary};
        padding: ${e.spacing(1,0)};
      }
    `,icon:Ue.css`
      color: ${e.colors.success.main};
      margin-right: ${e.spacing(1)};
    `,link:Ue.css`
      margin-left: ${e.spacing(2)};
    `,title:Ue.css`
      color: ${e.colors.text.maxContrast};
    `,caption:Ue.css`
      font-weight: ${e.typography.fontWeightLight};
      margin: ${e.spacing(1,0,0)};
    `}),Fe=e=>e.startsWith("http")?e:"/public/img/enterprise/highlights/"+e;var Ee,Ve;function Oe(e,s,t){return s in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}!function(e){e.Members="members",e.Settings="settings",e.GroupSync="groupsync"}(Ve||(Ve={}));const We={loadTeam:u.QX,loadTeamMembers:u.ei},Ze=(0,n.connect)((function(e,s){var t;const a=parseInt(s.match.params.id,10),n=(0,h.VP)(e.team,a);let i="members";x.Vt.accessControlEnabled()&&(n&&x.Vt.hasPermissionInMetadata(f.bW.ActionTeamsPermissionsRead,n)||(i="settings"));const r=null!==(t=s.match.params.page)&&void 0!==t?t:i,l=(0,Le.o)(r);return{navModel:(0,_e.h)(e.navIndex,`team-${r}-${a}`,l),teamId:a,pageName:r,team:n,members:(0,h.YY)(e.team),editorsCanAdmin:o.ZP.editorsCanAdmin,signedInUser:x.Vt.user}}),We);class Qe extends a.PureComponent{constructor(e){super(e),Oe(this,"textsAreEqual",((e,s)=>!e&&!s||!(!e||!s)&&e.toLocaleLowerCase()===s.toLocaleLowerCase())),Oe(this,"hideTabsFromNonTeamAdmin",((e,s)=>(x.Vt.accessControlEnabled()||!s&&e.main&&e.main.children&&e.main.children.filter((e=>!this.textsAreEqual(e.text,Ve.Members))).map((e=>{e.hideFromTabs=!0})),e))),this.state={isLoading:!1,isSyncEnabled:(0,Me.featureEnabled)("teamsync")}}async componentDidMount(){await this.fetchTeam();const{isSyncEnabled:e}=this.state;this.getCurrentPage()===Ve.GroupSync&&!e&&o.ZP.featureToggles.featureHighlights&&(0,Me.reportExperimentView)("feature-highlights-team-sync","test","")}async fetchTeam(){const{loadTeam:e,teamId:s}=this.props;this.setState({isLoading:!0});const t=await e(s);return x.Vt.accessControlEnabled()||await this.props.loadTeamMembers(),this.setState({isLoading:!1}),t}getCurrentPage(){const e=["members","settings","groupsync"],s=this.props.pageName;return(0,i.includes)(e,s)?s:e[0]}renderPage(e){const{isSyncEnabled:s}=this.state,{members:t,team:a,theme:n}=this.props,i=this.getCurrentPage(),r=x.Vt.hasAccessInMetadata(f.bW.ActionTeamsRead,a,e),l=x.Vt.hasAccessInMetadata(f.bW.ActionTeamsPermissionsRead,a,e),d=x.Vt.hasAccessInMetadata(f.bW.ActionTeamsPermissionsWrite,a,e);switch(i){case Ve.Members:return x.Vt.accessControlEnabled()?(0,p.jsx)(ue,{team:a}):(0,p.jsx)(G,{syncEnabled:s,members:t});case Ve.Settings:return r&&(0,p.jsx)(be,{team:a});case Ve.GroupSync:if(s){if(l)return(0,p.jsx)($e,{isReadOnly:!d})}else if(o.ZP.featureToggles.featureHighlights)return(0,p.jsxs)(p.Fragment,{children:[Ee||(Ee=(0,p.jsx)(Be,{featureName:"team sync"})),(0,p.jsx)(ze,{listItems:["Stop managing user access in two places - assign users to groups in SAML, LDAP or Oauth, and manage access at a Team level in Grafana","Update users’ permissions immediately when you add or remove them from an LDAP group, with no need for them to sign out and back in"],image:`team-sync-${n.isLight?"light":"dark"}.png`,featureName:"team sync",featureUrl:"https://grafana.com/docs/grafana/latest/enterprise/team-sync",description:"Team Sync makes it easier for you to manage users’ access in Grafana, by immediately updating each user’s Grafana teams and permissions based on their single sign-on group membership, instead of when users sign in."})]})}return null}render(){const{team:e,navModel:s,members:t,editorsCanAdmin:a,signedInUser:n}=this.props,i=(0,h.vt)({members:t,editorsCanAdmin:a,signedInUser:n});return(0,p.jsx)(l.Z,{navModel:this.hideTabsFromNonTeamAdmin(s,i),children:(0,p.jsx)(l.Z.Contents,{isLoading:this.state.isLoading,children:e&&0!==Object.keys(e).length&&this.renderPage(i)})})}}const He=Ze((0,r.withTheme2)(Qe))},"./public/app/features/teams/state/actions.ts":(e,s,t)=>{t.d(s,{jI:()=>c,QX:()=>m,ei:()=>u,Lt:()=>h,zT:()=>p,fs:()=>g,j_:()=>b,A_:()=>x,P5:()=>f,fC:()=>j,zZ:()=>v});var a=t("./packages/grafana-runtime/src/index.ts"),n=t("./public/app/types/index.ts"),i=t("./public/app/core/actions/index.ts"),r=t("./public/app/features/teams/state/navModel.ts"),o=t("./public/app/features/teams/state/reducers.ts"),l=t("./public/app/core/utils/accessControl.ts"),d=t("./public/app/core/core.ts");function c(){return async e=>{if(!d.Vt.hasPermission(n.bW.ActionTeamsRead))return void e((0,o.PL)([]));const s=await(0,a.getBackendSrv)().get("/api/teams/search",(0,l.y)({perpage:1e3,page:1}));e((0,o.PL)(s.teams))}}function m(e){return async s=>{const t=await(0,a.getBackendSrv)().get(`/api/teams/${e}`,(0,l.y)());s((0,o.y$)(t)),s((0,i.RL)((0,r.B)(t)))}}function u(){return async(e,s)=>{const t=s().team.team,n=await(0,a.getBackendSrv)().get(`/api/teams/${t.id}/members`);e((0,o.n2)(n))}}function h(e){return async(s,t)=>{const n=t().team.team;await(0,a.getBackendSrv)().post(`/api/teams/${n.id}/members`,{userId:e}),s(u())}}function p(e){return async(s,t)=>{const n=t().team.team;await(0,a.getBackendSrv)().delete(`/api/teams/${n.id}/members/${e}`),s(u())}}function g(e,s){return async(t,n)=>{const i=n().team.team;await(0,a.getBackendSrv)().put(`/api/teams/${i.id}`,{name:e,email:s}),t(m(i.id))}}function b(){return async(e,s)=>{const t=s().team.team,n=await(0,a.getBackendSrv)().get(`/api/teams/${t.id}/groups`);e((0,o.iI)(n))}}function x(e){return async(s,t)=>{const n=t().team.team;await(0,a.getBackendSrv)().post(`/api/teams/${n.id}/groups`,{groupId:e}),s(b())}}function f(e){return async(s,t)=>{const n=t().team.team;await(0,a.getBackendSrv)().delete(`/api/teams/${n.id}/groups/${encodeURIComponent(e)}`),s(b())}}function j(e){return async s=>{await(0,a.getBackendSrv)().delete(`/api/teams/${e}`),await d.Vt.fetchUserPermissions(),s(c())}}function v(e){return async s=>{await(0,a.getBackendSrv)().put(`/api/teams/${e.teamId}/members/${e.userId}`,{permission:e.permission}),s(u())}}},"./public/app/features/teams/state/navModel.ts":(e,s,t)=>{t.d(s,{B:()=>d,o:()=>c});var a=t("./public/app/types/index.ts"),n=t("./packages/grafana-runtime/src/index.ts"),i=t("./public/app/core/config.ts"),r=t("./public/app/core/services/context_srv.ts"),o=t("./public/app/core/components/Upgrade/ProBadge.tsx");const l={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:a.hw.Member};function d(e){const s={img:e.avatarUrl,id:"team-"+e.id,subTitle:"Manage members and settings",url:"",text:e.name,breadcrumbs:[{title:"Teams",url:"org/teams"}],children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${e.id}`,text:"Settings",url:`org/teams/edit/${e.id}/settings`}]};(e===l||r.Vt.hasPermissionInMetadata(a.bW.ActionTeamsPermissionsRead,e))&&s.children.unshift({active:!1,icon:"users-alt",id:`team-members-${e.id}`,text:"Members",url:`org/teams/edit/${e.id}/members`});const t={active:!1,icon:"sync",id:`team-groupsync-${e.id}`,text:"External group sync",url:`org/teams/edit/${e.id}/groupsync`},d=e===l;return(0,n.featureEnabled)("teamsync")?(d||r.Vt.hasPermissionInMetadata(a.bW.ActionTeamsPermissionsRead,e))&&s.children.push(t):i.ZP.featureToggles.featureHighlights&&s.children.push(Object.assign({},t,{tabSuffix:()=>(0,o.Z)({experimentId:d?"":"feature-highlights-team-sync-badge"})})),s}function c(e){const s=d(l);let t;for(const a of s.children)if(a.id.indexOf(e)>0){a.active=!0,t=a;break}return{main:s,node:t}}},"./public/app/features/teams/state/selectors.ts":(e,s,t)=>{t.d(s,{uP:()=>n,xc:()=>i,JB:()=>r,v7:()=>o,_u:()=>l,VP:()=>d,LK:()=>c,YY:()=>m,vt:()=>u,kC:()=>h});var a=t("./public/app/types/index.ts");const n=e=>e.searchQuery,i=e=>e.searchMemberQuery,r=e=>e.groups,o=e=>e.teams.length,l=e=>e.searchPage,d=(e,s)=>e.team.id===parseInt(s,10)?e.team:null,c=e=>{const s=RegExp(e.searchQuery,"i");return e.teams.filter((e=>s.test(e.name)))},m=e=>{const s=RegExp(e.searchMemberQuery,"i");return e.members.filter((e=>s.test(e.login)||s.test(e.email)||s.test(e.name)))},u=e=>{const{members:s,signedInUser:t,editorsCanAdmin:n}=e,i=s.find((e=>e.userId===t.id)),r=i?i.permission:a.hw.Member;return h({permission:r,signedInUser:t,editorsCanAdmin:n})},h=e=>{const{permission:s,signedInUser:t,editorsCanAdmin:n}=e,i=t.isGrafanaAdmin||t.orgRole===a.B5.Admin,r=s===a.hw.Admin;return i||r||!n}}}]);
//# sourceMappingURL=TeamPages.109a2a405cf7c8a04a9d.js.map