"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3320],{91159:(be,j,r)=>{r.d(j,{n:()=>ne});var O=r(57706),M=r(68404),Y=r(40400),U=r(93003),e=r(29344),w=r(37777),X=r(1357),G=r(18302),J=r(59796),A=r(31439);const q=M.lazy(()=>Promise.all([r.e(1899),r.e(4254),r.e(3348),r.e(7142)]).then(r.bind(r,47864))),y=C=>M.createElement(M.Suspense,{fallback:null},M.createElement(q,{...C})),T=C=>{const R=(0,M.useRef)(null),{runQueryOnBlur:Q,onRunQuery:L,onChange:P,...m}=C,F=B=>{R.current=B,P(B),L()},$=B=>{Q?B!==R.current&&F(B):P(B)};return M.createElement(y,{onRunQuery:F,onBlur:$,...m})},D="grafana.datasources.loki.browser.labels";function x(C,{typeaheadContext:R,typeaheadText:Q}){switch(R){case"context-labels":{const L=e.getNextCharacter();(!L||L==="}"||L===",")&&(C+="=");break}case"context-label-values":{let L="";Q.match(/^(!?=~?"|")/)||(L='"'),L+=(0,A.Hk)(C,Q),e.getNextCharacter()!=='"'&&(L+='"'),C=L;break}default:}return C}class ne extends M.PureComponent{constructor(R){super(R),this._isMounted=!1,this.onChangeLabelBrowser=Q=>{this.onChangeQuery(Q,!0),this.setState({labelBrowserVisible:!1})},this.onChangeQuery=(Q,L)=>{const{query:P,onChange:m,onRunQuery:F}=this.props;if(m){const $={...P,expr:Q};m($),L&&F&&F()}},this.onTypeahead=async Q=>{const{datasource:L}=this.props;if(!L.languageProvider)return{suggestions:[]};const P=L.languageProvider,{history:m}=this.props,{prefix:F,text:$,value:B,wrapperClasses:ee,labelKey:te}=Q;return await P.provideCompletionItems({text:$,value:B,prefix:F,wrapperClasses:ee,labelKey:te},{history:m})},this.state={labelsLoaded:!1,labelBrowserVisible:!1},this.plugins=[(0,w.h)(),(0,X.Z)({onlyIn:Q=>Q.object==="block"&&Q.type==="code_block",getSyntax:Q=>"logql"},{...O.languages,logql:this.props.datasource.languageProvider.getSyntax()})]}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(R){const{range:Q,datasource:{languageProvider:L}}=this.props;(0,A.rf)(Q,R.range)&&L.fetchLabels()}render(){const{ExtraFieldElement:R,query:Q,app:L,datasource:P,placeholder:m="Enter a Loki query (run with Shift+Enter)",history:F,onRunQuery:$,onBlur:B}=this.props;return M.createElement(J.G,{storageKey:D,defaultValue:[]},(ee,te,re)=>M.createElement(M.Fragment,null,M.createElement("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"]},M.createElement("div",{className:"gf-form gf-form--grow flex-shrink-1 min-width-15"},U.v.featureToggles.lokiMonacoEditor?M.createElement(T,{runQueryOnBlur:L!==Y.zj.Explore,datasource:P,history:F??[],onChange:this.onChangeQuery,onRunQuery:$,initialValue:Q.expr??""}):M.createElement(G.q,{additionalPlugins:this.plugins,cleanText:P.languageProvider.cleanText,query:Q.expr,onTypeahead:this.onTypeahead,onWillApplySuggestion:x,onChange:this.onChangeQuery,onBlur:B,onRunQuery:$,placeholder:m,portalOrigin:"loki"}))),R))}}},31439:(be,j,r)=>{r.d(j,{Hk:()=>J,U9:()=>w,_z:()=>A,aC:()=>q,iS:()=>X,rf:()=>Y,tU:()=>G});function O(y){return M(y/1e3)}function M(y){return Math.floor(y/60)}function Y(y,T){if(y&&T){const D=O(y.from.valueOf())===O(T.from.valueOf()),x=O(y.to.valueOf())===O(T.to.valueOf());return!(D&&x)}return!1}const U=/[*+?()|\\.\[\]{}^$]/g;function e(y){return y.replace(U,"\\$&")}function w(y){return y.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function X(y){return y.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function G(y){return w(e(y))}function J(y,T){return A(T)?G(y):w(y)}function A(y){return!!(y&&(y.includes("=~")||y.includes("!~")))}function q(y){const T=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],D=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${T.join("|")})$`);return!!y.match(D)}},33320:(be,j,r)=>{r.r(j),r.d(j,{plugin:()=>la});var O=r(7238),M=r(55294),Y=r(1821),U=r(82897),e=r(68404),w=r(77274);const X=['{job="default/prometheus"}'],G=["job","app","k8s_app"],J=5,A=[{title:"Log pipeline",expression:'{job="mysql"} |= "metrics" | logfmt | duration > 10s',label:'This query targets the MySQL job, keeps logs that contain the substring "metrics", and then parses and filters the logs further.'},{title:"Count over time",expression:'count_over_time({job="mysql"}[5m])',label:"This query counts all the log lines within the last five minutes for the MySQL job."},{title:"Rate",expression:'rate(({job="mysql"} |= "error" != "timeout")[10s])',label:"This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job."},{title:"Aggregate, count, and group",expression:'sum(count_over_time({job="mysql"}[5m])) by (level)',label:"Get the count of logs during the last five minutes, grouping by level."}];class q extends e.PureComponent{constructor(){super(...arguments),this.state={userExamples:[]},this.checkUserLabels=async()=>{const t=this.props.datasource?.languageProvider;if(t.started){const s=t.getLabelKeys()||[],l=G.find(n=>s.includes(n));if(l){const n=await t.getLabelValues(l),i=(0,U.shuffle)(n).slice(0,J).map(c=>`{${l}="${c}"}`);this.setState({userExamples:i})}}else this.scheduleUserLabelChecking()}}componentDidMount(){this.scheduleUserLabelChecking(),(0,w.ff)("grafana_loki_cheatsheet_opened",{})}componentWillUnmount(){clearTimeout(this.userLabelTimer)}scheduleUserLabelChecking(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)}renderExpression(t){const{onClickExample:s}=this.props,l=n=>{s(n),(0,w.ff)("grafana_loki_cheatsheet_example_clicked",{})};return e.createElement("button",{type:"button",className:"cheat-sheet-item__example",key:t,onClick:n=>l({refId:"A",expr:t})},e.createElement("code",null,t))}render(){const{userExamples:t}=this.state,s=t.length>0;return e.createElement("div",null,e.createElement("h2",null,"Loki Cheat Sheet"),e.createElement("div",{className:"cheat-sheet-item"},e.createElement("div",{className:"cheat-sheet-item__title"},"See your logs"),e.createElement("div",{className:"cheat-sheet-item__label"},"Start by selecting a log stream from the Label browser, or alternatively you can write a stream selector into the query field."),s?e.createElement("div",null,e.createElement("div",{className:"cheat-sheet-item__label"},"Here are some example streams from your logs:"),t.map(l=>this.renderExpression(l))):e.createElement("div",null,e.createElement("div",{className:"cheat-sheet-item__label"},"Here is an example of a log stream:"),this.renderExpression(X[0]))),e.createElement("div",{className:"cheat-sheet-item"},e.createElement("div",{className:"cheat-sheet-item__title"},"Combine stream selectors"),this.renderExpression('{app="cassandra",namespace="prod"}'),e.createElement("div",{className:"cheat-sheet-item__label"},"Returns all log lines from streams that have both labels.")),e.createElement("div",{className:"cheat-sheet-item"},e.createElement("div",{className:"cheat-sheet-item__title"},"Filtering for search terms."),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),e.createElement("div",{className:"cheat-sheet-item__label"},e.createElement("a",{href:"https://grafana.com/docs/loki/latest/logql/#log-pipeline",target:"logql"},"LogQL")," ","supports exact and regular expression filters.")),A.map(l=>e.createElement("div",{className:"cheat-sheet-item",key:l.expression},e.createElement("div",{className:"cheat-sheet-item__title"},l.title),this.renderExpression(l.expression),e.createElement("div",{className:"cheat-sheet-item__label"},l.label))))}}var y=r(40400),T=r(49922),D=r(68183),x=r(26418),ne=r(81202),C=r(90723),R=r(92611),Q=r(89318),L=r(58079),P=r(89290),m=r(52423),F=r(29516),$=r(6694),B=r(90090),ee=r(59796),te=r(75478),re=r(11337),oe=r(38835),ie=r(83978),De=r(25474),Ue=r(90701),ce=r(31439);const ue=1e3,de=1e4,Oe=4,me="{}";function I(a){const t=[];for(const s of a)if(s.selected&&s.values&&s.values.length>0){const l=s.values.filter(n=>n.selected).map(n=>n.name);l.length>1?t.push(`${s.name}=~"${l.map(ce.tU).join("|")}"`):l.length===1&&t.push(`${s.name}="${(0,ce.U9)(l[0])}"`)}return["{",t.join(","),"}"].join("")}function Ie(a,t,s){return a.map(l=>{const n=t[l.name];if(n){let i;if(l.name===s&&l.values)i=l.values;else{const c=new Set(l.values?.filter(o=>o.selected).map(o=>o.name)||[]);i=n.map(o=>({name:o,selected:c.has(o)}))}return{...l,loading:!1,values:i,facets:i.length}}return{...l,loading:!1,hidden:!n,values:void 0,facets:0}})}const Ae=a=>({wrapper:m.css`
    background-color: ${a.colors.background.secondary};
    padding: ${a.spacing(2)};
    width: 100%;
  `,list:m.css`
    margin-top: ${a.spacing(1)};
    display: flex;
    flex-wrap: wrap;
    max-height: 200px;
    overflow: auto;
  `,section:m.css`
    & + & {
      margin: ${a.spacing(2,0)};
    }
    position: relative;
  `,selector:m.css`
    font-family: ${a.typography.fontFamilyMonospace};
    margin-bottom: ${a.spacing(1)};
  `,status:m.css`
    margin-bottom: ${a.spacing(1)};
    color: ${a.colors.text.secondary};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: opacity 100ms linear;
    opacity: 0;
  `,statusShowing:m.css`
    opacity: 1;
  `,error:m.css`
    color: ${a.colors.error.main};
  `,valueList:m.css`
    margin-right: ${a.spacing(1)};
    resize: horizontal;
  `,valueListWrapper:m.css`
    border-left: 1px solid ${a.colors.border.medium};
    margin: ${a.spacing(1,0)};
    padding: ${a.spacing(1,0,1,1)};
  `,valueListArea:m.css`
    display: flex;
    flex-wrap: wrap;
    margin-top: ${a.spacing(1)};
  `,valueTitle:m.css`
    margin-left: -${a.spacing(.5)};
    margin-bottom: ${a.spacing(1)};
  `,validationStatus:m.css`
    padding: ${a.spacing(.5)};
    margin-bottom: ${a.spacing(1)};
    color: ${a.colors.text.maxContrast};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  `});class ze extends e.Component{constructor(){super(...arguments),this.state={labels:[],searchTerm:"",status:"Ready",error:"",validationStatus:""},this.onChangeSearch=t=>{this.setState({searchTerm:t.target.value})},this.onClickRunLogsQuery=()=>{(0,w.ff)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsButton"});const t=I(this.state.labels);this.props.onChange(t)},this.onClickRunMetricsQuery=()=>{(0,w.ff)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsRateButton"});const s=`rate(${I(this.state.labels)}[$__interval])`;this.props.onChange(s)},this.onClickClear=()=>{this.setState(t=>({labels:t.labels.map(l=>({...l,values:void 0,selected:!1,loading:!1,hidden:!1,facets:void 0})),searchTerm:"",status:"",error:"",validationStatus:""})),this.props.deleteLastUsedLabels()},this.onClickLabel=(t,s,l)=>{const n=this.state.labels.find(o=>o.name===t);if(!n)return;const i=!n.selected;let c={selected:i};if(n.values&&!i){const o=n.values.map(d=>({...d,selected:!1}));c={...c,facets:0,values:o}}this.setState({searchTerm:""}),this.updateLabelState(t,c,"",()=>this.doFacettingForLabel(t))},this.onClickValue=(t,s,l)=>{const n=this.state.labels.find(c=>c.name===t);if(!n||!n.values)return;this.setState({searchTerm:""});const i=n.values.map(c=>({...c,selected:c.name===s?!c.selected:c.selected}));this.updateLabelState(t,{values:i},"",()=>this.doFacetting(t))},this.onClickValidate=()=>{const t=I(this.state.labels);this.validateSelector(t)},this.doFacetting=t=>{const s=I(this.state.labels);if(s===me){const l=this.state.labels.map(n=>({...n,facets:0,values:void 0,hidden:!1}));this.setState({labels:l},()=>{this.state.labels.forEach(n=>n.selected&&this.fetchValues(n.name,s))})}else this.fetchSeries(s,t)}}updateLabelState(t,s,l="",n){this.setState(i=>{const c=i.labels.map(d=>d.name===t?{...d,...s}:d),o=l?"":i.error;return{labels:c,status:l,error:o,validationStatus:""}},n)}componentDidMount(){const{languageProvider:t,autoSelect:s=Oe,lastUsedLabels:l}=this.props;if(t){const n=l;t.start().then(()=>{let i=t.getLabelKeys();if(i.length>ue){const o=`Too many labels found (showing only ${ue} of ${i.length})`;i=i.slice(0,ue),this.setState({error:o})}const c=i.map((o,d,g)=>({name:o,selected:g.length<=s&&n.length===0||n.includes(o),loading:!1}));this.setState({labels:c},()=>{this.state.labels.forEach(o=>{o.selected&&this.fetchValues(o.name,me)})})})}}doFacettingForLabel(t){const s=this.state.labels.find(n=>n.name===t);if(!s)return;const l=this.state.labels.filter(n=>n.selected).map(n=>n.name);this.props.storeLastUsedLabels(l),s.selected?s.values||this.fetchValues(t,I(this.state.labels)):this.doFacetting()}async fetchValues(t,s){const{languageProvider:l}=this.props;this.updateLabelState(t,{loading:!0},`Fetching values for ${t}`);try{let n=await l.getLabelValues(t);if(s!==I(this.state.labels)){this.updateLabelState(t,{loading:!1},"");return}if(n.length>de){const c=`Too many values for ${t} (showing only ${de} of ${n.length})`;n=n.slice(0,de),this.setState({error:c})}const i=n.map(c=>({name:c}));this.updateLabelState(t,{values:i,loading:!1})}catch(n){console.error(n)}}async fetchSeries(t,s){const{languageProvider:l}=this.props;s&&this.updateLabelState(s,{loading:!0},`Loading labels for ${t}`);try{const n=await l.fetchSeriesLabels(t,!0);if(t!==I(this.state.labels)){s&&this.updateLabelState(s,{loading:!1});return}if(Object.keys(n).length===0){this.setState({error:`Empty results, no matching label for ${t}`});return}const i=Ie(this.state.labels,n,s);this.setState({labels:i,error:""}),s&&this.updateLabelState(s,{loading:!1})}catch(n){console.error(n)}}async validateSelector(t){const{languageProvider:s}=this.props;this.setState({validationStatus:`Validating selector ${t}`,error:""});const l=await s.fetchSeries(t);this.setState({validationStatus:`Selector is valid (${l.length} streams found)`})}render(){const{theme:t}=this.props,{labels:s,searchTerm:l,status:n,error:i,validationStatus:c}=this.state;if(s.length===0)return e.createElement(B.u,{text:"Loading labels..."});const o=Ae(t),d=I(this.state.labels),g=d===me;let p=s.filter(u=>u.selected&&u.values);return l?p=p.map(u=>{const b=u.values.filter(h=>{if(h.selected)return h.highlightParts=void 0,!0;const S=(0,re.C)(h.name.toLowerCase(),l.toLowerCase());return S.found?(h.highlightParts=S.ranges,h.order=S.distance,!0):!1});return{...u,values:(0,U.sortBy)(b,h=>h.selected?-1/0:h.order)}}):p=this.state.labels.filter(u=>u.selected&&u.values).map(u=>({...u,values:u?.values?u.values.map(b=>({...b,highlightParts:void 0})):[]})),e.createElement("div",{className:o.wrapper},e.createElement("div",{className:o.section},e.createElement(oe._,{description:"Which labels would you like to consider for your search?"},"1. Select labels to search in"),e.createElement("div",{className:o.list},s.map(u=>e.createElement(ie._,{key:u.name,name:u.name,loading:u.loading,active:u.selected,hidden:u.hidden,facets:u.facets,onClick:this.onClickLabel})))),e.createElement("div",{className:o.section},e.createElement(oe._,{description:"Choose the label values that you would like to use for the query. Use the search field to find values across selected labels."},"2. Find values for the selected labels"),e.createElement("div",null,e.createElement(De.I,{onChange:this.onChangeSearch,"aria-label":"Filter expression for values",value:l,placeholder:"Enter a label value"})),e.createElement("div",{className:o.valueListArea},p.map(u=>e.createElement("div",{role:"list",key:u.name,className:o.valueListWrapper},e.createElement("div",{className:o.valueTitle,"aria-label":`Values for ${u.name}`},e.createElement(ie._,{name:u.name,loading:u.loading,active:u.selected,hidden:u.hidden,facets:u.facets||u.values?.length,onClick:this.onClickLabel})),e.createElement(te.t7,{height:200,itemCount:u.values?.length||0,itemSize:28,itemKey:b=>u.values[b].name,width:200,className:o.valueList},({index:b,style:h})=>{const S=u.values?.[b];return S?e.createElement("div",{style:h},e.createElement(ie._,{name:u.name,value:S?.name,active:S?.selected,highlightParts:S?.highlightParts,onClick:this.onClickValue,searchTerm:l})):null}))))),e.createElement("div",{className:o.section},e.createElement(oe._,null,"3. Resulting selector"),e.createElement("div",{"aria-label":"selector",className:o.selector},d),c&&e.createElement("div",{className:o.validationStatus},c),e.createElement("div",{className:(0,m.cx)(o.status,(n||i)&&o.statusShowing)},e.createElement("span",{className:i?o.error:""},i||n)),e.createElement(Ue.Lh,null,e.createElement(C.zx,{"aria-label":"Use selector as logs button",disabled:g,onClick:this.onClickRunLogsQuery},"Show logs"),e.createElement(C.zx,{"aria-label":"Use selector as metrics button",variant:"secondary",disabled:g,onClick:this.onClickRunMetricsQuery},"Show logs rate"),e.createElement(C.zx,{"aria-label":"Validate submit button",variant:"secondary",disabled:g,onClick:this.onClickValidate},"Validate selector"),e.createElement(C.zx,{"aria-label":"Selector clear button",variant:"secondary",onClick:this.onClickClear},"Clear"))))}}const We=(0,F.HE)(ze),je=a=>{const{isOpen:t,onClose:s,datasource:l,app:n}=a,[i,c]=(0,e.useState)(!1),[o,d]=(0,e.useState)(!1),g="grafana.datasources.loki.browser.labels",p=(0,F.wW)(Ge);(0,e.useEffect)(()=>{t&&l.languageProvider.start().then(()=>{c(!0),d(l.languageProvider.getLabelKeys().length>0)})},[l,t]);const u=S=>{const{query:E,onChange:f,onRunQuery:N}=a,v={...E,expr:S};f(v),N()},b=S=>{u(S),s()},h=()=>{(0,w.ff)("grafana_loki_label_browser_closed",{app:n,closeType:"modalClose"}),s()};return e.createElement($.u,{isOpen:t,title:"Label browser",onDismiss:h,className:p.modal},!i&&e.createElement(B.u,{text:"Loading labels..."}),i&&!o&&e.createElement("p",null,"No labels found."),i&&o&&e.createElement(ee.G,{storageKey:g,defaultValue:[]},(S,E,f)=>e.createElement(We,{languageProvider:l.languageProvider,onChange:b,lastUsedLabels:S,storeLastUsedLabels:E,deleteLastUsedLabels:f,app:n})))},Ge=a=>({modal:m.css`
      width: 85vw;
      ${a.breakpoints.down("md")} {
        width: 100%;
      }
    `});var He=r(32557),k=r(39682),z=r(21745),Ke=r(69311),H=r(63134),K=r(46739);function Ze({item:a,defaultOp:t,onChange:s,onDelete:l,onGetLabelNames:n,onGetLabelValues:i,invalidLabel:c,invalidValue:o}){const[d,g]=(0,e.useState)({}),p=(h=a.op)=>Le.find(S=>S.label===h)?.isMultiValue,u=h=>h?h.indexOf("|")>0?h.split("|"):[h]:[],b=()=>{const h=d.labelValues?[...d.labelValues]:[],S=u(a?.value).map(H.E);return(0,U.uniqBy)([...S,...h],"value")};return e.createElement("div",{"data-testid":"prometheus-dimensions-filter-item"},e.createElement(x.InputGroup,null,e.createElement(K.Ph,{placeholder:"Select label","aria-label":D.wl.components.QueryBuilder.labelSelect,inputId:"prometheus-dimensions-filter-item-key",width:"auto",value:a.label?(0,H.E)(a.label):null,allowCustomValue:!0,onOpenMenu:async()=>{g({isLoadingLabelNames:!0});const h=await n(a);g({labelNames:h,isLoadingLabelNames:void 0})},isLoading:d.isLoadingLabelNames,options:d.labelNames,onChange:h=>{h.label&&s({...a,op:a.op??t,label:h.label})},invalid:c}),e.createElement(K.Ph,{"aria-label":D.wl.components.QueryBuilder.matchOperatorSelect,value:(0,H.E)(a.op??t),options:Le,width:"auto",onChange:h=>{h.value!=null&&s({...a,op:h.value,value:p(h.value)?a.value:u(a?.value)[0]})}}),e.createElement(K.Ph,{placeholder:"Select value","aria-label":D.wl.components.QueryBuilder.valueSelect,inputId:"prometheus-dimensions-filter-item-value",width:"auto",value:p()?u(a?.value).map(H.E):u(a?.value).map(H.E)[0],allowCustomValue:!0,onOpenMenu:async()=>{g({isLoadingLabelValues:!0});const h=await i(a);g({...d,labelValues:h,isLoadingLabelValues:void 0})},isMulti:p(),isLoading:d.isLoadingLabelValues,options:b(),onChange:h=>{if(h.value)s({...a,value:h.value,op:a.op??t});else{const S=h.map(E=>E.label).join("|");s({...a,value:S,op:a.op??t})}},invalid:o}),e.createElement(x.AccessoryButton,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:l})))}const Le=[{label:"=~",value:"=~",isMultiValue:!0},{label:"=",value:"=",isMultiValue:!1},{label:"!=",value:"!=",isMultiValue:!1},{label:"!~",value:"!~",isMultiValue:!0}],Ye="Select at least 1 label filter (label and value)";function Xe({labelsFilters:a,onChange:t,onGetLabelNames:s,onGetLabelValues:l,labelFilterRequired:n}){const i="=",[c,o]=(0,e.useState)([{op:i}]);(0,e.useEffect)(()=>{a.length>0?o(a):o([{op:i}])},[a]);const d=p=>{o(p);const u=p.filter(b=>b.label!=null&&b.value!=null);(0,U.isEqual)(u,a)||t(u)},g=c.some(p=>p.label&&p.value);return e.createElement(x.EditorFieldGroup,null,e.createElement(x.EditorField,{label:"Label filters",error:Ye,invalid:n&&!g},e.createElement(x.EditorList,{items:c,onChange:d,renderItem:(p,u,b)=>e.createElement(Ze,{item:p,defaultOp:i,onChange:u,onDelete:b,onGetLabelNames:s,onGetLabelValues:l,invalidLabel:n&&!p.label,invalidValue:n&&!p.value})})))}var xe=r(58439),Je=r(41285),Se=r(19023),qe=r(73250),_e=r(75765),ae=r(45204),se=r(19370),Ce=r(91720);const Ne="Fetch all log lines matching label filters.",Qe=e.memo(({query:a})=>{const t=(0,z._)(a||"").query,s={grammar:se.xY,name:"lokiql"};return e.createElement(x.Stack,{gap:0,direction:"column"},e.createElement(xe.B,{stepNumber:1,title:e.createElement(ae.U,{query:`${k.y.renderLabels(t.labels)}`,lang:s})},Ne),e.createElement(Se.V,{stepNumber:2,queryModeller:k.y,query:t,lang:s}))});Qe.displayName="LokiQueryBuilderExplained";var he=r(53799),et=r(20017),tt=r(75215);const Me=e.memo(({nestedQuery:a,index:t,datasource:s,onChange:l,onRemove:n,onRunQuery:i,showExplain:c})=>{const o=(0,F.wW)(st);return e.createElement("div",{className:o.card},e.createElement("div",{className:o.header},e.createElement("div",{className:o.name},"Operator"),e.createElement(K.Ph,{"aria-label":"Select operator",width:"auto",options:at,value:(0,H.E)(a.operator),onChange:d=>{l(t,{...a,operator:d.value})}}),e.createElement("div",{className:o.name},"Vector matches"),e.createElement("div",{className:o.vectorMatchWrapper},e.createElement(K.Ph,{width:"auto",value:a.vectorMatchesType||"on",allowCustomValue:!0,options:[{value:"on",label:"on"},{value:"ignoring",label:"ignoring"}],onChange:d=>{l(t,{...a,vectorMatchesType:d.value})}}),e.createElement(he.H,{className:o.vectorMatchInput,minWidth:20,defaultValue:a.vectorMatches,onCommitChange:d=>{l(t,{...a,vectorMatches:d.currentTarget.value,vectorMatchesType:a.vectorMatchesType||"on"})}})),e.createElement(x.FlexItem,{grow:1}),e.createElement(et.h,{ariaLabel:"Remove nested query",name:"times",size:"sm",onClick:()=>n(t)})),e.createElement("div",{className:o.body},e.createElement(x.EditorRows,null,e.createElement(ge,{showExplain:c,query:a.query,datasource:s,onRunQuery:i,onChange:d=>{l(t,{...a,query:d})}}))))}),at=tt.i.map(a=>({label:a.sign,value:a.sign}));Me.displayName="NestedQuery";const st=a=>({card:(0,m.css)({label:"card",display:"flex",flexDirection:"column",gap:a.spacing(.5)}),header:(0,m.css)({label:"header",padding:a.spacing(.5,.5,.5,1),gap:a.spacing(1),display:"flex",alignItems:"center"}),name:(0,m.css)({label:"name",whiteSpace:"nowrap"}),body:(0,m.css)({label:"body",paddingLeft:a.spacing(2)}),vectorMatchInput:(0,m.css)({label:"vectorMatchInput",marginLeft:-1}),vectorMatchWrapper:(0,m.css)({label:"vectorMatchWrapper",display:"flex"})});function lt({query:a,datasource:t,onChange:s,onRunQuery:l,showExplain:n}){const i=a.binaryQueries??[],c=(d,g)=>{const p=[...i];p.splice(d,1,g),s({...a,binaryQueries:p})},o=d=>{const g=[...i.slice(0,d),...i.slice(d+1)];s({...a,binaryQueries:g})};return e.createElement(x.Stack,{direction:"column",gap:1},i.map((d,g)=>e.createElement(Me,{key:g.toString(),nestedQuery:d,index:g,onChange:c,datasource:t,onRemove:o,onRunQuery:l,showExplain:n})))}const ge=e.memo(({datasource:a,query:t,onChange:s,onRunQuery:l,showExplain:n})=>{const[i,c]=(0,e.useState)(),[o,d]=(0,e.useState)(void 0),g=E=>{s({...t,labels:E})},p=async E=>{const f=await E;return[...a.getVariables(),...f].map(N=>({label:N,value:N}))},u=async E=>{const f=t.labels.filter(W=>W!==E);if(f.length===0)return await a.languageProvider.refreshLogLabels(),a.languageProvider.getLabelKeys();const N=k.y.renderLabels(f),v=await a.languageProvider.fetchSeriesLabels(N),Z=f.map(W=>W.label);return Object.keys(v).filter(W=>!Z.includes(W)).sort()},b=async E=>{if(!E.label)return[];let f;const N=t.labels.filter(v=>v!==E);if(N.length===0)f=await a.languageProvider.fetchLabelValues(E.label);else{const v=k.y.renderLabels(N);f=(await a.languageProvider.fetchSeriesLabels(v))[a.interpolateString(E.label)]}return f?f.map(v=>(0,ce.Hk)(v,E.op)):[]},h=(0,e.useMemo)(()=>{const{labels:E,operations:f}=t;return!E.length&&f.length?!(f.length===1&&f[0].id===Ce.B5.LineContains&&f[0].params[0]===""):!1},[t]);(0,e.useEffect)(()=>{(async()=>{const f={expr:k.y.renderQuery(t),refId:"data-samples"},v={series:await a.getDataSamples(f),state:T.Gu.Done,timeRange:(0,Ke.JK)()};c(v)})().catch(console.error)},[a,t]);const S={grammar:se.ZP,name:"logql"};return e.createElement("div",{"data-testid":ve.editor},e.createElement(x.EditorRow,null,e.createElement(Xe,{onGetLabelNames:E=>p(u(E)),onGetLabelValues:E=>p(b(E)),labelsFilters:t.labels,onChange:g,labelFilterRequired:h})),n&&e.createElement(xe.B,{stepNumber:1,title:e.createElement(ae.U,{query:`${k.y.renderLabels(t.labels)}`,lang:S})},Ne),e.createElement(qe.B,null,e.createElement(Je.P,{queryModeller:k.y,query:t,onChange:s,onRunQuery:l,datasource:a,highlightedOp:o}),e.createElement(_e.L,{datasource:a,query:t,onChange:s,data:i,queryModeller:k.y,buildVisualQueryFromString:z._})),n&&e.createElement(Se.V,{stepNumber:2,queryModeller:k.y,query:t,lang:S,onMouseEnter:E=>{d(E)},onMouseLeave:()=>{d(void 0)}}),t.binaryQueries&&t.binaryQueries.length>0&&e.createElement(lt,{query:t,datasource:a,onChange:s,onRunQuery:l,showExplain:n}))});ge.displayName="LokiQueryBuilder";function nt({query:a}){return e.createElement(x.EditorRow,null,e.createElement(x.EditorFieldGroup,null,e.createElement(ae.U,{query:a,lang:{grammar:se.xY,name:"lokiql"}})))}function rt(a){const{query:t,onChange:s,onRunQuery:l,datasource:n,showExplain:i}=a,[c,o]=(0,e.useReducer)(Fe.reducer,{expr:t.expr,visQuery:t.expr===""?{labels:[],operations:[{id:"__line_contains",params:[""]}]}:void 0});(0,e.useEffect)(()=>{o(it(t.expr))},[t.expr]);const d=g=>{const p=k.y.renderQuery(g);o(ot({visQuery:g,expr:p})),s({...a.query,expr:p})};return c.visQuery?e.createElement(e.Fragment,null,e.createElement(ge,{query:c.visQuery,datasource:n,onChange:d,onRunQuery:l,showExplain:i,"data-testid":ve.editor}),t.expr!==""&&e.createElement(nt,{query:t.expr})):null}const Fe=(0,He.oM)({name:"loki-builder-container",initialState:{expr:""},reducers:{visualQueryChange:(a,t)=>{a.expr=t.payload.expr,a.visQuery=t.payload.visQuery},exprChanged:(a,t)=>{if(!a.visQuery||a.expr!==t.payload){a.expr=t.payload;const s=(0,z._)(t.payload);a.visQuery=s.query}}}}),{visualQueryChange:ot,exprChanged:it}=Fe.actions;var ct=r(318),ut=r(38435),_=r(47138),dt=r(24666),pe=r(92555);const we=e.memo(({app:a,query:t,onChange:s,onRunQuery:l,maxLines:n})=>{const i=u=>{s({...t,queryType:u}),l()},c=u=>{(0,w.ff)("grafana_loki_resolution_clicked",{app:a,resolution:u.value}),s({...t,resolution:u.value}),l()},o=u=>{s({...t,legendFormat:u.currentTarget.value}),l()};function d(u){const b=(0,_.Wz)(u.currentTarget.value);t.maxLines!==b&&(s({...t,maxLines:b}),l())}let g=t.queryType??(t.instant?pe.EM.Instant:pe.EM.Range),p=(0,dt.rE)(t.expr);return e.createElement(x.EditorRow,null,e.createElement(ut.d,{title:"Options",collapsedInfo:mt(t,g,p,n)},e.createElement(x.EditorField,{label:"Legend",tooltip:"Series name override or template. Ex. {{hostname}} will be replaced with label value for hostname."},e.createElement(he.H,{placeholder:"{{label}}",id:"loki-query-editor-legend-format",type:"string",minWidth:14,defaultValue:t.legendFormat,onCommitChange:o})),e.createElement(x.EditorField,{label:"Type"},e.createElement(ct.S,{options:_.uG,value:g,onChange:i})),p&&e.createElement(x.EditorField,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query."},e.createElement(he.H,{className:"width-4",placeholder:n.toString(),type:"number",min:0,defaultValue:t.maxLines?.toString()??"",onCommitChange:d})),e.createElement(x.EditorField,{label:"Resolution"},e.createElement(K.Ph,{isSearchable:!1,onChange:c,options:_.oZ,value:t.resolution||1,"aria-label":"Select resolution"}))))});function mt(a,t,s,l){const n=_.uG.find(o=>o.value===t),i=_.oZ.find(o=>o.value===(a.resolution??1)),c=[];return a.legendFormat&&c.push(`Legend: ${a.legendFormat}`),a.resolution&&c.push(`Resolution: ${i?.label}`),c.push(`Type: ${n?.label}`),s&&c.push(`Line limit: ${a.maxLines??l}`),c}we.displayName="LokiQueryBuilderOptions";var ke=r(91159);function ht({query:a,datasource:t,range:s,onRunQuery:l,onChange:n,data:i,app:c,showExplain:o,history:d}){const g=(0,F.wW)(gt),p=c===y.zj.Explore?()=>{}:void 0;return e.createElement("div",{className:g.wrapper},e.createElement(ke.n,{datasource:t,query:a,range:s,onRunQuery:l,onChange:n,onBlur:p,history:d,data:i,app:c,"data-testid":ve.editor}),o&&e.createElement(Qe,{query:a.expr}))}const gt=a=>({wrapper:m.css`
      max-width: 100%;
      .gf-form {
        margin-bottom: 0.5;
      }
    `});var pt=r(7917),ft=r(99822),fe=r(66208);const vt=a=>{const{pattern:t,onPatternSelect:s,hasNewQueryOption:l,hasPreviousQuery:n,selectedPatternName:i,setSelectedPatternName:c}=a,o=(0,F.wW)(yt),d={grammar:se.ZP,name:"logql"};return e.createElement(fe.Z,{className:o.card},e.createElement(fe.Z.Heading,null,t.name),e.createElement("div",{className:o.rawQueryContainer},e.createElement(ae.U,{query:k.y.renderQuery({labels:[],operations:t.operations}),lang:d,className:o.rawQuery})),e.createElement(fe.Z.Actions,null,i!==t.name?e.createElement(C.zx,{size:"sm",onClick:()=>{n?c(t.name):s(t)}},"Use this query"):e.createElement(e.Fragment,null,e.createElement("div",{className:o.spacing},`If you would like to use this query, ${l?"you can either replace your current query or create a new query":"your current query will be replaced"}.`),e.createElement(C.zx,{size:"sm",fill:"outline",onClick:()=>c(null)},"Back"),e.createElement(C.zx,{size:"sm",onClick:()=>{s(t)}},"Replace query"),l&&e.createElement(C.zx,{size:"sm",onClick:()=>{s(t,!0)}},"Create new query"))))},yt=a=>({card:m.css`
      width: 49.5%;
      display: flex;
      flex-direction: column;
    `,rawQueryContainer:m.css`
      flex-grow: 1;
    `,rawQuery:m.css`
      background-color: ${a.colors.background.primary};
      padding: ${a.spacing(1)};
      margin-top: ${a.spacing(1)};
    `,spacing:m.css`
      margin-bottom: ${a.spacing(1)};
    `}),Et=a=>{const{isOpen:t,onClose:s,onChange:l,onAddQuery:n,query:i,queries:c,app:o}=a,[d,g]=(0,e.useState)([]),[p,u]=(0,e.useState)(null),b=(0,F.wW)(bt),h=!!n,S=(0,e.useMemo)(()=>(0,z._)(i.expr).query.operations.length>0,[i.expr]),E=(f,N=!1)=>{const v=(0,z._)(N?"":i.expr);(0,w.ff)("grafana_loki_query_patterns_selected",{version:"v2",app:o??"",editorMode:i.editorMode,selectedPattern:f.name,preSelectedOperationsCount:v.query.operations.length,preSelectedLabelsCount:v.query.labels.length,createNewQuery:h&&N}),v.query.operations=f.operations,h&&N?n({...i,refId:(0,ft.Hs)(c??[i]),expr:k.y.renderQuery(v.query)}):l({...i,expr:k.y.renderQuery(v.query)}),u(null),s()};return e.createElement($.u,{isOpen:t,title:"Kick start your query",onDismiss:s,className:b.modal},e.createElement("div",{className:b.spacing},"Kick start your query by selecting one of these queries. You can then continue to complete your query."),Object.values(Ce.Hv).map(f=>e.createElement(pt.U,{key:f,label:`${(0,U.capitalize)(f)} query starters`,isOpen:d.includes(f),collapsible:!0,onToggle:()=>g(N=>N.includes(f)?N.filter(v=>v!==f):[...N,f])},e.createElement("div",{className:b.cardsContainer},k.y.getQueryPatterns().filter(N=>N.type===f).map(N=>e.createElement(vt,{key:N.name,pattern:N,hasNewQueryOption:h,hasPreviousQuery:S,onPatternSelect:E,selectedPatternName:p,setSelectedPatternName:u}))))),e.createElement(C.zx,{variant:"secondary",onClick:s},"Close"))},bt=a=>({cardsContainer:m.css`
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
    `,spacing:m.css`
      margin-bottom: ${a.spacing(1)};
    `,modal:m.css`
      width: 85vw;
      ${a.breakpoints.down("md")} {
        width: 100%;
      }
    `});var Te=r(58379);const Pe="LokiQueryEditorModeDefault";function Lt(a,t,s){a.expr===""&&Te.Z.set(Pe,t),s({...a,editorMode:t})}function xt(a){if(a!=null&&a!=="")return L.c.Code;const t=Te.Z.get(Pe);switch(t){case L.c.Builder:case L.c.Code:return t;default:return L.c.Builder}}function St(a){let t=a;return a.editorMode||(t={...a,editorMode:xt(a.expr)}),a.expr==null&&(t={...t,expr:""}),a.queryType==null&&(t={...t,queryType:pe.EM.Range}),t}const ve={editor:"loki-editor"},Be=e.memo(a=>{const{onChange:t,onRunQuery:s,onAddQuery:l,data:n,app:i,queries:c,datasource:o}=a,[d,g]=(0,e.useState)(!1),[p,u]=(0,e.useState)(!1),[b,h]=(0,e.useState)(!1),[S,E]=(0,e.useState)(!1),{flag:f,setFlag:N}=(0,P.P5)(P.iS),v=St(a.query),Z=v.editorMode,Ve=V=>{N(V.currentTarget.checked)},W=(0,e.useCallback)(V=>{if((0,w.ff)("grafana_loki_editor_mode_clicked",{newEditor:V,previousEditor:v.editorMode??"",newQuery:!v.expr,app:i??""}),V===L.c.Builder&&(0,z._)(v.expr||"").errors.length){g(!0);return}Lt(v,V,t)},[t,v,i]);(0,e.useEffect)(()=>{h(!1)},[n]);const Ee=V=>{h(!0),t(V)},na=()=>{(0,w.ff)("grafana_loki_label_browser_opened",{app:i}),E(V=>!V)};return e.createElement(e.Fragment,null,e.createElement(ne.s,{isOpen:d,title:"Query parsing",body:"There were errors while trying to parse the query. Continuing to visual builder may lose some parts of the query.",confirmText:"Continue",onConfirm:()=>{t({...v,editorMode:L.c.Builder}),g(!1)},onDismiss:()=>g(!1)}),e.createElement(Et,{isOpen:p,onClose:()=>u(!1),query:v,queries:c,app:i,onChange:t,onAddQuery:l}),e.createElement(je,{isOpen:S,datasource:o,query:v,app:i,onClose:()=>E(!1),onChange:Ee,onRunQuery:s}),e.createElement(x.EditorHeader,null,e.createElement(x.Stack,{gap:1},e.createElement(C.zx,{"aria-label":D.wl.components.QueryBuilder.queryPatterns,variant:"secondary",size:"sm",onClick:()=>{u($e=>!$e);const V=(0,z._)(v.expr||"");(0,w.ff)("grafana_loki_query_patterns_opened",{version:"v2",app:i??"",editorMode:v.editorMode,preSelectedOperationsCount:V.query.operations.length,preSelectedLabelsCount:V.query.labels.length})}},"Kick start your query"),e.createElement(C.zx,{variant:"secondary",size:"sm",onClick:na,"data-testid":"label-browser-button"},"Label browser")),e.createElement(Q.n,{label:"Explain query",value:f,onChange:Ve}),e.createElement(x.FlexItem,{grow:1}),i!==y.zj.Explore&&i!==y.zj.Correlations&&e.createElement(C.zx,{variant:b?"primary":"secondary",size:"sm",onClick:s,icon:n?.state===T.Gu.Loading?"fa fa-spinner":void 0,disabled:n?.state===T.Gu.Loading},"Run queries"),e.createElement(R.k,{mode:Z,onChange:W})),e.createElement(x.Space,{v:.5}),e.createElement(x.EditorRows,null,Z===L.c.Code&&e.createElement(ht,{...a,query:v,onChange:Ee,showExplain:f}),Z===L.c.Builder&&e.createElement(rt,{datasource:a.datasource,query:v,onChange:Ee,onRunQuery:a.onRunQuery,showExplain:f}),e.createElement(we,{query:v,onChange:t,onRunQuery:s,app:i,maxLines:o.maxLines})))});Be.displayName="LokiQueryEditor";function Ct(a){const{query:t,data:s,datasource:l,onChange:n,onRunQuery:i,history:c}=a;return e.createElement(ke.n,{datasource:l,query:t,onChange:n,onRunQuery:i,onBlur:i,history:c,data:s,placeholder:"Enter a Loki query","data-testid":Nt.editor})}const Nt={editor:"loki-editor-cloud-alerting"};function Qt(a){const{app:t}=a;switch(t){case y.zj.CloudAlerting:return e.createElement(Ct,{...a});default:return e.createElement(Be,{...a})}}const Mt=(0,e.memo)(Qt),ra={editor:"loki-editor"};var Ft=r(93003),wt=r(32695),kt=r(97064),Tt=r(36555),Pt=r(89029),Bt=r(28151),Rt=r(9085),Vt=r.n(Rt),$t=r(14582),Dt=r(19695),ye=r(89014),Ut=r(71570);const{FormField:Ot}=ye.LegacyForms,It=a=>{const{derivedFields:t,className:s}=a,[l,n]=(0,e.useState)("");let i=[];return l&&t&&(i=zt(t,l)),e.createElement("div",{className:s},e.createElement(Ot,{labelWidth:12,label:"Debug log message",inputEl:e.createElement("textarea",{placeholder:"Paste an example log line here to test the regular expressions of your derived fields",className:Vt()("gf-form-input gf-form-textarea",m.css`
                width: 100%;
              `),value:l,onChange:c=>n(c.currentTarget.value)})}),!!i.length&&e.createElement(At,{fields:i}))},At=({fields:a})=>e.createElement("table",{className:"filter-table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Name"),e.createElement("th",null,"Value"),e.createElement("th",null,"Url"))),e.createElement("tbody",null,a.map(t=>{let s=t.value;return t.error&&t.error instanceof Error?s=t.error.message:t.href&&(s=e.createElement("a",{href:t.href},s)),e.createElement("tr",{key:`${t.name}=${t.value}`},e.createElement("td",null,t.name),e.createElement("td",null,s),e.createElement("td",null,t.href?e.createElement("a",{href:t.href},t.href):""))})));function zt(a,t){return a.filter(s=>s.name&&s.matcherRegex).map(s=>{try{const l=t.match(s.matcherRegex),n=l&&l[1];let i=null;return s.url&&n&&(i=(0,Ut.a)({field:{name:"",type:$t.fS.string,values:new Dt.G([n]),config:{links:[{title:"",url:s.url}]}},rowIndex:0,range:{}})[0]),{name:s.name,value:n||"<no match>",href:i?i.href:void 0}}catch(l){return{name:s.name,error:l}}})}var Wt=r(54291),jt=r(2248),Gt=r(64377);const{Switch:Ht,FormField:le}=ye.LegacyForms,Kt=a=>({row:m.css`
    display: flex;
    align-items: baseline;
  `,nameField:m.css`
    flex: 2;
  `,regexField:m.css`
    flex: 3;
  `,urlField:m.css`
    flex: 1;
    margin-right: ${a.spacing(.5)};
  `,urlDisplayLabelField:m.css`
    flex: 1;
  `}),Zt=a=>{const{value:t,onChange:s,onDelete:l,suggestions:n,className:i}=a,c=(0,F.wW)(Kt),[o,d]=(0,e.useState)(!!t.datasourceUid),g=(0,Wt.Z)(t.datasourceUid);(0,e.useEffect)(()=>{!g&&t.datasourceUid&&!o&&d(!0),g&&!t.datasourceUid&&o&&d(!1)},[g,t.datasourceUid,o]);const p=u=>b=>{s({...t,[u]:b.currentTarget.value})};return e.createElement("div",{className:i,"data-testid":"derived-field"},e.createElement("div",{className:"gf-form"},e.createElement(le,{labelWidth:10,className:c.nameField,inputWidth:null,label:"Name",type:"text",value:t.name,onChange:p("name")}),e.createElement(le,{labelWidth:10,className:c.regexField,inputWidth:null,label:"Regex",type:"text",value:t.matcherRegex,onChange:p("matcherRegex"),tooltip:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),e.createElement(C.zx,{variant:"destructive",title:"Remove field",icon:"times",onClick:u=>{u.preventDefault(),l()}})),e.createElement("div",{className:"gf-form"},e.createElement(le,{labelWidth:10,label:o?"Query":"URL",inputEl:e.createElement(Gt.v,{placeholder:o?"${__value.raw}":"http://example.com/${__value.raw}",value:t.url||"",onChange:u=>s({...t,url:u}),suggestions:n}),className:c.urlField}),e.createElement(le,{className:c.urlDisplayLabelField,labelWidth:10,inputWidth:null,label:"URL Label",type:"text",value:t.urlDisplayLabel,onChange:p("urlDisplayLabel"),tooltip:"Use to override the button label when this derived field is found in a log."})),e.createElement("div",{className:c.row},e.createElement(Ht,{label:"Internal link",checked:o,onChange:()=>{o&&s({...t,datasourceUid:void 0}),d(!o)}}),o&&e.createElement(jt.q,{tracing:!0,onChange:u=>s({...t,datasourceUid:u.uid}),current:t.datasourceUid})))},Yt=a=>({infoText:m.css`
    padding-bottom: ${a.spacing(2)};
    color: ${a.colors.text.secondary};
  `,derivedField:m.css`
    margin-bottom: ${a.spacing(1)};
  `}),Xt=({value:a=[],onChange:t})=>{const s=(0,F.l4)(),l=Yt(s),[n,i]=(0,e.useState)(!1);return e.createElement(e.Fragment,null,e.createElement("h3",{className:"page-heading"},"Derived fields"),e.createElement("div",{className:l.infoText},"Derived fields can be used to extract new fields from a log message and create a link from its value."),e.createElement("div",{className:"gf-form-group"},a.map((c,o)=>e.createElement(Zt,{className:l.derivedField,key:o,value:c,onChange:d=>{const g=[...a];g.splice(o,1,d),t(g)},onDelete:()=>{const d=[...a];d.splice(o,1),t(d)},suggestions:[{value:Pt.W.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:Bt.L.Value}]})),e.createElement("div",null,e.createElement(C.zx,{variant:"secondary",className:m.css`
              margin-right: 10px;
            `,icon:"plus",onClick:c=>{c.preventDefault();const o=[...a,{name:"",matcherRegex:""}];t(o)}},"Add"),a.length>0&&e.createElement(C.zx,{variant:"secondary",type:"button",onClick:()=>i(!n)},n?"Hide example log message":"Show example log message"))),n&&e.createElement("div",{className:"gf-form-group"},e.createElement(It,{className:m.css`
              margin-bottom: 10px;
            `,derivedFields:a})))},{FormField:Jt}=ye.LegacyForms,qt=a=>{const{value:t,onChange:s}=a;return e.createElement(Jt,{label:"Maximum lines",labelWidth:11,inputWidth:20,inputEl:e.createElement("input",{type:"number",className:"gf-form-input width-8 gf-form-input--has-help-icon",value:t,onChange:l=>s(l.currentTarget.value),spellCheck:!1,placeholder:"1000"}),tooltip:e.createElement(e.Fragment,null,"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results.")})},Re=a=>(t,s)=>({...t,jsonData:{...t.jsonData,[a]:s}}),_t=Re("maxLines"),ea=Re("derivedFields"),ta=a=>{const{options:t,onOptionsChange:s}=a;return e.createElement(e.Fragment,null,e.createElement(wt.E,{defaultUrl:"http://localhost:3100",dataSourceConfig:t,showAccessOptions:!1,onChange:s}),Ft.v.featureToggles.secureSocksDatasourceProxy&&e.createElement(kt.i,{options:t,onOptionsChange:s}),e.createElement(Tt.O,{options:t,onOptionsChange:s}),e.createElement("div",{className:"gf-form-group"},e.createElement("div",{className:"gf-form-inline"},e.createElement("div",{className:"gf-form"},e.createElement(qt,{value:t.jsonData.maxLines||"",onChange:l=>s(_t(t,l))})))),e.createElement(Xt,{value:t.jsonData.derivedFields,onChange:l=>s(ea(t,l))}))};var aa=r(72881),sa=r(32920);const la=new O.hf(aa.KV).setQueryEditor(Mt).setConfigEditor(ta).setQueryEditorHelp(q);(0,Y.N$)().subscribe(M.Pl,sa.u)}}]);

//# sourceMappingURL=3320.254e064030ce8c770718.js.map