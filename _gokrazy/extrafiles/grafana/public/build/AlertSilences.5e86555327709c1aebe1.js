"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1783],{8572:(U,M,t)=>{t.r(M),t.d(M,{default:()=>Dt});var e=t(68404),m=t(70356),c=t(2323),u=t(78758),v=t(81168),R=t(30173),T=t(79572),I=t(94984),B=t(45524),W=t(731),b=t(88331),r=t(52423),Q=t(82897),N=t(59052),V=t(70197),$=t(37556),s=t(69311),f=t(46519),A=t(93003),h=t(29516),L=t(65587),D=t(74955),P=t(25474),G=t(79090),Y=t(90723),q=t(40014),z=t(39031),ae=t(31808),Z=t(79370),H=t(72004),F=t(20194),ie=t(66367),w=t(10505),re=t(46818),De=t(68884),Me=t(61627),Ce=t(79662),de=t(52694),me=t(53731),Se=t(45608);const Pe=()=>{const[a,n]=(0,e.useState)([]),o=(0,N.Gc)(),i=(0,v.useDispatch)(),{watch:g}=o,y=g("matchers"),l=(0,h.wW)(xe),p=Re();(0,e.useEffect)(()=>{i((0,H.ei)())},[i]);const d=(0,Me.Zo)();return(0,V.Z)(()=>{const C=d.flatMap(E=>E.groups.flatMap(x=>x.rules.map(S=>S.promRule).filter(S=>(0,Ce.x_)(S)).flatMap(S=>(0,ie.TZ)(S.alerts??[],y))));n(C)},500,[d,y]),e.createElement("div",null,e.createElement("h4",{className:l.title},"Affected alert instances",a.length>0?e.createElement(De.C,{className:l.badge,color:"blue",text:a.length}):null),e.createElement("div",{className:l.table},y.every(C=>!C.value&&!C.name)?e.createElement("span",null,"Add a valid matcher to see affected alerts"):e.createElement(e.Fragment,null,e.createElement(me.t,{items:a.slice(0,5)??[],isExpandable:!1,cols:p}),a.length>5&&e.createElement("div",{className:l.moreMatches},"and ",a.length-5," more"))))};function Re(){return[{id:"state",label:"State",renderCell:function({data:{matchedInstance:n}}){return e.createElement(Se.l,{state:n.state})},size:"160px"},{id:"labels",label:"Labels",renderCell:function({data:{matchedInstance:n}}){return e.createElement(de.s,{labels:n.labels})},size:"250px"},{id:"created",label:"Created",renderCell:function({data:{matchedInstance:n}}){return e.createElement(e.Fragment,null,n.activeAt.startsWith("0001")?"-":(0,f.CQ)(n.activeAt).format("YYYY-MM-DD HH:mm:ss"))},size:"400px"}]}const xe=a=>({table:r.css`
    max-width: ${a.breakpoints.values.lg}px;
  `,moreMatches:r.css`
    margin-top: ${a.spacing(1)};
  `,title:r.css`
    display: flex;
    align-items: center;
  `,badge:r.css`
    margin-left: ${a.spacing(1)};
  `});var Oe=t(11017),Te=t(46739),Ie=t(20017);const Be=({className:a})=>{const n=(0,h.wW)(We),o=(0,N.Gc)(),{control:i,register:g,formState:{errors:y}}=o,{fields:l=[],append:p,remove:d}=(0,N.Dq)({name:"matchers"});return e.createElement("div",{className:(0,r.cx)(a,n.wrapper)},e.createElement(D.g,{label:"Matching labels",required:!0},e.createElement("div",null,e.createElement("div",{className:n.matchers},l.map((C,E)=>e.createElement("div",{className:n.row,key:`${C.id}`,"data-testid":"matcher"},e.createElement(D.g,{label:"Label",invalid:!!y?.matchers?.[E]?.name,error:y?.matchers?.[E]?.name?.message},e.createElement(P.I,{...g(`matchers.${E}.name`,{required:{value:!0,message:"Required."}}),defaultValue:C.name,placeholder:"label"})),e.createElement(D.g,{label:"Operator"},e.createElement(Oe.g,{control:i,render:({field:{onChange:x,ref:S,...O}})=>e.createElement(Te.Ph,{...O,onChange:_=>x(_.value),className:n.matcherOptions,options:F.tA,"aria-label":"operator"}),defaultValue:C.operator||F.tA[0].value,name:`matchers.${E}.operator`,rules:{required:{value:!0,message:"Required."}}})),e.createElement(D.g,{label:"Value",invalid:!!y?.matchers?.[E]?.value,error:y?.matchers?.[E]?.value?.message},e.createElement(P.I,{...g(`matchers.${E}.value`,{required:{value:!0,message:"Required."}}),defaultValue:C.value,placeholder:"value"})),l.length>1&&e.createElement(Ie.h,{className:n.removeButton,tooltip:"Remove matcher",name:"trash-alt",onClick:()=>d(E)},"Remove")))),e.createElement(Y.zx,{type:"button",icon:"plus",variant:"secondary",onClick:()=>{const C={name:"",value:"",operator:z._M.equal};p(C)}},"Add matcher"))))},We=a=>({wrapper:r.css`
      margin-top: ${a.spacing(2)};
    `,row:r.css`
      display: flex;
      align-items: flex-start;
      flex-direction: row;
      background-color: ${a.colors.background.secondary};
      padding: ${a.spacing(1)} ${a.spacing(1)} 0 ${a.spacing(1)};
      & > * + * {
        margin-left: ${a.spacing(2)};
      }
    `,removeButton:r.css`
      margin-left: ${a.spacing(1)};
      margin-top: ${a.spacing(2.5)};
    `,matcherOptions:r.css`
      min-width: 140px;
    `,matchers:r.css`
      max-width: ${a.breakpoints.values.sm}px;
      margin: ${a.spacing(1)} 0;
      padding-top: ${a.spacing(.5)};
    `}),be=Be;var Ne=t(77592);const Le=()=>{const{control:a,getValues:n}=(0,N.Gc)(),{field:{onChange:o,value:i},fieldState:{invalid:g}}=(0,N.bc)({name:"startsAt",control:a,rules:{validate:O=>n().endsAt>O}}),{field:{onChange:y,value:l},fieldState:{invalid:p}}=(0,N.bc)({name:"endsAt",control:a,rules:{validate:O=>n().startsAt<O}}),{field:{onChange:d,value:C}}=(0,N.bc)({name:"timeZone",control:a}),E=g||p,x=(0,f.CQ)(i),S=(0,f.CQ)(l);return e.createElement(D.g,{className:$e.timeRange,label:"Silence start and end",error:E?"To is before or the same as from":"",invalid:E},e.createElement(Ne.K,{value:{from:x,to:S,raw:{from:x,to:S}},timeZone:C,onChange:O=>{o((0,f.CQ)(O.from)),y((0,f.CQ)(O.to))},onChangeTimeZone:O=>d(O),hideTimeZone:!1,hideQuickRanges:!0,placeholder:"Select time range"}))},$e={timeRange:r.css`
    width: 400px;
  `},Ke=a=>{const n={},o=a.get("comment"),i=a.getAll("matcher"),g=(0,ie.RT)(i);return g.length&&(n.matchers=g.map(F.cm)),o&&(n.comment=o),n},Ue=(a,n)=>{const o=new Date;if(n){const g=Date.parse(n.endsAt)<Date.now()?{start:o,end:(0,$.Ks)(o,{hours:2})}:{start:new Date(n.startsAt),end:new Date(n.endsAt)};return{id:n.id,startsAt:g.start.toISOString(),endsAt:g.end.toISOString(),comment:n.comment,createdBy:n.createdBy,duration:(0,$.vT)(g),isRegex:!1,matchers:n.matchers?.map(F.cm)||[],matcherName:"",matcherValue:"",timeZone:s.Ys}}else{const i=(0,$.Ks)(o,{hours:2});return{id:"",startsAt:o.toISOString(),endsAt:i.toISOString(),comment:`created ${(0,f.CQ)().format("YYYY-MM-DD HH:mm")}`,createdBy:A.v.bootData.user.name,duration:"2h",isRegex:!1,matchers:[{name:"",value:"",operator:z._M.equal}],matcherName:"",matcherValue:"",timeZone:s.Ys,...Ke(a)}}},Qe=({silence:a,alertManagerSourceName:n})=>{const[o]=(0,ae.j)(),i=(0,e.useMemo)(()=>Ue(o,a),[a,o]),g=(0,N.cI)({defaultValues:i}),y=(0,v.useDispatch)(),l=(0,h.wW)(ze),{loading:p}=(0,Z._)(J=>J.updateSilence);(0,q.x)(J=>J.unifiedAlerting.updateSilence=re.oq);const{register:d,handleSubmit:C,formState:E,watch:x,setValue:S,clearErrors:O}=g,_=J=>{const{id:Ae,startsAt:se,endsAt:Ct,comment:St,createdBy:Pt,matchers:Rt}=J,xt=Rt.map(F._J),ye=(0,Q.pickBy)({id:Ae,startsAt:se,endsAt:Ct,comment:St,createdBy:Pt,matchers:xt},Ot=>!!Ot);y((0,H.QY)({alertManagerSourceName:n,payload:ye,exitOnSave:!0,successMessage:`Silence ${ye.id?"updated":"created"}`}))},j=x("duration"),k=x("startsAt"),X=x("endsAt"),[K,ee]=(0,e.useState)(j);(0,V.Z)(()=>{if((0,$.qb)(k)&&(0,$.qb)(X))if(j!==K)S("endsAt",(0,f.CQ)((0,$.Ks)(new Date(k),(0,$.RA)(j))).toISOString()),ee(j);else{const J=new Date(k).valueOf();if(new Date(X).valueOf()>J){const se=(0,$.vT)({start:new Date(k),end:new Date(X)});S("duration",se),ee(se)}}},700,[O,j,X,K,S,k]);const Mt=Boolean(A.v.bootData.user.isSignedIn&&A.v.bootData.user.name);return e.createElement(N.RV,{...g},e.createElement("form",{onSubmit:C(_)},e.createElement(L.C,{label:`${a?"Recreate silence":"Create silence"}`},e.createElement("div",{className:(0,r.cx)(l.flexRow,l.silencePeriod)},e.createElement(Le,null),e.createElement(D.g,{label:"Duration",invalid:!!E.errors.duration,error:E.errors.duration&&(E.errors.duration.type==="required"?"Required field":E.errors.duration.message)},e.createElement(P.I,{className:l.createdBy,...d("duration",{validate:J=>Object.keys((0,$.RA)(J)).length===0?"Invalid duration. Valid example: 1d 4h (Available units: y, M, w, d, h, m, s)":void 0}),id:"duration"}))),e.createElement(be,null),e.createElement(D.g,{className:(0,r.cx)(l.field,l.textArea),label:"Comment",required:!0,error:E.errors.comment?.message,invalid:!!E.errors.comment},e.createElement(G.K,{...d("comment",{required:{value:!0,message:"Required."}}),rows:5,placeholder:"Details about the silence"})),!Mt&&e.createElement(D.g,{className:(0,r.cx)(l.field,l.createdBy),label:"Created By",required:!0,error:E.errors.createdBy?.message,invalid:!!E.errors.createdBy},e.createElement(P.I,{...d("createdBy",{required:{value:!0,message:"Required."}}),placeholder:"Who's creating the silence"})),e.createElement(Pe,null)),e.createElement("div",{className:l.flexRow},p&&e.createElement(Y.zx,{disabled:!0,icon:"fa fa-spinner",variant:"primary"},"Saving..."),!p&&e.createElement(Y.zx,{type:"submit"},"Submit"),e.createElement(Y.Qj,{href:(0,w.eQ)("alerting/silences",n),variant:"secondary",fill:"outline"},"Cancel"))))},ze=a=>({field:r.css`
    margin: ${a.spacing(1,0)};
  `,textArea:r.css`
    max-width: ${a.breakpoints.values.sm}px;
  `,createdBy:r.css`
    width: 200px;
  `,flexRow:r.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;

    & > * {
      margin-right: ${a.spacing(1)};
    }
  `,silencePeriod:r.css`
    max-width: ${a.breakpoints.values.sm}px;
  `}),ue=Qe;var ne=t(21053),ge=t(26418),Ee=t(90031),le=t(81697),oe=t(96044),te=t(82002),ce=t(97953),Fe=t(51981);const fe=({className:a,...n})=>{const o=(0,h.wW)(Ge);return e.createElement(Y.zx,{variant:"secondary",size:"xs",className:(0,r.cx)(o.wrapper,a),...n})},Ge=a=>({wrapper:r.css`
    height: 24px;
    font-size: ${a.typography.bodySmall.fontSize};
  `});var Ye=t(65750),Ve=t(99631),Ze=t(86373),je=t(69142);const He=({alertManagerSourceName:a})=>{const n=(0,ce.QX)(a);return te.Vt.hasAccess(n.create,te.Vt.isEditor)?e.createElement(je.Z,{title:"You haven't created any silences yet",buttonIcon:"bell-slash",buttonLink:(0,w.eQ)("alerting/silence/new",a),buttonTitle:"New silence"}):e.createElement(Ze._,{callToActionElement:e.createElement("div",null),message:"No silences found."})};var Je=t(85655),we=t(33950),Xe=t(90072);const ke=({alert:a,className:n})=>{const[o,i]=(0,e.useState)(!0),g=(0,$.vT)({start:new Date(a.startsAt),end:new Date(a.endsAt)}),y=Object.entries(a.labels).reduce((l,[p,d])=>((p==="alertname"||p==="__alert_rule_title__")&&(l=d),l),"");return e.createElement(e.Fragment,null,e.createElement("tr",{className:n},e.createElement("td",null,e.createElement(we.U,{isCollapsed:o,onToggle:l=>i(l)})),e.createElement("td",null,e.createElement(Xe.G,{state:a.status.state})),e.createElement("td",null,"for ",g," seconds"),e.createElement("td",null,y)),!o&&e.createElement("tr",{className:n},e.createElement("td",null),e.createElement("td",{colSpan:5},e.createElement(de.s,{labels:a.labels}))))},qe=({silencedAlerts:a})=>{const n=(0,h.wW)(Je.D),o=(0,h.wW)(_e);return a.length?e.createElement("table",{className:(0,r.cx)(n.table,o.tableMargin)},e.createElement("colgroup",null,e.createElement("col",{className:n.colExpand}),e.createElement("col",{className:o.colState}),e.createElement("col",null),e.createElement("col",{className:o.colName})),e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"State"),e.createElement("th",null),e.createElement("th",null,"Alert name"))),e.createElement("tbody",null,a.map((i,g)=>e.createElement(ke,{key:i.fingerprint,alert:i,className:g%2===0?n.evenRow:""})))):null},_e=a=>({tableMargin:r.css`
    margin-bottom: ${a.spacing(1)};
  `,colState:r.css`
    width: 110px;
  `,colName:r.css`
    width: 65%;
  `}),et=qe,tt=({silence:a})=>{const{startsAt:n,endsAt:o,comment:i,createdBy:g,silencedAlerts:y}=a,l=(0,h.wW)(at),p="YYYY-MM-DD HH:mm",d=ne.parse(n),C=ne.parse(o),E=(0,$.vT)({start:new Date(n),end:new Date(o)});return e.createElement("div",{className:l.container},e.createElement("div",{className:l.title},"Comment"),e.createElement("div",null,i),e.createElement("div",{className:l.title},"Schedule"),e.createElement("div",null,`${d?.format(p)} - ${C?.format(p)}`),e.createElement("div",{className:l.title},"Duration"),e.createElement("div",null," ",E),e.createElement("div",{className:l.title},"Created by"),e.createElement("div",null," ",g),e.createElement("div",{className:l.title},"Affected alerts"),e.createElement(et,{silencedAlerts:y}))},at=a=>({container:r.css`
    display: grid;
    grid-template-columns: 1fr 9fr;
    grid-row-gap: 1rem;
  `,title:r.css`
    color: ${a.colors.text.primary};
  `,row:r.css`
    margin: ${a.spacing(1,0)};
  `});var nt=t(79453);const st={[z.As.Active]:"good",[z.As.Expired]:"neutral",[z.As.Pending]:"neutral"},rt=({state:a})=>e.createElement(nt.i,{state:st[a]},a);var lt=t(38835),ot=t(48756),ct=t(318);const it=Object.entries(z.As).map(([a,n])=>({label:a,value:n})),ve=()=>(0,Q.uniqueId)("query-string-"),dt=()=>{const[a,n]=(0,e.useState)(ve()),[o,i]=(0,oe.K)(),{queryString:g,silenceState:y}=(0,w.pF)(o),l=(0,h.wW)(mt),p=(0,Q.debounce)(x=>{const S=x.target;i({queryString:S.value||null})},400),d=x=>{i({silenceState:x})},C=()=>{i({queryString:null,silenceState:null}),setTimeout(()=>n(ve()))},E=g&&g.length>3?(0,F.Zh)(g).length===0:!1;return e.createElement("div",{className:l.flexRow},e.createElement(D.g,{className:l.rowChild,label:e.createElement(lt._,null,e.createElement(ge.Stack,{gap:.5},e.createElement("span",null,"Search by matchers"),e.createElement(ot.u,{content:e.createElement("div",null,"Filter silences by matchers using a comma separated list of matchers, ie:",e.createElement("pre",null,"severity=critical, instance=~cluster-us-.+"))},e.createElement(le.J,{name:"info-circle",size:"sm"})))),invalid:E,error:E?"Query must use valid matcher syntax":null},e.createElement(P.I,{key:a,className:l.searchInput,prefix:e.createElement(le.J,{name:"search"}),onChange:p,defaultValue:g??"",placeholder:"Search","data-testid":"search-query-input"})),e.createElement(D.g,{className:l.rowChild,label:"State"},e.createElement(ct.S,{options:it,value:y,onChange:d})),(g||y)&&e.createElement("div",{className:l.rowChild},e.createElement(Y.zx,{variant:"secondary",icon:"times",onClick:C},"Clear filters")))},mt=a=>({searchInput:r.css`
    width: 360px;
  `,flexRow:r.css`
    display: flex;
    flex-direction: row;
    align-items: flex-end;
    padding-bottom: ${a.spacing(2)};
    border-bottom: 1px solid ${a.colors.border.strong};
  `,rowChild:r.css`
    margin-right: ${a.spacing(1)};
    margin-bottom: 0;
    max-height: 52px;
  `,fieldLabel:r.css`
    font-size: 12px;
    font-weight: 500;
  `}),ut=({silences:a,alertManagerAlerts:n,alertManagerSourceName:o})=>{const i=(0,h.wW)(he),[g]=(0,oe.K)(),y=gt(a),l=(0,ce.QX)(o),{silenceState:p}=(0,w.pF)(g),d=!!y.length&&(p===void 0||p===z.As.Expired),C=Et(o),E=(0,e.useMemo)(()=>{const x=S=>n.filter(O=>O.status.silencedBy.includes(S));return y.map(S=>{const O=x(S.id);return{id:S.id,data:{...S,silencedAlerts:O}}})},[y,n]);return e.createElement("div",{"data-testid":"silences-table"},!!a.length&&e.createElement(e.Fragment,null,e.createElement(dt,null),e.createElement(Fe.q,{actions:[l.create],fallback:te.Vt.isEditor},e.createElement("div",{className:i.topButtonContainer},e.createElement(Ee.r,{href:(0,w.eQ)("/alerting/silence/new",o)},e.createElement(Y.zx,{className:i.addNewSilence,icon:"plus"},"New Silence")))),E.length?e.createElement(e.Fragment,null,e.createElement(me.t,{items:E,cols:C,isExpandable:!0,renderExpandedContent:({data:x})=>e.createElement(tt,{silence:x})}),d&&e.createElement("div",{className:i.callout},e.createElement(le.J,{className:i.calloutIcon,name:"info-circle"}),e.createElement("span",null,"Expired silences are automatically deleted after 5 days."))):"No matching silences found"),!a.length&&e.createElement(He,{alertManagerSourceName:o}))},gt=a=>{const[n]=(0,oe.K)();return(0,e.useMemo)(()=>{const{queryString:o,silenceState:i}=(0,w.pF)(n),g=n?.silenceIds;return a.filter(y=>!(typeof g=="string"&&!g.split(",").includes(y.id)||o&&!(0,F.Zh)(o).every(d=>y.matchers?.some(({name:C,value:E,isEqual:x,isRegex:S})=>d.name===C&&d.value===E&&d.isEqual===x&&d.isRegex===S))||i&&!(y.status.state===i)))},[n,a])},he=a=>({topButtonContainer:r.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-end;
  `,addNewSilence:r.css`
    margin: ${a.spacing(2,0)};
  `,callout:r.css`
    background-color: ${a.colors.background.secondary};
    border-top: 3px solid ${a.colors.info.border};
    border-radius: 2px;
    height: 62px;
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-top: ${a.spacing(2)};

    & > * {
      margin-left: ${a.spacing(1)};
    }
  `,calloutIcon:r.css`
    color: ${a.colors.info.text};
  `,editButton:r.css`
    margin-left: ${a.spacing(.5)};
  `});function Et(a){const n=(0,v.useDispatch)(),o=(0,h.wW)(he),i=(0,ce.QX)(a);return(0,e.useMemo)(()=>{const g=p=>{n((0,H.yO)(a,p))},y=te.Vt.hasAccess(i.update,te.Vt.isEditor),l=[{id:"state",label:"State",renderCell:function({data:{status:d}}){return e.createElement(rt,{state:d.state})},size:4},{id:"matchers",label:"Matching labels",renderCell:function({data:{matchers:d}}){return e.createElement(Ve.g,{matchers:d||[]})},size:10},{id:"alerts",label:"Alerts",renderCell:function({data:{silencedAlerts:d}}){return e.createElement("span",{"data-testid":"alerts"},d.length)},size:4},{id:"schedule",label:"Schedule",renderCell:function({data:{startsAt:d,endsAt:C}}){const E=ne.parse(d),x=ne.parse(C),S="YYYY-MM-DD HH:mm";return e.createElement(e.Fragment,null," ",E?.format(S)," ","-",x?.format(S))},size:7}];return y&&l.push({id:"actions",label:"Actions",renderCell:function({data:d}){return e.createElement(ge.Stack,{gap:.5},d.status.state==="expired"?e.createElement(Ee.r,{href:(0,w.eQ)(`/alerting/silence/${d.id}/edit`,a)},e.createElement(fe,{icon:"sync"},"Recreate")):e.createElement(fe,{icon:"bell",onClick:()=>g(d.id)},"Unsilence"),d.status.state!=="expired"&&e.createElement(Ye.A,{className:o.editButton,to:(0,w.eQ)(`/alerting/silence/${d.id}/edit`,a),icon:"pen",tooltip:"edit"}))},size:5}),l},[a,n,o,i])}const ft=ut;var vt=t(29614),ht=t(23403);const pe={icon:"bell-slash",breadcrumbs:[{title:"Silences",url:"alerting/silences"}]};function pt(){const{isExact:a,path:n}=(0,m.$B)(),[o,i]=(0,e.useState)();return(0,e.useEffect)(()=>{n==="/alerting/silence/new"?i({...pe,id:"silence-new",text:"Add silence"}):n==="/alerting/silence/:id/edit"&&i({...pe,id:"silence-edit",text:"Edit silence"})},[n,a]),o}var At=t(37190);const yt=()=>{const a=(0,ht.k)("instance"),[n,o]=(0,vt.k)(a),i=(0,v.useDispatch)(),{useGetAlertmanagerChoiceQuery:g}=R.h,y=(0,Z._)(K=>K.silences),l=(0,Z._)(K=>K.amAlerts),p=n?l[n]||re.oq:void 0,d=(0,m.TH)(),C=pt(),E=d.pathname.endsWith("/alerting/silences"),{currentData:x}=T.T.useDiscoverAmFeaturesQuery({amSourceName:n??""},{skip:!n}),{currentData:S}=g();(0,e.useEffect)(()=>{function K(){n&&(i((0,H.je)(n)),i((0,H.dB)(n)))}K();const ee=setInterval(()=>K,At.cm);return()=>{clearInterval(ee)}},[n,i]);const{result:O,loading:_,error:j}=n&&y[n]||re.oq,k=(0,e.useCallback)(K=>O&&O.find(ee=>ee.id===K),[O]),X=j?.message?.includes("the Alertmanager is not configured")&&x?.lazyConfigInit;return n?e.createElement(B.J,{pageId:"silences",isLoading:_,pageNav:C},e.createElement(I.P,{disabled:!E,current:n,onChange:o,dataSources:a}),e.createElement(W.u,{currentAlertmanager:n,alertmanagerChoice:S}),X&&e.createElement(c.b,{title:"The selected Alertmanager has no configuration",severity:"warning"},"Create a new contact point to create a configuration using the default values or contact your administrator to set up the Alertmanager."),j&&!_&&!X&&e.createElement(c.b,{severity:"error",title:"Error loading silences"},j.message||"Unknown error."),p?.error&&!p?.loading&&!X&&e.createElement(c.b,{severity:"error",title:"Error loading Alertmanager alerts"},p.error?.message||"Unknown error."),O&&!j&&e.createElement(m.rs,null,e.createElement(m.AW,{exact:!0,path:"/alerting/silences"},e.createElement(ft,{silences:O,alertManagerAlerts:p?.result??[],alertManagerSourceName:n})),e.createElement(m.AW,{exact:!0,path:"/alerting/silence/new"},e.createElement(ue,{alertManagerSourceName:n})),e.createElement(m.AW,{exact:!0,path:"/alerting/silence/:id/edit"},({match:K})=>K?.params.id&&e.createElement(ue,{silence:k(K.params.id),alertManagerSourceName:n})))):E?e.createElement(B.J,{pageId:"silences",pageNav:C},e.createElement(b.I,{availableAlertManagers:a})):e.createElement(m.l_,{to:"/alerting/silences"})},Dt=(0,u.Pf)(yt,{style:"page"})},30173:(U,M,t)=>{t.d(M,{h:()=>m});var e=t(29427);const m=e.C.injectEndpoints({endpoints:c=>({getAlertmanagerChoice:c.query({query:()=>({url:"/api/v1/ngalert"}),providesTags:["AlertmanagerChoice"],transformResponse:u=>u.alertmanagersChoice}),getExternalAlertmanagerConfig:c.query({query:()=>({url:"/api/v1/ngalert/admin_config"}),providesTags:["AlertmanagerChoice"]}),getExternalAlertmanagers:c.query({query:()=>({url:"/api/v1/ngalert/alertmanagers"}),transformResponse:u=>u.data}),saveExternalAlertmanagersConfig:c.mutation({query:u=>({url:"/api/v1/ngalert/admin_config",method:"POST",data:u}),invalidatesTags:["AlertmanagerChoice"]})})})},45524:(U,M,t)=>{t.d(M,{J:()=>c});var e=t(68404),m=t(79396);const c=({children:u,pageId:v,pageNav:R,isLoading:T})=>e.createElement(m.T,{pageNav:R,navId:v},e.createElement(m.T.Contents,{isLoading:T},u))},51981:(U,M,t)=>{t.d(M,{q:()=>c});var e=t(68404),m=t(82002);const c=({actions:u,children:v,fallback:R=!0})=>u.some(T=>m.Vt.hasAccess(T,R))?e.createElement(e.Fragment,null,v):null},731:(U,M,t)=>{t.d(M,{u:()=>T});var e=t(52423),m=t(68404),c=t(29516),u=t(2323),v=t(39031),R=t(45849);function T({alertmanagerChoice:B,currentAlertmanager:W}){const b=(0,c.wW)(I);return W!==R.GC||B!==v.TE.External?null:m.createElement(u.b,{title:"Grafana alerts are not delivered to Grafana Alertmanager"},"Grafana is configured to send alerts to external Alertmanagers only. Changing Grafana Alertmanager configuration will not affect delivery of your alerts!",m.createElement("div",{className:b.adminHint},"You can change the configuration on the Alerting Admin page. If you do not have access, contact your Administrator"))}const I=B=>({adminHint:e.css`
    font-size: ${B.typography.bodySmall.fontSize};
    font-weight: ${B.typography.bodySmall.fontWeight};
  `})},88331:(U,M,t)=>{t.d(M,{I:()=>T});var e=t(68404),m=t(2323),c=t(29614),u=t(94984);const v=()=>e.createElement(m.b,{title:"No Alertmanager found",severity:"warning"},"We could not find any external Alertmanagers and you may not have access to the built-in Grafana Alertmanager."),R=()=>e.createElement(m.b,{title:"Selected Alertmanager not found. Select a different Alertmanager.",severity:"warning"},"Selected Alertmanager no longer exists or you may not have permission to access it."),T=({availableAlertManagers:I})=>{const[B,W]=(0,c.k)(I),b=I.length>0;return e.createElement("div",null,b?e.createElement(e.Fragment,null,e.createElement(u.P,{onChange:W,dataSources:I}),e.createElement(R,null)):e.createElement(v,null))}},65750:(U,M,t)=>{t.d(M,{A:()=>u});var e=t(68404),m=t(48756),c=t(90723);const u=({tooltip:v,icon:R,to:T,target:I,onClick:B,className:W,tooltipPlacement:b="top",...r})=>{const Q=typeof v=="string"?v:void 0;return e.createElement(m.u,{content:v,placement:b},T?e.createElement(c.Qj,{variant:"secondary",fill:"text",icon:R,href:T,size:"sm",target:I,...r,"aria-label":Q}):e.createElement(c.zx,{className:W,variant:"secondary",fill:"text",size:"sm",icon:R,type:"button",onClick:B,...r,"aria-label":Q}))}},90072:(U,M,t)=>{t.d(M,{G:()=>v});var e=t(68404),m=t(39031),c=t(79453);const u={[m.Z9.Active]:"bad",[m.Z9.Unprocessed]:"neutral",[m.Z9.Suppressed]:"info"},v=({state:R})=>e.createElement(c.i,{state:u[R]},R)},99631:(U,M,t)=>{t.d(M,{g:()=>R});var e=t(52423),m=t(68404),c=t(29516),u=t(36012),v=t(20194);const R=({matchers:I})=>{const B=(0,c.wW)(T);return m.createElement("div",null,m.createElement(u.P,{className:B.tags,tags:I.map(W=>`${W.name}${(0,v.zy)(W)}${W.value}`)}))},T=()=>({tags:e.css`
    justify-content: flex-start;
  `})},29614:(U,M,t)=>{t.d(M,{k:()=>T});var e=t(68404),m=t(96044),c=t(58379),u=t(37190),v=t(45849);function R(I){return(0,e.useCallback)(B=>I.map(b=>b.name).includes(B),[I])}function T(I){const[B,W]=(0,m.K)(),b=R(I),r=(0,e.useCallback)(V=>{b(V)&&(V===v.GC?(c.Z.delete(u.de),W({[u.c4]:null})):(c.Z.set(u.de,V),W({[u.c4]:V})))},[W,b]),Q=B[u.c4];if(Q&&typeof Q=="string")return b(Q)?[Q,r]:[void 0,r];const N=c.Z.get(u.de);return N&&typeof N=="string"&&b(N)?(r(N),[N,r]):b(v.GC)?[v.GC,r]:[void 0,r]}},23403:(U,M,t)=>{t.d(M,{k:()=>c});var e=t(68404),m=t(45849);function c(u){return(0,e.useMemo)(()=>(0,m.LE)(u),[u])}},61627:(U,M,t)=>{t.d(M,{Kd:()=>I,Zo:()=>T});var e=t(82897),m=t.n(e),c=t(68404),u=t(45849),v=t(79662),R=t(79370);function T(s){const f=(0,R._)(D=>D.promRules),A=(0,R._)(D=>D.rulerRules),h=(0,c.useRef)({}),L=(0,c.useMemo)(()=>{if(s){const D=(0,u.o_)(s);if(!D)throw new Error(`Unknown rules source: ${s}`);return[D]}return(0,u.h_)()},[s]);return(0,c.useMemo)(()=>L.map(D=>{const P=(0,u.jq)(D)?D.name:D,G=f[P]?.result,Y=A[P]?.result,q=h.current[P];if(q&&q.promRules===G&&q.rulerRules===Y)return q.result;const z={};Object.entries(Y||{}).forEach(([Z,H])=>{const F={rulesSource:D,name:Z,groups:[]};z[Z]=F,W(F,H)}),G?.forEach(({name:Z,groups:H})=>{const F=z[Z]=z[Z]||{rulesSource:D,name:Z,groups:[]};b(F,H)});const ae=Object.values(z);return h.current[P]={promRules:G,rulerRules:Y,result:ae},ae}).flat(),[f,A,L])}function I(s){return s.map(f=>{const A={...f,groups:[]};return A.groups.push({name:"default",rules:B(f.groups.flatMap(h=>h.rules))}),A})}function B(s){return s.sort((f,A)=>f.name.localeCompare(A.name))}function W(s,f=[]){s.groups=f.map(A=>{const h={name:A.name,interval:A.interval,source_tenants:A.source_tenants,rules:[]};return h.rules=A.rules.map(L=>Q(L,s,h)),h})}function b(s,f){const A=new Map;s.groups.forEach(h=>A.set(h.name,h)),f.forEach(h=>{let L=A.get(h.name);L||(L={name:h.name,rules:[]},s.groups.push(L),A.set(h.name,L));const D=new Map;L.rules.forEach(P=>{const G=D.get(P.name);G?G.push(P):D.set(P.name,[P])}),(h.rules??[]).forEach(P=>{const G=N(P,D,s.rulesSource);G?G.promRule=P:L.rules.push(r(P,s,L))})})}function r(s,f,A){return{name:s.name,query:s.query,labels:s.labels||{},annotations:(0,v.x_)(s)?s.annotations||{}:{},promRule:s,namespace:f,group:A}}function Q(s,f,A){return(0,v.cG)(s)?{name:s.alert,query:s.expr,labels:s.labels||{},annotations:s.annotations||{},rulerRule:s,namespace:f,group:A}:(0,v.yF)(s)?{name:s.record,query:s.expr,labels:s.labels||{},annotations:{},rulerRule:s,namespace:f,group:A}:{name:s.grafana_alert.title,query:"",labels:s.labels||{},annotations:s.annotations||{},rulerRule:s,namespace:f,group:A}}function N(s,f,A){const h=f.get(s.name);if(!h)return;if((0,u.HY)(A))return h[0];const L=h.find(P=>!P.promRule&&V(P,s,!0));if(L)return L;const D=h.find(P=>!P.promRule&&V(P,s,!1));if(D)return D}function V(s,f,A=!0){return s.name===f.name?(0,e.isEqual)([A?$(s.query):"",s.labels,s.annotations],[A?$(f.query):"",f.labels||{},(0,v.x_)(f)?f.annotations||{}:{}]):!1}function $(s){return s.length>1&&s[0]==="("&&s[s.length-1]===")"&&(s=s.slice(1,-1)),s=s.replace(/\s|\n/g,""),s.split("").sort().join("")}},31808:(U,M,t)=>{t.d(M,{j:()=>u});var e=t(68404),m=t(70356),c=t(57388);function u(){const{search:v}=(0,m.TH)(),R=(0,e.useMemo)(()=>new URLSearchParams(v),[v]),T=(0,e.useCallback)((I,B)=>{c.E1.partial(I,B)},[]);return[R,T]}},85655:(U,M,t)=>{t.d(M,{D:()=>m});var e=t(52423);const m=c=>({table:e.css`
    width: 100%;
    border-radius: ${c.shape.borderRadius()};
    border: solid 1px ${c.colors.border.weak};
    background-color: ${c.colors.background.secondary};

    th {
      padding: ${c.spacing(1)};
    }

    td {
      padding: 0 ${c.spacing(1)};
    }

    tr {
      height: 38px;
    }
  `,evenRow:e.css`
    background-color: ${c.colors.background.primary};
  `,colExpand:e.css`
    width: 36px;
  `,actionsCell:e.css`
    text-align: right;
    width: 1%;
    white-space: nowrap;

    & > * + * {
      margin-left: ${c.spacing(.5)};
    }
  `})}}]);

//# sourceMappingURL=AlertSilences.5e86555327709c1aebe1.js.map