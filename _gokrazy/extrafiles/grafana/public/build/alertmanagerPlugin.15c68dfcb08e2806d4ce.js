(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6795],{98548:(T,h,d)=>{"use strict";d.r(h),d.d(h,{plugin:()=>n});var f=d(7238),O=d(64421),u=d(68404),a=d(37308),l=d(49371),D=d(46739),F=d(71210),N=d(44727),I=d(32695),K=d(47694),j=d(39031);const P=[{value:j.sK.mimir,label:"Mimir",description:"https://grafana.com/oss/mimir/. An open source, horizontally scalable, highly available, multi-tenant, long-term storage for Prometheus."},{value:j.sK.cortex,label:"Cortex",description:"https://cortexmetrics.io/"},{value:j.sK.prometheus,label:"Prometheus",description:"https://prometheus.io/. Does not support editing configuration via API, so contact points and notification policies are read-only."}],M=o=>{const{options:t,onOptionsChange:r}=o;return u.createElement(u.Fragment,null,u.createElement("h3",{className:"page-heading"},"Alertmanager"),u.createElement("div",{className:"gf-form-group"},u.createElement("div",{className:"gf-form-inline"},u.createElement("div",{className:"gf-form"},u.createElement(l.c,{width:13},"Implementation"),u.createElement(D.Ph,{width:40,options:P,value:t.jsonData.implementation||j.sK.mimir,onChange:i=>r({...t,jsonData:{...t.jsonData,implementation:i.value}})}))),u.createElement("div",{className:"gf-form-inline"},u.createElement(F._,{label:"Receive Grafana Alerts",tooltip:"When enabled, Grafana-managed alerts are sent to this Alertmanager.",labelWidth:26},u.createElement(N.x,{value:t.jsonData.handleGrafanaManagedAlerts??!1,onChange:i=>{r((0,O.ZP)(t,g=>{g.jsonData.handleGrafanaManagedAlerts=i.currentTarget.checked}))}})))),u.createElement(I.E,{defaultUrl:"",dataSourceConfig:t,showAccessOptions:!0,onChange:r,sigV4AuthToggleEnabled:K.vc.sigV4AuthEnabled,renderSigV4Editor:u.createElement(a.SIGV4ConnectionConfig,{...o})}))};var J=d(53786),S=d(3363),W=d(47214),B=d(44737),e=d(46818);class s extends f.MF{constructor(t){super(t),this.instanceSettings=t}query(){return(0,J.of)({data:[]})}_request(t){const r={headers:{},method:"GET",url:this.instanceSettings.url+t};return(this.instanceSettings.basicAuth||this.instanceSettings.withCredentials)&&(this.instanceSettings.withCredentials=!0),this.instanceSettings.basicAuth&&(r.headers.Authorization=this.instanceSettings.basicAuth),(0,S.n)((0,W.i)().fetch(r))}async testDatasource(){let t;const r=this.instanceSettings.url,i=r?await(0,B.SJ)(r):{lazyConfigInit:!1};if(this.instanceSettings.jsonData.implementation===j.sK.prometheus){try{if(t=await this._request("/alertmanager/api/v2/status"),t&&t?.status===200)return{status:"error",message:"It looks like you have chosen Prometheus implementation, but detected a Mimir or Cortex endpoint. Please update implementation selection and try again."}}catch{}try{t=await this._request("/api/v2/status")}catch{}}else{try{if(t=await this._request("/api/v2/status"),t&&t?.status===200)return{status:"error",message:"It looks like you have chosen a Mimir or Cortex implementation, but detected a Prometheus endpoint. Please update implementation selection and try again."}}catch{}try{t=await this._request("/alertmanager/api/v2/status")}catch(g){if((0,W.kW)(g)&&i.lazyConfigInit&&(0,e.kk)(g)?.includes("the Alertmanager is not configured"))return{status:"success",message:"Health check passed.",details:{message:"Mimir Alertmanager without the fallback configuration has been discovered."}}}}return t?.status===200?{status:"success",message:"Health check passed."}:{status:"error",message:"Health check failed."}}}const n=new f.hf(s).setConfigEditor(M)},77172:(T,h,d)=>{var f;f={value:!0};var O,u=d(68404),a=(O=u)&&typeof O=="object"&&"default"in O?O.default:O,l=d(84666),D=d(24034),F=d(82897);const N=["af-south-1","ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-southeast-1","ap-southeast-2","ca-central-1","cn-north-1","cn-northwest-1","eu-central-1","eu-north-1","eu-west-1","eu-west-2","eu-west-3","me-south-1","sa-east-1","us-east-1","us-east-2","us-gov-east-1","us-gov-west-1","us-iso-east-1","us-isob-east-1","us-west-1","us-west-2"];var I;(I=h._e||(h._e={})).Keys="keys",I.Credentials="credentials",I.Default="default",I.EC2IAMRole="ec2_iam_role",I.ARN="arn";const K=[{label:"Workspace IAM Role",value:h._e.EC2IAMRole},{label:"AWS SDK Default",value:h._e.Default},{label:"Access & secret key",value:h._e.Keys},{label:"Credentials file",value:h._e.Credentials}],j=e=>({value:e,label:e}),P=e=>{var s,n,o,t,r,i,g,m;const[v,p]=u.useState((e.standardRegions||N).map(j)),{loadRegions:y,onOptionsChange:A,skipHeader:w=!1,skipEndpoint:k=!1}=e,{labelWidth:C=28,options:c}=e;let E=c.jsonData.profile;E===void 0&&(E=c.database);const R=window.grafanaBootData.settings,V=u.useMemo(()=>{var b;return(b=R.awsAllowedAuthProviders)!==null&&b!==void 0?b:[h._e.Default,h._e.Keys,h._e.Credentials]},[R.awsAllowedAuthProviders]),L=(s=R.awsAssumeRoleEnabled)===null||s===void 0||s,U=K.find(b=>b.value===c.jsonData.authType);return u.useEffect(()=>{!U&&V.length&&A(Object.assign(Object.assign({},c),{jsonData:Object.assign(Object.assign({},c.jsonData),{authType:V[0]})}))},[U,c,A,V]),u.useEffect(()=>{y&&y().then(b=>p(b.map(j)))},[y]),a.createElement(l.FieldSet,{label:w?"":"Connection Details","data-testid":"connection-config"},a.createElement(l.InlineField,{label:"Authentication Provider",labelWidth:C,tooltip:"Specify which AWS credentials chain to use."},a.createElement(l.Select,{"aria-label":"Authentication Provider",className:"width-30",value:U,options:K.filter(b=>V.includes(b.value)),defaultValue:c.jsonData.authType,onChange:b=>{D.onUpdateDatasourceJsonDataOptionSelect(e,"authType")(b)},menuShouldPortal:!0})),c.jsonData.authType==="credentials"&&a.createElement(l.InlineField,{label:"Credentials Profile Name",labelWidth:C,tooltip:"Credentials profile name, as specified in ~/.aws/credentials, leave blank for default."},a.createElement(l.Input,{"aria-label":"Credentials Profile Name",className:"width-30",placeholder:"default",value:E,onChange:D.onUpdateDatasourceJsonDataOption(e,"profile")})),c.jsonData.authType==="keys"&&a.createElement(a.Fragment,null,a.createElement(l.InlineField,{label:"Access Key ID",labelWidth:C},!((n=e.options.secureJsonFields)===null||n===void 0)&&n.accessKey?a.createElement(l.ButtonGroup,{className:"width-30"},a.createElement(l.Input,{disabled:!0,placeholder:"Configured"}),a.createElement(l.ToolbarButton,{icon:"edit",tooltip:"Edit Access Key ID",type:"button",onClick:D.onUpdateDatasourceResetOption(e,"accessKey")})):a.createElement(l.Input,{"aria-label":"Access Key ID",className:"width-30",value:(t=(o=c.secureJsonData)===null||o===void 0?void 0:o.accessKey)!==null&&t!==void 0?t:"",onChange:D.onUpdateDatasourceSecureJsonDataOption(e,"accessKey")})),a.createElement(l.InlineField,{label:"Secret Access Key",labelWidth:C},!((r=e.options.secureJsonFields)===null||r===void 0)&&r.secretKey?a.createElement(l.ButtonGroup,{className:"width-30"},a.createElement(l.Input,{disabled:!0,placeholder:"Configured"}),a.createElement(l.ToolbarButton,{icon:"edit",type:"button",tooltip:"Edit Secret Access Key",onClick:D.onUpdateDatasourceResetOption(e,"secretKey")})):a.createElement(l.Input,{"aria-label":"Secret Access Key",className:"width-30",value:(g=(i=c.secureJsonData)===null||i===void 0?void 0:i.secretKey)!==null&&g!==void 0?g:"",onChange:D.onUpdateDatasourceSecureJsonDataOption(e,"secretKey")}))),L&&a.createElement(a.Fragment,null,a.createElement(l.InlineField,{label:"Assume Role ARN",labelWidth:C,tooltip:"Optionally, specify the ARN of a role to assume. Specifying a role here will ensure that the selected authentication provider is used to assume the specified role rather than using the credentials directly. Leave blank if you don't need to assume a role at all"},a.createElement(l.Input,{"aria-label":"Assume Role ARN",className:"width-30",placeholder:"arn:aws:iam:*",value:c.jsonData.assumeRoleArn||"",onChange:D.onUpdateDatasourceJsonDataOption(e,"assumeRoleArn")})),a.createElement(l.InlineField,{label:"External ID",labelWidth:C,tooltip:"If you are assuming a role in another account, that has been created with an external ID, specify the external ID here."},a.createElement(l.Input,{"aria-label":"External ID",className:"width-30",placeholder:"External ID",value:c.jsonData.externalId||"",onChange:D.onUpdateDatasourceJsonDataOption(e,"externalId")}))),!k&&a.createElement(l.InlineField,{label:"Endpoint",labelWidth:C,tooltip:"Optionally, specify a custom endpoint for the service"},a.createElement(l.Input,{"aria-label":"Endpoint",className:"width-30",placeholder:(m=e.defaultEndpoint)!==null&&m!==void 0?m:"https://{service}.{region}.amazonaws.com",value:c.jsonData.endpoint||"",onChange:D.onUpdateDatasourceJsonDataOption(e,"endpoint")})),a.createElement(l.InlineField,{label:"Default Region",labelWidth:C,tooltip:"Specify the region, such as for US West (Oregon) use ` us-west-2 ` as the region."},a.createElement(l.Select,{"aria-label":"Default Region",className:"width-30",value:v.find(b=>b.value===c.jsonData.defaultRegion),options:v,defaultValue:c.jsonData.defaultRegion,allowCustomValue:!0,onChange:D.onUpdateDatasourceJsonDataOptionSelect(e,"defaultRegion"),formatCreateLabel:b=>"Use region: "+b,menuShouldPortal:!0})),e.children)};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function M(e,s,n,o){return new(n||(n=Promise))(function(t,r){function i(v){try{m(o.next(v))}catch(p){r(p)}}function g(v){try{m(o.throw(v))}catch(p){r(p)}}function m(v){var p;v.done?t(v.value):(p=v.value,p instanceof n?p:new n(function(y){y(p)})).then(i,g)}m((o=o.apply(e,s||[])).next())})}function J(e){const[s,n]=u.useState(e.value||e.default||null),[o,t]=u.useState(s?[s]:[]),[r,i]=u.useState(e.dependencies),[g,m]=u.useState(!1),[v,p]=u.useState(!1),y=u.useMemo(()=>{const c=[{label:`default (${e.default})`,value:"__default",description:"Default value set in the data source"}];return e.value&&e.value!=="__default"&&c.push({label:e.value,value:e.value}),c},[e.default,e.value]),[A,w]=u.useState(e.default?y:[]);u.useEffect(()=>{e.resources!==void 0&&t(e.resources)},[e.resources]),u.useEffect(()=>{const c=e.default?y:[];o.length?(o.forEach(E=>{const R=typeof E=="string"?E:E.value;c.find(V=>V.value===R)||(typeof E=="string"?c.push({label:E,value:E}):c.push(E))}),w(c)):w([])},[o,y,e.default]),u.useEffect(()=>{F.isEqual(e.dependencies,r)||(p(!1),n(null),e.onChange(null),i(e.dependencies))},[e,r]);const k=()=>M(this,void 0,void 0,function*(){if(!v){e.saveOptions&&(yield e.saveOptions());try{const c=yield e.fetch();t(c)}finally{p(!0)}}}),C=()=>M(this,void 0,void 0,function*(){m(!0);try{yield k()}finally{m(!1)}});return a.createElement(l.InlineField,{label:e.label,labelWidth:e.labelWidth,tooltip:e.tooltip,hidden:e.hidden},a.createElement("div",{"data-testid":e["data-testid"],title:e.title},a.createElement(l.Select,Object.assign({},e,{"aria-label":e.label,options:A,onChange:c=>{e.onChange(c),c.value&&n(c.value)},isLoading:g,className:e.className||"min-width-6",onOpenMenu:()=>e.fetch&&C(),menuShouldPortal:!0}))))}var S;(S=h.rB||(h.rB={}))[S.Previous=0]="Previous",S[S.Null=1]="Null",S[S.Value=2]="Value";const W=[{label:"Previous Value",value:h.rB.Previous},{label:"NULL",value:h.rB.Null},{label:"Value",value:h.rB.Value}];function B(e){return typeof e=="string"?e:e.map(s=>function(n){return"'"+String(n).replace(/'/g,"''")+"'"}(s)).join(",")}f=function(e){var s,n,o;const{jsonData:t}=e.options,r={title:t.defaultRegion?"":"select a default region",labelWidth:(s=e.labelWidth)!==null&&s!==void 0?s:28,className:"width-30"},i=[e.options.jsonData.assumeRoleArn,e.options.jsonData.authType,e.options.jsonData.defaultRegion,e.options.jsonData.endpoint,e.options.jsonData.externalId,e.options.jsonData.profile,(n=e.options.secureJsonData)===null||n===void 0?void 0:n.accessKey,(o=e.options.secureJsonData)===null||o===void 0?void 0:o.secretKey].concat(e.dependencies);return a.createElement(J,Object.assign({label:e.label,"data-testid":e["data-testid"],onChange:e.onChange,fetch:e.fetch,value:e.value,saveOptions:e.saveOptions,dependencies:i,hidden:e.hidden,disabled:e.disabled||!t.defaultRegion,allowCustomValue:e.allowCustomValue,autoFocus:e.autoFocus,backspaceRemovesValue:e.backspaceRemovesValue,className:e.className,invalid:e.invalid,isClearable:e.isClearable,isMulti:e.isMulti,inputId:e.inputId,showAllSelectedWhenOpen:e.showAllSelectedWhenOpen,maxMenuHeight:e.maxMenuHeight,minMenuHeight:e.minMenuHeight,maxVisibleValues:e.maxVisibleValues,menuPlacement:e.menuPlacement,menuPosition:e.menuPosition,noOptionsMessage:e.noOptionsMessage,onBlur:e.onBlur,onCreateOption:e.onCreateOption,onInputChange:e.onInputChange,placeholder:e.placeholder,width:e.width,isOptionDisabled:e.isOptionDisabled},r))},h.ConnectionConfig=P,f=function(e){var s,n,o;return a.createElement(a.Fragment,null,a.createElement(l.InlineField,{label:"Fill value",tooltip:"value to fill missing points"},a.createElement(l.Select,{"aria-label":"Fill value",options:W,value:(n=(s=e.query.fillMode)===null||s===void 0?void 0:s.mode)!==null&&n!==void 0?n:h.rB.Previous,onChange:({value:t})=>{var r;e.onChange(Object.assign(Object.assign({},e.query),{fillMode:Object.assign(Object.assign({},e.query.fillMode),{mode:t})})),(r=e.onRunQuery)===null||r===void 0||r.call(e)},className:"width-12",menuShouldPortal:!0})),((o=e.query.fillMode)===null||o===void 0?void 0:o.mode)===h.rB.Value&&a.createElement(l.InlineField,{label:"Value",labelWidth:11},a.createElement(l.Input,{type:"number","aria-label":"Value",value:e.query.fillMode.value,onChange:({currentTarget:t})=>e.onChange(Object.assign(Object.assign({},e.query),{fillMode:{mode:h.rB.Value,value:t.valueAsNumber}})),onBlur:()=>{var t;return(t=e.onRunQuery)===null||t===void 0?void 0:t.call(e)}})))},f=function(e){return a.createElement(l.InlineField,{label:"Format as",labelWidth:11},a.createElement(l.Select,{"aria-label":"Format as",options:e.options,value:e.query.format,onChange:s=>{var n;e.onChange(Object.assign(Object.assign({},e.query),{format:s.value||0})),(n=e.onRunQuery)===null||n===void 0||n.call(e)},className:"width-12",menuShouldPortal:!0}))},f=function(e){var s;return a.createElement(l.InlineField,{label:e.label,labelWidth:(s=e.labelWidth)!==null&&s!==void 0?s:28,tooltip:e.tooltip,hidden:e.hidden,disabled:e.disabled},a.createElement(l.Input,{"data-testid":e["data-testid"],className:"width-30",value:e.value,onChange:e.onChange,placeholder:e.placeholder,disabled:e.disabled}))},f=function(e){const{getSuggestions:s,query:n}=e,{rawSQL:o}=F.defaults(e.query,{rawSQL:""}),t=u.useRef([]);return u.useEffect(()=>{t.current=s(n)},[s,n]),a.createElement(l.CodeEditor,Object.assign({language:e.language,value:o,onBlur:r=>{const i=Object.assign(Object.assign({},e.query),{rawSQL:r});e.onChange(i),e.onRunQuery()},showMiniMap:!1,showLineNumbers:!0,getSuggestions:()=>t.current,height:"240px"},e.editorProps))},f=J,h.SIGV4ConnectionConfig=e=>{var s,n,o,t;const{onOptionsChange:r,options:i}=e,g={onOptionsChange:m=>{var v,p,y,A;const w=Object.assign(Object.assign({},i),{jsonData:Object.assign(Object.assign({},i.jsonData),{sigV4AuthType:m.jsonData.authType,sigV4Profile:m.jsonData.profile,sigV4AssumeRoleArn:m.jsonData.assumeRoleArn,sigV4ExternalId:m.jsonData.externalId,sigV4Region:m.jsonData.defaultRegion,sigV4Endpoint:m.jsonData.endpoint}),secureJsonFields:{sigV4AccessKey:(v=m.secureJsonFields)===null||v===void 0?void 0:v.accessKey,sigV4SecretKey:(p=m.secureJsonFields)===null||p===void 0?void 0:p.secretKey},secureJsonData:{sigV4AccessKey:(y=m.secureJsonData)===null||y===void 0?void 0:y.accessKey,sigV4SecretKey:(A=m.secureJsonData)===null||A===void 0?void 0:A.secretKey}});r(w)},options:Object.assign(Object.assign({},i),{jsonData:Object.assign(Object.assign({},i.jsonData),{authType:i.jsonData.sigV4AuthType,profile:i.jsonData.sigV4Profile,assumeRoleArn:i.jsonData.sigV4AssumeRoleArn,externalId:i.jsonData.sigV4ExternalId,defaultRegion:i.jsonData.sigV4Region,endpoint:i.jsonData.sigV4Endpoint}),secureJsonFields:{accessKey:(s=i.secureJsonFields)===null||s===void 0?void 0:s.sigV4AccessKey,secretKey:(n=i.secureJsonFields)===null||n===void 0?void 0:n.sigV4SecretKey},secureJsonData:{accessKey:(o=i.secureJsonData)===null||o===void 0?void 0:o.sigV4AccessKey,secretKey:(t=i.secureJsonData)===null||t===void 0?void 0:t.sigV4SecretKey}})};return a.createElement(a.Fragment,null,a.createElement("div",{className:"gf-form"},a.createElement("h6",null,"SigV4 Auth Details")),a.createElement(P,Object.assign({},g,{skipHeader:!0,skipEndpoint:!0})))},f=(e,s)=>{const n=e(),o=[];return n.getVariables().forEach(t=>{const r="$"+t.name;let i=n.replace(r);i===r&&(i=""),o.push({label:r,kind:l.CodeEditorSuggestionItemKind.Text,detail:"(Template Variable) "+i})}),s.concat(o)},f=function(e,s,n){const o=n();return Object.assign(Object.assign({},e),{rawSQL:o.replace(e.rawSQL,s,B)})},f=K,f=function(e){return!!e.rawSQL},f=N},37308:(T,h,d)=>{"use strict";T.exports=d(77172)}}]);

//# sourceMappingURL=alertmanagerPlugin.15c68dfcb08e2806d4ce.js.map