"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8881],{"./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/Field.tsx":(e,r,t)=>{t.d(r,{g:()=>a});var n=t("./packages/grafana-ui/src/index.ts"),o=(t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js"));const a=e=>(0,o.jsx)(n.InlineField,Object.assign({labelWidth:18},e))},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/LogsQueryEditor/index.tsx":(e,r,t)=>{t.d(r,{Z:()=>te});var n=t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),o=t("./packages/grafana-ui/src/index.ts");function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class i{constructor(){a(this,"resolve",void 0),a(this,"reject",void 0),a(this,"promise",void 0),this.resolve=void 0,this.reject=void 0,this.promise=new Promise(((e,r)=>{this.resolve=e,this.reject=r})),Object.freeze(this)}}var s=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/LogsQueryEditor/setQueryValue.ts"),u=t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const c=e=>{var r,t,a;let{query:c,datasource:l,onQueryChange:d}=e;const p=(0,n.useRef)();(0,n.useEffect)((()=>{var e;if(null===(e=c.azureLogAnalytics)||void 0===e||!e.resource)return;const r=[l.azureLogAnalyticsDatasource.getKustoSchema(c.azureLogAnalytics.resource),(p.current||(p.current=new i),p.current.promise)];Promise.all(r).then((e=>{let[r,{monaco:t,editor:n}]=e;t.languages.kusto.getKustoWorker().then((e=>{const r=n.getModel();return r&&e(r.uri)})).then((e=>{null==e||e.setSchema(r,"https://help.kusto.windows.net","Samples")}))}))}),[l.azureLogAnalyticsDatasource,null===(r=c.azureLogAnalytics)||void 0===r?void 0:r.resource]);const g=(0,n.useCallback)(((e,r)=>{var t,n;null===(t=p.current)||void 0===t||null===(n=t.resolve)||void 0===n||n.call(t,{editor:e,monaco:r})}),[]),m=(0,n.useCallback)((e=>{d((0,s.J3)(c,e))}),[d,c]);return(0,u.jsx)(o.CodeEditor,{value:null!==(t=null===(a=c.azureLogAnalytics)||void 0===a?void 0:a.query)&&void 0!==t?t:"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:m,onSave:m,onEditorDidMount:g})};var l=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/Field.tsx");const d=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"}],p=e=>{var r;let{query:t,variableOptionGroup:a,onQueryChange:i}=e;const c=(0,n.useMemo)((()=>[...d,a]),[a]),p=(0,n.useCallback)((e=>{const{value:r}=e;if(!r)return;const n=(0,s.d5)(t,r);i(n)}),[i,t]);return(0,u.jsx)(l.g,{label:"Format as",children:(0,u.jsx)(o.Select,{menuShouldPortal:!0,inputId:"azure-monitor-logs-workspaces-field",value:null===(r=t.azureLogAnalytics)||void 0===r?void 0:r.resultFormat,onChange:p,options:c,width:38})})};var g,m,v,h,b=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),f=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/utils/messageFromError.ts"),y=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/Space.tsx"),j=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/ResourcePicker/types.ts");const x=e=>{let{isOpen:r,entry:{type:t}}=e;switch(t){case j.J.Subscription:return g||(g=(0,u.jsx)(o.Icon,{name:"layer-group"}));case j.J.ResourceGroup:return(0,u.jsx)(o.Icon,{name:r?"folder-open":"folder"});case j.J.Resource:return m||(m=(0,u.jsx)(o.Icon,{name:"cube"}));case j.J.VariableGroup:return v||(v=(0,u.jsx)(o.Icon,{name:"x"}));case j.J.Variable:return h||(h=(0,u.jsx)(o.Icon,{name:"x"}));default:return null}},z=e=>({table:(0,b.css)({width:"100%",tableLayout:"fixed"}),tableScroller:(0,b.css)({maxHeight:"50vh",overflow:"auto"}),header:(0,b.css)({background:e.colors.background.secondary}),row:(0,b.css)({borderBottom:`1px solid ${e.colors.border.weak}`,"&:last-of-type":{borderBottomColor:e.colors.border.medium}}),disabledRow:(0,b.css)({opacity:.5}),cell:(0,b.css)({padding:e.spacing(1,1,1,0),width:"25%",overflow:"hidden",textOverflow:"ellipsis","&:first-of-type":{width:"50%",padding:e.spacing(1,1,1,2)}}),collapseButton:(0,b.css)({margin:0}),loadingCell:(0,b.css)({textAlign:"center"}),spinner:(0,b.css)({marginBottom:0}),nestedEntry:(0,b.css)({display:"flex",alignItems:"center"}),entryContentItem:(0,b.css)({margin:e.spacing(0,1,0,0)}),truncated:(0,b.css)({minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),nestedRowCheckbox:(0,b.css)({zIndex:0})});var I,w,C,O;const M=e=>{let{entry:r,isSelected:t,isDisabled:a,isOpen:i,isSelectable:s,level:c,onToggleCollapse:l,onSelectedChange:d}=e;const p=(0,o.useTheme2)(),g=(0,o.useStyles2)(z),m=!!r.children,v=(0,n.useCallback)((()=>{l(r)}),[l,r]),h=(0,n.useCallback)((e=>{const t=e.target.checked;d(r,t)}),[r,d]),f=`checkbox_${r.id}`;return(0,n.useEffect)((()=>{var e;t&&(null===(e=document.getElementById(f))||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"}))}),[]),(0,u.jsxs)("div",{className:g.nestedEntry,style:{marginLeft:c*(3*p.spacing.gridSize)},children:[m?(0,u.jsx)(o.IconButton,{className:g.collapseButton,name:i?"angle-down":"angle-right","aria-label":i?`Collapse ${r.name}`:`Expand ${r.name}`,onClick:v,id:r.id}):I||(I=(0,u.jsx)(y.T,{layout:"inline",h:2})),w||(w=(0,u.jsx)(y.T,{layout:"inline",h:2})),s&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(o.Checkbox,{id:f,onChange:h,disabled:a,value:t,className:g.nestedRowCheckbox}),C||(C=(0,u.jsx)(y.T,{layout:"inline",h:2}))]}),(0,u.jsx)(x,{entry:r,isOpen:i}),O||(O=(0,u.jsx)(y.T,{layout:"inline",h:1})),(0,u.jsx)("label",{htmlFor:f,className:(0,b.cx)(g.entryContentItem,g.truncated),children:r.name})]})};var G=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/ResourcePicker/utils.ts");const S=e=>{var r;let{row:t,selectedRows:a,level:i,requestNestedRows:s,onRowSelectedChange:c,selectableEntryTypes:l}=e;const d=(0,o.useStyles2)(z),[p,g]=(0,n.useState)("closed"),m=!!a.find((e=>e.id===t.id)),v=a.length>0&&!m,h="open"===p;return(0,n.useEffect)((()=>{var e;const r=a[0];r&&!!(0,G.K5)(null!==(e=t.children)&&void 0!==e?e:[],r.id)&&g("open")}),[a,t]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("tr",{className:(0,b.cx)(d.row,v&&d.disabledRow),children:[(0,u.jsx)("td",{className:d.cell,children:(0,u.jsx)(M,{level:i,isSelected:m,isDisabled:v,isOpen:h,entry:t,onToggleCollapse:async()=>{"open"!==p?(g("loading"),s(t).then((()=>g("open"))).catch((()=>g("closed")))):g("closed")},onSelectedChange:c,isSelectable:l.some((e=>e===t.type))})}),(0,u.jsx)("td",{className:d.cell,children:t.typeLabel}),(0,u.jsx)("td",{className:d.cell,children:null!==(r=t.location)&&void 0!==r?r:"-"})]},t.id),h&&t.children&&Object.keys(t.children).length>0&&(0,u.jsx)(A,{rows:t.children,selectedRows:a,level:i+1,requestNestedRows:s,onRowSelectedChange:c,selectableEntryTypes:l}),(0,u.jsx)(o.FadeTransition,{visible:"loading"===p,children:(0,u.jsx)("tr",{children:(0,u.jsx)("td",{className:(0,b.cx)(d.cell,d.loadingCell),colSpan:3,children:(0,u.jsx)(o.LoadingPlaceholder,{text:"Loading...",className:d.spinner})})})})]})},A=e=>{let{rows:r,selectedRows:t,level:n,requestNestedRows:o,onRowSelectedChange:a,selectableEntryTypes:i}=e;return(0,u.jsx)(u.Fragment,{children:r.map((e=>(0,u.jsx)(S,{row:e,selectedRows:t,level:n,requestNestedRows:o,onRowSelectedChange:a,selectableEntryTypes:i},e.id)))})},k=e=>{let{rows:r,selectedRows:t,noHeader:n,requestNestedRows:a,onRowSelectedChange:i,selectableEntryTypes:s}=e;const c=(0,o.useStyles2)(z);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("table",{className:c.table,children:!n&&(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{className:(0,b.cx)(c.row,c.header),children:[(0,u.jsx)("td",{className:c.cell,children:"Scope"}),(0,u.jsx)("td",{className:c.cell,children:"Type"}),(0,u.jsx)("td",{className:c.cell,children:"Location"})]})})}),(0,u.jsx)("div",{className:c.tableScroller,children:(0,u.jsx)("table",{className:c.table,children:(0,u.jsx)("tbody",{children:(0,u.jsx)(A,{rows:r,selectedRows:t,level:0,requestNestedRows:a,onRowSelectedChange:i,selectableEntryTypes:s})})})})]})};var q,N,E,T,R,F,P;const D=e=>{let{resourcePickerData:r,resourceURI:t,onApply:a,onCancel:i,selectableEntryTypes:s}=e;const c=(0,o.useStyles2)(_),[l,d]=(0,n.useState)("NotStarted"),[p,g]=(0,n.useState)([]),[m,v]=(0,n.useState)(t),[h,b]=(0,n.useState)(void 0),[x,z]=(0,n.useState)(null==t?void 0:t.includes("$"));(0,n.useEffect)((()=>{v(t)}),[t]),(0,n.useEffect)((()=>{if("NotStarted"===l){(async()=>{try{d("Started");let t=await r.getSubscriptions();if(!m)return g(t),void d("Done");const n=(0,G._E)(null!=m?m:"");if(n){var e;const o=`/subscriptions/${n.subscriptionID}/resourceGroups/${n.resourceGroup}`;if(n.resourceGroup&&!(0,G.K5)(t,o)){const e=await r.getResourceGroupsBySubscriptionId(n.subscriptionID);t=(0,G.E4)(t,`/subscriptions/${n.subscriptionID}`,e)}if(n.resource&&!(0,G.K5)(p,null!==(e=n.resource)&&void 0!==e?e:"")){const e=await r.getResourcesForResourceGroup(o);t=(0,G.E4)(t,o,e)}}g(t),d("Done")}catch(e){d("Done"),b((0,f.Z)(e))}})()}}),[r,m,p,l]);const I=(0,n.useMemo)((()=>{const e=m&&(0,G.K5)(p,m);return e?[Object.assign({},e,{children:void 0})]:[]}),[m,p]),w=(0,n.useCallback)((async e=>{var t;if(b(void 0),null===(t=e.children)||void 0===t||!t.length)try{const t=e.type===j.J.Subscription?await r.getResourceGroupsBySubscriptionId(e.id):await r.getResourcesForResourceGroup(e.id),n=(0,G.E4)(p,e.uri,t);g(n)}catch(e){throw b((0,f.Z)(e)),e}}),[r,p]),C=(0,n.useCallback)(((e,r)=>{v(r?e.uri:void 0)}),[]),O=(0,n.useCallback)((()=>{a(m)}),[m,a]);return(0,u.jsxs)("div",{children:["Started"===l?(0,u.jsx)("div",{className:c.loadingWrapper,children:q||(q=(0,u.jsx)(o.LoadingPlaceholder,{text:"Loading..."}))}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(k,{rows:p,requestNestedRows:w,onRowSelectedChange:C,selectedRows:I,selectableEntryTypes:s}),(0,u.jsxs)("div",{className:c.selectionFooter,children:[I.length>0&&(0,u.jsxs)(u.Fragment,{children:[N||(N=(0,u.jsx)("h5",{children:"Selection"})),(0,u.jsx)(k,{rows:I,requestNestedRows:w,onRowSelectedChange:C,selectedRows:I,noHeader:!0,selectableEntryTypes:s}),E||(E=(0,u.jsx)(y.T,{v:2}))]}),(0,u.jsxs)(o.Collapse,{collapsible:!0,label:"Advanced",isOpen:x,onToggle:()=>z(!x),children:[(0,u.jsx)(o.Label,{htmlFor:`input-${m}`,children:T||(T=(0,u.jsxs)("h6",{children:["Resource URI"," ",(0,u.jsx)(o.Tooltip,{content:(0,u.jsxs)(u.Fragment,{children:["Manually edit the"," ",(0,u.jsxs)("a",{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/logs/log-standard-columns#_resourceid",rel:"noopener noreferrer",target:"_blank",children:["resource uri."," "]}),"Supports the use of multiple template variables (ex: /subscriptions/$subId/resourceGroups/$rg)"]}),placement:"right",interactive:!0,children:(0,u.jsx)(o.Icon,{name:"info-circle"})})]}))}),(0,u.jsx)(o.Input,{id:`input-${m}`,value:m,onChange:e=>v(e.currentTarget.value),placeholder:"ex: /subscriptions/$subId"})]}),R||(R=(0,u.jsx)(y.T,{v:2})),(0,u.jsx)(o.Button,{disabled:!!h,onClick:O,children:"Apply"}),F||(F=(0,u.jsx)(y.T,{layout:"inline",h:1})),(0,u.jsx)(o.Button,{onClick:i,variant:"secondary",children:"Cancel"})]})]}),h&&(0,u.jsxs)(u.Fragment,{children:[P||(P=(0,u.jsx)(y.T,{v:2})),(0,u.jsx)(o.Alert,{severity:"error",title:"An error occurred while requesting resources from Azure Monitor",children:h})]})]})},_=e=>({selectionFooter:(0,b.css)({position:"sticky",bottom:0,background:e.colors.background.primary,paddingTop:e.spacing(2)}),loadingWrapper:(0,b.css)({textAlign:"center",paddingTop:e.spacing(2),paddingBottom:e.spacing(2),color:e.colors.text.secondary})});var L,Q,B,U,$,V,K,Z;function H(e){const r=(0,G._E)(e);if(r)return{subscriptionName:r.subscriptionID,resourceGroupName:r.resourceGroup,resourceName:r.resource}}const J=e=>{let{resource:r,datasource:t}=e;const[a,i]=(0,n.useState)(H(null!=r?r:""));return(0,n.useEffect)((()=>{r&&H(r)?t.resourcePickerData.getResourceURIDisplayProperties(r).then(i):i(void 0)}),[t.resourcePickerData,r]),r?a?(0,u.jsx)(W,{resource:a}):r.startsWith("$")?(0,u.jsxs)("span",{children:[L||(L=(0,u.jsx)(o.Icon,{name:"x"}))," ",r]}):(0,u.jsx)(u.Fragment,{children:r}):(0,u.jsx)(u.Fragment,{children:"Select a resource"})},W=e=>{let{resource:r}=e;return(0,u.jsxs)("span",{children:[Q||(Q=(0,u.jsx)(o.Icon,{name:"layer-group"}))," ",r.subscriptionName,r.resourceGroupName&&(0,u.jsxs)(u.Fragment,{children:[B||(B=(0,u.jsx)(X,{})),U||(U=(0,u.jsx)(o.Icon,{name:"folder"}))," ",r.resourceGroupName]}),r.resourceName&&(0,u.jsxs)(u.Fragment,{children:[$||($=(0,u.jsx)(X,{})),V||(V=(0,u.jsx)(o.Icon,{name:"cube"}))," ",r.resourceName]})]})},X=()=>(0,u.jsxs)(u.Fragment,{children:[K||(K=(0,u.jsx)(y.T,{layout:"inline",h:2})),"/",Z||(Z=(0,u.jsx)(y.T,{layout:"inline",h:2}))]}),Y=e=>{var r;let{query:t,datasource:a,onQueryChange:i}=e;const c=(0,o.useStyles2)(ee),{resource:d}=null!==(r=t.azureLogAnalytics)&&void 0!==r?r:{},[p,g]=(0,n.useState)(!1),m=(0,n.useCallback)((()=>{g(!0)}),[]),v=(0,n.useCallback)((()=>{g(!1)}),[]),h=(0,n.useCallback)((e=>{i((0,s.DF)(t,e)),v()}),[v,i,t]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(o.Modal,{className:c.modal,title:"Select a resource",isOpen:p,onDismiss:v,trapFocus:!1,children:(0,u.jsx)(D,{resourcePickerData:a.resourcePickerData,resourceURI:d,onApply:h,onCancel:v,selectableEntryTypes:[j.J.Subscription,j.J.ResourceGroup,j.J.Resource,j.J.Variable]})}),(0,u.jsx)(l.g,{label:"Resource",children:(0,u.jsx)(o.Button,{variant:"secondary",onClick:m,type:"button",children:(0,u.jsx)(J,{resource:d,datasource:a})})})]})},ee=e=>({modal:(0,b.css)({width:e.breakpoints.values.lg})});function re(e,r,t){const[o,a]=(0,n.useState)();return(0,n.useEffect)((()=>{(async function(e,r,t){var n;if(void 0!==(null===(n=r.azureLogAnalytics)||void 0===n?void 0:n.workspace)&&!r.azureLogAnalytics.resource){let n;n=(0,G.uD)(r.azureLogAnalytics.workspace)?await e.resourcePickerData.getResourceURIFromWorkspace(r.azureLogAnalytics.workspace):r.azureLogAnalytics.workspace;const o=Object.assign({},r,{azureLogAnalytics:Object.assign({},r.azureLogAnalytics,{resource:n,workspace:void 0})});delete o.azureLogAnalytics.workspace,t(o)}})(e,r,t).catch((e=>a({title:"Unable to migrate workspace as a resource",message:e.message})))}),[e,r,t]),o}const te=e=>{let{query:r,datasource:t,subscriptionId:n,variableOptionGroup:a,onChange:i,setError:s,hideFormatAs:l}=e;const d=re(t,r,i);return(0,u.jsxs)("div",{"data-testid":"azure-monitor-logs-query-editor",children:[(0,u.jsx)(o.InlineFieldRow,{children:(0,u.jsx)(Y,{query:r,datasource:t,subscriptionId:n,variableOptionGroup:a,onQueryChange:i,setError:s})}),(0,u.jsx)(c,{query:r,datasource:t,subscriptionId:n,variableOptionGroup:a,onQueryChange:i,setError:s}),!l&&(0,u.jsx)(p,{query:r,datasource:t,subscriptionId:n,variableOptionGroup:a,onQueryChange:i,setError:s}),d&&(0,u.jsx)(o.Alert,{title:d.title,children:d.message})]})}},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/LogsQueryEditor/setQueryValue.ts":(e,r,t)=>{function n(e,r){return Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{query:r})})}function o(e,r){return Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{resultFormat:r})})}function a(e,r){return Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{resource:r})})}t.d(r,{DF:()=>a,J3:()=>n,d5:()=>o})},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/MetricsQueryEditor/setQueryValue.ts":(e,r,t)=>{function n(e,r){return e.subscription===r?e:Object.assign({},e,{subscription:r,azureMonitor:Object.assign({},e.azureMonitor,{resourceGroup:void 0,metricDefinition:void 0,metricNamespace:void 0,resourceName:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function o(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.resourceGroup)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{resourceGroup:r,metricDefinition:void 0,metricNamespace:void 0,resourceName:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function a(e,r){var t;if((null===(t=e.azureMonitor)||void 0===t?void 0:t.metricDefinition)===r)return e;return Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricDefinition:r,resourceName:void 0,metricNamespace:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function i(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.resourceName)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{resourceName:r,metricNamespace:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function s(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.metricNamespace)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricNamespace:r,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function u(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.metricName)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricName:r,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function c(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.aggregation)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{aggregation:r})})}function l(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.timeGrain)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{timeGrain:r})})}function d(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.dimensionFilters)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{dimensionFilters:r})})}function p(e){var r,t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"eq",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";const i=null!==(r=null===(t=e.azureMonitor)||void 0===t?void 0:t.dimensionFilters)&&void 0!==r?r:[];return d(e,[...i,{dimension:n,operator:o,filter:a}])}function g(e,r){var t,n;const o=[...null!==(t=null===(n=e.azureMonitor)||void 0===n?void 0:n.dimensionFilters)&&void 0!==t?t:[]];return o.splice(r,1),d(e,o)}function m(e,r,t,n){var o,a;const i=[...null!==(o=null===(a=e.azureMonitor)||void 0===a?void 0:a.dimensionFilters)&&void 0!==o?o:[]];return i[r][t]=n,d(e,i)}function v(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.top)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{top:r})})}function h(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.alias)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{alias:r})})}t.d(r,{Ad:()=>n,In:()=>s,QC:()=>m,R3:()=>i,Wp:()=>u,b2:()=>o,b3:()=>a,d2:()=>p,do:()=>g,hd:()=>h,pt:()=>c,y1:()=>v,zB:()=>l})},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/QueryEditor/QueryEditor.tsx":(e,r,t)=>{t.d(r,{Z:()=>ne});var n=t("./packages/grafana-ui/src/index.ts"),o=t("./packages/grafana-runtime/src/index.ts"),a=t("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),i=t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),s=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/types/index.ts"),u=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/utils/useLastError.ts"),c=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/utils/common.ts"),l=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/Field.tsx"),d=t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const p=e=>{let{query:r,subscriptions:t,variableOptionGroup:o,onQueryChange:a,multiSelect:u=!1}=e;const p=(0,i.useCallback)((e=>{if(!e.value)return;let t=Object.assign({},r,{subscription:e.value});r.queryType===s.Bj.AzureMonitor&&(t.azureMonitor=Object.assign({},t.azureMonitor,{resourceGroup:void 0,metricDefinition:void 0,metricNamespace:void 0,resourceName:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})),a(t)}),[r,a]),g=(0,i.useCallback)((e=>{e&&(r.subscriptions=e.map((e=>{var r;return null!==(r=e.value)&&void 0!==r?r:""})),a(r))}),[r,a]),m=(0,i.useMemo)((()=>[...t,o]),[t,o]);return u?(0,d.jsx)(l.g,{label:"Subscriptions",children:(0,d.jsx)(n.MultiSelect,{menuShouldPortal:!0,isClearable:!0,value:(0,c.b9)([...t,...o.options],r.subscriptions),inputId:"azure-monitor-subscriptions-field",onChange:g,options:m,width:38})}):(0,d.jsx)(l.g,{label:"Subscription",children:(0,d.jsx)(n.Select,{menuShouldPortal:!0,value:r.subscription,inputId:"azure-monitor-subscriptions-field",onChange:p,options:m,width:38,allowCustomValue:!0})})},g=e=>{var r,t;let{query:o,onQueryChange:a}=e;const s=(0,i.useCallback)((e=>{a(Object.assign({},o,{azureResourceGraph:Object.assign({},o.azureResourceGraph,{query:e})}))}),[a,o]);return(0,d.jsx)(n.CodeEditor,{value:null!==(r=null===(t=o.azureResourceGraph)||void 0===t?void 0:t.query)&&void 0!==r?r:"",language:"kusto",height:200,width:1e3,showMiniMap:!1,onBlur:s,onSave:s})},m="arg-subscriptions",v=e=>{let{query:r,datasource:t,subscriptionId:o,variableOptionGroup:a,onChange:s,setError:u}=e;const c=(0,i.useRef)(!1),[l,v]=(0,i.useState)([]);return(0,i.useEffect)((()=>{c.current||(c.current=!0,t.azureMonitorDatasource.getSubscriptions().then((e=>{var t;const n=e.map((e=>({label:e.text,value:e.value,description:e.value})));var o;(v(n),u(m,void 0),null!==(t=r.subscriptions)&&void 0!==t&&t.length||null==n||!n.length)||s(Object.assign({},r,{subscriptions:[null!==(o=r.subscription)&&void 0!==o?o:n[0].value]}))})).catch((e=>u(m,e))))}),[t,s,r,u]),(0,d.jsxs)("div",{"data-testid":"azure-monitor-logs-query-editor",children:[(0,d.jsx)(n.InlineFieldRow,{children:(0,d.jsx)(p,{multiSelect:!0,subscriptions:l,query:r,datasource:t,subscriptionId:o,variableOptionGroup:a,onQueryChange:s,setError:u})}),(0,d.jsx)(g,{query:r,datasource:t,subscriptionId:o,variableOptionGroup:a,onQueryChange:s,setError:u})]})};var h;const b=e=>{let{timeGrainCount:r,timeGrainType:t,timeGrainUnit:o}=e;const a="specific"===t?["specific",r,o]:[t];return(0,d.jsx)(l.g,{label:"Timegrain",children:(0,d.jsx)(d.Fragment,{children:a.map((e=>(0,d.jsx)(n.Input,{value:e,disabled:!0,onChange:()=>{},width:10},e)))})})},f=e=>{var r,t,o,a,i,s,u,c;let{query:p}=e;const g=(null===(r=p.appInsights)||void 0===r?void 0:r.dimension)||[];return(0,d.jsxs)("div",{"data-testid":"azure-monitor-application-insights-query-editor",children:[(0,d.jsx)(l.g,{label:"Metric",disabled:!0,children:(0,d.jsx)(n.Input,{value:null===(t=p.appInsights)||void 0===t?void 0:t.metricName,disabled:!0,onChange:()=>{},id:"azure-monitor-application-insights-metric"})}),(0,d.jsx)(l.g,{label:"Aggregation",disabled:!0,children:(0,d.jsx)(n.Input,{value:null===(o=p.appInsights)||void 0===o?void 0:o.aggregation,disabled:!0,onChange:()=>{}})}),g.length>0&&(0,d.jsx)(l.g,{label:"Group by",children:(0,d.jsx)(d.Fragment,{children:g.map((e=>(0,d.jsx)(n.Input,{value:e,disabled:!0,onChange:()=>{}},e)))})}),(0,d.jsx)(l.g,{label:"Filter",disabled:!0,children:(0,d.jsx)(n.Input,{value:null===(a=p.appInsights)||void 0===a?void 0:a.dimensionFilter,disabled:!0,onChange:()=>{}})}),(0,d.jsx)(b,{timeGrainCount:(null===(i=p.appInsights)||void 0===i?void 0:i.timeGrainCount)||"",timeGrainType:(null===(s=p.appInsights)||void 0===s?void 0:s.timeGrainType)||"auto",timeGrainUnit:(null===(u=p.appInsights)||void 0===u?void 0:u.timeGrainUnit)||"minute"}),(0,d.jsx)(l.g,{label:"Legend format",disabled:!0,children:(0,d.jsx)(n.Input,{placeholder:"Alias patterns",value:null===(c=p.appInsights)||void 0===c?void 0:c.alias,onChange:()=>{},disabled:!0})}),h||(h=(0,d.jsx)(n.Alert,{severity:"info",title:"Deprecated",children:"Application Insights is deprecated and is now read only. Migrate your queries to Metrics to make changes."}))]})};var y,j,x=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/Space.tsx");const z=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"}],I=e=>{var r,t,o;let{query:a}=e;return(0,d.jsxs)("div",{"data-testid":"azure-monitor-insights-analytics-query-editor",children:[(0,d.jsx)(n.CodeEditor,{language:"kusto",value:null!==(r=null===(t=a.insightsAnalytics)||void 0===t?void 0:t.query)&&void 0!==r?r:"",height:200,width:"100%",readOnly:!0,showMiniMap:!1}),(0,d.jsx)(l.g,{label:"Format as",children:(0,d.jsx)(n.Select,{menuShouldPortal:!0,inputId:"azure-monitor-logs-workspaces-field",value:null===(o=a.insightsAnalytics)||void 0===o?void 0:o.resultFormat,disabled:!0,options:z,onChange:()=>{},width:38})}),y||(y=(0,d.jsx)(x.T,{v:2})),j||(j=(0,d.jsx)(n.Alert,{severity:"info",title:"Deprecated",children:"Insights Analytics is deprecated and is now read only. Migrate your queries to Logs to make changes."}))]})};var w=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/deprecated/utils.tsx"),C=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/LogsQueryEditor/index.tsx"),O=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/MetricsQueryEditor/setQueryValue.ts");const M=e=>{var r,t;let{metricNamespaces:o,query:a,variableOptionGroup:s,onQueryChange:u}=e;const c=(0,i.useCallback)((e=>{if(!e.value)return;const r=(0,O.In)(a,e.value);u(r)}),[u,a]),p=(0,i.useMemo)((()=>[...o,s]),[o,s]),g=o.map((e=>e.value)).concat(s.options.map((e=>e.value))),m=null===(r=a.azureMonitor)||void 0===r?void 0:r.metricNamespace;return m&&!g.includes(m)&&p.push({label:m,value:m}),(0,d.jsx)(l.g,{label:"Metric namespace",children:(0,d.jsx)(n.Select,{menuShouldPortal:!0,inputId:"azure-monitor-metrics-metric-namespace-field",value:null===(t=a.azureMonitor)||void 0===t?void 0:t.metricNamespace,onChange:c,options:p,width:38,allowCustomValue:!0})})},G=e=>{var r;let{resourceTypes:t,query:o,variableOptionGroup:a,onQueryChange:s}=e;const u=(0,i.useCallback)((e=>{if(!e.value)return;const r=(0,O.b3)(o,e.value);s(r)}),[s,o]),c=(0,i.useMemo)((()=>[...t,a]),[t,a]);return(0,d.jsx)(l.g,{label:"Resource type",children:(0,d.jsx)(n.Select,{menuShouldPortal:!0,inputId:"azure-monitor-metrics-resource-type-field",value:null===(r=o.azureMonitor)||void 0===r?void 0:r.metricDefinition,onChange:u,options:c,width:38,allowCustomValue:!0})})},S=e=>{var r;let{query:t,resourceGroups:o,variableOptionGroup:a,onQueryChange:s,setError:u}=e;const c=(0,i.useCallback)((e=>{const r=(0,O.b2)(t,e.value);s(r)}),[s,t]),p=(0,i.useMemo)((()=>[...o,a]),[o,a]);return(0,d.jsx)(l.g,{label:"Resource group",children:(0,d.jsx)(n.Select,{menuShouldPortal:!0,inputId:"azure-monitor-metrics-resource-group-field",value:null===(r=t.azureMonitor)||void 0===r?void 0:r.resourceGroup,onChange:c,options:p,width:38,allowCustomValue:!0})})},A=e=>{var r,t;let{resourceNames:o,query:a,variableOptionGroup:s,onQueryChange:u}=e;const c=(0,i.useCallback)((e=>{const r=(0,O.R3)(a,e.value);u(r)}),[u,a]),p=(0,i.useMemo)((()=>[...o,s]),[o,s]),g=null!==(r=null===(t=a.azureMonitor)||void 0===t?void 0:t.resourceName)&&void 0!==r?r:null;return(0,d.jsx)(l.g,{label:"Resource name",children:(0,d.jsx)(n.Select,{menuShouldPortal:!0,inputId:"azure-monitor-metrics-resource-name-field",value:g,onChange:c,options:p,width:38,allowCustomValue:!0})})},k=e=>{var r,t;let{metricNames:o,query:a,variableOptionGroup:s,onQueryChange:u}=e;const c=(0,i.useCallback)((e=>{if(!e.value)return;const r=(0,O.Wp)(a,e.value);u(r)}),[u,a]),p=(0,i.useMemo)((()=>[...o,s]),[o,s]);return(0,d.jsx)(l.g,{label:"Metric",children:(0,d.jsx)(n.Select,{menuShouldPortal:!0,inputId:"azure-monitor-metrics-metric-field",value:null!==(r=null===(t=a.azureMonitor)||void 0===t?void 0:t.metricName)&&void 0!==r?r:null,onChange:c,options:p,width:38,allowCustomValue:!0})})},q=e=>{var r;let{query:t,variableOptionGroup:o,onQueryChange:a,aggregationOptions:s,isLoading:u}=e;const c=(0,i.useCallback)((e=>{if(!e.value)return;const r=(0,O.pt)(t,e.value);a(r)}),[a,t]),p=(0,i.useMemo)((()=>[...s,o]),[s,o]);return(0,d.jsx)(l.g,{label:"Aggregation",children:(0,d.jsx)(n.Select,{menuShouldPortal:!0,inputId:"azure-monitor-metrics-aggregation-field",value:null===(r=t.azureMonitor)||void 0===r?void 0:r.aggregation,onChange:c,options:p,width:38,isLoading:u})})};var N=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/time_grain_converter.ts");const E=e=>{var r;let{query:t,timeGrainOptions:o,variableOptionGroup:a,onQueryChange:s}=e;const u=(0,i.useCallback)((e=>{if(!e.value)return;const r=(0,O.zB)(t,e.value);s(r)}),[s,t]),c=(0,i.useMemo)((()=>{const e=N.Z.findClosestTimeGrain("1m",o.map((e=>N.Z.createKbnUnitFromISO8601Duration(e.value)))||["1m","5m","15m","30m","1h","6h","12h","1d"]);return[...o.map((r=>"auto"===r.value?Object.assign({},r,{description:e}):r)),a]}),[o,a]);return(0,d.jsx)(l.g,{label:"Time grain",children:(0,d.jsx)(n.Select,{menuShouldPortal:!0,inputId:"azure-monitor-metrics-time-grain-field",value:null===(r=t.azureMonitor)||void 0===r?void 0:r.timeGrain,onChange:u,options:c,width:38})})};var T;const R=e=>{var r;let{query:t,dimensionOptions:o,onQueryChange:a}=e;const s=(0,i.useMemo)((()=>{var e,r;return null!==(e=null===(r=t.azureMonitor)||void 0===r?void 0:r.dimensionFilters)&&void 0!==e?e:[]}),[null===(r=t.azureMonitor)||void 0===r?void 0:r.dimensionFilters]),u=(e,r,n)=>{a((0,O.QC)(t,e,r,n))};return(0,d.jsx)(l.g,{label:"Dimension",children:(0,d.jsxs)(n.VerticalGroup,{spacing:"xs",children:[s.map(((e,r)=>(0,d.jsxs)(n.HorizontalGroup,{spacing:"xs",children:[(0,d.jsx)(n.Select,{menuShouldPortal:!0,placeholder:"Field",value:e.dimension,options:o,onChange:e=>{var t;return u(r,"dimension",null!==(t=e.value)&&void 0!==t?t:"")},width:38}),T||(T=(0,d.jsx)(n.InlineLabel,{"aria-label":"equals",children:"=="})),(0,d.jsx)(n.Input,{placeholder:"",value:e.filter,onChange:e=>((e,r)=>{r.target instanceof HTMLInputElement&&u(e,"filter",r.target.value)})(r,e)}),(0,d.jsx)(n.Button,{variant:"secondary",size:"md",icon:"trash-alt","aria-label":"Remove",onClick:()=>(e=>{a((0,O.do)(t,e))})(r)})]},r))),(0,d.jsx)(n.Button,{variant:"secondary",size:"md",onClick:()=>{a((0,O.d2)(t))},children:"Add new dimension"})]})})},F=e=>{var r,t;let{onQueryChange:o,query:a}=e;const[s,u]=(0,i.useState)(null!==(r=null===(t=a.azureMonitor)||void 0===t?void 0:t.top)&&void 0!==r?r:""),c=(0,i.useCallback)((e=>{e.target instanceof HTMLInputElement&&u(e.target.value)}),[]),p=(0,i.useCallback)((()=>{const e=(0,O.y1)(a,s);o(e)}),[o,a,s]);return(0,d.jsx)(l.g,{label:"Top",children:(0,d.jsx)(n.Input,{id:"azure-monitor-metrics-top-field",value:s,onChange:c,onBlur:p,width:16})})},P=e=>{var r,t;let{onQueryChange:o,query:a}=e;const[s,u]=(0,i.useState)(null!==(r=null===(t=a.azureMonitor)||void 0===t?void 0:t.alias)&&void 0!==r?r:""),c=(0,i.useCallback)((e=>{e.target instanceof HTMLInputElement&&u(e.target.value)}),[]),p=(0,i.useCallback)((()=>{const e=(0,O.hd)(a,s);o(e)}),[o,a,s]);return(0,d.jsx)(l.g,{label:"Legend format",children:(0,d.jsx)(n.Input,{id:"azure-monitor-metrics-legend-field",placeholder:"Alias patterns",value:s,onChange:c,onBlur:p,width:38})})};function D(e,r,t){const[n]=(0,i.useState)((()=>Math.random())),[o,a]=(0,i.useState)(),s=(0,i.useMemo)((()=>null!=o?o:[]),[o]);return(0,i.useEffect)((()=>{e().then((e=>{a(e),r(n,void 0)})).catch((e=>{r(n,e)}))}),t),s}const _=(e,r,t,n)=>{const o=r.azureMonitorDatasource.defaultSubscriptionId,{subscription:a}=e,s=D((async()=>L(await r.azureMonitorDatasource.getSubscriptions(),a)),n,[]);return(0,i.useEffect)((()=>{((e,r,t,n)=>{const{subscription:o}=e;if(!r.length||o&&((0,c.Gq)(r,o)||o.includes("$")))return;const a=n||r[0].value;!o&&a&&(0,c.Gq)(r,a)&&t((0,O.Ad)(e,a)),o&&!(0,c.Gq)(r,o)&&((0,c.Gq)(r,a)?t((0,O.Ad)(e,a)):t((0,O.Ad)(e,"")))})(e,s,t,o)}),[s,e,o,t]),s};function L(e,r){const t=e.map(c.Er);return r&&!t.find((e=>e.value===r))&&t.push({label:r,value:r}),t}const Q=e=>{var r,t,o;let{query:a,datasource:s,subscriptionId:u,variableOptionGroup:c,onChange:l,setError:g}=e;const m=((e,r,t)=>{var n;const[o,a]=(0,i.useState)({aggOptions:[],timeGrains:[],dimensions:[],isLoading:!1,supportedAggTypes:[],primaryAggType:void 0}),{subscription:s}=e,{resourceGroup:u,metricDefinition:c,resourceName:l,metricNamespace:d,metricName:p,aggregation:g,timeGrain:m}=null!==(n=e.azureMonitor)&&void 0!==n?n:{};return(0,i.useEffect)((()=>{s&&u&&c&&l&&d&&p&&r.getMetricMetadata(s,u,c,l,d,p).then((e=>{var r;const t=(e.supportedAggTypes||[e.primaryAggType]).map((e=>({label:e,value:e})));a({aggOptions:t,timeGrains:e.supportedTimeGrains,dimensions:e.dimensions,isLoading:!1,supportedAggTypes:null!==(r=e.supportedAggTypes)&&void 0!==r?r:[],primaryAggType:e.primaryAggType})}))}),[r,s,u,c,l,d,p]),(0,i.useEffect)((()=>{const r=g||o.primaryAggType,n=m||"auto";r===g&&n===m||t(Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{aggregation:r,timeGrain:n})}))}),[t,o,g,m,e]),o})(a,s,l),v=_(a,s,l,g),h=((e,r,t,n)=>{var o;const{subscription:a}=e,{resourceGroup:i}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return D((async()=>{if(a)return L(await r.getResourceGroups(a),i)}),n,[a])})(a,s,0,g),b=((e,r,t,n)=>{var o;const{subscription:a}=e,{resourceGroup:i,metricDefinition:s}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return D((async()=>{if(a&&i)return L(await r.getMetricDefinitions(a,i),s)}),n,[a,i])})(a,s,0,g),f=((e,r,t,n)=>{var o;const{subscription:a}=e,{resourceGroup:i,metricDefinition:s,resourceName:u}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return D((async()=>{if(a&&i&&s)return L(await r.getResourceNames(a,i,s),u)}),n,[a,i,s])})(a,s,0,g),y=((e,r,t,n)=>{var o;const{subscription:a}=e,{resourceGroup:i,metricDefinition:s,resourceName:u,metricNamespace:c,metricName:l}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return D((async()=>{if(a&&i&&s&&u&&c)return L(await r.getMetricNames(a,i,s,u,c),l)}),n,[a,i,s,u,c])})(a,s,0,g),j=((e,r,t,n)=>{var o;const{subscription:a}=e,{resourceGroup:i,metricDefinition:s,resourceName:u,metricNamespace:c}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return D((async()=>{if(!(a&&i&&s&&u))return;const n=L(await r.getMetricNamespaces(a,i,s,u),c);return!c&&n.length&&t((0,O.In)(e,n[0].value)),n}),n,[a,i,s,u])})(a,s,l,g);return(0,d.jsxs)("div",{"data-testid":"azure-monitor-metrics-query-editor",children:[(0,d.jsxs)(n.InlineFieldRow,{children:[(0,d.jsx)(p,{subscriptions:v,query:a,datasource:s,subscriptionId:u,variableOptionGroup:c,onQueryChange:l,setError:g}),(0,d.jsx)(S,{resourceGroups:h,query:a,datasource:s,subscriptionId:u,variableOptionGroup:c,onQueryChange:l,setError:g})]}),(0,d.jsxs)(n.InlineFieldRow,{children:[(0,d.jsx)(G,{resourceTypes:b,query:a,datasource:s,subscriptionId:u,variableOptionGroup:c,onQueryChange:l,setError:g}),(0,d.jsx)(A,{resourceNames:f,query:a,datasource:s,subscriptionId:u,variableOptionGroup:c,onQueryChange:l,setError:g})]}),(0,d.jsxs)(n.InlineFieldRow,{children:[(0,d.jsx)(M,{metricNamespaces:j,query:a,datasource:s,subscriptionId:u,variableOptionGroup:c,onQueryChange:l,setError:g}),(0,d.jsx)(k,{metricNames:y,query:a,datasource:s,subscriptionId:u,variableOptionGroup:c,onQueryChange:l,setError:g})]}),(0,d.jsxs)(n.InlineFieldRow,{children:[(0,d.jsx)(q,{query:a,datasource:s,subscriptionId:u,variableOptionGroup:c,onQueryChange:l,setError:g,aggregationOptions:null!==(r=null==m?void 0:m.aggOptions)&&void 0!==r?r:[],isLoading:m.isLoading}),(0,d.jsx)(E,{query:a,datasource:s,subscriptionId:u,variableOptionGroup:c,onQueryChange:l,setError:g,timeGrainOptions:null!==(t=null==m?void 0:m.timeGrains)&&void 0!==t?t:[]})]}),(0,d.jsx)(R,{query:a,datasource:s,subscriptionId:u,variableOptionGroup:c,onQueryChange:l,setError:g,dimensionOptions:null!==(o=null==m?void 0:m.dimensions)&&void 0!==o?o:[]}),(0,d.jsx)(F,{query:a,datasource:s,subscriptionId:u,variableOptionGroup:c,onQueryChange:l,setError:g}),(0,d.jsx)(P,{query:a,datasource:s,subscriptionId:u,variableOptionGroup:c,onQueryChange:l,setError:g})]})};var B;const U=e=>{let{}=e;return B||(B=(0,d.jsx)("div",{"data-testid":"azure-monitor-metrics-query-editor-with-resource-picker",children:"New Query Editor"}))},$=e=>{let{query:r,onQueryChange:t}=e;const[o]=(0,i.useState)(r.queryType),a=[{value:s.Bj.AzureMonitor,label:"Metrics"},{value:s.Bj.LogAnalytics,label:"Logs"},{value:s.Bj.AzureResourceGraph,label:"Azure Resource Graph"}];(0,w.z)()||o!==s.H0.ApplicationInsights&&o!==s.H0.InsightsAnalytics||a.push({value:s.H0.ApplicationInsights,label:"Application Insights"},{value:s.H0.InsightsAnalytics,label:"Insights Analytics"});const u=(0,i.useCallback)((e=>{e.value&&t(Object.assign({},r,{queryType:e.value}))}),[t,r]);return(0,d.jsx)(l.g,{label:"Service",children:(0,d.jsx)(n.Select,{menuShouldPortal:!0,inputId:"azure-monitor-query-type-field",value:r.queryType,options:a,onChange:u,width:38})})};var V=t("../../opt/drone/yarncache/fast-deep-equal-npm-3.1.3-790edcfcf5-e21a9d8d84.zip/node_modules/fast-deep-equal/index.js"),K=t.n(V),Z=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/utils/migrateQuery.ts");const H={queryType:s.Bj.AzureMonitor},J=(e,r)=>{const t=(0,i.useMemo)((()=>(e=>{const r=(0,a.defaults)({},e,H),t=(0,Z.Z)(r);return K()(t,e)?e:t})(e)),[e]);return(0,i.useEffect)((()=>{t!==e&&r(t)}),[t,e,r]),t};var W,X,Y,ee,re;const te=e=>{let{subscriptionId:r,query:t,datasource:a,variableOptionGroup:i,onChange:u,setError:c}=e;switch(t.queryType){case s.Bj.AzureMonitor:return o.config.featureToggles.azureMonitorResourcePickerForMetrics?X||(X=(0,d.jsx)(U,{})):(0,d.jsx)(Q,{subscriptionId:r,query:t,datasource:a,onChange:u,variableOptionGroup:i,setError:c});case s.Bj.LogAnalytics:return(0,d.jsx)(C.Z,{subscriptionId:r,query:t,datasource:a,onChange:u,variableOptionGroup:i,setError:c});case s.Bj.AzureResourceGraph:return(0,d.jsx)(v,{subscriptionId:r,query:t,datasource:a,onChange:u,variableOptionGroup:i,setError:c});case s.H0.ApplicationInsights:return(0,w.z)()?Y||(Y=(0,d.jsxs)(n.Alert,{title:"Deprecated",children:["Application Insights has been deprecated."," ",(0,d.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/datasources/azuremonitor/deprecated-application-insights/#application-insights",target:"_blank",rel:"noreferrer",children:"Use the Metrics service instead"}),"."]})):(0,d.jsx)(f,{query:t});case s.H0.InsightsAnalytics:return(0,w.z)()?ee||(ee=(0,d.jsxs)(n.Alert,{title:"Deprecated",children:["Insight Analytics has been deprecated."," ",(0,d.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/datasources/azuremonitor/deprecated-application-insights/#insights-analytics",target:"_blank",rel:"noreferrer",children:"Queries can be written with Kusto in the Logs query type by selecting your Application Insights resource"}),"."]})):(0,d.jsx)(I,{query:t});default:return re||(re=(0,d.jsx)(n.Alert,{title:"Unknown query type"}))}return null},ne=e=>{let{query:r,datasource:t,onChange:o,onRunQuery:s}=e;const[c,l]=(0,u.Z)(),p=(0,i.useMemo)((()=>(0,a.debounce)(s,500)),[s]),g=(0,i.useCallback)((e=>{o(e),p()}),[o,p]),m=J(r,g),v=m.subscription||t.azureMonitorDatasource.defaultSubscriptionId,h={label:"Template Variables",options:t.getVariables().map((e=>({label:e,value:e})))};return(0,d.jsxs)("div",{"data-testid":"azure-monitor-query-editor",children:[(0,d.jsx)($,{query:m,onQueryChange:g}),(0,d.jsx)(te,{subscriptionId:v,query:m,datasource:t,onChange:g,variableOptionGroup:h,setError:l}),c&&(0,d.jsxs)(d.Fragment,{children:[W||(W=(0,d.jsx)(x.T,{v:2})),(0,d.jsx)(n.Alert,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor",children:c})]})]})}},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/ResourcePicker/types.ts":(e,r,t)=>{let n;t.d(r,{J:()=>n}),function(e){e.Subscription="Subscription",e.ResourceGroup="ResourceGroup",e.Resource="Resource",e.VariableGroup="TemplateVariableGroup",e.Variable="TemplateVariable"}(n||(n={}))},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/ResourcePicker/utils.ts":(e,r,t)=>{t.d(r,{E4:()=>u,K5:()=>s,_E:()=>a,uD:()=>i});var n=t("../../opt/drone/yarncache/immer-npm-9.0.12-e8cd7358fa-bcbec6d76d.zip/node_modules/immer/dist/immer.esm.js");const o=/\/subscriptions\/(?<subscriptionID>[^/]+)(?:\/resourceGroups\/(?<resourceGroup>[^/]+)(?:\/providers.+\/(?<resource>[^/]+))?)?/;function a(e){var r;const t=o.exec(e),n=null!==(r=null==t?void 0:t.groups)&&void 0!==r?r:{},{subscriptionID:a,resourceGroup:i,resource:s}=n;if(a)return{subscriptionID:a,resourceGroup:i,resource:s}}function i(e){return!!e.match(/^[A-Z0-9]+/i)}function s(e,r){for(const t of e){if(t.uri.toLowerCase()===r.toLowerCase())return t;if(t.children){const e=s(t.children,r);if(e)return e}}}function u(e,r,t){return(0,n.ZP)(e,(e=>{const n=s(e,r);n&&(n.children=t)}))}},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/Space.tsx":(e,r,t)=>{t.d(r,{T:()=>i});t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js");var n=t("./.yarn/__virtual__/@emotion-css-virtual-72c314ddb1/3/opt/drone/yarncache/@emotion-css-npm-11.7.1-25ff8755a7-ac1f56656f.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),o=t("./packages/grafana-ui/src/index.ts"),a=t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/jsx-runtime.js");const i=e=>{const r=(0,o.useTheme2)(),t=s(r,e);return(0,a.jsx)("span",{className:(0,n.cx)(t.wrapper)})};i.defaultProps={v:0,h:0,layout:"block"};const s=(0,o.stylesFactory)(((e,r)=>{var t,o;return{wrapper:(0,n.css)([{paddingRight:e.spacing(null!==(t=r.h)&&void 0!==t?t:0),paddingBottom:e.spacing(null!==(o=r.v)&&void 0!==o?o:0)},"inline"===r.layout&&{display:"inline-block"},"block"===r.layout&&{display:"block"}])}}))},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/deprecated/utils.tsx":(e,r,t)=>{t.d(r,{C:()=>a,z:()=>i});var n=t("./packages/grafana-runtime/src/index.ts"),o=t("../../opt/drone/yarncache/semver-npm-7.3.5-618cf5db6a-5eafe6102b.zip/node_modules/semver/index.js");function a(e){return!(!e.jsonData.appInsightsAppId||!e.secureJsonFields.appInsightsApiKey)}function i(){return(0,o.valid)(n.config.buildInfo.version)&&(0,o.gt)(n.config.buildInfo.version,"9.0.0-beta1")}},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/time_grain_converter.ts":(e,r,t)=>{t.d(r,{Z:()=>a});var n=t("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),o=t("./packages/grafana-data/src/index.ts");class a{static createISO8601Duration(e,r){return(0,n.includes)(["hour","minute","h","m"],r)?`PT${e}${r[0].toUpperCase()}`:`P${e}${r[0].toUpperCase()}`}static createISO8601DurationFromInterval(e){const r=+e.slice(0,e.length-1),t=e[e.length-1];if(e.indexOf("ms")>-1)return a.createISO8601Duration(1,"m");if("s"===e[e.length-1]){let e=60*r%60;return e<1&&(e=1),a.createISO8601Duration(e,"m")}return a.createISO8601Duration(r,t)}static findClosestTimeGrain(e,r){const t=(0,n.filter)(r,(e=>"auto"!==e));let a=t[0];const i=o.rangeUtil.intervalToMs(e);for(let e=0;e<t.length;e++)i>o.rangeUtil.intervalToMs(t[e])&&(a=e+1<t.length?t[e+1]:t[e]);return a}static createTimeGrainFromISO8601Duration(e){let r=1;"PT"===e.substring(0,2)&&(r=2);const t=e.substring(r,e.length-1),n=e.substring(e.length-1);return t+" "+a.timeUnitToText(+t,n)}static timeUnitToText(e,r){let t="";return"S"===r&&(t="second"),"M"===r&&(t="minute"),"H"===r&&(t="hour"),"D"===r&&(t="day"),e>1?t+"s":t}static createKbnUnitFromISO8601Duration(e){if("auto"===e)return"auto";let r=1;"PT"===e.substring(0,2)&&(r=2);const t=e.substring(r,e.length-1),n=e.substring(e.length-1);return t+a.timeUnitToKbn(+t,n)}static timeUnitToKbn(e,r){return"S"===r?"s":"M"===r?"m":"H"===r?"h":"D"===r?"d":""}}},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/types/index.ts":(e,r,t)=>{let n,o,a;t.d(r,{_v:()=>a,Bj:()=>n,H0:()=>o}),function(e){e.AzureMonitor="Azure Monitor",e.LogAnalytics="Azure Log Analytics",e.AzureResourceGraph="Azure Resource Graph",e.GrafanaTemplateVariableFn="Grafana Template Variable Function"}(n||(n={})),function(e){e.ApplicationInsights="Application Insights",e.InsightsAnalytics="Insights Analytics"}(o||(o={})),function(e){e.Public="AzureCloud",e.China="AzureChinaCloud",e.USGovernment="AzureUSGovernment",e.Germany="AzureGermanCloud",e.None=""}(a||(a={}))},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/utils/common.ts":(e,r,t)=>{t.d(r,{Er:()=>i,Gq:()=>o,Ll:()=>u,b9:()=>a,kr:()=>s});var n=t("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js");t("./packages/grafana-data/src/index.ts"),t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/time_grain_converter.ts");const o=(e,r)=>e.some((e=>e.options?o(e.options,r):e.value===r)),a=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===r.length)return[];const t=r.reduce(((e,r)=>(e.add(r),e)),new Set);return e.filter((e=>t.has(e.value)))},i=e=>({value:e.value,label:e.text});const s={azureMonitor:"azuremonitor",logAnalytics:"loganalytics",appInsights:"appinsights",resourceGraph:"resourcegraph"};function u(e,r){if("string"==typeof e)return r.multi||r.includeAll?"'"+e+"'":e;if("number"==typeof e)return e;return(0,n.map)(e,(r=>"number"==typeof e?e:"'"+r+"'")).join(",")}},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/utils/migrateQuery.ts":(e,r,t)=>{t.d(r,{N:()=>l,Z:()=>u});var n=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/LogsQueryEditor/setQueryValue.ts"),o=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/components/MetricsQueryEditor/setQueryValue.ts"),a=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/time_grain_converter.ts"),i=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/types/index.ts");const s="select";function u(e){let r=e;return r=function(e){var r,t;let n=e;if(null!==(r=n.azureMonitor)&&void 0!==r&&r.timeGrainUnit&&"auto"!==n.azureMonitor.timeGrain){var i,s;const e=a.Z.createISO8601Duration(null!==(i=n.azureMonitor.timeGrain)&&void 0!==i?i:"auto",n.azureMonitor.timeGrainUnit);n=(0,o.zB)(n,e),null===(s=n.azureMonitor)||void 0===s||delete s.timeGrainUnit}if(null!==(t=n.appInsights)&&void 0!==t&&t.timeGrainUnit&&"auto"!==n.appInsights.timeGrain){const e=Object.assign({},n.appInsights);n.appInsights.timeGrainCount?e.timeGrain=a.Z.createISO8601Duration(n.appInsights.timeGrainCount,n.appInsights.timeGrainUnit):(e.timeGrainCount=n.appInsights.timeGrain,n.appInsights.timeGrain&&(e.timeGrain=a.Z.createISO8601Duration(n.appInsights.timeGrain,n.appInsights.timeGrainUnit))),n=Object.assign({},n,{appInsights:e})}return n}(r),r=function(e){var r,t,o,a;let i=e;null!==(r=i.azureLogAnalytics)&&void 0!==r&&null!==(t=r.query)&&void 0!==t&&t.match(/\$__from\s/gi)&&(i=(0,n.J3)(i,i.azureLogAnalytics.query.replace(/\$__from\s/gi,"$__timeFrom() ")));null!==(o=i.azureLogAnalytics)&&void 0!==o&&null!==(a=o.query)&&void 0!==a&&a.match(/\$__to\s/gi)&&(i=(0,n.J3)(i,i.azureLogAnalytics.query.replace(/\$__to\s/gi,"$__timeTo() ")));return i}(r),r=function(e){var r,t;if((!(null===(r=e.azureMonitor)||void 0===r?void 0:r.metricNamespace)||e.azureMonitor.metricNamespace===s)&&null!==(t=e.azureMonitor)&&void 0!==t&&t.metricDefinition)return Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricNamespace:e.azureMonitor.metricDefinition})});return e}(r),r=function(e){var r;const t=null==e||null===(r=e.appInsights)||void 0===r?void 0:r.dimension;if(t&&"string"==typeof t)return Object.assign({},e,{appInsights:Object.assign({},e.appInsights,{dimension:[t]})});return e}(r),r=c(r),r}function c(e){var r;let t=e;const n=null===(r=t.azureMonitor)||void 0===r?void 0:r.dimension;var a;n&&"None"!==n&&(t=(0,o.d2)(t,n,"eq",null===(a=t.azureMonitor)||void 0===a?void 0:a.dimensionFilter));return t}function l(e){var r;let t=e;return t.queryType===i.H0.ApplicationInsights&&null!==(r=t.appInsights)&&void 0!==r&&r.rawQuery&&(t=Object.assign({},t,{queryType:i.H0.InsightsAnalytics,appInsights:void 0,insightsAnalytics:{query:t.appInsights.rawQuery,resultFormat:"time_series"}})),t.queryType||(t=Object.assign({},t,{queryType:i.Bj.AzureMonitor})),t.queryType===i.Bj.AzureMonitor&&t.azureMonitor&&(t=c(t)),t}},"./public/app/plugins/datasource/grafana-azure-monitor-datasource/utils/useLastError.ts":(e,r,t)=>{t.d(r,{Z:()=>a});var n=t("../../opt/drone/yarncache/react-npm-17.0.2-99ba37d931-b254cc17ce.zip/node_modules/react/index.js"),o=t("./public/app/plugins/datasource/grafana-azure-monitor-datasource/utils/messageFromError.ts");function a(){const[e,r]=(0,n.useState)([]),t=(0,n.useCallback)(((e,t)=>{r((r=>{const n=[...r],o=r.findIndex((r=>{let[t]=r;return t===e}));return o>-1&&n.splice(o,1),t&&n.unshift([e,t]),n}))}),[]);return[(0,n.useMemo)((()=>{const r=e[0];return r&&(0,o.Z)(r[1])}),[e]),t]}},"../../opt/drone/yarncache/immer-npm-9.0.12-e8cd7358fa-bcbec6d76d.zip/node_modules/immer/dist/immer.esm.js":(e,r,t)=>{function n(e){for(var r=arguments.length,t=Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(t.length?" "+t.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function o(e){return!!e&&!!e[$]}function a(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var r=Object.getPrototypeOf(e);if(null===r)return!0;var t=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return t===Object||"function"==typeof t&&Function.toString.call(t)===V}(e)||Array.isArray(e)||!!e[U]||!!e.constructor[U]||p(e)||g(e))}function i(e,r,t){void 0===t&&(t=!1),0===s(e)?(t?Object.keys:K)(e).forEach((function(n){t&&"symbol"==typeof n||r(n,e[n],e)})):e.forEach((function(t,n){return r(n,t,e)}))}function s(e){var r=e[$];return r?r.i>3?r.i-4:r.i:Array.isArray(e)?1:p(e)?2:g(e)?3:0}function u(e,r){return 2===s(e)?e.has(r):Object.prototype.hasOwnProperty.call(e,r)}function c(e,r){return 2===s(e)?e.get(r):e[r]}function l(e,r,t){var n=s(e);2===n?e.set(r,t):3===n?(e.delete(r),e.add(t)):e[r]=t}function d(e,r){return e===r?0!==e||1/e==1/r:e!=e&&r!=r}function p(e){return _&&e instanceof Map}function g(e){return L&&e instanceof Set}function m(e){return e.o||e.t}function v(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var r=Z(e);delete r[$];for(var t=K(r),n=0;n<t.length;n++){var o=t[n],a=r[o];!1===a.writable&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(r[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),r)}function h(e,r){return void 0===r&&(r=!1),f(e)||o(e)||!a(e)||(s(e)>1&&(e.set=e.add=e.clear=e.delete=b),Object.freeze(e),r&&i(e,(function(e,r){return h(r,!0)}),!0)),e}function b(){n(2)}function f(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function y(e){var r=H[e];return r||n(18,e),r}function j(){return P}function x(e,r){r&&(y("Patches"),e.u=[],e.s=[],e.v=r)}function z(e){I(e),e.p.forEach(C),e.p=null}function I(e){e===P&&(P=e.l)}function w(e){return P={p:[],l:P,h:e,m:!0,_:0}}function C(e){var r=e[$];0===r.i||1===r.i?r.j():r.O=!0}function O(e,r){r._=r.p.length;var t=r.p[0],o=void 0!==e&&e!==t;return r.h.g||y("ES5").S(r,e,o),o?(t[$].P&&(z(r),n(4)),a(e)&&(e=M(r,e),r.l||S(r,e)),r.u&&y("Patches").M(t[$].t,e,r.u,r.s)):e=M(r,t,[]),z(r),r.u&&r.v(r.u,r.s),e!==B?e:void 0}function M(e,r,t){if(f(r))return r;var n=r[$];if(!n)return i(r,(function(o,a){return G(e,n,r,o,a,t)}),!0),r;if(n.A!==e)return r;if(!n.P)return S(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var o=4===n.i||5===n.i?n.o=v(n.k):n.o;i(3===n.i?new Set(o):o,(function(r,a){return G(e,n,o,r,a,t)})),S(e,o,!1),t&&e.u&&y("Patches").R(n,t,e.u,e.s)}return n.o}function G(e,r,t,n,i,s){if(o(i)){var c=M(e,i,s&&r&&3!==r.i&&!u(r.D,n)?s.concat(n):void 0);if(l(t,n,c),!o(c))return;e.m=!1}if(a(i)&&!f(i)){if(!e.h.F&&e._<1)return;M(e,i),r&&r.A.l||S(e,i)}}function S(e,r,t){void 0===t&&(t=!1),e.h.F&&e.m&&h(r,t)}function A(e,r){var t=e[$];return(t?m(t):e)[r]}function k(e,r){if(r in e)for(var t=Object.getPrototypeOf(e);t;){var n=Object.getOwnPropertyDescriptor(t,r);if(n)return n;t=Object.getPrototypeOf(t)}}function q(e){e.P||(e.P=!0,e.l&&q(e.l))}function N(e){e.o||(e.o=v(e.t))}function E(e,r,t){var n=p(r)?y("MapSet").N(r,t):g(r)?y("MapSet").T(r,t):e.g?function(e,r){var t=Array.isArray(e),n={i:t?1:0,A:r?r.A:j(),P:!1,I:!1,D:{},l:r,t:e,k:null,o:null,j:null,C:!1},o=n,a=J;t&&(o=[n],a=W);var i=Proxy.revocable(o,a),s=i.revoke,u=i.proxy;return n.k=u,n.j=s,u}(r,t):y("ES5").J(r,t);return(t?t.A:j()).p.push(n),n}function T(e){return o(e)||n(22,e),function e(r){if(!a(r))return r;var t,n=r[$],o=s(r);if(n){if(!n.P&&(n.i<4||!y("ES5").K(n)))return n.t;n.I=!0,t=R(r,o),n.I=!1}else t=R(r,o);return i(t,(function(r,o){n&&c(n.t,r)===o||l(t,r,e(o))})),3===o?new Set(t):t}(e)}function R(e,r){switch(r){case 2:return new Map(e);case 3:return Array.from(e)}return v(e)}t.d(r,{ZP:()=>re});var F,P,D="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),_="undefined"!=typeof Map,L="undefined"!=typeof Set,Q="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,B=D?Symbol.for("immer-nothing"):((F={})["immer-nothing"]=!0,F),U=D?Symbol.for("immer-draftable"):"__$immer_draftable",$=D?Symbol.for("immer-state"):"__$immer_state",V=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),K="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Z=Object.getOwnPropertyDescriptors||function(e){var r={};return K(e).forEach((function(t){r[t]=Object.getOwnPropertyDescriptor(e,t)})),r},H={},J={get:function(e,r){if(r===$)return e;var t=m(e);if(!u(t,r))return function(e,r,t){var n,o=k(r,t);return o?"value"in o?o.value:null===(n=o.get)||void 0===n?void 0:n.call(e.k):void 0}(e,t,r);var n=t[r];return e.I||!a(n)?n:n===A(e.t,r)?(N(e),e.o[r]=E(e.A.h,n,e)):n},has:function(e,r){return r in m(e)},ownKeys:function(e){return Reflect.ownKeys(m(e))},set:function(e,r,t){var n=k(m(e),r);if(null==n?void 0:n.set)return n.set.call(e.k,t),!0;if(!e.P){var o=A(m(e),r),a=null==o?void 0:o[$];if(a&&a.t===t)return e.o[r]=t,e.D[r]=!1,!0;if(d(t,o)&&(void 0!==t||u(e.t,r)))return!0;N(e),q(e)}return e.o[r]===t&&"number"!=typeof t&&(void 0!==t||r in e.o)||(e.o[r]=t,e.D[r]=!0,!0)},deleteProperty:function(e,r){return void 0!==A(e.t,r)||r in e.t?(e.D[r]=!1,N(e),q(e)):delete e.D[r],e.o&&delete e.o[r],!0},getOwnPropertyDescriptor:function(e,r){var t=m(e),n=Reflect.getOwnPropertyDescriptor(t,r);return n?{writable:!0,configurable:1!==e.i||"length"!==r,enumerable:n.enumerable,value:t[r]}:n},defineProperty:function(){n(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){n(12)}},W={};i(J,(function(e,r){W[e]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}})),W.deleteProperty=function(e,r){return W.set.call(this,e,r,void 0)},W.set=function(e,r,t){return J.set.call(this,e[0],r,t,e[0])};var X=function(){function e(e){var r=this;this.g=Q,this.F=!0,this.produce=function(e,t,o){if("function"==typeof e&&"function"!=typeof t){var i=t;t=e;var s=r;return function(e){var r=this;void 0===e&&(e=i);for(var n=arguments.length,o=Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return s.produce(e,(function(e){var n;return(n=t).call.apply(n,[r,e].concat(o))}))}}var u;if("function"!=typeof t&&n(6),void 0!==o&&"function"!=typeof o&&n(7),a(e)){var c=w(r),l=E(r,e,void 0),d=!0;try{u=t(l),d=!1}finally{d?z(c):I(c)}return"undefined"!=typeof Promise&&u instanceof Promise?u.then((function(e){return x(c,o),O(e,c)}),(function(e){throw z(c),e})):(x(c,o),O(u,c))}if(!e||"object"!=typeof e){if(void 0===(u=t(e))&&(u=e),u===B&&(u=void 0),r.F&&h(u,!0),o){var p=[],g=[];y("Patches").M(e,u,p,g),o(p,g)}return u}n(21,e)},this.produceWithPatches=function(e,t){if("function"==typeof e)return function(t){for(var n=arguments.length,o=Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return r.produceWithPatches(t,(function(r){return e.apply(void 0,[r].concat(o))}))};var n,o,a=r.produce(e,t,(function(e,r){n=e,o=r}));return"undefined"!=typeof Promise&&a instanceof Promise?a.then((function(e){return[e,n,o]})):[a,n,o]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var r=e.prototype;return r.createDraft=function(e){a(e)||n(8),o(e)&&(e=T(e));var r=w(this),t=E(this,e,void 0);return t[$].C=!0,I(r),t},r.finishDraft=function(e,r){var t=(e&&e[$]).A;return x(t,r),O(void 0,t)},r.setAutoFreeze=function(e){this.F=e},r.setUseProxies=function(e){e&&!Q&&n(20),this.g=e},r.applyPatches=function(e,r){var t;for(t=r.length-1;t>=0;t--){var n=r[t];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}t>-1&&(r=r.slice(t+1));var a=y("Patches").$;return o(e)?a(e,r):this.produce(e,(function(e){return a(e,r)}))},e}(),Y=new X,ee=Y.produce;Y.produceWithPatches.bind(Y),Y.setAutoFreeze.bind(Y),Y.setUseProxies.bind(Y),Y.applyPatches.bind(Y),Y.createDraft.bind(Y),Y.finishDraft.bind(Y);const re=ee}}]);
//# sourceMappingURL=8881.15718e8e3083449662a7.js.map